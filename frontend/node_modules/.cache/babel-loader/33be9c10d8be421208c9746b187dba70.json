{"ast":null,"code":"/*!\n * FilePondPluginImageTransform 3.8.7\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define(factory) : (global = global || self, global.FilePondPluginImageTransform = factory());\n})(this, function () {\n  'use strict'; // test if file is of type image\n\n  var isImage = function isImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n    return name.substr(0, name.lastIndexOf('.')) || name;\n  }; // only handles image/jpg, image/jpeg, image/png, and image/svg+xml for now\n\n\n  var ExtensionMap = {\n    jpeg: 'jpg',\n    'svg+xml': 'svg'\n  };\n\n  var renameFileToMatchMimeType = function renameFileToMatchMimeType(filename, mimeType) {\n    var name = getFilenameWithoutExtension(filename);\n    var type = mimeType.split('/')[1];\n    var extension = ExtensionMap[type] || type;\n    return ''.concat(name, '.').concat(extension);\n  }; // returns all the valid output formats we can encode towards\n\n\n  var getValidOutputMimeType = function getValidOutputMimeType(type) {\n    return /jpeg|png|svg\\+xml/.test(type) ? type : 'image/jpeg';\n  }; // test if file is of type image\n\n\n  var isImage$1 = function isImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  var MATRICES = {\n    1: function _() {\n      return [1, 0, 0, 1, 0, 0];\n    },\n    2: function _(width) {\n      return [-1, 0, 0, 1, width, 0];\n    },\n    3: function _(width, height) {\n      return [-1, 0, 0, -1, width, height];\n    },\n    4: function _(width, height) {\n      return [1, 0, 0, -1, 0, height];\n    },\n    5: function _() {\n      return [0, 1, 1, 0, 0, 0];\n    },\n    6: function _(width, height) {\n      return [0, 1, -1, 0, height, 0];\n    },\n    7: function _(width, height) {\n      return [0, -1, -1, 0, height, width];\n    },\n    8: function _(width) {\n      return [0, -1, 1, 0, 0, width];\n    }\n  };\n\n  var getImageOrientationMatrix = function getImageOrientationMatrix(width, height, orientation) {\n    if (orientation === -1) {\n      orientation = 1;\n    }\n\n    return MATRICES[orientation](width, height);\n  };\n\n  var createVector = function createVector(x, y) {\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var vectorDot = function vectorDot(a, b) {\n    return a.x * b.x + a.y * b.y;\n  };\n\n  var vectorSubtract = function vectorSubtract(a, b) {\n    return createVector(a.x - b.x, a.y - b.y);\n  };\n\n  var vectorDistanceSquared = function vectorDistanceSquared(a, b) {\n    return vectorDot(vectorSubtract(a, b), vectorSubtract(a, b));\n  };\n\n  var vectorDistance = function vectorDistance(a, b) {\n    return Math.sqrt(vectorDistanceSquared(a, b));\n  };\n\n  var getOffsetPointOnEdge = function getOffsetPointOnEdge(length, rotation) {\n    var a = length;\n    var A = 1.5707963267948966;\n    var B = rotation;\n    var C = 1.5707963267948966 - rotation;\n    var sinA = Math.sin(A);\n    var sinB = Math.sin(B);\n    var sinC = Math.sin(C);\n    var cosC = Math.cos(C);\n    var ratio = a / sinA;\n    var b = ratio * sinB;\n    var c = ratio * sinC;\n    return createVector(cosC * b, cosC * c);\n  };\n\n  var getRotatedRectSize = function getRotatedRectSize(rect, rotation) {\n    var w = rect.width;\n    var h = rect.height;\n    var hor = getOffsetPointOnEdge(w, rotation);\n    var ver = getOffsetPointOnEdge(h, rotation);\n    var tl = createVector(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));\n    var tr = createVector(rect.x + rect.width + Math.abs(ver.y), rect.y + Math.abs(ver.x));\n    var bl = createVector(rect.x - Math.abs(ver.y), rect.y + rect.height - Math.abs(ver.x));\n    return {\n      width: vectorDistance(tl, tr),\n      height: vectorDistance(tl, bl)\n    };\n  };\n\n  var getImageRectZoomFactor = function getImageRectZoomFactor(imageRect, cropRect) {\n    var rotation = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var center = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n      x: 0.5,\n      y: 0.5\n    }; // calculate available space round image center position\n\n    var cx = center.x > 0.5 ? 1 - center.x : center.x;\n    var cy = center.y > 0.5 ? 1 - center.y : center.y;\n    var imageWidth = cx * 2 * imageRect.width;\n    var imageHeight = cy * 2 * imageRect.height; // calculate rotated crop rectangle size\n\n    var rotatedCropSize = getRotatedRectSize(cropRect, rotation);\n    return Math.max(rotatedCropSize.width / imageWidth, rotatedCropSize.height / imageHeight);\n  };\n\n  var getCenteredCropRect = function getCenteredCropRect(container, aspectRatio) {\n    var width = container.width;\n    var height = width * aspectRatio;\n\n    if (height > container.height) {\n      height = container.height;\n      width = height / aspectRatio;\n    }\n\n    var x = (container.width - width) * 0.5;\n    var y = (container.height - height) * 0.5;\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height\n    };\n  };\n\n  var calculateCanvasSize = function calculateCanvasSize(image, canvasAspectRatio) {\n    var zoom = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var imageAspectRatio = image.height / image.width; // determine actual pixels on x and y axis\n\n    var canvasWidth = 1;\n    var canvasHeight = canvasAspectRatio;\n    var imgWidth = 1;\n    var imgHeight = imageAspectRatio;\n\n    if (imgHeight > canvasHeight) {\n      imgHeight = canvasHeight;\n      imgWidth = imgHeight / imageAspectRatio;\n    }\n\n    var scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);\n    var width = image.width / (zoom * scalar * imgWidth);\n    var height = width * canvasAspectRatio;\n    return {\n      width: width,\n      height: height\n    };\n  };\n\n  var canvasRelease = function canvasRelease(canvas) {\n    canvas.width = 1;\n    canvas.height = 1;\n    var ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, 1, 1);\n  };\n\n  var isFlipped = function isFlipped(flip) {\n    return flip && (flip.horizontal || flip.vertical);\n  };\n\n  var getBitmap = function getBitmap(image, orientation, flip) {\n    if (orientation <= 1 && !isFlipped(flip)) {\n      image.width = image.naturalWidth;\n      image.height = image.naturalHeight;\n      return image;\n    }\n\n    var canvas = document.createElement('canvas');\n    var width = image.naturalWidth;\n    var height = image.naturalHeight; // if is rotated incorrectly swap width and height\n\n    var swapped = orientation >= 5 && orientation <= 8;\n\n    if (swapped) {\n      canvas.width = height;\n      canvas.height = width;\n    } else {\n      canvas.width = width;\n      canvas.height = height;\n    } // draw the image but first fix orientation and set correct flip\n\n\n    var ctx = canvas.getContext('2d'); // get base transformation matrix\n\n    if (orientation) {\n      ctx.transform.apply(ctx, getImageOrientationMatrix(width, height, orientation));\n    }\n\n    if (isFlipped(flip)) {\n      // flip horizontal\n      // [-1, 0, 0, 1, width, 0]\n      var matrix = [1, 0, 0, 1, 0, 0];\n\n      if (!swapped && flip.horizontal || swapped & flip.vertical) {\n        matrix[0] = -1;\n        matrix[4] = width;\n      } // flip vertical\n      // [1, 0, 0, -1, 0, height]\n\n\n      if (!swapped && flip.vertical || swapped && flip.horizontal) {\n        matrix[3] = -1;\n        matrix[5] = height;\n      }\n\n      ctx.transform.apply(ctx, matrix);\n    }\n\n    ctx.drawImage(image, 0, 0, width, height);\n    return canvas;\n  };\n\n  var imageToImageData = function imageToImageData(imageElement, orientation) {\n    var crop = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    var canvasMemoryLimit = options.canvasMemoryLimit,\n        _options$background = options.background,\n        background = _options$background === void 0 ? null : _options$background;\n    var zoom = crop.zoom || 1; // fixes possible image orientation problems by drawing the image on the correct canvas\n\n    var bitmap = getBitmap(imageElement, orientation, crop.flip);\n    var imageSize = {\n      width: bitmap.width,\n      height: bitmap.height\n    };\n    var aspectRatio = crop.aspectRatio || imageSize.height / imageSize.width;\n    var canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n\n    if (canvasMemoryLimit) {\n      var requiredMemory = canvasSize.width * canvasSize.height;\n\n      if (requiredMemory > canvasMemoryLimit) {\n        var scalar = Math.sqrt(canvasMemoryLimit) / Math.sqrt(requiredMemory);\n        imageSize.width = Math.floor(imageSize.width * scalar);\n        imageSize.height = Math.floor(imageSize.height * scalar);\n        canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n      }\n    }\n\n    var canvas = document.createElement('canvas');\n    var canvasCenter = {\n      x: canvasSize.width * 0.5,\n      y: canvasSize.height * 0.5\n    };\n    var stage = {\n      x: 0,\n      y: 0,\n      width: canvasSize.width,\n      height: canvasSize.height,\n      center: canvasCenter\n    };\n    var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n    var scale = zoom * getImageRectZoomFactor(imageSize, getCenteredCropRect(stage, aspectRatio), crop.rotation, shouldLimit ? crop.center : {\n      x: 0.5,\n      y: 0.5\n    }); // start drawing\n\n    canvas.width = Math.round(canvasSize.width / scale);\n    canvas.height = Math.round(canvasSize.height / scale);\n    canvasCenter.x /= scale;\n    canvasCenter.y /= scale;\n    var imageOffset = {\n      x: canvasCenter.x - imageSize.width * (crop.center ? crop.center.x : 0.5),\n      y: canvasCenter.y - imageSize.height * (crop.center ? crop.center.y : 0.5)\n    };\n    var ctx = canvas.getContext('2d');\n\n    if (background) {\n      ctx.fillStyle = background;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    } // move to draw offset\n\n\n    ctx.translate(canvasCenter.x, canvasCenter.y);\n    ctx.rotate(crop.rotation || 0); // draw the image\n\n    ctx.drawImage(bitmap, imageOffset.x - canvasCenter.x, imageOffset.y - canvasCenter.y, imageSize.width, imageSize.height); // get data from canvas\n\n    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height); // release canvas\n\n    canvasRelease(canvas); // return data\n\n    return imageData;\n  };\n  /**\n   * Polyfill toBlob for Edge\n   */\n\n\n  var IS_BROWSER = function () {\n    return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  }();\n\n  if (IS_BROWSER) {\n    if (!HTMLCanvasElement.prototype.toBlob) {\n      Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n        value: function value(callback, type, quality) {\n          var dataURL = this.toDataURL(type, quality).split(',')[1];\n          setTimeout(function () {\n            var binStr = atob(dataURL);\n            var len = binStr.length;\n            var arr = new Uint8Array(len);\n\n            for (var i = 0; i < len; i++) {\n              arr[i] = binStr.charCodeAt(i);\n            }\n\n            callback(new Blob([arr], {\n              type: type || 'image/png'\n            }));\n          });\n        }\n      });\n    }\n  }\n\n  var canvasToBlob = function canvasToBlob(canvas, options) {\n    var beforeCreateBlob = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    return new Promise(function (resolve) {\n      var promisedImage = beforeCreateBlob ? beforeCreateBlob(canvas) : canvas;\n      Promise.resolve(promisedImage).then(function (canvas) {\n        canvas.toBlob(resolve, options.type, options.quality);\n      });\n    });\n  };\n\n  var vectorMultiply = function vectorMultiply(v, amount) {\n    return createVector$1(v.x * amount, v.y * amount);\n  };\n\n  var vectorAdd = function vectorAdd(a, b) {\n    return createVector$1(a.x + b.x, a.y + b.y);\n  };\n\n  var vectorNormalize = function vectorNormalize(v) {\n    var l = Math.sqrt(v.x * v.x + v.y * v.y);\n\n    if (l === 0) {\n      return {\n        x: 0,\n        y: 0\n      };\n    }\n\n    return createVector$1(v.x / l, v.y / l);\n  };\n\n  var vectorRotate = function vectorRotate(v, radians, origin) {\n    var cos = Math.cos(radians);\n    var sin = Math.sin(radians);\n    var t = createVector$1(v.x - origin.x, v.y - origin.y);\n    return createVector$1(origin.x + cos * t.x - sin * t.y, origin.y + sin * t.x + cos * t.y);\n  };\n\n  var createVector$1 = function createVector() {\n    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var getMarkupValue = function getMarkupValue(value, size) {\n    var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var axis = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (typeof value === 'string') {\n      return parseFloat(value) * scalar;\n    }\n\n    if (typeof value === 'number') {\n      return value * (axis ? size[axis] : Math.min(size.width, size.height));\n    }\n\n    return;\n  };\n\n  var getMarkupStyles = function getMarkupStyles(markup, size, scale) {\n    var lineStyle = markup.borderStyle || markup.lineStyle || 'solid';\n    var fill = markup.backgroundColor || markup.fontColor || 'transparent';\n    var stroke = markup.borderColor || markup.lineColor || 'transparent';\n    var strokeWidth = getMarkupValue(markup.borderWidth || markup.lineWidth, size, scale);\n    var lineCap = markup.lineCap || 'round';\n    var lineJoin = markup.lineJoin || 'round';\n    var dashes = typeof lineStyle === 'string' ? '' : lineStyle.map(function (v) {\n      return getMarkupValue(v, size, scale);\n    }).join(',');\n    var opacity = markup.opacity || 1;\n    return {\n      'stroke-linecap': lineCap,\n      'stroke-linejoin': lineJoin,\n      'stroke-width': strokeWidth || 0,\n      'stroke-dasharray': dashes,\n      stroke: stroke,\n      fill: fill,\n      opacity: opacity\n    };\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  };\n\n  var getMarkupRect = function getMarkupRect(rect, size) {\n    var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var left = getMarkupValue(rect.x, size, scalar, 'width') || getMarkupValue(rect.left, size, scalar, 'width');\n    var top = getMarkupValue(rect.y, size, scalar, 'height') || getMarkupValue(rect.top, size, scalar, 'height');\n    var width = getMarkupValue(rect.width, size, scalar, 'width');\n    var height = getMarkupValue(rect.height, size, scalar, 'height');\n    var right = getMarkupValue(rect.right, size, scalar, 'width');\n    var bottom = getMarkupValue(rect.bottom, size, scalar, 'height');\n\n    if (!isDefined(top)) {\n      if (isDefined(height) && isDefined(bottom)) {\n        top = size.height - height - bottom;\n      } else {\n        top = bottom;\n      }\n    }\n\n    if (!isDefined(left)) {\n      if (isDefined(width) && isDefined(right)) {\n        left = size.width - width - right;\n      } else {\n        left = right;\n      }\n    }\n\n    if (!isDefined(width)) {\n      if (isDefined(left) && isDefined(right)) {\n        width = size.width - left - right;\n      } else {\n        width = 0;\n      }\n    }\n\n    if (!isDefined(height)) {\n      if (isDefined(top) && isDefined(bottom)) {\n        height = size.height - top - bottom;\n      } else {\n        height = 0;\n      }\n    }\n\n    return {\n      x: left || 0,\n      y: top || 0,\n      width: width || 0,\n      height: height || 0\n    };\n  };\n\n  var pointsToPathShape = function pointsToPathShape(points) {\n    return points.map(function (point, index) {\n      return ''.concat(index === 0 ? 'M' : 'L', ' ').concat(point.x, ' ').concat(point.y);\n    }).join(' ');\n  };\n\n  var setAttributes = function setAttributes(element, attr) {\n    return Object.keys(attr).forEach(function (key) {\n      return element.setAttribute(key, attr[key]);\n    });\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n\n  var svg = function svg(tag, attr) {\n    var element = document.createElementNS(ns, tag);\n\n    if (attr) {\n      setAttributes(element, attr);\n    }\n\n    return element;\n  };\n\n  var updateRect = function updateRect(element) {\n    return setAttributes(element, Object.assign({}, element.rect, element.styles));\n  };\n\n  var updateEllipse = function updateEllipse(element) {\n    var cx = element.rect.x + element.rect.width * 0.5;\n    var cy = element.rect.y + element.rect.height * 0.5;\n    var rx = element.rect.width * 0.5;\n    var ry = element.rect.height * 0.5;\n    return setAttributes(element, Object.assign({\n      cx: cx,\n      cy: cy,\n      rx: rx,\n      ry: ry\n    }, element.styles));\n  };\n\n  var IMAGE_FIT_STYLE = {\n    contain: 'xMidYMid meet',\n    cover: 'xMidYMid slice'\n  };\n\n  var updateImage = function updateImage(element, markup) {\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      preserveAspectRatio: IMAGE_FIT_STYLE[markup.fit] || 'none'\n    }));\n  };\n\n  var TEXT_ANCHOR = {\n    left: 'start',\n    center: 'middle',\n    right: 'end'\n  };\n\n  var updateText = function updateText(element, markup, size, scale) {\n    var fontSize = getMarkupValue(markup.fontSize, size, scale);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = TEXT_ANCHOR[markup.textAlign] || 'start';\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      'stroke-width': 0,\n      'font-weight': fontWeight,\n      'font-size': fontSize,\n      'font-family': fontFamily,\n      'text-anchor': textAlign\n    })); // update text\n\n    if (element.text !== markup.text) {\n      element.text = markup.text;\n      element.textContent = markup.text.length ? markup.text : ' ';\n    }\n  };\n\n  var updateLine = function updateLine(element, markup, size, scale) {\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      fill: 'none'\n    }));\n    var line = element.childNodes[0];\n    var begin = element.childNodes[1];\n    var end = element.childNodes[2];\n    var origin = element.rect;\n    var target = {\n      x: element.rect.x + element.rect.width,\n      y: element.rect.y + element.rect.height\n    };\n    setAttributes(line, {\n      x1: origin.x,\n      y1: origin.y,\n      x2: target.x,\n      y2: target.y\n    });\n    if (!markup.lineDecoration) return;\n    begin.style.display = 'none';\n    end.style.display = 'none';\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n    var l = getMarkupValue(0.05, size, scale);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n      setAttributes(begin, {\n        style: 'display:block;',\n        d: 'M'.concat(arrowBeginA.x, ',').concat(arrowBeginA.y, ' L').concat(origin.x, ',').concat(origin.y, ' L').concat(arrowBeginB.x, ',').concat(arrowBeginB.y)\n      });\n    }\n\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n      setAttributes(end, {\n        style: 'display:block;',\n        d: 'M'.concat(arrowEndA.x, ',').concat(arrowEndA.y, ' L').concat(target.x, ',').concat(target.y, ' L').concat(arrowEndB.x, ',').concat(arrowEndB.y)\n      });\n    }\n  };\n\n  var updatePath = function updatePath(element, markup, size, scale) {\n    setAttributes(element, Object.assign({}, element.styles, {\n      fill: 'none',\n      d: pointsToPathShape(markup.points.map(function (point) {\n        return {\n          x: getMarkupValue(point.x, size, scale, 'width'),\n          y: getMarkupValue(point.y, size, scale, 'height')\n        };\n      }))\n    }));\n  };\n\n  var createShape = function createShape(node) {\n    return function (markup) {\n      return svg(node, {\n        id: markup.id\n      });\n    };\n  };\n\n  var createImage = function createImage(markup) {\n    var shape = svg('image', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round',\n      opacity: '0'\n    });\n\n    shape.onload = function () {\n      shape.setAttribute('opacity', markup.opacity || 1);\n    };\n\n    shape.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', markup.src);\n    return shape;\n  };\n\n  var createLine = function createLine(markup) {\n    var shape = svg('g', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round'\n    });\n    var line = svg('line');\n    shape.appendChild(line);\n    var begin = svg('path');\n    shape.appendChild(begin);\n    var end = svg('path');\n    shape.appendChild(end);\n    return shape;\n  };\n\n  var CREATE_TYPE_ROUTES = {\n    image: createImage,\n    rect: createShape('rect'),\n    ellipse: createShape('ellipse'),\n    text: createShape('text'),\n    path: createShape('path'),\n    line: createLine\n  };\n  var UPDATE_TYPE_ROUTES = {\n    rect: updateRect,\n    ellipse: updateEllipse,\n    image: updateImage,\n    text: updateText,\n    path: updatePath,\n    line: updateLine\n  };\n\n  var createMarkupByType = function createMarkupByType(type, markup) {\n    return CREATE_TYPE_ROUTES[type](markup);\n  };\n\n  var updateMarkupByType = function updateMarkupByType(element, type, markup, size, scale) {\n    if (type !== 'path') {\n      element.rect = getMarkupRect(markup, size, scale);\n    }\n\n    element.styles = getMarkupStyles(markup, size, scale);\n    UPDATE_TYPE_ROUTES[type](element, markup, size, scale);\n  };\n\n  var sortMarkupByZIndex = function sortMarkupByZIndex(a, b) {\n    if (a[1].zIndex > b[1].zIndex) {\n      return 1;\n    }\n\n    if (a[1].zIndex < b[1].zIndex) {\n      return -1;\n    }\n\n    return 0;\n  };\n\n  var cropSVG = function cropSVG(blob) {\n    var crop = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var markup = arguments.length > 2 ? arguments[2] : undefined;\n    var options = arguments.length > 3 ? arguments[3] : undefined;\n    return new Promise(function (resolve) {\n      var _options$background = options.background,\n          background = _options$background === void 0 ? null : _options$background; // load blob contents and wrap in crop svg\n\n      var fr = new FileReader();\n\n      fr.onloadend = function () {\n        // get svg text\n        var text = fr.result; // create element with svg and get size\n\n        var original = document.createElement('div');\n        original.style.cssText = 'position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;';\n        original.innerHTML = text;\n        var originalNode = original.querySelector('svg');\n        document.body.appendChild(original); // request bounding box dimensions\n\n        var bBox = originalNode.getBBox();\n        original.parentNode.removeChild(original); // get title\n\n        var titleNode = original.querySelector('title'); // calculate new heights and widths\n\n        var viewBoxAttribute = originalNode.getAttribute('viewBox') || '';\n        var widthAttribute = originalNode.getAttribute('width') || '';\n        var heightAttribute = originalNode.getAttribute('height') || '';\n        var width = parseFloat(widthAttribute) || null;\n        var height = parseFloat(heightAttribute) || null;\n        var widthUnits = (widthAttribute.match(/[a-z]+/) || [])[0] || '';\n        var heightUnits = (heightAttribute.match(/[a-z]+/) || [])[0] || ''; // create new size\n\n        var viewBoxList = viewBoxAttribute.split(' ').map(parseFloat);\n        var viewBox = viewBoxList.length ? {\n          x: viewBoxList[0],\n          y: viewBoxList[1],\n          width: viewBoxList[2],\n          height: viewBoxList[3]\n        } : bBox;\n        var imageWidth = width != null ? width : viewBox.width;\n        var imageHeight = height != null ? height : viewBox.height;\n        originalNode.style.overflow = 'visible';\n        originalNode.setAttribute('width', imageWidth);\n        originalNode.setAttribute('height', imageHeight); // markup\n\n        var markupSVG = '';\n\n        if (markup && markup.length) {\n          var size = {\n            width: imageWidth,\n            height: imageHeight\n          };\n          markupSVG = markup.sort(sortMarkupByZIndex).reduce(function (prev, shape) {\n            var el = createMarkupByType(shape[0], shape[1]);\n            updateMarkupByType(el, shape[0], shape[1], size);\n            el.removeAttribute('id');\n\n            if (el.getAttribute('opacity') === 1) {\n              el.removeAttribute('opacity');\n            }\n\n            return prev + '\\n' + el.outerHTML + '\\n';\n          }, '');\n          markupSVG = '\\n\\n<g>'.concat(markupSVG.replace(/&nbsp;/g, ' '), '</g>\\n\\n');\n        }\n\n        var aspectRatio = crop.aspectRatio || imageHeight / imageWidth;\n        var canvasWidth = imageWidth;\n        var canvasHeight = canvasWidth * aspectRatio;\n        var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n        var cropCenterX = crop.center ? crop.center.x : 0.5;\n        var cropCenterY = crop.center ? crop.center.y : 0.5;\n        var canvasZoomFactor = getImageRectZoomFactor({\n          width: imageWidth,\n          height: imageHeight\n        }, getCenteredCropRect({\n          width: canvasWidth,\n          height: canvasHeight\n        }, aspectRatio), crop.rotation, shouldLimit ? {\n          x: cropCenterX,\n          y: cropCenterY\n        } : {\n          x: 0.5,\n          y: 0.5\n        });\n        var scale = crop.zoom * canvasZoomFactor;\n        var rotation = crop.rotation * (180 / Math.PI);\n        var canvasCenter = {\n          x: canvasWidth * 0.5,\n          y: canvasHeight * 0.5\n        };\n        var imageOffset = {\n          x: canvasCenter.x - imageWidth * cropCenterX,\n          y: canvasCenter.y - imageHeight * cropCenterY\n        };\n        var cropTransforms = [// rotate\n        'rotate('.concat(rotation, ' ').concat(canvasCenter.x, ' ').concat(canvasCenter.y, ')'), // scale\n        'translate('.concat(canvasCenter.x, ' ').concat(canvasCenter.y, ')'), 'scale('.concat(scale, ')'), 'translate('.concat(-canvasCenter.x, ' ').concat(-canvasCenter.y, ')'), // offset\n        'translate('.concat(imageOffset.x, ' ').concat(imageOffset.y, ')')];\n        var cropFlipHorizontal = crop.flip && crop.flip.horizontal;\n        var cropFlipVertical = crop.flip && crop.flip.vertical;\n        var flipTransforms = ['scale('.concat(cropFlipHorizontal ? -1 : 1, ' ').concat(cropFlipVertical ? -1 : 1, ')'), 'translate('.concat(cropFlipHorizontal ? -imageWidth : 0, ' ').concat(cropFlipVertical ? -imageHeight : 0, ')')]; // crop\n\n        var transformed = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<svg width=\"'.concat(canvasWidth).concat(widthUnits, '\" height=\"').concat(canvasHeight).concat(heightUnits, '\" \\nviewBox=\"0 0 ').concat(canvasWidth, ' ').concat(canvasHeight, '\" ').concat(background ? 'style=\"background:' + background + '\" ' : '', '\\npreserveAspectRatio=\"xMinYMin\"\\nxmlns:xlink=\"http://www.w3.org/1999/xlink\"\\nxmlns=\"http://www.w3.org/2000/svg\">\\n<!-- Generated by PQINA - https://pqina.nl/ -->\\n<title>').concat(titleNode ? titleNode.textContent : '', '</title>\\n<g transform=\"').concat(cropTransforms.join(' '), '\">\\n<g transform=\"').concat(flipTransforms.join(' '), '\">\\n').concat(originalNode.outerHTML).concat(markupSVG, '\\n</g>\\n</g>\\n</svg>'); // create new svg file\n\n        resolve(transformed);\n      };\n\n      fr.readAsText(blob);\n    });\n  };\n\n  var objectToImageData = function objectToImageData(obj) {\n    var imageData;\n\n    try {\n      imageData = new ImageData(obj.width, obj.height);\n    } catch (e) {\n      // IE + Old EDGE (tested on 12)\n      var canvas = document.createElement('canvas');\n      imageData = canvas.getContext('2d').createImageData(obj.width, obj.height);\n    }\n\n    imageData.data.set(obj.data);\n    return imageData;\n  };\n  /* javascript-obfuscator:disable */\n\n\n  var TransformWorker = function TransformWorker() {\n    // maps transform types to transform functions\n    var TRANSFORMS = {\n      resize: resize,\n      filter: filter\n    }; // applies all image transforms to the image data array\n\n    var applyTransforms = function applyTransforms(transforms, imageData) {\n      transforms.forEach(function (transform) {\n        imageData = TRANSFORMS[transform.type](imageData, transform.data);\n      });\n      return imageData;\n    }; // transform image hub\n\n\n    var transform = function transform(data, cb) {\n      var transforms = data.transforms; // if has filter and has resize, move filter to resize operation\n\n      var filterTransform = null;\n      transforms.forEach(function (transform) {\n        if (transform.type === 'filter') {\n          filterTransform = transform;\n        }\n      });\n\n      if (filterTransform) {\n        // find resize\n        var resizeTransform = null;\n        transforms.forEach(function (transform) {\n          if (transform.type === 'resize') {\n            resizeTransform = transform;\n          }\n        });\n\n        if (resizeTransform) {\n          // update resize operation\n          resizeTransform.data.matrix = filterTransform.data; // remove filter\n\n          transforms = transforms.filter(function (transform) {\n            return transform.type !== 'filter';\n          });\n        }\n      }\n\n      cb(applyTransforms(transforms, data.imageData));\n    }; // eslint-disable-next-line no-restricted-globals\n\n\n    self.onmessage = function (e) {\n      transform(e.data.message, function (response) {\n        // eslint-disable-next-line no-restricted-globals\n        self.postMessage({\n          id: e.data.id,\n          message: response\n        }, [response.data.buffer]);\n      });\n    };\n\n    var br = 1.0;\n    var bg = 1.0;\n    var bb = 1.0;\n\n    function applyFilterMatrix(index, data, m) {\n      var ir = data[index] / 255;\n      var ig = data[index + 1] / 255;\n      var ib = data[index + 2] / 255;\n      var ia = data[index + 3] / 255;\n      var mr = ir * m[0] + ig * m[1] + ib * m[2] + ia * m[3] + m[4];\n      var mg = ir * m[5] + ig * m[6] + ib * m[7] + ia * m[8] + m[9];\n      var mb = ir * m[10] + ig * m[11] + ib * m[12] + ia * m[13] + m[14];\n      var ma = ir * m[15] + ig * m[16] + ib * m[17] + ia * m[18] + m[19];\n      var or = Math.max(0, mr * ma) + br * (1.0 - ma);\n      var og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n      var ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n      data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n      data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n      data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255;\n    }\n\n    var identityMatrix = self.JSON.stringify([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0]);\n\n    function isIdentityMatrix(filter) {\n      return self.JSON.stringify(filter || []) === identityMatrix;\n    }\n\n    function filter(imageData, matrix) {\n      if (!matrix || isIdentityMatrix(matrix)) return imageData;\n      var data = imageData.data;\n      var l = data.length;\n      var m11 = matrix[0];\n      var m12 = matrix[1];\n      var m13 = matrix[2];\n      var m14 = matrix[3];\n      var m15 = matrix[4];\n      var m21 = matrix[5];\n      var m22 = matrix[6];\n      var m23 = matrix[7];\n      var m24 = matrix[8];\n      var m25 = matrix[9];\n      var m31 = matrix[10];\n      var m32 = matrix[11];\n      var m33 = matrix[12];\n      var m34 = matrix[13];\n      var m35 = matrix[14];\n      var m41 = matrix[15];\n      var m42 = matrix[16];\n      var m43 = matrix[17];\n      var m44 = matrix[18];\n      var m45 = matrix[19];\n      var index = 0,\n          r = 0.0,\n          g = 0.0,\n          b = 0.0,\n          a = 0.0,\n          mr = 0.0,\n          mg = 0.0,\n          mb = 0.0,\n          ma = 0.0,\n          or = 0.0,\n          og = 0.0,\n          ob = 0.0;\n\n      for (; index < l; index += 4) {\n        r = data[index] / 255;\n        g = data[index + 1] / 255;\n        b = data[index + 2] / 255;\n        a = data[index + 3] / 255;\n        mr = r * m11 + g * m12 + b * m13 + a * m14 + m15;\n        mg = r * m21 + g * m22 + b * m23 + a * m24 + m25;\n        mb = r * m31 + g * m32 + b * m33 + a * m34 + m35;\n        ma = r * m41 + g * m42 + b * m43 + a * m44 + m45;\n        or = Math.max(0, mr * ma) + br * (1.0 - ma);\n        og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n        ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n        data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n        data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n        data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255; // don't update alpha value\n      }\n\n      return imageData;\n    }\n\n    function resize(imageData, data) {\n      var _data$mode = data.mode,\n          mode = _data$mode === void 0 ? 'contain' : _data$mode,\n          _data$upscale = data.upscale,\n          upscale = _data$upscale === void 0 ? false : _data$upscale,\n          width = data.width,\n          height = data.height,\n          matrix = data.matrix; // test if is identity matrix\n\n      matrix = !matrix || isIdentityMatrix(matrix) ? null : matrix; // need at least a width or a height\n      // also 0 is not a valid width or height\n\n      if (!width && !height) {\n        return filter(imageData, matrix);\n      } // make sure all bounds are set\n\n\n      if (width === null) {\n        width = height;\n      } else if (height === null) {\n        height = width;\n      }\n\n      if (mode !== 'force') {\n        var scalarWidth = width / imageData.width;\n        var scalarHeight = height / imageData.height;\n        var scalar = 1;\n\n        if (mode === 'cover') {\n          scalar = Math.max(scalarWidth, scalarHeight);\n        } else if (mode === 'contain') {\n          scalar = Math.min(scalarWidth, scalarHeight);\n        } // if image is too small, exit here with original image\n\n\n        if (scalar > 1 && upscale === false) {\n          return filter(imageData, matrix);\n        }\n\n        width = imageData.width * scalar;\n        height = imageData.height * scalar;\n      }\n\n      var originWidth = imageData.width;\n      var originHeight = imageData.height;\n      var targetWidth = Math.round(width);\n      var targetHeight = Math.round(height);\n      var inputData = imageData.data;\n      var outputData = new Uint8ClampedArray(targetWidth * targetHeight * 4);\n      var ratioWidth = originWidth / targetWidth;\n      var ratioHeight = originHeight / targetHeight;\n      var ratioWidthHalf = Math.ceil(ratioWidth * 0.5);\n      var ratioHeightHalf = Math.ceil(ratioHeight * 0.5);\n\n      for (var j = 0; j < targetHeight; j++) {\n        for (var i = 0; i < targetWidth; i++) {\n          var x2 = (i + j * targetWidth) * 4;\n          var weight = 0;\n          var weights = 0;\n          var weightsAlpha = 0;\n          var r = 0;\n          var g = 0;\n          var b = 0;\n          var a = 0;\n          var centerY = (j + 0.5) * ratioHeight;\n\n          for (var yy = Math.floor(j * ratioHeight); yy < (j + 1) * ratioHeight; yy++) {\n            var dy = Math.abs(centerY - (yy + 0.5)) / ratioHeightHalf;\n            var centerX = (i + 0.5) * ratioWidth;\n            var w0 = dy * dy;\n\n            for (var xx = Math.floor(i * ratioWidth); xx < (i + 1) * ratioWidth; xx++) {\n              var dx = Math.abs(centerX - (xx + 0.5)) / ratioWidthHalf;\n              var w = Math.sqrt(w0 + dx * dx);\n\n              if (w >= -1 && w <= 1) {\n                weight = 2 * w * w * w - 3 * w * w + 1;\n\n                if (weight > 0) {\n                  dx = 4 * (xx + yy * originWidth);\n                  var ref = inputData[dx + 3];\n                  a += weight * ref;\n                  weightsAlpha += weight;\n\n                  if (ref < 255) {\n                    weight = weight * ref / 250;\n                  }\n\n                  r += weight * inputData[dx];\n                  g += weight * inputData[dx + 1];\n                  b += weight * inputData[dx + 2];\n                  weights += weight;\n                }\n              }\n            }\n          }\n\n          outputData[x2] = r / weights;\n          outputData[x2 + 1] = g / weights;\n          outputData[x2 + 2] = b / weights;\n          outputData[x2 + 3] = a / weightsAlpha;\n          matrix && applyFilterMatrix(x2, outputData, matrix);\n        }\n      }\n\n      return {\n        data: outputData,\n        width: targetWidth,\n        height: targetHeight\n      };\n    }\n  };\n  /* javascript-obfuscator:enable */\n\n\n  var correctOrientation = function correctOrientation(view, offset) {\n    // Missing 0x45786966 Marker? No Exif Header, stop here\n    if (view.getUint32(offset + 4, false) !== 0x45786966) return; // next byte!\n\n    offset += 4; // First 2bytes defines byte align of TIFF data.\n    // If it is 0x4949=\"I I\", it means \"Intel\" type byte align\n\n    var intelByteAligned = view.getUint16(offset += 6, false) === 0x4949;\n    offset += view.getUint32(offset + 4, intelByteAligned);\n    var tags = view.getUint16(offset, intelByteAligned);\n    offset += 2; // find Orientation tag\n\n    for (var i = 0; i < tags; i++) {\n      if (view.getUint16(offset + i * 12, intelByteAligned) === 0x0112) {\n        view.setUint16(offset + i * 12 + 8, 1, intelByteAligned);\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var readData = function readData(data) {\n    var view = new DataView(data); // Every JPEG file starts from binary value '0xFFD8'\n    // If it's not present, exit here\n\n    if (view.getUint16(0) !== 0xffd8) return null;\n    var offset = 2; // Start at 2 as we skipped two bytes (FFD8)\n\n    var marker;\n    var markerLength;\n    var orientationCorrected = false;\n\n    while (offset < view.byteLength) {\n      marker = view.getUint16(offset, false);\n      markerLength = view.getUint16(offset + 2, false) + 2; // Test if is APP and COM markers\n\n      var isData = marker >= 0xffe0 && marker <= 0xffef || marker === 0xfffe;\n\n      if (!isData) {\n        break;\n      }\n\n      if (!orientationCorrected) {\n        orientationCorrected = correctOrientation(view, offset, markerLength);\n      }\n\n      if (offset + markerLength > view.byteLength) {\n        break;\n      }\n\n      offset += markerLength;\n    }\n\n    return data.slice(0, offset);\n  };\n\n  var getImageHead = function getImageHead(file) {\n    return new Promise(function (resolve) {\n      var reader = new FileReader();\n\n      reader.onload = function () {\n        return resolve(readData(reader.result) || null);\n      };\n\n      reader.readAsArrayBuffer(file.slice(0, 256 * 1024));\n    });\n  };\n\n  var getBlobBuilder = function getBlobBuilder() {\n    return window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n  };\n\n  var createBlob = function createBlob(arrayBuffer, mimeType) {\n    var BB = getBlobBuilder();\n\n    if (BB) {\n      var bb = new BB();\n      bb.append(arrayBuffer);\n      return bb.getBlob(mimeType);\n    }\n\n    return new Blob([arrayBuffer], {\n      type: mimeType\n    });\n  };\n\n  var getUniqueId = function getUniqueId() {\n    return Math.random().toString(36).substr(2, 9);\n  };\n\n  var createWorker = function createWorker(fn) {\n    var workerBlob = new Blob(['(', fn.toString(), ')()'], {\n      type: 'application/javascript'\n    });\n    var workerURL = URL.createObjectURL(workerBlob);\n    var worker = new Worker(workerURL);\n    var trips = [];\n    return {\n      transfer: function transfer() {},\n      // (message, cb) => {}\n      post: function post(message, cb, transferList) {\n        var id = getUniqueId();\n        trips[id] = cb;\n\n        worker.onmessage = function (e) {\n          var cb = trips[e.data.id];\n          if (!cb) return;\n          cb(e.data.message);\n          delete trips[e.data.id];\n        };\n\n        worker.postMessage({\n          id: id,\n          message: message\n        }, transferList);\n      },\n      terminate: function terminate() {\n        worker.terminate();\n        URL.revokeObjectURL(workerURL);\n      }\n    };\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function (resolve, reject) {\n      var img = new Image();\n\n      img.onload = function () {\n        resolve(img);\n      };\n\n      img.onerror = function (e) {\n        reject(e);\n      };\n\n      img.src = url;\n    });\n  };\n\n  var chain = function chain(funcs) {\n    return funcs.reduce(function (promise, func) {\n      return promise.then(function (result) {\n        return func().then(Array.prototype.concat.bind(result));\n      });\n    }, Promise.resolve([]));\n  };\n\n  var canvasApplyMarkup = function canvasApplyMarkup(canvas, markup) {\n    return new Promise(function (resolve) {\n      var size = {\n        width: canvas.width,\n        height: canvas.height\n      };\n      var ctx = canvas.getContext('2d');\n      var drawers = markup.sort(sortMarkupByZIndex).map(function (item) {\n        return function () {\n          return new Promise(function (resolve) {\n            var result = TYPE_DRAW_ROUTES[item[0]](ctx, size, item[1], resolve);\n            if (result) resolve();\n          });\n        };\n      });\n      chain(drawers).then(function () {\n        return resolve(canvas);\n      });\n    });\n  };\n\n  var applyMarkupStyles = function applyMarkupStyles(ctx, styles) {\n    ctx.beginPath();\n    ctx.lineCap = styles['stroke-linecap'];\n    ctx.lineJoin = styles['stroke-linejoin'];\n    ctx.lineWidth = styles['stroke-width'];\n\n    if (styles['stroke-dasharray'].length) {\n      ctx.setLineDash(styles['stroke-dasharray'].split(','));\n    }\n\n    ctx.fillStyle = styles['fill'];\n    ctx.strokeStyle = styles['stroke'];\n    ctx.globalAlpha = styles.opacity || 1;\n  };\n\n  var drawMarkupStyles = function drawMarkupStyles(ctx) {\n    ctx.fill();\n    ctx.stroke();\n    ctx.globalAlpha = 1;\n  };\n\n  var drawRect = function drawRect(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.rect(rect.x, rect.y, rect.width, rect.height);\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawEllipse = function drawEllipse(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    var x = rect.x,\n        y = rect.y,\n        w = rect.width,\n        h = rect.height,\n        kappa = 0.5522848,\n        ox = w / 2 * kappa,\n        oy = h / 2 * kappa,\n        xe = x + w,\n        ye = y + h,\n        xm = x + w / 2,\n        ym = y + h / 2;\n    ctx.moveTo(x, ym);\n    ctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\n    ctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\n    ctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n    ctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawImage = function drawImage(ctx, size, markup, done) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    var image = new Image(); // if is cross origin image add cross origin attribute\n\n    var isCrossOriginImage = new URL(markup.src, window.location.href).origin !== window.location.origin;\n    if (isCrossOriginImage) image.crossOrigin = '';\n\n    image.onload = function () {\n      if (markup.fit === 'cover') {\n        var ar = rect.width / rect.height;\n        var width = ar > 1 ? image.width : image.height * ar;\n        var height = ar > 1 ? image.width / ar : image.height;\n        var x = image.width * 0.5 - width * 0.5;\n        var y = image.height * 0.5 - height * 0.5;\n        ctx.drawImage(image, x, y, width, height, rect.x, rect.y, rect.width, rect.height);\n      } else if (markup.fit === 'contain') {\n        var scalar = Math.min(rect.width / image.width, rect.height / image.height);\n\n        var _width = scalar * image.width;\n\n        var _height = scalar * image.height;\n\n        var _x = rect.x + rect.width * 0.5 - _width * 0.5;\n\n        var _y = rect.y + rect.height * 0.5 - _height * 0.5;\n\n        ctx.drawImage(image, 0, 0, image.width, image.height, _x, _y, _width, _height);\n      } else {\n        ctx.drawImage(image, 0, 0, image.width, image.height, rect.x, rect.y, rect.width, rect.height);\n      }\n\n      drawMarkupStyles(ctx, styles);\n      done();\n    };\n\n    image.src = markup.src;\n  };\n\n  var drawText = function drawText(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    var fontSize = getMarkupValue(markup.fontSize, size);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = markup.textAlign || 'left';\n    ctx.font = ''.concat(fontWeight, ' ').concat(fontSize, 'px ').concat(fontFamily);\n    ctx.textAlign = textAlign;\n    ctx.fillText(markup.text, rect.x, rect.y);\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawPath = function drawPath(ctx, size, markup) {\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.beginPath();\n    var points = markup.points.map(function (point) {\n      return {\n        x: getMarkupValue(point.x, size, 1, 'width'),\n        y: getMarkupValue(point.y, size, 1, 'height')\n      };\n    });\n    ctx.moveTo(points[0].x, points[0].y);\n    var l = points.length;\n\n    for (var i = 1; i < l; i++) {\n      ctx.lineTo(points[i].x, points[i].y);\n    }\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawLine = function drawLine(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.beginPath();\n    var origin = {\n      x: rect.x,\n      y: rect.y\n    };\n    var target = {\n      x: rect.x + rect.width,\n      y: rect.y + rect.height\n    };\n    ctx.moveTo(origin.x, origin.y);\n    ctx.lineTo(target.x, target.y);\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n    var l = 0.04 * Math.min(size.width, size.height);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n      ctx.moveTo(arrowBeginA.x, arrowBeginA.y);\n      ctx.lineTo(origin.x, origin.y);\n      ctx.lineTo(arrowBeginB.x, arrowBeginB.y);\n    }\n\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n      ctx.moveTo(arrowEndA.x, arrowEndA.y);\n      ctx.lineTo(target.x, target.y);\n      ctx.lineTo(arrowEndB.x, arrowEndB.y);\n    }\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var TYPE_DRAW_ROUTES = {\n    rect: drawRect,\n    ellipse: drawEllipse,\n    image: drawImage,\n    text: drawText,\n    line: drawLine,\n    path: drawPath\n  };\n\n  var imageDataToCanvas = function imageDataToCanvas(imageData) {\n    var image = document.createElement('canvas');\n    image.width = imageData.width;\n    image.height = imageData.height;\n    var ctx = image.getContext('2d');\n    ctx.putImageData(imageData, 0, 0);\n    return image;\n  };\n\n  var transformImage = function transformImage(file, instructions) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return new Promise(function (resolve, reject) {\n      // if the file is not an image we do not have any business transforming it\n      if (!file || !isImage$1(file)) return reject({\n        status: 'not an image file',\n        file: file\n      }); // get separate options for easier use\n\n      var stripImageHead = options.stripImageHead,\n          beforeCreateBlob = options.beforeCreateBlob,\n          afterCreateBlob = options.afterCreateBlob,\n          canvasMemoryLimit = options.canvasMemoryLimit; // get crop\n\n      var crop = instructions.crop,\n          size = instructions.size,\n          filter = instructions.filter,\n          markup = instructions.markup,\n          output = instructions.output; // get exif orientation\n\n      var orientation = instructions.image && instructions.image.orientation ? Math.max(1, Math.min(8, instructions.image.orientation)) : null; // compression quality 0 => 100\n\n      var qualityAsPercentage = output && output.quality;\n      var quality = qualityAsPercentage === null ? null : qualityAsPercentage / 100; // output format\n\n      var type = output && output.type || null; // background color\n\n      var background = output && output.background || null; // get transforms\n\n      var transforms = []; // add resize transforms if set\n\n      if (size && (typeof size.width === 'number' || typeof size.height === 'number')) {\n        transforms.push({\n          type: 'resize',\n          data: size\n        });\n      } // add filters\n\n\n      if (filter && filter.length === 20) {\n        transforms.push({\n          type: 'filter',\n          data: filter\n        });\n      } // resolves with supplied blob\n\n\n      var resolveWithBlob = function resolveWithBlob(blob) {\n        var promisedBlob = afterCreateBlob ? afterCreateBlob(blob) : blob;\n        Promise.resolve(promisedBlob).then(resolve);\n      }; // done\n\n\n      var toBlob = function toBlob(imageData, options) {\n        var canvas = imageDataToCanvas(imageData);\n        var promisedCanvas = markup.length ? canvasApplyMarkup(canvas, markup) : canvas;\n        Promise.resolve(promisedCanvas).then(function (canvas) {\n          canvasToBlob(canvas, options, beforeCreateBlob).then(function (blob) {\n            // force release of canvas memory\n            canvasRelease(canvas); // remove image head (default)\n\n            if (stripImageHead) return resolveWithBlob(blob); // try to copy image head from original file to generated blob\n\n            getImageHead(file).then(function (imageHead) {\n              // re-inject image head in case of JPEG, as the image head is removed by canvas export\n              if (imageHead !== null) {\n                blob = new Blob([imageHead, blob.slice(20)], {\n                  type: blob.type\n                });\n              } // done!\n\n\n              resolveWithBlob(blob);\n            });\n          }).catch(reject);\n        });\n      }; // if this is an svg and we want it to stay an svg\n\n\n      if (/svg/.test(file.type) && type === null) {\n        return cropSVG(file, crop, markup, {\n          background: background\n        }).then(function (text) {\n          resolve(createBlob(text, 'image/svg+xml'));\n        });\n      } // get file url\n\n\n      var url = URL.createObjectURL(file); // turn the file into an image\n\n      loadImage(url).then(function (image) {\n        // url is no longer needed\n        URL.revokeObjectURL(url); // draw to canvas and start transform chain\n\n        var imageData = imageToImageData(image, orientation, crop, {\n          canvasMemoryLimit: canvasMemoryLimit,\n          background: background\n        }); // determine the format of the blob that we will output\n\n        var outputFormat = {\n          quality: quality,\n          type: type || file.type\n        }; // no transforms necessary, we done!\n\n        if (!transforms.length) {\n          return toBlob(imageData, outputFormat);\n        } // send to the transform worker to transform the blob on a separate thread\n\n\n        var worker = createWorker(TransformWorker);\n        worker.post({\n          transforms: transforms,\n          imageData: imageData\n        }, function (response) {\n          // finish up\n          toBlob(objectToImageData(response), outputFormat); // stop worker\n\n          worker.terminate();\n        }, [imageData.data.buffer]);\n      }).catch(reject);\n    });\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function (obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function (obj) {\n        return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE = typeof Symbol === 'function' && Symbol.for && Symbol.for('react.element') || 0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol === 'function') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function (resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n          if (wrappedAwait) {\n            resume('next', arg);\n            return;\n          }\n\n          settle(result.done ? 'return' : 'normal', arg);\n        }, function (err) {\n          resume('throw', err);\n        });\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function (arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function (arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function (arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function () {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n        waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function (resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function () {\n        return this;\n      };\n    }\n\n    iter.next = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function (value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function (value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function () {\n      var self = this,\n          args = arguments;\n      return new Promise(function (resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i];\n\n        for (var key in source) {\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\n            target[key] = source[key];\n          }\n        }\n      }\n\n      return target;\n    };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n          return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n      }\n\n      ownKeys.forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n      return o.__proto__ || Object.getPrototypeOf(o);\n    };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError('Super expression must either be null or a function');\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (right != null && typeof Symbol !== 'undefined' && right[Symbol.hasInstance]) {\n      return right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(Object.defineProperties(strings, {\n      raw: {\n        value: Object.freeze(raw)\n      }\n    }));\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error('Class \"' + name + '\" cannot be referenced in computed property keys.');\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _nonIterableRest();\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === '[object Arguments]') return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (var _iterator = arr[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function () {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and set to use loose mode. ' + 'To use proposal-class-properties in spec mode with decorators, wait for ' + 'the next major version of decorators in stage 2.');\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function (key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n      return decorator(target, property, desc) || desc;\n    }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function () {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function (O, elements) {\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function (F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            var placement = element.placement;\n\n            if (element.kind === kind && (placement === 'static' || placement === 'prototype')) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function (receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function (elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function (element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function (element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(element, placements);\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function (element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function (element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function (elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                  throw new TypeError('Duplicated element (' + elements[j].key + ')');\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function (element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function (elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function (elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(elementObject, 'finisher', 'An element descriptor');\n          this.disallowProperty(elementObject, 'extras', 'An element descriptor');\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function (elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (placement !== 'static' && placement !== 'prototype' && placement !== 'own') {\n          throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(elementObject, 'elements', 'An element descriptor');\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(elementObject, 'initializer', 'A method descriptor');\n        } else {\n          this.disallowProperty(descriptor, 'get', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'set', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'value', 'The property descriptor of a field descriptor');\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function (elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function (obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function (constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function (obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(objectType + \" can't have a .\" + name + ' property.');\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static ? 'static' : def.kind === 'field' ? 'own' : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function (other) {\n      return other.kind === 'method' && other.key === element.key && other.placement === element.placement;\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (element.kind === 'method' && (other = newElements.find(isSameElement))) {\n        if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError('Duplicated methods (' + element.key + \") can't be decorated.\");\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + 'the same property (' + element.key + ').');\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function (re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function (str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n          return '$' + groups[name];\n        }));\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function () {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function (groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var MARKUP_RECT = ['x', 'y', 'left', 'top', 'right', 'bottom', 'width', 'height'];\n\n  var toOptionalFraction = function toOptionalFraction(value) {\n    return typeof value === 'string' && /%/.test(value) ? parseFloat(value) / 100 : value;\n  }; // adds default markup properties, clones markup\n\n\n  var prepareMarkup = function prepareMarkup(markup) {\n    var _markup = _slicedToArray(markup, 2),\n        type = _markup[0],\n        props = _markup[1];\n\n    var rect = props.points ? {} : MARKUP_RECT.reduce(function (prev, curr) {\n      prev[curr] = toOptionalFraction(props[curr]);\n      return prev;\n    }, {});\n    return [type, Object.assign({\n      zIndex: 0\n    }, props, rect)];\n  };\n\n  var getImageSize = function getImageSize(file) {\n    return new Promise(function (resolve, reject) {\n      var imageElement = new Image();\n      imageElement.src = URL.createObjectURL(file); // start testing size\n\n      var measure = function measure() {\n        var width = imageElement.naturalWidth;\n        var height = imageElement.naturalHeight;\n        var hasSize = width && height;\n        if (!hasSize) return;\n        URL.revokeObjectURL(imageElement.src);\n        clearInterval(intervalId);\n        resolve({\n          width: width,\n          height: height\n        });\n      };\n\n      imageElement.onerror = function (err) {\n        URL.revokeObjectURL(imageElement.src);\n        clearInterval(intervalId);\n        reject(err);\n      };\n\n      var intervalId = setInterval(measure, 1);\n      measure();\n    });\n  };\n  /**\n   * Polyfill Edge and IE when in Browser\n   */\n\n\n  if (typeof window !== 'undefined' && typeof window.document !== 'undefined') {\n    if (!HTMLCanvasElement.prototype.toBlob) {\n      Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n        value: function value(cb, type, quality) {\n          var canvas = this;\n          setTimeout(function () {\n            var dataURL = canvas.toDataURL(type, quality).split(',')[1];\n            var binStr = atob(dataURL);\n            var index = binStr.length;\n            var data = new Uint8Array(index);\n\n            while (index--) {\n              data[index] = binStr.charCodeAt(index);\n            }\n\n            cb(new Blob([data], {\n              type: type || 'image/png'\n            }));\n          });\n        }\n      });\n    }\n  }\n\n  var isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  var isIOS = isBrowser && /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n  /**\n   * Image Transform Plugin\n   */\n\n  var plugin = function plugin(_ref) {\n    var addFilter = _ref.addFilter,\n        utils = _ref.utils;\n    var Type = utils.Type,\n        forin = utils.forin,\n        getFileFromBlob = utils.getFileFromBlob,\n        isFile = utils.isFile;\n    /**\n     * Helper functions\n     */\n    // valid transforms (in correct order)\n\n    var TRANSFORM_LIST = ['crop', 'resize', 'filter', 'markup', 'output'];\n\n    var createVariantCreator = function createVariantCreator(updateMetadata) {\n      return function (transform, file, metadata) {\n        return transform(file, updateMetadata ? updateMetadata(metadata) : metadata);\n      };\n    };\n\n    var isDefaultCrop = function isDefaultCrop(crop) {\n      return crop.aspectRatio === null && crop.rotation === 0 && crop.zoom === 1 && crop.center && crop.center.x === 0.5 && crop.center.y === 0.5 && crop.flip && crop.flip.horizontal === false && crop.flip.vertical === false;\n    };\n    /**\n     * Filters\n     */\n\n\n    addFilter('SHOULD_PREPARE_OUTPUT', function (shouldPrepareOutput, _ref2) {\n      var query = _ref2.query;\n      return new Promise(function (resolve) {\n        // If is not async should prepare now\n        resolve(!query('IS_ASYNC'));\n      });\n    });\n\n    var shouldTransformFile = function shouldTransformFile(query, file, item) {\n      return new Promise(function (resolve) {\n        if (!query('GET_ALLOW_IMAGE_TRANSFORM') || item.archived || !isFile(file) || !isImage(file)) {\n          return resolve(false);\n        } // if size can't be read this browser doesn't support image\n\n\n        getImageSize(file).then(function () {\n          var fn = query('GET_IMAGE_TRANSFORM_IMAGE_FILTER');\n\n          if (fn) {\n            var filterResult = fn(file);\n\n            if (filterResult == null) {\n              // undefined or null\n              return handleRevert(true);\n            }\n\n            if (typeof filterResult === 'boolean') {\n              return resolve(filterResult);\n            }\n\n            if (typeof filterResult.then === 'function') {\n              return filterResult.then(resolve);\n            }\n          }\n\n          resolve(true);\n        }).catch(function (err) {\n          resolve(false);\n        });\n      });\n    };\n\n    addFilter('DID_CREATE_ITEM', function (item, _ref3) {\n      var query = _ref3.query,\n          dispatch = _ref3.dispatch;\n      if (!query('GET_ALLOW_IMAGE_TRANSFORM')) return;\n      item.extend('requestPrepare', function () {\n        return new Promise(function (resolve, reject) {\n          dispatch('REQUEST_PREPARE_OUTPUT', {\n            query: item.id,\n            item: item,\n            success: resolve,\n            failure: reject\n          }, true);\n        });\n      });\n    }); // subscribe to file transformations\n\n    addFilter('PREPARE_OUTPUT', function (file, _ref4) {\n      var query = _ref4.query,\n          item = _ref4.item;\n      return new Promise(function (resolve) {\n        shouldTransformFile(query, file, item).then(function (shouldTransform) {\n          // no need to transform, exit\n          if (!shouldTransform) return resolve(file); // get variants\n\n          var variants = []; // add original file\n\n          if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL')) {\n            variants.push(function () {\n              return new Promise(function (resolve) {\n                resolve({\n                  name: query('GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME'),\n                  file: file\n                });\n              });\n            });\n          } // add default output version if output default set to true or if no variants defined\n\n\n          if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT')) {\n            variants.push(function (transform, file, metadata) {\n              return new Promise(function (resolve) {\n                transform(file, metadata).then(function (file) {\n                  return resolve({\n                    name: query('GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME'),\n                    file: file\n                  });\n                });\n              });\n            });\n          } // get other variants\n\n\n          var variantsDefinition = query('GET_IMAGE_TRANSFORM_VARIANTS') || {};\n          forin(variantsDefinition, function (key, fn) {\n            var createVariant = createVariantCreator(fn);\n            variants.push(function (transform, file, metadata) {\n              return new Promise(function (resolve) {\n                createVariant(transform, file, metadata).then(function (file) {\n                  return resolve({\n                    name: key,\n                    file: file\n                  });\n                });\n              });\n            });\n          }); // output format (quality 0 => 100)\n\n          var qualityAsPercentage = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY');\n          var qualityMode = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE');\n          var quality = qualityAsPercentage === null ? null : qualityAsPercentage / 100;\n          var type = query('GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE');\n          var clientTransforms = query('GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS') || TRANSFORM_LIST; // update transform metadata object\n\n          item.setMetadata('output', {\n            type: type,\n            quality: quality,\n            client: clientTransforms\n          }, true); // the function that is used to apply the file transformations\n\n          var transform = function transform(file, metadata) {\n            return new Promise(function (resolve, reject) {\n              var filteredMetadata = Object.assign({}, metadata);\n              Object.keys(filteredMetadata).filter(function (instruction) {\n                return instruction !== 'exif';\n              }).forEach(function (instruction) {\n                // if not in list, remove from object, the instruction will be handled by the server\n                if (clientTransforms.indexOf(instruction) === -1) {\n                  delete filteredMetadata[instruction];\n                }\n              });\n              var resize = filteredMetadata.resize,\n                  exif = filteredMetadata.exif,\n                  output = filteredMetadata.output,\n                  crop = filteredMetadata.crop,\n                  filter = filteredMetadata.filter,\n                  markup = filteredMetadata.markup;\n              var instructions = {\n                image: {\n                  orientation: exif ? exif.orientation : null\n                },\n                output: output && (output.type || typeof output.quality === 'number' || output.background) ? {\n                  type: output.type,\n                  quality: typeof output.quality === 'number' ? output.quality * 100 : null,\n                  background: output.background || query('GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR') || null\n                } : undefined,\n                size: resize && (resize.size.width || resize.size.height) ? Object.assign({\n                  mode: resize.mode,\n                  upscale: resize.upscale\n                }, resize.size) : undefined,\n                crop: crop && !isDefaultCrop(crop) ? Object.assign({}, crop) : undefined,\n                markup: markup && markup.length ? markup.map(prepareMarkup) : [],\n                filter: filter\n              };\n\n              if (instructions.output) {\n                // determine if file type will change\n                var willChangeType = output.type ? // type set\n                output.type !== file.type : // type not set\n                false;\n                var canChangeQuality = /\\/jpe?g$/.test(file.type);\n                var willChangeQuality = output.quality !== null ? // quality set\n                canChangeQuality && qualityMode === 'always' : // quality not set\n                false; // determine if file data will be modified\n\n                var willModifyImageData = !!(instructions.size || instructions.crop || instructions.filter || willChangeType || willChangeQuality); // if we're not modifying the image data then we don't have to modify the output\n\n                if (!willModifyImageData) return resolve(file);\n              }\n\n              var options = {\n                beforeCreateBlob: query('GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB'),\n                afterCreateBlob: query('GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB'),\n                canvasMemoryLimit: query('GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT'),\n                stripImageHead: query('GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD')\n              };\n              transformImage(file, instructions, options).then(function (blob) {\n                // set file object\n                var out = getFileFromBlob(blob, // rename the original filename to match the mime type of the output image\n                renameFileToMatchMimeType(file.name, getValidOutputMimeType(blob.type)));\n                resolve(out);\n              }).catch(reject);\n            });\n          }; // start creating variants\n\n\n          var variantPromises = variants.map(function (create) {\n            return create(transform, file, item.getMetadata());\n          }); // wait for results\n\n          Promise.all(variantPromises).then(function (files) {\n            // if single file object in array, return the single file object else, return array of\n            resolve(files.length === 1 && files[0].name === null ? // return the File object\n            files[0].file : // return an array of files { name:'name', file:File }\n            files);\n          });\n        });\n      });\n    }); // Expose plugin options\n\n    return {\n      options: {\n        allowImageTransform: [true, Type.BOOLEAN],\n        // filter images to transform\n        imageTransformImageFilter: [null, Type.FUNCTION],\n        // null, 'image/jpeg', 'image/png'\n        imageTransformOutputMimeType: [null, Type.STRING],\n        // null, 0 - 100\n        imageTransformOutputQuality: [null, Type.INT],\n        // set to false to copy image exif data to output\n        imageTransformOutputStripImageHead: [true, Type.BOOLEAN],\n        // only apply transforms in this list\n        imageTransformClientTransforms: [null, Type.ARRAY],\n        // only apply output quality when a transform is required\n        imageTransformOutputQualityMode: ['always', Type.STRING],\n        // 'always'\n        // 'optional'\n        // 'mismatch' (future feature, only applied if quality differs from input)\n        // get image transform variants\n        imageTransformVariants: [null, Type.OBJECT],\n        // should we post the default transformed file\n        imageTransformVariantsIncludeDefault: [true, Type.BOOLEAN],\n        // which name to prefix the default transformed file with\n        imageTransformVariantsDefaultName: [null, Type.STRING],\n        // should we post the original file\n        imageTransformVariantsIncludeOriginal: [false, Type.BOOLEAN],\n        // which name to prefix the original file with\n        imageTransformVariantsOriginalName: ['original_', Type.STRING],\n        // called before creating the blob, receives canvas, expects promise resolve with canvas\n        imageTransformBeforeCreateBlob: [null, Type.FUNCTION],\n        // expects promise resolved with blob\n        imageTransformAfterCreateBlob: [null, Type.FUNCTION],\n        // canvas memory limit\n        imageTransformCanvasMemoryLimit: [isBrowser && isIOS ? 4096 * 4096 : null, Type.INT],\n        // background image of the output canvas\n        imageTransformCanvasBackgroundColor: [null, Type.STRING]\n      }\n    };\n  }; // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\n\n\n  if (isBrowser) {\n    document.dispatchEvent(new CustomEvent('FilePond:pluginloaded', {\n      detail: plugin\n    }));\n  }\n\n  return plugin;\n});","map":{"version":3,"sources":["/home/soumyajit/Personal_Projects/topgram-app/frontend/node_modules/filepond-plugin-image-transform/dist/filepond-plugin-image-transform.js"],"names":["global","factory","exports","module","define","amd","self","FilePondPluginImageTransform","isImage","file","test","type","getFilenameWithoutExtension","name","substr","lastIndexOf","ExtensionMap","jpeg","renameFileToMatchMimeType","filename","mimeType","split","extension","concat","getValidOutputMimeType","isImage$1","MATRICES","_","width","height","getImageOrientationMatrix","orientation","createVector","x","y","vectorDot","a","b","vectorSubtract","vectorDistanceSquared","vectorDistance","Math","sqrt","getOffsetPointOnEdge","length","rotation","A","B","C","sinA","sin","sinB","sinC","cosC","cos","ratio","c","getRotatedRectSize","rect","w","h","hor","ver","tl","abs","tr","bl","getImageRectZoomFactor","imageRect","cropRect","arguments","undefined","center","cx","cy","imageWidth","imageHeight","rotatedCropSize","max","getCenteredCropRect","container","aspectRatio","calculateCanvasSize","image","canvasAspectRatio","zoom","imageAspectRatio","canvasWidth","canvasHeight","imgWidth","imgHeight","scalar","canvasRelease","canvas","ctx","getContext","clearRect","isFlipped","flip","horizontal","vertical","getBitmap","naturalWidth","naturalHeight","document","createElement","swapped","transform","apply","matrix","drawImage","imageToImageData","imageElement","crop","options","canvasMemoryLimit","_options$background","background","bitmap","imageSize","canvasSize","requiredMemory","floor","canvasCenter","stage","shouldLimit","scaleToFit","scale","round","imageOffset","fillStyle","fillRect","translate","rotate","imageData","getImageData","IS_BROWSER","window","HTMLCanvasElement","prototype","toBlob","Object","defineProperty","value","callback","quality","dataURL","toDataURL","setTimeout","binStr","atob","len","arr","Uint8Array","i","charCodeAt","Blob","canvasToBlob","beforeCreateBlob","Promise","resolve","promisedImage","then","vectorMultiply","v","amount","createVector$1","vectorAdd","vectorNormalize","l","vectorRotate","radians","origin","t","getMarkupValue","size","axis","parseFloat","min","getMarkupStyles","markup","lineStyle","borderStyle","fill","backgroundColor","fontColor","stroke","borderColor","lineColor","strokeWidth","borderWidth","lineWidth","lineCap","lineJoin","dashes","map","join","opacity","isDefined","getMarkupRect","left","top","right","bottom","pointsToPathShape","points","point","index","setAttributes","element","attr","keys","forEach","key","setAttribute","ns","svg","tag","createElementNS","updateRect","assign","styles","updateEllipse","rx","ry","IMAGE_FIT_STYLE","contain","cover","updateImage","preserveAspectRatio","fit","TEXT_ANCHOR","updateText","fontSize","fontFamily","fontWeight","textAlign","text","textContent","updateLine","line","childNodes","begin","end","target","x1","y1","x2","y2","lineDecoration","style","display","indexOf","arrowBeginRotationPoint","arrowBeginCenter","arrowBeginA","arrowBeginB","d","arrowEndRotationPoint","arrowEndCenter","arrowEndA","arrowEndB","updatePath","createShape","node","id","createImage","shape","onload","setAttributeNS","src","createLine","appendChild","CREATE_TYPE_ROUTES","ellipse","path","UPDATE_TYPE_ROUTES","createMarkupByType","updateMarkupByType","sortMarkupByZIndex","zIndex","cropSVG","blob","fr","FileReader","onloadend","result","original","cssText","innerHTML","originalNode","querySelector","body","bBox","getBBox","parentNode","removeChild","titleNode","viewBoxAttribute","getAttribute","widthAttribute","heightAttribute","widthUnits","match","heightUnits","viewBoxList","viewBox","overflow","markupSVG","sort","reduce","prev","el","removeAttribute","outerHTML","replace","cropCenterX","cropCenterY","canvasZoomFactor","PI","cropTransforms","cropFlipHorizontal","cropFlipVertical","flipTransforms","transformed","readAsText","objectToImageData","obj","ImageData","e","createImageData","data","set","TransformWorker","TRANSFORMS","resize","filter","applyTransforms","transforms","cb","filterTransform","resizeTransform","onmessage","message","response","postMessage","buffer","br","bg","bb","applyFilterMatrix","m","ir","ig","ib","ia","mr","mg","mb","ma","or","og","ob","identityMatrix","JSON","stringify","isIdentityMatrix","m11","m12","m13","m14","m15","m21","m22","m23","m24","m25","m31","m32","m33","m34","m35","m41","m42","m43","m44","m45","r","g","_data$mode","mode","_data$upscale","upscale","scalarWidth","scalarHeight","originWidth","originHeight","targetWidth","targetHeight","inputData","outputData","Uint8ClampedArray","ratioWidth","ratioHeight","ratioWidthHalf","ceil","ratioHeightHalf","j","weight","weights","weightsAlpha","centerY","yy","dy","centerX","w0","xx","dx","ref","correctOrientation","view","offset","getUint32","intelByteAligned","getUint16","tags","setUint16","readData","DataView","marker","markerLength","orientationCorrected","byteLength","isData","slice","getImageHead","reader","readAsArrayBuffer","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","createBlob","arrayBuffer","BB","append","getBlob","getUniqueId","random","toString","createWorker","fn","workerBlob","workerURL","URL","createObjectURL","worker","Worker","trips","transfer","post","transferList","terminate","revokeObjectURL","loadImage","url","reject","img","Image","onerror","chain","funcs","promise","func","Array","bind","canvasApplyMarkup","drawers","item","TYPE_DRAW_ROUTES","applyMarkupStyles","beginPath","setLineDash","strokeStyle","globalAlpha","drawMarkupStyles","drawRect","drawEllipse","kappa","ox","oy","xe","ye","xm","ym","moveTo","bezierCurveTo","done","isCrossOriginImage","location","href","crossOrigin","ar","_width","_height","_x","_y","drawText","font","fillText","drawPath","lineTo","drawLine","imageDataToCanvas","putImageData","transformImage","instructions","status","stripImageHead","afterCreateBlob","output","qualityAsPercentage","push","resolveWithBlob","promisedBlob","promisedCanvas","imageHead","catch","outputFormat","_typeof","Symbol","iterator","constructor","REACT_ELEMENT_TYPE","_jsx","props","children","for","defaultProps","childrenLength","propName","childArray","$$typeof","_owner","_asyncIterator","iterable","method","asyncIterator","call","TypeError","_AwaitValue","wrapped","_AsyncGenerator","gen","front","back","send","arg","request","next","resume","wrappedAwait","settle","err","_invoke","return","throw","_wrapAsyncGenerator","_awaitAsyncGenerator","_asyncGeneratorDelegate","inner","awaitWrap","iter","waiting","pump","asyncGeneratorStep","_next","_throw","info","error","_asyncToGenerator","args","_classCallCheck","instance","Constructor","_defineProperties","descriptor","enumerable","configurable","writable","_createClass","protoProps","staticProps","_defineEnumerableProperties","descs","desc","getOwnPropertySymbols","objectSymbols","sym","_defaults","defaults","getOwnPropertyNames","getOwnPropertyDescriptor","_defineProperty","_extends","source","hasOwnProperty","_objectSpread","ownKeys","_inherits","subClass","superClass","create","_setPrototypeOf","_inheritsLoose","__proto__","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","p","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","_construct","Parent","Class","Function","_isNativeFunction","_wrapNativeSuper","_cache","Map","has","get","Wrapper","_instanceof","hasInstance","_interopRequireDefault","__esModule","default","_interopRequireWildcard","newObj","_newArrowCheck","innerThis","boundThis","_objectDestructuringEmpty","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_superPropBase","object","property","_get","receiver","base","_set","isStrict","s","Error","_taggedTemplateLiteral","strings","raw","freeze","defineProperties","_taggedTemplateLiteralLoose","_temporalRef","val","_temporalUndefined","_readOnlyError","_classNameTDZError","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_slicedToArrayLoose","_iterableToArrayLimitLoose","_toArray","_iterableToArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","isArray","arr2","from","_arr","_n","_d","_e","_i","_s","_iterator","_step","_skipFirstGeneratorNext","it","_toPrimitive","input","hint","prim","toPrimitive","res","String","Number","_toPropertyKey","_initializerWarningHelper","context","_initializerDefineProperty","initializer","_applyDecoratedDescriptor","decorators","reverse","decorator","_classPrivateFieldLooseKey","_classPrivateFieldLooseBase","privateKey","_classPrivateFieldGet","privateMap","_classPrivateFieldSet","_classStaticPrivateFieldSpecGet","classConstructor","_classStaticPrivateFieldSpecSet","_classStaticPrivateMethodGet","_classStaticPrivateMethodSet","_decorate","mixins","api","_getDecoratorsApi","initialize","O","initializeInstanceElements","decorated","elements","decorateClass","_coalesceClassElements","_createElementDescriptor","initializeClassElements","F","runClassFinishers","finishers","elementsDefinitionOrder","kind","placement","defineClassElement","proto","newElements","placements","static","own","addElementPlacement","_hasDecorators","elementFinishersExtras","decorateElement","extras","decorateConstructor","silent","splice","elementObject","fromElementDescriptor","elementFinisherExtras","toElementFinisherExtras","finisher","newExtras","fromClassDescriptor","elementsAndFinisher","toClassDescriptor","k","toStringTag","toElementDescriptors","elementObjects","toElementDescriptor","disallowProperty","_optionalCallableProperty","newConstructor","objectType","def","_coalesceGetterSetter","other","isSameElement","find","_isDataDescriptor","_classPrivateMethodGet","privateSet","_classPrivateMethodSet","_wrapRegExp","re","groups","BabelRegExp","_RegExp","RegExp","_super","_groups","WeakMap","_this","exec","str","buildGroups","substitution","MARKUP_RECT","toOptionalFraction","prepareMarkup","_markup","curr","getImageSize","measure","hasSize","clearInterval","intervalId","setInterval","isBrowser","isIOS","navigator","userAgent","MSStream","plugin","_ref","addFilter","utils","Type","forin","getFileFromBlob","isFile","TRANSFORM_LIST","createVariantCreator","updateMetadata","metadata","isDefaultCrop","shouldPrepareOutput","_ref2","query","shouldTransformFile","archived","filterResult","handleRevert","_ref3","dispatch","extend","success","failure","_ref4","shouldTransform","variants","variantsDefinition","createVariant","qualityMode","clientTransforms","setMetadata","client","filteredMetadata","instruction","exif","willChangeType","canChangeQuality","willChangeQuality","willModifyImageData","out","variantPromises","getMetadata","all","files","allowImageTransform","BOOLEAN","imageTransformImageFilter","FUNCTION","imageTransformOutputMimeType","STRING","imageTransformOutputQuality","INT","imageTransformOutputStripImageHead","imageTransformClientTransforms","ARRAY","imageTransformOutputQualityMode","imageTransformVariants","OBJECT","imageTransformVariantsIncludeDefault","imageTransformVariantsDefaultName","imageTransformVariantsIncludeOriginal","imageTransformVariantsOriginalName","imageTransformBeforeCreateBlob","imageTransformAfterCreateBlob","imageTransformCanvasMemoryLimit","imageTransformCanvasBackgroundColor","dispatchEvent","CustomEvent","detail"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA;AAEA,CAAC,UAASA,MAAT,EAAiBC,OAAjB,EAA0B;AACvB,SAAOC,OAAP,KAAmB,QAAnB,IAA+B,OAAOC,MAAP,KAAkB,WAAjD,GACOA,MAAM,CAACD,OAAP,GAAiBD,OAAO,EAD/B,GAEM,OAAOG,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACC,GAAvC,GACAD,MAAM,CAACH,OAAD,CADN,IAEED,MAAM,GAAGA,MAAM,IAAIM,IAApB,EAA4BN,MAAM,CAACO,4BAAP,GAAsCN,OAAO,EAF1E,CAFN;AAKH,CAND,EAMG,IANH,EAMS,YAAW;AAChB,eADgB,CAGhB;;AACA,MAAIO,OAAO,GAAG,SAASA,OAAT,CAAiBC,IAAjB,EAAuB;AACjC,WAAO,SAASC,IAAT,CAAcD,IAAI,CAACE,IAAnB,CAAP;AACH,GAFD;;AAIA,MAAIC,2BAA2B,GAAG,SAASA,2BAAT,CAAqCC,IAArC,EAA2C;AACzE,WAAOA,IAAI,CAACC,MAAL,CAAY,CAAZ,EAAeD,IAAI,CAACE,WAAL,CAAiB,GAAjB,CAAf,KAAyCF,IAAhD;AACH,GAFD,CARgB,CAYhB;;;AACA,MAAIG,YAAY,GAAG;AACfC,IAAAA,IAAI,EAAE,KADS;AAEf,eAAW;AAFI,GAAnB;;AAKA,MAAIC,yBAAyB,GAAG,SAASA,yBAAT,CAAmCC,QAAnC,EAA6CC,QAA7C,EAAuD;AACnF,QAAIP,IAAI,GAAGD,2BAA2B,CAACO,QAAD,CAAtC;AACA,QAAIR,IAAI,GAAGS,QAAQ,CAACC,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAX;AACA,QAAIC,SAAS,GAAGN,YAAY,CAACL,IAAD,CAAZ,IAAsBA,IAAtC;AACA,WAAO,GAAGY,MAAH,CAAUV,IAAV,EAAgB,GAAhB,EAAqBU,MAArB,CAA4BD,SAA5B,CAAP;AACH,GALD,CAlBgB,CAyBhB;;;AACA,MAAIE,sBAAsB,GAAG,SAASA,sBAAT,CAAgCb,IAAhC,EAAsC;AAC/D,WAAO,oBAAoBD,IAApB,CAAyBC,IAAzB,IAAiCA,IAAjC,GAAwC,YAA/C;AACH,GAFD,CA1BgB,CA8BhB;;;AACA,MAAIc,SAAS,GAAG,SAASjB,OAAT,CAAiBC,IAAjB,EAAuB;AACnC,WAAO,SAASC,IAAT,CAAcD,IAAI,CAACE,IAAnB,CAAP;AACH,GAFD;;AAIA,MAAIe,QAAQ,GAAG;AACX,OAAG,SAASC,CAAT,GAAa;AACZ,aAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,CAAP;AACH,KAHU;AAIX,OAAG,SAASA,CAAT,CAAWC,KAAX,EAAkB;AACjB,aAAO,CAAC,CAAC,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAcA,KAAd,EAAqB,CAArB,CAAP;AACH,KANU;AAOX,OAAG,SAASD,CAAT,CAAWC,KAAX,EAAkBC,MAAlB,EAA0B;AACzB,aAAO,CAAC,CAAC,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAC,CAAZ,EAAeD,KAAf,EAAsBC,MAAtB,CAAP;AACH,KATU;AAUX,OAAG,SAASF,CAAT,CAAWC,KAAX,EAAkBC,MAAlB,EAA0B;AACzB,aAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAC,CAAX,EAAc,CAAd,EAAiBA,MAAjB,CAAP;AACH,KAZU;AAaX,OAAG,SAASF,CAAT,GAAa;AACZ,aAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,CAAP;AACH,KAfU;AAgBX,OAAG,SAASA,CAAT,CAAWC,KAAX,EAAkBC,MAAlB,EAA0B;AACzB,aAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAC,CAAR,EAAW,CAAX,EAAcA,MAAd,EAAsB,CAAtB,CAAP;AACH,KAlBU;AAmBX,OAAG,SAASF,CAAT,CAAWC,KAAX,EAAkBC,MAAlB,EAA0B;AACzB,aAAO,CAAC,CAAD,EAAI,CAAC,CAAL,EAAQ,CAAC,CAAT,EAAY,CAAZ,EAAeA,MAAf,EAAuBD,KAAvB,CAAP;AACH,KArBU;AAsBX,OAAG,SAASD,CAAT,CAAWC,KAAX,EAAkB;AACjB,aAAO,CAAC,CAAD,EAAI,CAAC,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiBA,KAAjB,CAAP;AACH;AAxBU,GAAf;;AA2BA,MAAIE,yBAAyB,GAAG,SAASA,yBAAT,CAAmCF,KAAnC,EAA0CC,MAA1C,EAAkDE,WAAlD,EAA+D;AAC3F,QAAIA,WAAW,KAAK,CAAC,CAArB,EAAwB;AACpBA,MAAAA,WAAW,GAAG,CAAd;AACH;;AACD,WAAOL,QAAQ,CAACK,WAAD,CAAR,CAAsBH,KAAtB,EAA6BC,MAA7B,CAAP;AACH,GALD;;AAOA,MAAIG,YAAY,GAAG,SAASA,YAAT,CAAsBC,CAAtB,EAAyBC,CAAzB,EAA4B;AAC3C,WAAO;AAAED,MAAAA,CAAC,EAAEA,CAAL;AAAQC,MAAAA,CAAC,EAAEA;AAAX,KAAP;AACH,GAFD;;AAIA,MAAIC,SAAS,GAAG,SAASA,SAAT,CAAmBC,CAAnB,EAAsBC,CAAtB,EAAyB;AACrC,WAAOD,CAAC,CAACH,CAAF,GAAMI,CAAC,CAACJ,CAAR,GAAYG,CAAC,CAACF,CAAF,GAAMG,CAAC,CAACH,CAA3B;AACH,GAFD;;AAIA,MAAII,cAAc,GAAG,SAASA,cAAT,CAAwBF,CAAxB,EAA2BC,CAA3B,EAA8B;AAC/C,WAAOL,YAAY,CAACI,CAAC,CAACH,CAAF,GAAMI,CAAC,CAACJ,CAAT,EAAYG,CAAC,CAACF,CAAF,GAAMG,CAAC,CAACH,CAApB,CAAnB;AACH,GAFD;;AAIA,MAAIK,qBAAqB,GAAG,SAASA,qBAAT,CAA+BH,CAA/B,EAAkCC,CAAlC,EAAqC;AAC7D,WAAOF,SAAS,CAACG,cAAc,CAACF,CAAD,EAAIC,CAAJ,CAAf,EAAuBC,cAAc,CAACF,CAAD,EAAIC,CAAJ,CAArC,CAAhB;AACH,GAFD;;AAIA,MAAIG,cAAc,GAAG,SAASA,cAAT,CAAwBJ,CAAxB,EAA2BC,CAA3B,EAA8B;AAC/C,WAAOI,IAAI,CAACC,IAAL,CAAUH,qBAAqB,CAACH,CAAD,EAAIC,CAAJ,CAA/B,CAAP;AACH,GAFD;;AAIA,MAAIM,oBAAoB,GAAG,SAASA,oBAAT,CAA8BC,MAA9B,EAAsCC,QAAtC,EAAgD;AACvE,QAAIT,CAAC,GAAGQ,MAAR;AAEA,QAAIE,CAAC,GAAG,kBAAR;AACA,QAAIC,CAAC,GAAGF,QAAR;AACA,QAAIG,CAAC,GAAG,qBAAqBH,QAA7B;AAEA,QAAII,IAAI,GAAGR,IAAI,CAACS,GAAL,CAASJ,CAAT,CAAX;AACA,QAAIK,IAAI,GAAGV,IAAI,CAACS,GAAL,CAASH,CAAT,CAAX;AACA,QAAIK,IAAI,GAAGX,IAAI,CAACS,GAAL,CAASF,CAAT,CAAX;AACA,QAAIK,IAAI,GAAGZ,IAAI,CAACa,GAAL,CAASN,CAAT,CAAX;AACA,QAAIO,KAAK,GAAGnB,CAAC,GAAGa,IAAhB;AACA,QAAIZ,CAAC,GAAGkB,KAAK,GAAGJ,IAAhB;AACA,QAAIK,CAAC,GAAGD,KAAK,GAAGH,IAAhB;AAEA,WAAOpB,YAAY,CAACqB,IAAI,GAAGhB,CAAR,EAAWgB,IAAI,GAAGG,CAAlB,CAAnB;AACH,GAhBD;;AAkBA,MAAIC,kBAAkB,GAAG,SAASA,kBAAT,CAA4BC,IAA5B,EAAkCb,QAAlC,EAA4C;AACjE,QAAIc,CAAC,GAAGD,IAAI,CAAC9B,KAAb;AACA,QAAIgC,CAAC,GAAGF,IAAI,CAAC7B,MAAb;AAEA,QAAIgC,GAAG,GAAGlB,oBAAoB,CAACgB,CAAD,EAAId,QAAJ,CAA9B;AACA,QAAIiB,GAAG,GAAGnB,oBAAoB,CAACiB,CAAD,EAAIf,QAAJ,CAA9B;AAEA,QAAIkB,EAAE,GAAG/B,YAAY,CAAC0B,IAAI,CAACzB,CAAL,GAASQ,IAAI,CAACuB,GAAL,CAASH,GAAG,CAAC5B,CAAb,CAAV,EAA2ByB,IAAI,CAACxB,CAAL,GAASO,IAAI,CAACuB,GAAL,CAASH,GAAG,CAAC3B,CAAb,CAApC,CAArB;AAEA,QAAI+B,EAAE,GAAGjC,YAAY,CAAC0B,IAAI,CAACzB,CAAL,GAASyB,IAAI,CAAC9B,KAAd,GAAsBa,IAAI,CAACuB,GAAL,CAASF,GAAG,CAAC5B,CAAb,CAAvB,EAAwCwB,IAAI,CAACxB,CAAL,GAASO,IAAI,CAACuB,GAAL,CAASF,GAAG,CAAC7B,CAAb,CAAjD,CAArB;AAEA,QAAIiC,EAAE,GAAGlC,YAAY,CAAC0B,IAAI,CAACzB,CAAL,GAASQ,IAAI,CAACuB,GAAL,CAASF,GAAG,CAAC5B,CAAb,CAAV,EAA2BwB,IAAI,CAACxB,CAAL,GAASwB,IAAI,CAAC7B,MAAd,GAAuBY,IAAI,CAACuB,GAAL,CAASF,GAAG,CAAC7B,CAAb,CAAlD,CAArB;AAEA,WAAO;AACHL,MAAAA,KAAK,EAAEY,cAAc,CAACuB,EAAD,EAAKE,EAAL,CADlB;AAEHpC,MAAAA,MAAM,EAAEW,cAAc,CAACuB,EAAD,EAAKG,EAAL;AAFnB,KAAP;AAIH,GAjBD;;AAmBA,MAAIC,sBAAsB,GAAG,SAASA,sBAAT,CAAgCC,SAAhC,EAA2CC,QAA3C,EAAqD;AAC9E,QAAIxB,QAAQ,GAAGyB,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,CAAnF;AACA,QAAIE,MAAM,GACNF,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE;AAAErC,MAAAA,CAAC,EAAE,GAAL;AAAUC,MAAAA,CAAC,EAAE;AAAb,KADxE,CAF8E,CAK9E;;AACA,QAAIuC,EAAE,GAAGD,MAAM,CAACvC,CAAP,GAAW,GAAX,GAAiB,IAAIuC,MAAM,CAACvC,CAA5B,GAAgCuC,MAAM,CAACvC,CAAhD;AACA,QAAIyC,EAAE,GAAGF,MAAM,CAACtC,CAAP,GAAW,GAAX,GAAiB,IAAIsC,MAAM,CAACtC,CAA5B,GAAgCsC,MAAM,CAACtC,CAAhD;AACA,QAAIyC,UAAU,GAAGF,EAAE,GAAG,CAAL,GAASL,SAAS,CAACxC,KAApC;AACA,QAAIgD,WAAW,GAAGF,EAAE,GAAG,CAAL,GAASN,SAAS,CAACvC,MAArC,CAT8E,CAW9E;;AACA,QAAIgD,eAAe,GAAGpB,kBAAkB,CAACY,QAAD,EAAWxB,QAAX,CAAxC;AAEA,WAAOJ,IAAI,CAACqC,GAAL,CAASD,eAAe,CAACjD,KAAhB,GAAwB+C,UAAjC,EAA6CE,eAAe,CAAChD,MAAhB,GAAyB+C,WAAtE,CAAP;AACH,GAfD;;AAiBA,MAAIG,mBAAmB,GAAG,SAASA,mBAAT,CAA6BC,SAA7B,EAAwCC,WAAxC,EAAqD;AAC3E,QAAIrD,KAAK,GAAGoD,SAAS,CAACpD,KAAtB;AACA,QAAIC,MAAM,GAAGD,KAAK,GAAGqD,WAArB;;AACA,QAAIpD,MAAM,GAAGmD,SAAS,CAACnD,MAAvB,EAA+B;AAC3BA,MAAAA,MAAM,GAAGmD,SAAS,CAACnD,MAAnB;AACAD,MAAAA,KAAK,GAAGC,MAAM,GAAGoD,WAAjB;AACH;;AACD,QAAIhD,CAAC,GAAG,CAAC+C,SAAS,CAACpD,KAAV,GAAkBA,KAAnB,IAA4B,GAApC;AACA,QAAIM,CAAC,GAAG,CAAC8C,SAAS,CAACnD,MAAV,GAAmBA,MAApB,IAA8B,GAAtC;AAEA,WAAO;AACHI,MAAAA,CAAC,EAAEA,CADA;AAEHC,MAAAA,CAAC,EAAEA,CAFA;AAGHN,MAAAA,KAAK,EAAEA,KAHJ;AAIHC,MAAAA,MAAM,EAAEA;AAJL,KAAP;AAMH,GAhBD;;AAkBA,MAAIqD,mBAAmB,GAAG,SAASA,mBAAT,CAA6BC,KAA7B,EAAoCC,iBAApC,EAAuD;AAC7E,QAAIC,IAAI,GAAGf,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,CAA/E;AAEA,QAAIgB,gBAAgB,GAAGH,KAAK,CAACtD,MAAN,GAAesD,KAAK,CAACvD,KAA5C,CAH6E,CAK7E;;AACA,QAAI2D,WAAW,GAAG,CAAlB;AACA,QAAIC,YAAY,GAAGJ,iBAAnB;AACA,QAAIK,QAAQ,GAAG,CAAf;AACA,QAAIC,SAAS,GAAGJ,gBAAhB;;AACA,QAAII,SAAS,GAAGF,YAAhB,EAA8B;AAC1BE,MAAAA,SAAS,GAAGF,YAAZ;AACAC,MAAAA,QAAQ,GAAGC,SAAS,GAAGJ,gBAAvB;AACH;;AAED,QAAIK,MAAM,GAAGlD,IAAI,CAACqC,GAAL,CAASS,WAAW,GAAGE,QAAvB,EAAiCD,YAAY,GAAGE,SAAhD,CAAb;AACA,QAAI9D,KAAK,GAAGuD,KAAK,CAACvD,KAAN,IAAeyD,IAAI,GAAGM,MAAP,GAAgBF,QAA/B,CAAZ;AACA,QAAI5D,MAAM,GAAGD,KAAK,GAAGwD,iBAArB;AAEA,WAAO;AACHxD,MAAAA,KAAK,EAAEA,KADJ;AAEHC,MAAAA,MAAM,EAAEA;AAFL,KAAP;AAIH,GAvBD;;AAyBA,MAAI+D,aAAa,GAAG,SAASA,aAAT,CAAuBC,MAAvB,EAA+B;AAC/CA,IAAAA,MAAM,CAACjE,KAAP,GAAe,CAAf;AACAiE,IAAAA,MAAM,CAAChE,MAAP,GAAgB,CAAhB;AACA,QAAIiE,GAAG,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAV;AACAD,IAAAA,GAAG,CAACE,SAAJ,CAAc,CAAd,EAAiB,CAAjB,EAAoB,CAApB,EAAuB,CAAvB;AACH,GALD;;AAOA,MAAIC,SAAS,GAAG,SAASA,SAAT,CAAmBC,IAAnB,EAAyB;AACrC,WAAOA,IAAI,KAAKA,IAAI,CAACC,UAAL,IAAmBD,IAAI,CAACE,QAA7B,CAAX;AACH,GAFD;;AAIA,MAAIC,SAAS,GAAG,SAASA,SAAT,CAAmBlB,KAAnB,EAA0BpD,WAA1B,EAAuCmE,IAAvC,EAA6C;AACzD,QAAInE,WAAW,IAAI,CAAf,IAAoB,CAACkE,SAAS,CAACC,IAAD,CAAlC,EAA0C;AACtCf,MAAAA,KAAK,CAACvD,KAAN,GAAcuD,KAAK,CAACmB,YAApB;AACAnB,MAAAA,KAAK,CAACtD,MAAN,GAAesD,KAAK,CAACoB,aAArB;AACA,aAAOpB,KAAP;AACH;;AAED,QAAIU,MAAM,GAAGW,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;AACA,QAAI7E,KAAK,GAAGuD,KAAK,CAACmB,YAAlB;AACA,QAAIzE,MAAM,GAAGsD,KAAK,CAACoB,aAAnB,CATyD,CAWzD;;AACA,QAAIG,OAAO,GAAG3E,WAAW,IAAI,CAAf,IAAoBA,WAAW,IAAI,CAAjD;;AACA,QAAI2E,OAAJ,EAAa;AACTb,MAAAA,MAAM,CAACjE,KAAP,GAAeC,MAAf;AACAgE,MAAAA,MAAM,CAAChE,MAAP,GAAgBD,KAAhB;AACH,KAHD,MAGO;AACHiE,MAAAA,MAAM,CAACjE,KAAP,GAAeA,KAAf;AACAiE,MAAAA,MAAM,CAAChE,MAAP,GAAgBA,MAAhB;AACH,KAnBwD,CAqBzD;;;AACA,QAAIiE,GAAG,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAV,CAtByD,CAwBzD;;AACA,QAAIhE,WAAJ,EAAiB;AACb+D,MAAAA,GAAG,CAACa,SAAJ,CAAcC,KAAd,CAAoBd,GAApB,EAAyBhE,yBAAyB,CAACF,KAAD,EAAQC,MAAR,EAAgBE,WAAhB,CAAlD;AACH;;AAED,QAAIkE,SAAS,CAACC,IAAD,CAAb,EAAqB;AACjB;AACA;AACA,UAAIW,MAAM,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,CAAb;;AACA,UAAK,CAACH,OAAD,IAAYR,IAAI,CAACC,UAAlB,IAAiCO,OAAO,GAAGR,IAAI,CAACE,QAApD,EAA8D;AAC1DS,QAAAA,MAAM,CAAC,CAAD,CAAN,GAAY,CAAC,CAAb;AACAA,QAAAA,MAAM,CAAC,CAAD,CAAN,GAAYjF,KAAZ;AACH,OAPgB,CASjB;AACA;;;AACA,UAAK,CAAC8E,OAAD,IAAYR,IAAI,CAACE,QAAlB,IAAgCM,OAAO,IAAIR,IAAI,CAACC,UAApD,EAAiE;AAC7DU,QAAAA,MAAM,CAAC,CAAD,CAAN,GAAY,CAAC,CAAb;AACAA,QAAAA,MAAM,CAAC,CAAD,CAAN,GAAYhF,MAAZ;AACH;;AAEDiE,MAAAA,GAAG,CAACa,SAAJ,CAAcC,KAAd,CAAoBd,GAApB,EAAyBe,MAAzB;AACH;;AAEDf,IAAAA,GAAG,CAACgB,SAAJ,CAAc3B,KAAd,EAAqB,CAArB,EAAwB,CAAxB,EAA2BvD,KAA3B,EAAkCC,MAAlC;AAEA,WAAOgE,MAAP;AACH,GAnDD;;AAqDA,MAAIkB,gBAAgB,GAAG,SAASA,gBAAT,CAA0BC,YAA1B,EAAwCjF,WAAxC,EAAqD;AACxE,QAAIkF,IAAI,GAAG3C,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAA/E;AACA,QAAI4C,OAAO,GAAG5C,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAlF;AACA,QAAI6C,iBAAiB,GAAGD,OAAO,CAACC,iBAAhC;AAAA,QACIC,mBAAmB,GAAGF,OAAO,CAACG,UADlC;AAAA,QAEIA,UAAU,GAAGD,mBAAmB,KAAK,KAAK,CAA7B,GAAiC,IAAjC,GAAwCA,mBAFzD;AAIA,QAAI/B,IAAI,GAAG4B,IAAI,CAAC5B,IAAL,IAAa,CAAxB,CAPwE,CASxE;;AACA,QAAIiC,MAAM,GAAGjB,SAAS,CAACW,YAAD,EAAejF,WAAf,EAA4BkF,IAAI,CAACf,IAAjC,CAAtB;AACA,QAAIqB,SAAS,GAAG;AACZ3F,MAAAA,KAAK,EAAE0F,MAAM,CAAC1F,KADF;AAEZC,MAAAA,MAAM,EAAEyF,MAAM,CAACzF;AAFH,KAAhB;AAKA,QAAIoD,WAAW,GAAGgC,IAAI,CAAChC,WAAL,IAAoBsC,SAAS,CAAC1F,MAAV,GAAmB0F,SAAS,CAAC3F,KAAnE;AAEA,QAAI4F,UAAU,GAAGtC,mBAAmB,CAACqC,SAAD,EAAYtC,WAAZ,EAAyBI,IAAzB,CAApC;;AAEA,QAAI8B,iBAAJ,EAAuB;AACnB,UAAIM,cAAc,GAAGD,UAAU,CAAC5F,KAAX,GAAmB4F,UAAU,CAAC3F,MAAnD;;AACA,UAAI4F,cAAc,GAAGN,iBAArB,EAAwC;AACpC,YAAIxB,MAAM,GAAGlD,IAAI,CAACC,IAAL,CAAUyE,iBAAV,IAA+B1E,IAAI,CAACC,IAAL,CAAU+E,cAAV,CAA5C;AACAF,QAAAA,SAAS,CAAC3F,KAAV,GAAkBa,IAAI,CAACiF,KAAL,CAAWH,SAAS,CAAC3F,KAAV,GAAkB+D,MAA7B,CAAlB;AACA4B,QAAAA,SAAS,CAAC1F,MAAV,GAAmBY,IAAI,CAACiF,KAAL,CAAWH,SAAS,CAAC1F,MAAV,GAAmB8D,MAA9B,CAAnB;AACA6B,QAAAA,UAAU,GAAGtC,mBAAmB,CAACqC,SAAD,EAAYtC,WAAZ,EAAyBI,IAAzB,CAAhC;AACH;AACJ;;AAED,QAAIQ,MAAM,GAAGW,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;AAEA,QAAIkB,YAAY,GAAG;AACf1F,MAAAA,CAAC,EAAEuF,UAAU,CAAC5F,KAAX,GAAmB,GADP;AAEfM,MAAAA,CAAC,EAAEsF,UAAU,CAAC3F,MAAX,GAAoB;AAFR,KAAnB;AAKA,QAAI+F,KAAK,GAAG;AACR3F,MAAAA,CAAC,EAAE,CADK;AAERC,MAAAA,CAAC,EAAE,CAFK;AAGRN,MAAAA,KAAK,EAAE4F,UAAU,CAAC5F,KAHV;AAIRC,MAAAA,MAAM,EAAE2F,UAAU,CAAC3F,MAJX;AAKR2C,MAAAA,MAAM,EAAEmD;AALA,KAAZ;AAQA,QAAIE,WAAW,GAAG,OAAOZ,IAAI,CAACa,UAAZ,KAA2B,WAA3B,IAA0Cb,IAAI,CAACa,UAAjE;AAEA,QAAIC,KAAK,GACL1C,IAAI,GACJlB,sBAAsB,CAClBoD,SADkB,EAElBxC,mBAAmB,CAAC6C,KAAD,EAAQ3C,WAAR,CAFD,EAGlBgC,IAAI,CAACpE,QAHa,EAIlBgF,WAAW,GAAGZ,IAAI,CAACzC,MAAR,GAAiB;AAAEvC,MAAAA,CAAC,EAAE,GAAL;AAAUC,MAAAA,CAAC,EAAE;AAAb,KAJV,CAF1B,CA/CwE,CAwDxE;;AACA2D,IAAAA,MAAM,CAACjE,KAAP,GAAea,IAAI,CAACuF,KAAL,CAAWR,UAAU,CAAC5F,KAAX,GAAmBmG,KAA9B,CAAf;AACAlC,IAAAA,MAAM,CAAChE,MAAP,GAAgBY,IAAI,CAACuF,KAAL,CAAWR,UAAU,CAAC3F,MAAX,GAAoBkG,KAA/B,CAAhB;AAEAJ,IAAAA,YAAY,CAAC1F,CAAb,IAAkB8F,KAAlB;AACAJ,IAAAA,YAAY,CAACzF,CAAb,IAAkB6F,KAAlB;AAEA,QAAIE,WAAW,GAAG;AACdhG,MAAAA,CAAC,EAAE0F,YAAY,CAAC1F,CAAb,GAAiBsF,SAAS,CAAC3F,KAAV,IAAmBqF,IAAI,CAACzC,MAAL,GAAcyC,IAAI,CAACzC,MAAL,CAAYvC,CAA1B,GAA8B,GAAjD,CADN;AAEdC,MAAAA,CAAC,EAAEyF,YAAY,CAACzF,CAAb,GAAiBqF,SAAS,CAAC1F,MAAV,IAAoBoF,IAAI,CAACzC,MAAL,GAAcyC,IAAI,CAACzC,MAAL,CAAYtC,CAA1B,GAA8B,GAAlD;AAFN,KAAlB;AAKA,QAAI4D,GAAG,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAV;;AACA,QAAIsB,UAAJ,EAAgB;AACZvB,MAAAA,GAAG,CAACoC,SAAJ,GAAgBb,UAAhB;AACAvB,MAAAA,GAAG,CAACqC,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmBtC,MAAM,CAACjE,KAA1B,EAAiCiE,MAAM,CAAChE,MAAxC;AACH,KAxEuE,CA0ExE;;;AACAiE,IAAAA,GAAG,CAACsC,SAAJ,CAAcT,YAAY,CAAC1F,CAA3B,EAA8B0F,YAAY,CAACzF,CAA3C;AACA4D,IAAAA,GAAG,CAACuC,MAAJ,CAAWpB,IAAI,CAACpE,QAAL,IAAiB,CAA5B,EA5EwE,CA8ExE;;AACAiD,IAAAA,GAAG,CAACgB,SAAJ,CACIQ,MADJ,EAEIW,WAAW,CAAChG,CAAZ,GAAgB0F,YAAY,CAAC1F,CAFjC,EAGIgG,WAAW,CAAC/F,CAAZ,GAAgByF,YAAY,CAACzF,CAHjC,EAIIqF,SAAS,CAAC3F,KAJd,EAKI2F,SAAS,CAAC1F,MALd,EA/EwE,CAuFxE;;AACA,QAAIyG,SAAS,GAAGxC,GAAG,CAACyC,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuB1C,MAAM,CAACjE,KAA9B,EAAqCiE,MAAM,CAAChE,MAA5C,CAAhB,CAxFwE,CA0FxE;;AACA+D,IAAAA,aAAa,CAACC,MAAD,CAAb,CA3FwE,CA6FxE;;AACA,WAAOyC,SAAP;AACH,GA/FD;AAiGA;AACJ;AACA;;;AACI,MAAIE,UAAU,GAAI,YAAW;AACzB,WAAO,OAAOC,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACjC,QAAd,KAA2B,WAAnE;AACH,GAFgB,EAAjB;;AAGA,MAAIgC,UAAJ,EAAgB;AACZ,QAAI,CAACE,iBAAiB,CAACC,SAAlB,CAA4BC,MAAjC,EAAyC;AACrCC,MAAAA,MAAM,CAACC,cAAP,CAAsBJ,iBAAiB,CAACC,SAAxC,EAAmD,QAAnD,EAA6D;AACzDI,QAAAA,KAAK,EAAE,SAASA,KAAT,CAAeC,QAAf,EAAyBrI,IAAzB,EAA+BsI,OAA/B,EAAwC;AAC3C,cAAIC,OAAO,GAAG,KAAKC,SAAL,CAAexI,IAAf,EAAqBsI,OAArB,EAA8B5H,KAA9B,CAAoC,GAApC,EAAyC,CAAzC,CAAd;AACA+H,UAAAA,UAAU,CAAC,YAAW;AAClB,gBAAIC,MAAM,GAAGC,IAAI,CAACJ,OAAD,CAAjB;AACA,gBAAIK,GAAG,GAAGF,MAAM,CAACzG,MAAjB;AACA,gBAAI4G,GAAG,GAAG,IAAIC,UAAJ,CAAeF,GAAf,CAAV;;AACA,iBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,GAApB,EAAyBG,CAAC,EAA1B,EAA8B;AAC1BF,cAAAA,GAAG,CAACE,CAAD,CAAH,GAASL,MAAM,CAACM,UAAP,CAAkBD,CAAlB,CAAT;AACH;;AACDV,YAAAA,QAAQ,CAAC,IAAIY,IAAJ,CAAS,CAACJ,GAAD,CAAT,EAAgB;AAAE7I,cAAAA,IAAI,EAAEA,IAAI,IAAI;AAAhB,aAAhB,CAAD,CAAR;AACH,WARS,CAAV;AASH;AAZwD,OAA7D;AAcH;AACJ;;AAED,MAAIkJ,YAAY,GAAG,SAASA,YAAT,CAAsBhE,MAAtB,EAA8BqB,OAA9B,EAAuC;AACtD,QAAI4C,gBAAgB,GAChBxF,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,IADxE;AAEA,WAAO,IAAIyF,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjC,UAAIC,aAAa,GAAGH,gBAAgB,GAAGA,gBAAgB,CAACjE,MAAD,CAAnB,GAA8BA,MAAlE;AACAkE,MAAAA,OAAO,CAACC,OAAR,CAAgBC,aAAhB,EAA+BC,IAA/B,CAAoC,UAASrE,MAAT,EAAiB;AACjDA,QAAAA,MAAM,CAAC+C,MAAP,CAAcoB,OAAd,EAAuB9C,OAAO,CAACvG,IAA/B,EAAqCuG,OAAO,CAAC+B,OAA7C;AACH,OAFD;AAGH,KALM,CAAP;AAMH,GATD;;AAWA,MAAIkB,cAAc,GAAG,SAASA,cAAT,CAAwBC,CAAxB,EAA2BC,MAA3B,EAAmC;AACpD,WAAOC,cAAc,CAACF,CAAC,CAACnI,CAAF,GAAMoI,MAAP,EAAeD,CAAC,CAAClI,CAAF,GAAMmI,MAArB,CAArB;AACH,GAFD;;AAIA,MAAIE,SAAS,GAAG,SAASA,SAAT,CAAmBnI,CAAnB,EAAsBC,CAAtB,EAAyB;AACrC,WAAOiI,cAAc,CAAClI,CAAC,CAACH,CAAF,GAAMI,CAAC,CAACJ,CAAT,EAAYG,CAAC,CAACF,CAAF,GAAMG,CAAC,CAACH,CAApB,CAArB;AACH,GAFD;;AAIA,MAAIsI,eAAe,GAAG,SAASA,eAAT,CAAyBJ,CAAzB,EAA4B;AAC9C,QAAIK,CAAC,GAAGhI,IAAI,CAACC,IAAL,CAAU0H,CAAC,CAACnI,CAAF,GAAMmI,CAAC,CAACnI,CAAR,GAAYmI,CAAC,CAAClI,CAAF,GAAMkI,CAAC,CAAClI,CAA9B,CAAR;;AACA,QAAIuI,CAAC,KAAK,CAAV,EAAa;AACT,aAAO;AACHxI,QAAAA,CAAC,EAAE,CADA;AAEHC,QAAAA,CAAC,EAAE;AAFA,OAAP;AAIH;;AACD,WAAOoI,cAAc,CAACF,CAAC,CAACnI,CAAF,GAAMwI,CAAP,EAAUL,CAAC,CAAClI,CAAF,GAAMuI,CAAhB,CAArB;AACH,GATD;;AAWA,MAAIC,YAAY,GAAG,SAASA,YAAT,CAAsBN,CAAtB,EAAyBO,OAAzB,EAAkCC,MAAlC,EAA0C;AACzD,QAAItH,GAAG,GAAGb,IAAI,CAACa,GAAL,CAASqH,OAAT,CAAV;AACA,QAAIzH,GAAG,GAAGT,IAAI,CAACS,GAAL,CAASyH,OAAT,CAAV;AACA,QAAIE,CAAC,GAAGP,cAAc,CAACF,CAAC,CAACnI,CAAF,GAAM2I,MAAM,CAAC3I,CAAd,EAAiBmI,CAAC,CAAClI,CAAF,GAAM0I,MAAM,CAAC1I,CAA9B,CAAtB;AACA,WAAOoI,cAAc,CAACM,MAAM,CAAC3I,CAAP,GAAWqB,GAAG,GAAGuH,CAAC,CAAC5I,CAAnB,GAAuBiB,GAAG,GAAG2H,CAAC,CAAC3I,CAAhC,EAAmC0I,MAAM,CAAC1I,CAAP,GAAWgB,GAAG,GAAG2H,CAAC,CAAC5I,CAAnB,GAAuBqB,GAAG,GAAGuH,CAAC,CAAC3I,CAAlE,CAArB;AACH,GALD;;AAOA,MAAIoI,cAAc,GAAG,SAAStI,YAAT,GAAwB;AACzC,QAAIC,CAAC,GAAGqC,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,CAA5E;AACA,QAAIpC,CAAC,GAAGoC,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,CAA5E;AACA,WAAO;AAAErC,MAAAA,CAAC,EAAEA,CAAL;AAAQC,MAAAA,CAAC,EAAEA;AAAX,KAAP;AACH,GAJD;;AAMA,MAAI4I,cAAc,GAAG,SAASA,cAAT,CAAwB/B,KAAxB,EAA+BgC,IAA/B,EAAqC;AACtD,QAAIpF,MAAM,GAAGrB,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,CAAjF;AACA,QAAI0G,IAAI,GAAG1G,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,GAAuB0B,SAAS,CAAC,CAAD,CAAhC,GAAsCC,SAAjD;;AACA,QAAI,OAAOwE,KAAP,KAAiB,QAArB,EAA+B;AAC3B,aAAOkC,UAAU,CAAClC,KAAD,CAAV,GAAoBpD,MAA3B;AACH;;AACD,QAAI,OAAOoD,KAAP,KAAiB,QAArB,EAA+B;AAC3B,aAAOA,KAAK,IAAIiC,IAAI,GAAGD,IAAI,CAACC,IAAD,CAAP,GAAgBvI,IAAI,CAACyI,GAAL,CAASH,IAAI,CAACnJ,KAAd,EAAqBmJ,IAAI,CAAClJ,MAA1B,CAAxB,CAAZ;AACH;;AACD;AACH,GAVD;;AAYA,MAAIsJ,eAAe,GAAG,SAASA,eAAT,CAAyBC,MAAzB,EAAiCL,IAAjC,EAAuChD,KAAvC,EAA8C;AAChE,QAAIsD,SAAS,GAAGD,MAAM,CAACE,WAAP,IAAsBF,MAAM,CAACC,SAA7B,IAA0C,OAA1D;AACA,QAAIE,IAAI,GAAGH,MAAM,CAACI,eAAP,IAA0BJ,MAAM,CAACK,SAAjC,IAA8C,aAAzD;AACA,QAAIC,MAAM,GAAGN,MAAM,CAACO,WAAP,IAAsBP,MAAM,CAACQ,SAA7B,IAA0C,aAAvD;AACA,QAAIC,WAAW,GAAGf,cAAc,CAACM,MAAM,CAACU,WAAP,IAAsBV,MAAM,CAACW,SAA9B,EAAyChB,IAAzC,EAA+ChD,KAA/C,CAAhC;AACA,QAAIiE,OAAO,GAAGZ,MAAM,CAACY,OAAP,IAAkB,OAAhC;AACA,QAAIC,QAAQ,GAAGb,MAAM,CAACa,QAAP,IAAmB,OAAlC;AACA,QAAIC,MAAM,GACN,OAAOb,SAAP,KAAqB,QAArB,GACM,EADN,GAEMA,SAAS,CACJc,GADL,CACS,UAAS/B,CAAT,EAAY;AACb,aAAOU,cAAc,CAACV,CAAD,EAAIW,IAAJ,EAAUhD,KAAV,CAArB;AACH,KAHL,EAIKqE,IAJL,CAIU,GAJV,CAHV;AAQA,QAAIC,OAAO,GAAGjB,MAAM,CAACiB,OAAP,IAAkB,CAAhC;AACA,WAAO;AACH,wBAAkBL,OADf;AAEH,yBAAmBC,QAFhB;AAGH,sBAAgBJ,WAAW,IAAI,CAH5B;AAIH,0BAAoBK,MAJjB;AAKHR,MAAAA,MAAM,EAAEA,MALL;AAMHH,MAAAA,IAAI,EAAEA,IANH;AAOHc,MAAAA,OAAO,EAAEA;AAPN,KAAP;AASH,GAzBD;;AA2BA,MAAIC,SAAS,GAAG,SAASA,SAAT,CAAmBvD,KAAnB,EAA0B;AACtC,WAAOA,KAAK,IAAI,IAAhB;AACH,GAFD;;AAIA,MAAIwD,aAAa,GAAG,SAASA,aAAT,CAAuB7I,IAAvB,EAA6BqH,IAA7B,EAAmC;AACnD,QAAIpF,MAAM,GAAGrB,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,CAAjF;AAEA,QAAIkI,IAAI,GACJ1B,cAAc,CAACpH,IAAI,CAACzB,CAAN,EAAS8I,IAAT,EAAepF,MAAf,EAAuB,OAAvB,CAAd,IACAmF,cAAc,CAACpH,IAAI,CAAC8I,IAAN,EAAYzB,IAAZ,EAAkBpF,MAAlB,EAA0B,OAA1B,CAFlB;AAGA,QAAI8G,GAAG,GACH3B,cAAc,CAACpH,IAAI,CAACxB,CAAN,EAAS6I,IAAT,EAAepF,MAAf,EAAuB,QAAvB,CAAd,IACAmF,cAAc,CAACpH,IAAI,CAAC+I,GAAN,EAAW1B,IAAX,EAAiBpF,MAAjB,EAAyB,QAAzB,CAFlB;AAGA,QAAI/D,KAAK,GAAGkJ,cAAc,CAACpH,IAAI,CAAC9B,KAAN,EAAamJ,IAAb,EAAmBpF,MAAnB,EAA2B,OAA3B,CAA1B;AACA,QAAI9D,MAAM,GAAGiJ,cAAc,CAACpH,IAAI,CAAC7B,MAAN,EAAckJ,IAAd,EAAoBpF,MAApB,EAA4B,QAA5B,CAA3B;AACA,QAAI+G,KAAK,GAAG5B,cAAc,CAACpH,IAAI,CAACgJ,KAAN,EAAa3B,IAAb,EAAmBpF,MAAnB,EAA2B,OAA3B,CAA1B;AACA,QAAIgH,MAAM,GAAG7B,cAAc,CAACpH,IAAI,CAACiJ,MAAN,EAAc5B,IAAd,EAAoBpF,MAApB,EAA4B,QAA5B,CAA3B;;AAEA,QAAI,CAAC2G,SAAS,CAACG,GAAD,CAAd,EAAqB;AACjB,UAAIH,SAAS,CAACzK,MAAD,CAAT,IAAqByK,SAAS,CAACK,MAAD,CAAlC,EAA4C;AACxCF,QAAAA,GAAG,GAAG1B,IAAI,CAAClJ,MAAL,GAAcA,MAAd,GAAuB8K,MAA7B;AACH,OAFD,MAEO;AACHF,QAAAA,GAAG,GAAGE,MAAN;AACH;AACJ;;AAED,QAAI,CAACL,SAAS,CAACE,IAAD,CAAd,EAAsB;AAClB,UAAIF,SAAS,CAAC1K,KAAD,CAAT,IAAoB0K,SAAS,CAACI,KAAD,CAAjC,EAA0C;AACtCF,QAAAA,IAAI,GAAGzB,IAAI,CAACnJ,KAAL,GAAaA,KAAb,GAAqB8K,KAA5B;AACH,OAFD,MAEO;AACHF,QAAAA,IAAI,GAAGE,KAAP;AACH;AACJ;;AAED,QAAI,CAACJ,SAAS,CAAC1K,KAAD,CAAd,EAAuB;AACnB,UAAI0K,SAAS,CAACE,IAAD,CAAT,IAAmBF,SAAS,CAACI,KAAD,CAAhC,EAAyC;AACrC9K,QAAAA,KAAK,GAAGmJ,IAAI,CAACnJ,KAAL,GAAa4K,IAAb,GAAoBE,KAA5B;AACH,OAFD,MAEO;AACH9K,QAAAA,KAAK,GAAG,CAAR;AACH;AACJ;;AAED,QAAI,CAAC0K,SAAS,CAACzK,MAAD,CAAd,EAAwB;AACpB,UAAIyK,SAAS,CAACG,GAAD,CAAT,IAAkBH,SAAS,CAACK,MAAD,CAA/B,EAAyC;AACrC9K,QAAAA,MAAM,GAAGkJ,IAAI,CAAClJ,MAAL,GAAc4K,GAAd,GAAoBE,MAA7B;AACH,OAFD,MAEO;AACH9K,QAAAA,MAAM,GAAG,CAAT;AACH;AACJ;;AAED,WAAO;AACHI,MAAAA,CAAC,EAAEuK,IAAI,IAAI,CADR;AAEHtK,MAAAA,CAAC,EAAEuK,GAAG,IAAI,CAFP;AAGH7K,MAAAA,KAAK,EAAEA,KAAK,IAAI,CAHb;AAIHC,MAAAA,MAAM,EAAEA,MAAM,IAAI;AAJf,KAAP;AAMH,GApDD;;AAsDA,MAAI+K,iBAAiB,GAAG,SAASA,iBAAT,CAA2BC,MAA3B,EAAmC;AACvD,WAAOA,MAAM,CACRV,GADE,CACE,UAASW,KAAT,EAAgBC,KAAhB,EAAuB;AACxB,aAAO,GACFxL,MADE,CACKwL,KAAK,KAAK,CAAV,GAAc,GAAd,GAAoB,GADzB,EAC8B,GAD9B,EAEFxL,MAFE,CAEKuL,KAAK,CAAC7K,CAFX,EAEc,GAFd,EAGFV,MAHE,CAGKuL,KAAK,CAAC5K,CAHX,CAAP;AAIH,KANE,EAOFkK,IAPE,CAOG,GAPH,CAAP;AAQH,GATD;;AAWA,MAAIY,aAAa,GAAG,SAASA,aAAT,CAAuBC,OAAvB,EAAgCC,IAAhC,EAAsC;AACtD,WAAOrE,MAAM,CAACsE,IAAP,CAAYD,IAAZ,EAAkBE,OAAlB,CAA0B,UAASC,GAAT,EAAc;AAC3C,aAAOJ,OAAO,CAACK,YAAR,CAAqBD,GAArB,EAA0BH,IAAI,CAACG,GAAD,CAA9B,CAAP;AACH,KAFM,CAAP;AAGH,GAJD;;AAMA,MAAIE,EAAE,GAAG,4BAAT;;AACA,MAAIC,GAAG,GAAG,SAASA,GAAT,CAAaC,GAAb,EAAkBP,IAAlB,EAAwB;AAC9B,QAAID,OAAO,GAAGzG,QAAQ,CAACkH,eAAT,CAAyBH,EAAzB,EAA6BE,GAA7B,CAAd;;AACA,QAAIP,IAAJ,EAAU;AACNF,MAAAA,aAAa,CAACC,OAAD,EAAUC,IAAV,CAAb;AACH;;AACD,WAAOD,OAAP;AACH,GAND;;AAQA,MAAIU,UAAU,GAAG,SAASA,UAAT,CAAoBV,OAApB,EAA6B;AAC1C,WAAOD,aAAa,CAACC,OAAD,EAAUpE,MAAM,CAAC+E,MAAP,CAAc,EAAd,EAAkBX,OAAO,CAACvJ,IAA1B,EAAgCuJ,OAAO,CAACY,MAAxC,CAAV,CAApB;AACH,GAFD;;AAIA,MAAIC,aAAa,GAAG,SAASA,aAAT,CAAuBb,OAAvB,EAAgC;AAChD,QAAIxI,EAAE,GAAGwI,OAAO,CAACvJ,IAAR,CAAazB,CAAb,GAAiBgL,OAAO,CAACvJ,IAAR,CAAa9B,KAAb,GAAqB,GAA/C;AACA,QAAI8C,EAAE,GAAGuI,OAAO,CAACvJ,IAAR,CAAaxB,CAAb,GAAiB+K,OAAO,CAACvJ,IAAR,CAAa7B,MAAb,GAAsB,GAAhD;AACA,QAAIkM,EAAE,GAAGd,OAAO,CAACvJ,IAAR,CAAa9B,KAAb,GAAqB,GAA9B;AACA,QAAIoM,EAAE,GAAGf,OAAO,CAACvJ,IAAR,CAAa7B,MAAb,GAAsB,GAA/B;AACA,WAAOmL,aAAa,CAChBC,OADgB,EAEhBpE,MAAM,CAAC+E,MAAP,CACI;AACInJ,MAAAA,EAAE,EAAEA,EADR;AAEIC,MAAAA,EAAE,EAAEA,EAFR;AAGIqJ,MAAAA,EAAE,EAAEA,EAHR;AAIIC,MAAAA,EAAE,EAAEA;AAJR,KADJ,EAOIf,OAAO,CAACY,MAPZ,CAFgB,CAApB;AAYH,GAjBD;;AAmBA,MAAII,eAAe,GAAG;AAClBC,IAAAA,OAAO,EAAE,eADS;AAElBC,IAAAA,KAAK,EAAE;AAFW,GAAtB;;AAKA,MAAIC,WAAW,GAAG,SAASA,WAAT,CAAqBnB,OAArB,EAA8B7B,MAA9B,EAAsC;AACpD4B,IAAAA,aAAa,CACTC,OADS,EAETpE,MAAM,CAAC+E,MAAP,CAAc,EAAd,EAAkBX,OAAO,CAACvJ,IAA1B,EAAgCuJ,OAAO,CAACY,MAAxC,EAAgD;AAC5CQ,MAAAA,mBAAmB,EAAEJ,eAAe,CAAC7C,MAAM,CAACkD,GAAR,CAAf,IAA+B;AADR,KAAhD,CAFS,CAAb;AAMH,GAPD;;AASA,MAAIC,WAAW,GAAG;AACd/B,IAAAA,IAAI,EAAE,OADQ;AAEdhI,IAAAA,MAAM,EAAE,QAFM;AAGdkI,IAAAA,KAAK,EAAE;AAHO,GAAlB;;AAMA,MAAI8B,UAAU,GAAG,SAASA,UAAT,CAAoBvB,OAApB,EAA6B7B,MAA7B,EAAqCL,IAArC,EAA2ChD,KAA3C,EAAkD;AAC/D,QAAI0G,QAAQ,GAAG3D,cAAc,CAACM,MAAM,CAACqD,QAAR,EAAkB1D,IAAlB,EAAwBhD,KAAxB,CAA7B;AACA,QAAI2G,UAAU,GAAGtD,MAAM,CAACsD,UAAP,IAAqB,YAAtC;AACA,QAAIC,UAAU,GAAGvD,MAAM,CAACuD,UAAP,IAAqB,QAAtC;AACA,QAAIC,SAAS,GAAGL,WAAW,CAACnD,MAAM,CAACwD,SAAR,CAAX,IAAiC,OAAjD;AAEA5B,IAAAA,aAAa,CACTC,OADS,EAETpE,MAAM,CAAC+E,MAAP,CAAc,EAAd,EAAkBX,OAAO,CAACvJ,IAA1B,EAAgCuJ,OAAO,CAACY,MAAxC,EAAgD;AAC5C,sBAAgB,CAD4B;AAE5C,qBAAec,UAF6B;AAG5C,mBAAaF,QAH+B;AAI5C,qBAAeC,UAJ6B;AAK5C,qBAAeE;AAL6B,KAAhD,CAFS,CAAb,CAN+D,CAiB/D;;AACA,QAAI3B,OAAO,CAAC4B,IAAR,KAAiBzD,MAAM,CAACyD,IAA5B,EAAkC;AAC9B5B,MAAAA,OAAO,CAAC4B,IAAR,GAAezD,MAAM,CAACyD,IAAtB;AACA5B,MAAAA,OAAO,CAAC6B,WAAR,GAAsB1D,MAAM,CAACyD,IAAP,CAAYjM,MAAZ,GAAqBwI,MAAM,CAACyD,IAA5B,GAAmC,GAAzD;AACH;AACJ,GAtBD;;AAwBA,MAAIE,UAAU,GAAG,SAASA,UAAT,CAAoB9B,OAApB,EAA6B7B,MAA7B,EAAqCL,IAArC,EAA2ChD,KAA3C,EAAkD;AAC/DiF,IAAAA,aAAa,CACTC,OADS,EAETpE,MAAM,CAAC+E,MAAP,CAAc,EAAd,EAAkBX,OAAO,CAACvJ,IAA1B,EAAgCuJ,OAAO,CAACY,MAAxC,EAAgD;AAC5CtC,MAAAA,IAAI,EAAE;AADsC,KAAhD,CAFS,CAAb;AAOA,QAAIyD,IAAI,GAAG/B,OAAO,CAACgC,UAAR,CAAmB,CAAnB,CAAX;AACA,QAAIC,KAAK,GAAGjC,OAAO,CAACgC,UAAR,CAAmB,CAAnB,CAAZ;AACA,QAAIE,GAAG,GAAGlC,OAAO,CAACgC,UAAR,CAAmB,CAAnB,CAAV;AAEA,QAAIrE,MAAM,GAAGqC,OAAO,CAACvJ,IAArB;AAEA,QAAI0L,MAAM,GAAG;AACTnN,MAAAA,CAAC,EAAEgL,OAAO,CAACvJ,IAAR,CAAazB,CAAb,GAAiBgL,OAAO,CAACvJ,IAAR,CAAa9B,KADxB;AAETM,MAAAA,CAAC,EAAE+K,OAAO,CAACvJ,IAAR,CAAaxB,CAAb,GAAiB+K,OAAO,CAACvJ,IAAR,CAAa7B;AAFxB,KAAb;AAKAmL,IAAAA,aAAa,CAACgC,IAAD,EAAO;AAChBK,MAAAA,EAAE,EAAEzE,MAAM,CAAC3I,CADK;AAEhBqN,MAAAA,EAAE,EAAE1E,MAAM,CAAC1I,CAFK;AAGhBqN,MAAAA,EAAE,EAAEH,MAAM,CAACnN,CAHK;AAIhBuN,MAAAA,EAAE,EAAEJ,MAAM,CAAClN;AAJK,KAAP,CAAb;AAOA,QAAI,CAACkJ,MAAM,CAACqE,cAAZ,EAA4B;AAE5BP,IAAAA,KAAK,CAACQ,KAAN,CAAYC,OAAZ,GAAsB,MAAtB;AACAR,IAAAA,GAAG,CAACO,KAAJ,CAAUC,OAAV,GAAoB,MAApB;AAEA,QAAIvF,CAAC,GAAGI,eAAe,CAAC;AACpBvI,MAAAA,CAAC,EAAEmN,MAAM,CAACnN,CAAP,GAAW2I,MAAM,CAAC3I,CADD;AAEpBC,MAAAA,CAAC,EAAEkN,MAAM,CAAClN,CAAP,GAAW0I,MAAM,CAAC1I;AAFD,KAAD,CAAvB;AAKA,QAAIuI,CAAC,GAAGK,cAAc,CAAC,IAAD,EAAOC,IAAP,EAAahD,KAAb,CAAtB;;AAEA,QAAIqD,MAAM,CAACqE,cAAP,CAAsBG,OAAtB,CAA8B,aAA9B,MAAiD,CAAC,CAAtD,EAAyD;AACrD,UAAIC,uBAAuB,GAAG1F,cAAc,CAACC,CAAD,EAAIK,CAAJ,CAA5C;AACA,UAAIqF,gBAAgB,GAAGvF,SAAS,CAACK,MAAD,EAASiF,uBAAT,CAAhC;AACA,UAAIE,WAAW,GAAGrF,YAAY,CAACE,MAAD,EAAS,CAAT,EAAYkF,gBAAZ,CAA9B;AACA,UAAIE,WAAW,GAAGtF,YAAY,CAACE,MAAD,EAAS,CAAC,CAAV,EAAakF,gBAAb,CAA9B;AAEA9C,MAAAA,aAAa,CAACkC,KAAD,EAAQ;AACjBQ,QAAAA,KAAK,EAAE,gBADU;AAEjBO,QAAAA,CAAC,EAAE,IACE1O,MADF,CACSwO,WAAW,CAAC9N,CADrB,EACwB,GADxB,EAEEV,MAFF,CAESwO,WAAW,CAAC7N,CAFrB,EAEwB,IAFxB,EAGEX,MAHF,CAGSqJ,MAAM,CAAC3I,CAHhB,EAGmB,GAHnB,EAIEV,MAJF,CAISqJ,MAAM,CAAC1I,CAJhB,EAImB,IAJnB,EAKEX,MALF,CAKSyO,WAAW,CAAC/N,CALrB,EAKwB,GALxB,EAMEV,MANF,CAMSyO,WAAW,CAAC9N,CANrB;AAFc,OAAR,CAAb;AAUH;;AAED,QAAIkJ,MAAM,CAACqE,cAAP,CAAsBG,OAAtB,CAA8B,WAA9B,MAA+C,CAAC,CAApD,EAAuD;AACnD,UAAIM,qBAAqB,GAAG/F,cAAc,CAACC,CAAD,EAAI,CAACK,CAAL,CAA1C;AACA,UAAI0F,cAAc,GAAG5F,SAAS,CAAC6E,MAAD,EAASc,qBAAT,CAA9B;AACA,UAAIE,SAAS,GAAG1F,YAAY,CAAC0E,MAAD,EAAS,CAAT,EAAYe,cAAZ,CAA5B;AACA,UAAIE,SAAS,GAAG3F,YAAY,CAAC0E,MAAD,EAAS,CAAC,CAAV,EAAae,cAAb,CAA5B;AAEAnD,MAAAA,aAAa,CAACmC,GAAD,EAAM;AACfO,QAAAA,KAAK,EAAE,gBADQ;AAEfO,QAAAA,CAAC,EAAE,IACE1O,MADF,CACS6O,SAAS,CAACnO,CADnB,EACsB,GADtB,EAEEV,MAFF,CAES6O,SAAS,CAAClO,CAFnB,EAEsB,IAFtB,EAGEX,MAHF,CAGS6N,MAAM,CAACnN,CAHhB,EAGmB,GAHnB,EAIEV,MAJF,CAIS6N,MAAM,CAAClN,CAJhB,EAImB,IAJnB,EAKEX,MALF,CAKS8O,SAAS,CAACpO,CALnB,EAKsB,GALtB,EAMEV,MANF,CAMS8O,SAAS,CAACnO,CANnB;AAFY,OAAN,CAAb;AAUH;AACJ,GAzED;;AA2EA,MAAIoO,UAAU,GAAG,SAASA,UAAT,CAAoBrD,OAApB,EAA6B7B,MAA7B,EAAqCL,IAArC,EAA2ChD,KAA3C,EAAkD;AAC/DiF,IAAAA,aAAa,CACTC,OADS,EAETpE,MAAM,CAAC+E,MAAP,CAAc,EAAd,EAAkBX,OAAO,CAACY,MAA1B,EAAkC;AAC9BtC,MAAAA,IAAI,EAAE,MADwB;AAE9B0E,MAAAA,CAAC,EAAErD,iBAAiB,CAChBxB,MAAM,CAACyB,MAAP,CAAcV,GAAd,CAAkB,UAASW,KAAT,EAAgB;AAC9B,eAAO;AACH7K,UAAAA,CAAC,EAAE6I,cAAc,CAACgC,KAAK,CAAC7K,CAAP,EAAU8I,IAAV,EAAgBhD,KAAhB,EAAuB,OAAvB,CADd;AAEH7F,UAAAA,CAAC,EAAE4I,cAAc,CAACgC,KAAK,CAAC5K,CAAP,EAAU6I,IAAV,EAAgBhD,KAAhB,EAAuB,QAAvB;AAFd,SAAP;AAIH,OALD,CADgB;AAFU,KAAlC,CAFS,CAAb;AAcH,GAfD;;AAiBA,MAAIwI,WAAW,GAAG,SAASA,WAAT,CAAqBC,IAArB,EAA2B;AACzC,WAAO,UAASpF,MAAT,EAAiB;AACpB,aAAOoC,GAAG,CAACgD,IAAD,EAAO;AAAEC,QAAAA,EAAE,EAAErF,MAAM,CAACqF;AAAb,OAAP,CAAV;AACH,KAFD;AAGH,GAJD;;AAMA,MAAIC,WAAW,GAAG,SAASA,WAAT,CAAqBtF,MAArB,EAA6B;AAC3C,QAAIuF,KAAK,GAAGnD,GAAG,CAAC,OAAD,EAAU;AACrBiD,MAAAA,EAAE,EAAErF,MAAM,CAACqF,EADU;AAErB,wBAAkB,OAFG;AAGrB,yBAAmB,OAHE;AAIrBpE,MAAAA,OAAO,EAAE;AAJY,KAAV,CAAf;;AAOAsE,IAAAA,KAAK,CAACC,MAAN,GAAe,YAAW;AACtBD,MAAAA,KAAK,CAACrD,YAAN,CAAmB,SAAnB,EAA8BlC,MAAM,CAACiB,OAAP,IAAkB,CAAhD;AACH,KAFD;;AAGAsE,IAAAA,KAAK,CAACE,cAAN,CAAqB,8BAArB,EAAqD,YAArD,EAAmEzF,MAAM,CAAC0F,GAA1E;AACA,WAAOH,KAAP;AACH,GAbD;;AAeA,MAAII,UAAU,GAAG,SAASA,UAAT,CAAoB3F,MAApB,EAA4B;AACzC,QAAIuF,KAAK,GAAGnD,GAAG,CAAC,GAAD,EAAM;AACjBiD,MAAAA,EAAE,EAAErF,MAAM,CAACqF,EADM;AAEjB,wBAAkB,OAFD;AAGjB,yBAAmB;AAHF,KAAN,CAAf;AAMA,QAAIzB,IAAI,GAAGxB,GAAG,CAAC,MAAD,CAAd;AACAmD,IAAAA,KAAK,CAACK,WAAN,CAAkBhC,IAAlB;AAEA,QAAIE,KAAK,GAAG1B,GAAG,CAAC,MAAD,CAAf;AACAmD,IAAAA,KAAK,CAACK,WAAN,CAAkB9B,KAAlB;AAEA,QAAIC,GAAG,GAAG3B,GAAG,CAAC,MAAD,CAAb;AACAmD,IAAAA,KAAK,CAACK,WAAN,CAAkB7B,GAAlB;AAEA,WAAOwB,KAAP;AACH,GAjBD;;AAmBA,MAAIM,kBAAkB,GAAG;AACrB9L,IAAAA,KAAK,EAAEuL,WADc;AAErBhN,IAAAA,IAAI,EAAE6M,WAAW,CAAC,MAAD,CAFI;AAGrBW,IAAAA,OAAO,EAAEX,WAAW,CAAC,SAAD,CAHC;AAIrB1B,IAAAA,IAAI,EAAE0B,WAAW,CAAC,MAAD,CAJI;AAKrBY,IAAAA,IAAI,EAAEZ,WAAW,CAAC,MAAD,CALI;AAMrBvB,IAAAA,IAAI,EAAE+B;AANe,GAAzB;AASA,MAAIK,kBAAkB,GAAG;AACrB1N,IAAAA,IAAI,EAAEiK,UADe;AAErBuD,IAAAA,OAAO,EAAEpD,aAFY;AAGrB3I,IAAAA,KAAK,EAAEiJ,WAHc;AAIrBS,IAAAA,IAAI,EAAEL,UAJe;AAKrB2C,IAAAA,IAAI,EAAEb,UALe;AAMrBtB,IAAAA,IAAI,EAAED;AANe,GAAzB;;AASA,MAAIsC,kBAAkB,GAAG,SAASA,kBAAT,CAA4B1Q,IAA5B,EAAkCyK,MAAlC,EAA0C;AAC/D,WAAO6F,kBAAkB,CAACtQ,IAAD,CAAlB,CAAyByK,MAAzB,CAAP;AACH,GAFD;;AAIA,MAAIkG,kBAAkB,GAAG,SAASA,kBAAT,CAA4BrE,OAA5B,EAAqCtM,IAArC,EAA2CyK,MAA3C,EAAmDL,IAAnD,EAAyDhD,KAAzD,EAAgE;AACrF,QAAIpH,IAAI,KAAK,MAAb,EAAqB;AACjBsM,MAAAA,OAAO,CAACvJ,IAAR,GAAe6I,aAAa,CAACnB,MAAD,EAASL,IAAT,EAAehD,KAAf,CAA5B;AACH;;AACDkF,IAAAA,OAAO,CAACY,MAAR,GAAiB1C,eAAe,CAACC,MAAD,EAASL,IAAT,EAAehD,KAAf,CAAhC;AACAqJ,IAAAA,kBAAkB,CAACzQ,IAAD,CAAlB,CAAyBsM,OAAzB,EAAkC7B,MAAlC,EAA0CL,IAA1C,EAAgDhD,KAAhD;AACH,GAND;;AAQA,MAAIwJ,kBAAkB,GAAG,SAASA,kBAAT,CAA4BnP,CAA5B,EAA+BC,CAA/B,EAAkC;AACvD,QAAID,CAAC,CAAC,CAAD,CAAD,CAAKoP,MAAL,GAAcnP,CAAC,CAAC,CAAD,CAAD,CAAKmP,MAAvB,EAA+B;AAC3B,aAAO,CAAP;AACH;;AACD,QAAIpP,CAAC,CAAC,CAAD,CAAD,CAAKoP,MAAL,GAAcnP,CAAC,CAAC,CAAD,CAAD,CAAKmP,MAAvB,EAA+B;AAC3B,aAAO,CAAC,CAAR;AACH;;AACD,WAAO,CAAP;AACH,GARD;;AAUA,MAAIC,OAAO,GAAG,SAASA,OAAT,CAAiBC,IAAjB,EAAuB;AACjC,QAAIzK,IAAI,GAAG3C,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAA/E;AACA,QAAI8G,MAAM,GAAG9G,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,GAAuB0B,SAAS,CAAC,CAAD,CAAhC,GAAsCC,SAAnD;AACA,QAAI2C,OAAO,GAAG5C,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,GAAuB0B,SAAS,CAAC,CAAD,CAAhC,GAAsCC,SAApD;AACA,WAAO,IAAIwF,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjC,UAAI5C,mBAAmB,GAAGF,OAAO,CAACG,UAAlC;AAAA,UACIA,UAAU,GAAGD,mBAAmB,KAAK,KAAK,CAA7B,GAAiC,IAAjC,GAAwCA,mBADzD,CADiC,CAIjC;;AACA,UAAIuK,EAAE,GAAG,IAAIC,UAAJ,EAAT;;AACAD,MAAAA,EAAE,CAACE,SAAH,GAAe,YAAW;AACtB;AACA,YAAIhD,IAAI,GAAG8C,EAAE,CAACG,MAAd,CAFsB,CAItB;;AACA,YAAIC,QAAQ,GAAGvL,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf;AACAsL,QAAAA,QAAQ,CAACrC,KAAT,CAAesC,OAAf,GACI,2EADJ;AAEAD,QAAAA,QAAQ,CAACE,SAAT,GAAqBpD,IAArB;AACA,YAAIqD,YAAY,GAAGH,QAAQ,CAACI,aAAT,CAAuB,KAAvB,CAAnB;AACA3L,QAAAA,QAAQ,CAAC4L,IAAT,CAAcpB,WAAd,CAA0Be,QAA1B,EAVsB,CAYtB;;AACA,YAAIM,IAAI,GAAGH,YAAY,CAACI,OAAb,EAAX;AACAP,QAAAA,QAAQ,CAACQ,UAAT,CAAoBC,WAApB,CAAgCT,QAAhC,EAdsB,CAgBtB;;AACA,YAAIU,SAAS,GAAGV,QAAQ,CAACI,aAAT,CAAuB,OAAvB,CAAhB,CAjBsB,CAmBtB;;AACA,YAAIO,gBAAgB,GAAGR,YAAY,CAACS,YAAb,CAA0B,SAA1B,KAAwC,EAA/D;AACA,YAAIC,cAAc,GAAGV,YAAY,CAACS,YAAb,CAA0B,OAA1B,KAAsC,EAA3D;AACA,YAAIE,eAAe,GAAGX,YAAY,CAACS,YAAb,CAA0B,QAA1B,KAAuC,EAA7D;AACA,YAAI/Q,KAAK,GAAGqJ,UAAU,CAAC2H,cAAD,CAAV,IAA8B,IAA1C;AACA,YAAI/Q,MAAM,GAAGoJ,UAAU,CAAC4H,eAAD,CAAV,IAA+B,IAA5C;AACA,YAAIC,UAAU,GAAG,CAACF,cAAc,CAACG,KAAf,CAAqB,QAArB,KAAkC,EAAnC,EAAuC,CAAvC,KAA6C,EAA9D;AACA,YAAIC,WAAW,GAAG,CAACH,eAAe,CAACE,KAAhB,CAAsB,QAAtB,KAAmC,EAApC,EAAwC,CAAxC,KAA8C,EAAhE,CA1BsB,CA4BtB;;AACA,YAAIE,WAAW,GAAGP,gBAAgB,CAACrR,KAAjB,CAAuB,GAAvB,EAA4B8K,GAA5B,CAAgClB,UAAhC,CAAlB;AACA,YAAIiI,OAAO,GAAGD,WAAW,CAACrQ,MAAZ,GACR;AACIX,UAAAA,CAAC,EAAEgR,WAAW,CAAC,CAAD,CADlB;AAEI/Q,UAAAA,CAAC,EAAE+Q,WAAW,CAAC,CAAD,CAFlB;AAGIrR,UAAAA,KAAK,EAAEqR,WAAW,CAAC,CAAD,CAHtB;AAIIpR,UAAAA,MAAM,EAAEoR,WAAW,CAAC,CAAD;AAJvB,SADQ,GAORZ,IAPN;AASA,YAAI1N,UAAU,GAAG/C,KAAK,IAAI,IAAT,GAAgBA,KAAhB,GAAwBsR,OAAO,CAACtR,KAAjD;AACA,YAAIgD,WAAW,GAAG/C,MAAM,IAAI,IAAV,GAAiBA,MAAjB,GAA0BqR,OAAO,CAACrR,MAApD;AAEAqQ,QAAAA,YAAY,CAACxC,KAAb,CAAmByD,QAAnB,GAA8B,SAA9B;AACAjB,QAAAA,YAAY,CAAC5E,YAAb,CAA0B,OAA1B,EAAmC3I,UAAnC;AACAuN,QAAAA,YAAY,CAAC5E,YAAb,CAA0B,QAA1B,EAAoC1I,WAApC,EA5CsB,CA8CtB;;AACA,YAAIwO,SAAS,GAAG,EAAhB;;AACA,YAAIhI,MAAM,IAAIA,MAAM,CAACxI,MAArB,EAA6B;AACzB,cAAImI,IAAI,GAAG;AACPnJ,YAAAA,KAAK,EAAE+C,UADA;AAEP9C,YAAAA,MAAM,EAAE+C;AAFD,WAAX;AAKAwO,UAAAA,SAAS,GAAGhI,MAAM,CAACiI,IAAP,CAAY9B,kBAAZ,EAAgC+B,MAAhC,CAAuC,UAASC,IAAT,EAAe5C,KAAf,EAAsB;AACrE,gBAAI6C,EAAE,GAAGnC,kBAAkB,CAACV,KAAK,CAAC,CAAD,CAAN,EAAWA,KAAK,CAAC,CAAD,CAAhB,CAA3B;AACAW,YAAAA,kBAAkB,CAACkC,EAAD,EAAK7C,KAAK,CAAC,CAAD,CAAV,EAAeA,KAAK,CAAC,CAAD,CAApB,EAAyB5F,IAAzB,CAAlB;AACAyI,YAAAA,EAAE,CAACC,eAAH,CAAmB,IAAnB;;AACA,gBAAID,EAAE,CAACb,YAAH,CAAgB,SAAhB,MAA+B,CAAnC,EAAsC;AAClCa,cAAAA,EAAE,CAACC,eAAH,CAAmB,SAAnB;AACH;;AACD,mBAAOF,IAAI,GAAG,IAAP,GAAcC,EAAE,CAACE,SAAjB,GAA6B,IAApC;AACH,WARW,EAQT,EARS,CAAZ;AASAN,UAAAA,SAAS,GAAG,UAAU7R,MAAV,CAAiB6R,SAAS,CAACO,OAAV,CAAkB,SAAlB,EAA6B,GAA7B,CAAjB,EAAoD,UAApD,CAAZ;AACH;;AAED,YAAI1O,WAAW,GAAGgC,IAAI,CAAChC,WAAL,IAAoBL,WAAW,GAAGD,UAApD;AAEA,YAAIY,WAAW,GAAGZ,UAAlB;AACA,YAAIa,YAAY,GAAGD,WAAW,GAAGN,WAAjC;AAEA,YAAI4C,WAAW,GAAG,OAAOZ,IAAI,CAACa,UAAZ,KAA2B,WAA3B,IAA0Cb,IAAI,CAACa,UAAjE;AAEA,YAAI8L,WAAW,GAAG3M,IAAI,CAACzC,MAAL,GAAcyC,IAAI,CAACzC,MAAL,CAAYvC,CAA1B,GAA8B,GAAhD;AACA,YAAI4R,WAAW,GAAG5M,IAAI,CAACzC,MAAL,GAAcyC,IAAI,CAACzC,MAAL,CAAYtC,CAA1B,GAA8B,GAAhD;AAEA,YAAI4R,gBAAgB,GAAG3P,sBAAsB,CACzC;AACIvC,UAAAA,KAAK,EAAE+C,UADX;AAEI9C,UAAAA,MAAM,EAAE+C;AAFZ,SADyC,EAMzCG,mBAAmB,CACf;AACInD,UAAAA,KAAK,EAAE2D,WADX;AAEI1D,UAAAA,MAAM,EAAE2D;AAFZ,SADe,EAMfP,WANe,CANsB,EAezCgC,IAAI,CAACpE,QAfoC,EAgBzCgF,WAAW,GACL;AAAE5F,UAAAA,CAAC,EAAE2R,WAAL;AAAkB1R,UAAAA,CAAC,EAAE2R;AAArB,SADK,GAEL;AACI5R,UAAAA,CAAC,EAAE,GADP;AAEIC,UAAAA,CAAC,EAAE;AAFP,SAlBmC,CAA7C;AAwBA,YAAI6F,KAAK,GAAGd,IAAI,CAAC5B,IAAL,GAAYyO,gBAAxB;AAEA,YAAIjR,QAAQ,GAAGoE,IAAI,CAACpE,QAAL,IAAiB,MAAMJ,IAAI,CAACsR,EAA5B,CAAf;AAEA,YAAIpM,YAAY,GAAG;AACf1F,UAAAA,CAAC,EAAEsD,WAAW,GAAG,GADF;AAEfrD,UAAAA,CAAC,EAAEsD,YAAY,GAAG;AAFH,SAAnB;AAKA,YAAIyC,WAAW,GAAG;AACdhG,UAAAA,CAAC,EAAE0F,YAAY,CAAC1F,CAAb,GAAiB0C,UAAU,GAAGiP,WADnB;AAEd1R,UAAAA,CAAC,EAAEyF,YAAY,CAACzF,CAAb,GAAiB0C,WAAW,GAAGiP;AAFpB,SAAlB;AAKA,YAAIG,cAAc,GAAG,CACjB;AACA,kBACKzS,MADL,CACYsB,QADZ,EACsB,GADtB,EAEKtB,MAFL,CAEYoG,YAAY,CAAC1F,CAFzB,EAE4B,GAF5B,EAGKV,MAHL,CAGYoG,YAAY,CAACzF,CAHzB,EAG4B,GAH5B,CAFiB,EAOjB;AACA,qBAAaX,MAAb,CAAoBoG,YAAY,CAAC1F,CAAjC,EAAoC,GAApC,EAAyCV,MAAzC,CAAgDoG,YAAY,CAACzF,CAA7D,EAAgE,GAAhE,CARiB,EASjB,SAASX,MAAT,CAAgBwG,KAAhB,EAAuB,GAAvB,CATiB,EAUjB,aAAaxG,MAAb,CAAoB,CAACoG,YAAY,CAAC1F,CAAlC,EAAqC,GAArC,EAA0CV,MAA1C,CAAiD,CAACoG,YAAY,CAACzF,CAA/D,EAAkE,GAAlE,CAViB,EAYjB;AACA,qBAAaX,MAAb,CAAoB0G,WAAW,CAAChG,CAAhC,EAAmC,GAAnC,EAAwCV,MAAxC,CAA+C0G,WAAW,CAAC/F,CAA3D,EAA8D,GAA9D,CAbiB,CAArB;AAgBA,YAAI+R,kBAAkB,GAAGhN,IAAI,CAACf,IAAL,IAAae,IAAI,CAACf,IAAL,CAAUC,UAAhD;AACA,YAAI+N,gBAAgB,GAAGjN,IAAI,CAACf,IAAL,IAAae,IAAI,CAACf,IAAL,CAAUE,QAA9C;AAEA,YAAI+N,cAAc,GAAG,CACjB,SACK5S,MADL,CACY0S,kBAAkB,GAAG,CAAC,CAAJ,GAAQ,CADtC,EACyC,GADzC,EAEK1S,MAFL,CAEY2S,gBAAgB,GAAG,CAAC,CAAJ,GAAQ,CAFpC,EAEuC,GAFvC,CADiB,EAIjB,aACK3S,MADL,CACY0S,kBAAkB,GAAG,CAACtP,UAAJ,GAAiB,CAD/C,EACkD,GADlD,EAEKpD,MAFL,CAEY2S,gBAAgB,GAAG,CAACtP,WAAJ,GAAkB,CAF9C,EAEiD,GAFjD,CAJiB,CAArB,CArIsB,CA8ItB;;AACA,YAAIwP,WAAW,GAAG,uDACb7S,MADa,CACNgE,WADM,EAEbhE,MAFa,CAENuR,UAFM,EAEM,YAFN,EAGbvR,MAHa,CAGNiE,YAHM,EAIbjE,MAJa,CAINyR,WAJM,EAIO,mBAJP,EAKbzR,MALa,CAKNgE,WALM,EAKO,GALP,EAMbhE,MANa,CAMNiE,YANM,EAMQ,IANR,EAObjE,MAPa,CAQV8F,UAAU,GAAG,uBAAuBA,UAAvB,GAAoC,IAAvC,GAA8C,EAR9C,EASV,6KATU,EAWb9F,MAXa,CAWNkR,SAAS,GAAGA,SAAS,CAAC3D,WAAb,GAA2B,EAX9B,EAWkC,0BAXlC,EAYbvN,MAZa,CAYNyS,cAAc,CAAC5H,IAAf,CAAoB,GAApB,CAZM,EAYoB,oBAZpB,EAab7K,MAba,CAaN4S,cAAc,CAAC/H,IAAf,CAAoB,GAApB,CAbM,EAaoB,MAbpB,EAcb7K,MAda,CAcN2Q,YAAY,CAACwB,SAdP,EAebnS,MAfa,CAeN6R,SAfM,EAeK,sBAfL,CAAlB,CA/IsB,CAgKtB;;AACApJ,QAAAA,OAAO,CAACoK,WAAD,CAAP;AACH,OAlKD;;AAoKAzC,MAAAA,EAAE,CAAC0C,UAAH,CAAc3C,IAAd;AACH,KA3KM,CAAP;AA4KH,GAhLD;;AAkLA,MAAI4C,iBAAiB,GAAG,SAASA,iBAAT,CAA2BC,GAA3B,EAAgC;AACpD,QAAIjM,SAAJ;;AACA,QAAI;AACAA,MAAAA,SAAS,GAAG,IAAIkM,SAAJ,CAAcD,GAAG,CAAC3S,KAAlB,EAAyB2S,GAAG,CAAC1S,MAA7B,CAAZ;AACH,KAFD,CAEE,OAAO4S,CAAP,EAAU;AACR;AACA,UAAI5O,MAAM,GAAGW,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;AACA6B,MAAAA,SAAS,GAAGzC,MAAM,CAACE,UAAP,CAAkB,IAAlB,EAAwB2O,eAAxB,CAAwCH,GAAG,CAAC3S,KAA5C,EAAmD2S,GAAG,CAAC1S,MAAvD,CAAZ;AACH;;AACDyG,IAAAA,SAAS,CAACqM,IAAV,CAAeC,GAAf,CAAmBL,GAAG,CAACI,IAAvB;AACA,WAAOrM,SAAP;AACH,GAXD;AAaA;;;AACA,MAAIuM,eAAe,GAAG,SAASA,eAAT,GAA2B;AAC7C;AACA,QAAIC,UAAU,GAAG;AAAEC,MAAAA,MAAM,EAAEA,MAAV;AAAkBC,MAAAA,MAAM,EAAEA;AAA1B,KAAjB,CAF6C,CAI7C;;AACA,QAAIC,eAAe,GAAG,SAASA,eAAT,CAAyBC,UAAzB,EAAqC5M,SAArC,EAAgD;AAClE4M,MAAAA,UAAU,CAAC9H,OAAX,CAAmB,UAASzG,SAAT,EAAoB;AACnC2B,QAAAA,SAAS,GAAGwM,UAAU,CAACnO,SAAS,CAAChG,IAAX,CAAV,CAA2B2H,SAA3B,EAAsC3B,SAAS,CAACgO,IAAhD,CAAZ;AACH,OAFD;AAGA,aAAOrM,SAAP;AACH,KALD,CAL6C,CAY7C;;;AACA,QAAI3B,SAAS,GAAG,SAASA,SAAT,CAAmBgO,IAAnB,EAAyBQ,EAAzB,EAA6B;AACzC,UAAID,UAAU,GAAGP,IAAI,CAACO,UAAtB,CADyC,CAGzC;;AACA,UAAIE,eAAe,GAAG,IAAtB;AACAF,MAAAA,UAAU,CAAC9H,OAAX,CAAmB,UAASzG,SAAT,EAAoB;AACnC,YAAIA,SAAS,CAAChG,IAAV,KAAmB,QAAvB,EAAiC;AAC7ByU,UAAAA,eAAe,GAAGzO,SAAlB;AACH;AACJ,OAJD;;AAKA,UAAIyO,eAAJ,EAAqB;AACjB;AACA,YAAIC,eAAe,GAAG,IAAtB;AACAH,QAAAA,UAAU,CAAC9H,OAAX,CAAmB,UAASzG,SAAT,EAAoB;AACnC,cAAIA,SAAS,CAAChG,IAAV,KAAmB,QAAvB,EAAiC;AAC7B0U,YAAAA,eAAe,GAAG1O,SAAlB;AACH;AACJ,SAJD;;AAMA,YAAI0O,eAAJ,EAAqB;AACjB;AACAA,UAAAA,eAAe,CAACV,IAAhB,CAAqB9N,MAArB,GAA8BuO,eAAe,CAACT,IAA9C,CAFiB,CAIjB;;AACAO,UAAAA,UAAU,GAAGA,UAAU,CAACF,MAAX,CAAkB,UAASrO,SAAT,EAAoB;AAC/C,mBAAOA,SAAS,CAAChG,IAAV,KAAmB,QAA1B;AACH,WAFY,CAAb;AAGH;AACJ;;AAEDwU,MAAAA,EAAE,CAACF,eAAe,CAACC,UAAD,EAAaP,IAAI,CAACrM,SAAlB,CAAhB,CAAF;AACH,KA/BD,CAb6C,CA8C7C;;;AACAhI,IAAAA,IAAI,CAACgV,SAAL,GAAiB,UAASb,CAAT,EAAY;AACzB9N,MAAAA,SAAS,CAAC8N,CAAC,CAACE,IAAF,CAAOY,OAAR,EAAiB,UAASC,QAAT,EAAmB;AACzC;AACAlV,QAAAA,IAAI,CAACmV,WAAL,CAAiB;AAAEhF,UAAAA,EAAE,EAAEgE,CAAC,CAACE,IAAF,CAAOlE,EAAb;AAAiB8E,UAAAA,OAAO,EAAEC;AAA1B,SAAjB,EAAuD,CAACA,QAAQ,CAACb,IAAT,CAAce,MAAf,CAAvD;AACH,OAHQ,CAAT;AAIH,KALD;;AAOA,QAAIC,EAAE,GAAG,GAAT;AACA,QAAIC,EAAE,GAAG,GAAT;AACA,QAAIC,EAAE,GAAG,GAAT;;AACA,aAASC,iBAAT,CAA2B/I,KAA3B,EAAkC4H,IAAlC,EAAwCoB,CAAxC,EAA2C;AACvC,UAAIC,EAAE,GAAGrB,IAAI,CAAC5H,KAAD,CAAJ,GAAc,GAAvB;AACA,UAAIkJ,EAAE,GAAGtB,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkB,GAA3B;AACA,UAAImJ,EAAE,GAAGvB,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkB,GAA3B;AACA,UAAIoJ,EAAE,GAAGxB,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkB,GAA3B;AAEA,UAAIqJ,EAAE,GAAGJ,EAAE,GAAGD,CAAC,CAAC,CAAD,CAAN,GAAYE,EAAE,GAAGF,CAAC,CAAC,CAAD,CAAlB,GAAwBG,EAAE,GAAGH,CAAC,CAAC,CAAD,CAA9B,GAAoCI,EAAE,GAAGJ,CAAC,CAAC,CAAD,CAA1C,GAAgDA,CAAC,CAAC,CAAD,CAA1D;AACA,UAAIM,EAAE,GAAGL,EAAE,GAAGD,CAAC,CAAC,CAAD,CAAN,GAAYE,EAAE,GAAGF,CAAC,CAAC,CAAD,CAAlB,GAAwBG,EAAE,GAAGH,CAAC,CAAC,CAAD,CAA9B,GAAoCI,EAAE,GAAGJ,CAAC,CAAC,CAAD,CAA1C,GAAgDA,CAAC,CAAC,CAAD,CAA1D;AACA,UAAIO,EAAE,GAAGN,EAAE,GAAGD,CAAC,CAAC,EAAD,CAAN,GAAaE,EAAE,GAAGF,CAAC,CAAC,EAAD,CAAnB,GAA0BG,EAAE,GAAGH,CAAC,CAAC,EAAD,CAAhC,GAAuCI,EAAE,GAAGJ,CAAC,CAAC,EAAD,CAA7C,GAAoDA,CAAC,CAAC,EAAD,CAA9D;AACA,UAAIQ,EAAE,GAAGP,EAAE,GAAGD,CAAC,CAAC,EAAD,CAAN,GAAaE,EAAE,GAAGF,CAAC,CAAC,EAAD,CAAnB,GAA0BG,EAAE,GAAGH,CAAC,CAAC,EAAD,CAAhC,GAAuCI,EAAE,GAAGJ,CAAC,CAAC,EAAD,CAA7C,GAAoDA,CAAC,CAAC,EAAD,CAA9D;AAEA,UAAIS,EAAE,GAAG/T,IAAI,CAACqC,GAAL,CAAS,CAAT,EAAYsR,EAAE,GAAGG,EAAjB,IAAuBZ,EAAE,IAAI,MAAMY,EAAV,CAAlC;AACA,UAAIE,EAAE,GAAGhU,IAAI,CAACqC,GAAL,CAAS,CAAT,EAAYuR,EAAE,GAAGE,EAAjB,IAAuBX,EAAE,IAAI,MAAMW,EAAV,CAAlC;AACA,UAAIG,EAAE,GAAGjU,IAAI,CAACqC,GAAL,CAAS,CAAT,EAAYwR,EAAE,GAAGC,EAAjB,IAAuBV,EAAE,IAAI,MAAMU,EAAV,CAAlC;AAEA5B,MAAAA,IAAI,CAAC5H,KAAD,CAAJ,GAActK,IAAI,CAACqC,GAAL,CAAS,GAAT,EAAcrC,IAAI,CAACyI,GAAL,CAAS,GAAT,EAAcsL,EAAd,CAAd,IAAmC,GAAjD;AACA7B,MAAAA,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkBtK,IAAI,CAACqC,GAAL,CAAS,GAAT,EAAcrC,IAAI,CAACyI,GAAL,CAAS,GAAT,EAAcuL,EAAd,CAAd,IAAmC,GAArD;AACA9B,MAAAA,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkBtK,IAAI,CAACqC,GAAL,CAAS,GAAT,EAAcrC,IAAI,CAACyI,GAAL,CAAS,GAAT,EAAcwL,EAAd,CAAd,IAAmC,GAArD;AACH;;AAED,QAAIC,cAAc,GAAGrW,IAAI,CAACsW,IAAL,CAAUC,SAAV,CAAoB,CACrC,CADqC,EAErC,CAFqC,EAGrC,CAHqC,EAIrC,CAJqC,EAKrC,CALqC,EAMrC,CANqC,EAOrC,CAPqC,EAQrC,CARqC,EASrC,CATqC,EAUrC,CAVqC,EAWrC,CAXqC,EAYrC,CAZqC,EAarC,CAbqC,EAcrC,CAdqC,EAerC,CAfqC,EAgBrC,CAhBqC,EAiBrC,CAjBqC,EAkBrC,CAlBqC,EAmBrC,CAnBqC,EAoBrC,CApBqC,CAApB,CAArB;;AAsBA,aAASC,gBAAT,CAA0B9B,MAA1B,EAAkC;AAC9B,aAAO1U,IAAI,CAACsW,IAAL,CAAUC,SAAV,CAAoB7B,MAAM,IAAI,EAA9B,MAAsC2B,cAA7C;AACH;;AAED,aAAS3B,MAAT,CAAgB1M,SAAhB,EAA2BzB,MAA3B,EAAmC;AAC/B,UAAI,CAACA,MAAD,IAAWiQ,gBAAgB,CAACjQ,MAAD,CAA/B,EAAyC,OAAOyB,SAAP;AAEzC,UAAIqM,IAAI,GAAGrM,SAAS,CAACqM,IAArB;AACA,UAAIlK,CAAC,GAAGkK,IAAI,CAAC/R,MAAb;AAEA,UAAImU,GAAG,GAAGlQ,MAAM,CAAC,CAAD,CAAhB;AACA,UAAImQ,GAAG,GAAGnQ,MAAM,CAAC,CAAD,CAAhB;AACA,UAAIoQ,GAAG,GAAGpQ,MAAM,CAAC,CAAD,CAAhB;AACA,UAAIqQ,GAAG,GAAGrQ,MAAM,CAAC,CAAD,CAAhB;AACA,UAAIsQ,GAAG,GAAGtQ,MAAM,CAAC,CAAD,CAAhB;AAEA,UAAIuQ,GAAG,GAAGvQ,MAAM,CAAC,CAAD,CAAhB;AACA,UAAIwQ,GAAG,GAAGxQ,MAAM,CAAC,CAAD,CAAhB;AACA,UAAIyQ,GAAG,GAAGzQ,MAAM,CAAC,CAAD,CAAhB;AACA,UAAI0Q,GAAG,GAAG1Q,MAAM,CAAC,CAAD,CAAhB;AACA,UAAI2Q,GAAG,GAAG3Q,MAAM,CAAC,CAAD,CAAhB;AAEA,UAAI4Q,GAAG,GAAG5Q,MAAM,CAAC,EAAD,CAAhB;AACA,UAAI6Q,GAAG,GAAG7Q,MAAM,CAAC,EAAD,CAAhB;AACA,UAAI8Q,GAAG,GAAG9Q,MAAM,CAAC,EAAD,CAAhB;AACA,UAAI+Q,GAAG,GAAG/Q,MAAM,CAAC,EAAD,CAAhB;AACA,UAAIgR,GAAG,GAAGhR,MAAM,CAAC,EAAD,CAAhB;AAEA,UAAIiR,GAAG,GAAGjR,MAAM,CAAC,EAAD,CAAhB;AACA,UAAIkR,GAAG,GAAGlR,MAAM,CAAC,EAAD,CAAhB;AACA,UAAImR,GAAG,GAAGnR,MAAM,CAAC,EAAD,CAAhB;AACA,UAAIoR,GAAG,GAAGpR,MAAM,CAAC,EAAD,CAAhB;AACA,UAAIqR,GAAG,GAAGrR,MAAM,CAAC,EAAD,CAAhB;AAEA,UAAIkG,KAAK,GAAG,CAAZ;AAAA,UACIoL,CAAC,GAAG,GADR;AAAA,UAEIC,CAAC,GAAG,GAFR;AAAA,UAGI/V,CAAC,GAAG,GAHR;AAAA,UAIID,CAAC,GAAG,GAJR;AAAA,UAKIgU,EAAE,GAAG,GALT;AAAA,UAMIC,EAAE,GAAG,GANT;AAAA,UAOIC,EAAE,GAAG,GAPT;AAAA,UAQIC,EAAE,GAAG,GART;AAAA,UASIC,EAAE,GAAG,GATT;AAAA,UAUIC,EAAE,GAAG,GAVT;AAAA,UAWIC,EAAE,GAAG,GAXT;;AAaA,aAAO3J,KAAK,GAAGtC,CAAf,EAAkBsC,KAAK,IAAI,CAA3B,EAA8B;AAC1BoL,QAAAA,CAAC,GAAGxD,IAAI,CAAC5H,KAAD,CAAJ,GAAc,GAAlB;AACAqL,QAAAA,CAAC,GAAGzD,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkB,GAAtB;AACA1K,QAAAA,CAAC,GAAGsS,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkB,GAAtB;AACA3K,QAAAA,CAAC,GAAGuS,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkB,GAAtB;AAEAqJ,QAAAA,EAAE,GAAG+B,CAAC,GAAGpB,GAAJ,GAAUqB,CAAC,GAAGpB,GAAd,GAAoB3U,CAAC,GAAG4U,GAAxB,GAA8B7U,CAAC,GAAG8U,GAAlC,GAAwCC,GAA7C;AACAd,QAAAA,EAAE,GAAG8B,CAAC,GAAGf,GAAJ,GAAUgB,CAAC,GAAGf,GAAd,GAAoBhV,CAAC,GAAGiV,GAAxB,GAA8BlV,CAAC,GAAGmV,GAAlC,GAAwCC,GAA7C;AACAlB,QAAAA,EAAE,GAAG6B,CAAC,GAAGV,GAAJ,GAAUW,CAAC,GAAGV,GAAd,GAAoBrV,CAAC,GAAGsV,GAAxB,GAA8BvV,CAAC,GAAGwV,GAAlC,GAAwCC,GAA7C;AACAtB,QAAAA,EAAE,GAAG4B,CAAC,GAAGL,GAAJ,GAAUM,CAAC,GAAGL,GAAd,GAAoB1V,CAAC,GAAG2V,GAAxB,GAA8B5V,CAAC,GAAG6V,GAAlC,GAAwCC,GAA7C;AAEA1B,QAAAA,EAAE,GAAG/T,IAAI,CAACqC,GAAL,CAAS,CAAT,EAAYsR,EAAE,GAAGG,EAAjB,IAAuBZ,EAAE,IAAI,MAAMY,EAAV,CAA9B;AACAE,QAAAA,EAAE,GAAGhU,IAAI,CAACqC,GAAL,CAAS,CAAT,EAAYuR,EAAE,GAAGE,EAAjB,IAAuBX,EAAE,IAAI,MAAMW,EAAV,CAA9B;AACAG,QAAAA,EAAE,GAAGjU,IAAI,CAACqC,GAAL,CAAS,CAAT,EAAYwR,EAAE,GAAGC,EAAjB,IAAuBV,EAAE,IAAI,MAAMU,EAAV,CAA9B;AAEA5B,QAAAA,IAAI,CAAC5H,KAAD,CAAJ,GAActK,IAAI,CAACqC,GAAL,CAAS,GAAT,EAAcrC,IAAI,CAACyI,GAAL,CAAS,GAAT,EAAcsL,EAAd,CAAd,IAAmC,GAAjD;AACA7B,QAAAA,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkBtK,IAAI,CAACqC,GAAL,CAAS,GAAT,EAAcrC,IAAI,CAACyI,GAAL,CAAS,GAAT,EAAcuL,EAAd,CAAd,IAAmC,GAArD;AACA9B,QAAAA,IAAI,CAAC5H,KAAK,GAAG,CAAT,CAAJ,GAAkBtK,IAAI,CAACqC,GAAL,CAAS,GAAT,EAAcrC,IAAI,CAACyI,GAAL,CAAS,GAAT,EAAcwL,EAAd,CAAd,IAAmC,GAArD,CAjB0B,CAkB1B;AACH;;AAED,aAAOpO,SAAP;AACH;;AAED,aAASyM,MAAT,CAAgBzM,SAAhB,EAA2BqM,IAA3B,EAAiC;AAC7B,UAAI0D,UAAU,GAAG1D,IAAI,CAAC2D,IAAtB;AAAA,UACIA,IAAI,GAAGD,UAAU,KAAK,KAAK,CAApB,GAAwB,SAAxB,GAAoCA,UAD/C;AAAA,UAEIE,aAAa,GAAG5D,IAAI,CAAC6D,OAFzB;AAAA,UAGIA,OAAO,GAAGD,aAAa,KAAK,KAAK,CAAvB,GAA2B,KAA3B,GAAmCA,aAHjD;AAAA,UAII3W,KAAK,GAAG+S,IAAI,CAAC/S,KAJjB;AAAA,UAKIC,MAAM,GAAG8S,IAAI,CAAC9S,MALlB;AAAA,UAMIgF,MAAM,GAAG8N,IAAI,CAAC9N,MANlB,CAD6B,CAS7B;;AACAA,MAAAA,MAAM,GAAG,CAACA,MAAD,IAAWiQ,gBAAgB,CAACjQ,MAAD,CAA3B,GAAsC,IAAtC,GAA6CA,MAAtD,CAV6B,CAY7B;AACA;;AACA,UAAI,CAACjF,KAAD,IAAU,CAACC,MAAf,EAAuB;AACnB,eAAOmT,MAAM,CAAC1M,SAAD,EAAYzB,MAAZ,CAAb;AACH,OAhB4B,CAkB7B;;;AACA,UAAIjF,KAAK,KAAK,IAAd,EAAoB;AAChBA,QAAAA,KAAK,GAAGC,MAAR;AACH,OAFD,MAEO,IAAIA,MAAM,KAAK,IAAf,EAAqB;AACxBA,QAAAA,MAAM,GAAGD,KAAT;AACH;;AAED,UAAI0W,IAAI,KAAK,OAAb,EAAsB;AAClB,YAAIG,WAAW,GAAG7W,KAAK,GAAG0G,SAAS,CAAC1G,KAApC;AACA,YAAI8W,YAAY,GAAG7W,MAAM,GAAGyG,SAAS,CAACzG,MAAtC;AACA,YAAI8D,MAAM,GAAG,CAAb;;AAEA,YAAI2S,IAAI,KAAK,OAAb,EAAsB;AAClB3S,UAAAA,MAAM,GAAGlD,IAAI,CAACqC,GAAL,CAAS2T,WAAT,EAAsBC,YAAtB,CAAT;AACH,SAFD,MAEO,IAAIJ,IAAI,KAAK,SAAb,EAAwB;AAC3B3S,UAAAA,MAAM,GAAGlD,IAAI,CAACyI,GAAL,CAASuN,WAAT,EAAsBC,YAAtB,CAAT;AACH,SATiB,CAWlB;;;AACA,YAAI/S,MAAM,GAAG,CAAT,IAAc6S,OAAO,KAAK,KAA9B,EAAqC;AACjC,iBAAOxD,MAAM,CAAC1M,SAAD,EAAYzB,MAAZ,CAAb;AACH;;AAEDjF,QAAAA,KAAK,GAAG0G,SAAS,CAAC1G,KAAV,GAAkB+D,MAA1B;AACA9D,QAAAA,MAAM,GAAGyG,SAAS,CAACzG,MAAV,GAAmB8D,MAA5B;AACH;;AAED,UAAIgT,WAAW,GAAGrQ,SAAS,CAAC1G,KAA5B;AACA,UAAIgX,YAAY,GAAGtQ,SAAS,CAACzG,MAA7B;AACA,UAAIgX,WAAW,GAAGpW,IAAI,CAACuF,KAAL,CAAWpG,KAAX,CAAlB;AACA,UAAIkX,YAAY,GAAGrW,IAAI,CAACuF,KAAL,CAAWnG,MAAX,CAAnB;AACA,UAAIkX,SAAS,GAAGzQ,SAAS,CAACqM,IAA1B;AACA,UAAIqE,UAAU,GAAG,IAAIC,iBAAJ,CAAsBJ,WAAW,GAAGC,YAAd,GAA6B,CAAnD,CAAjB;AACA,UAAII,UAAU,GAAGP,WAAW,GAAGE,WAA/B;AACA,UAAIM,WAAW,GAAGP,YAAY,GAAGE,YAAjC;AACA,UAAIM,cAAc,GAAG3W,IAAI,CAAC4W,IAAL,CAAUH,UAAU,GAAG,GAAvB,CAArB;AACA,UAAII,eAAe,GAAG7W,IAAI,CAAC4W,IAAL,CAAUF,WAAW,GAAG,GAAxB,CAAtB;;AAEA,WAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGT,YAApB,EAAkCS,CAAC,EAAnC,EAAuC;AACnC,aAAK,IAAI7P,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmP,WAApB,EAAiCnP,CAAC,EAAlC,EAAsC;AAClC,cAAI6F,EAAE,GAAG,CAAC7F,CAAC,GAAG6P,CAAC,GAAGV,WAAT,IAAwB,CAAjC;AACA,cAAIW,MAAM,GAAG,CAAb;AACA,cAAIC,OAAO,GAAG,CAAd;AACA,cAAIC,YAAY,GAAG,CAAnB;AACA,cAAIvB,CAAC,GAAG,CAAR;AACA,cAAIC,CAAC,GAAG,CAAR;AACA,cAAI/V,CAAC,GAAG,CAAR;AACA,cAAID,CAAC,GAAG,CAAR;AACA,cAAIuX,OAAO,GAAG,CAACJ,CAAC,GAAG,GAAL,IAAYJ,WAA1B;;AAEA,eAAK,IAAIS,EAAE,GAAGnX,IAAI,CAACiF,KAAL,CAAW6R,CAAC,GAAGJ,WAAf,CAAd,EAA2CS,EAAE,GAAG,CAACL,CAAC,GAAG,CAAL,IAAUJ,WAA1D,EAAuES,EAAE,EAAzE,EAA6E;AACzE,gBAAIC,EAAE,GAAGpX,IAAI,CAACuB,GAAL,CAAS2V,OAAO,IAAIC,EAAE,GAAG,GAAT,CAAhB,IAAiCN,eAA1C;AACA,gBAAIQ,OAAO,GAAG,CAACpQ,CAAC,GAAG,GAAL,IAAYwP,UAA1B;AACA,gBAAIa,EAAE,GAAGF,EAAE,GAAGA,EAAd;;AAEA,iBAAK,IAAIG,EAAE,GAAGvX,IAAI,CAACiF,KAAL,CAAWgC,CAAC,GAAGwP,UAAf,CAAd,EAA0Cc,EAAE,GAAG,CAACtQ,CAAC,GAAG,CAAL,IAAUwP,UAAzD,EAAqEc,EAAE,EAAvE,EAA2E;AACvE,kBAAIC,EAAE,GAAGxX,IAAI,CAACuB,GAAL,CAAS8V,OAAO,IAAIE,EAAE,GAAG,GAAT,CAAhB,IAAiCZ,cAA1C;AACA,kBAAIzV,CAAC,GAAGlB,IAAI,CAACC,IAAL,CAAUqX,EAAE,GAAGE,EAAE,GAAGA,EAApB,CAAR;;AAEA,kBAAItW,CAAC,IAAI,CAAC,CAAN,IAAWA,CAAC,IAAI,CAApB,EAAuB;AACnB6V,gBAAAA,MAAM,GAAG,IAAI7V,CAAJ,GAAQA,CAAR,GAAYA,CAAZ,GAAgB,IAAIA,CAAJ,GAAQA,CAAxB,GAA4B,CAArC;;AAEA,oBAAI6V,MAAM,GAAG,CAAb,EAAgB;AACZS,kBAAAA,EAAE,GAAG,KAAKD,EAAE,GAAGJ,EAAE,GAAGjB,WAAf,CAAL;AAEA,sBAAIuB,GAAG,GAAGnB,SAAS,CAACkB,EAAE,GAAG,CAAN,CAAnB;AACA7X,kBAAAA,CAAC,IAAIoX,MAAM,GAAGU,GAAd;AACAR,kBAAAA,YAAY,IAAIF,MAAhB;;AAEA,sBAAIU,GAAG,GAAG,GAAV,EAAe;AACXV,oBAAAA,MAAM,GAAIA,MAAM,GAAGU,GAAV,GAAiB,GAA1B;AACH;;AAED/B,kBAAAA,CAAC,IAAIqB,MAAM,GAAGT,SAAS,CAACkB,EAAD,CAAvB;AACA7B,kBAAAA,CAAC,IAAIoB,MAAM,GAAGT,SAAS,CAACkB,EAAE,GAAG,CAAN,CAAvB;AACA5X,kBAAAA,CAAC,IAAImX,MAAM,GAAGT,SAAS,CAACkB,EAAE,GAAG,CAAN,CAAvB;AACAR,kBAAAA,OAAO,IAAID,MAAX;AACH;AACJ;AACJ;AACJ;;AAEDR,UAAAA,UAAU,CAACzJ,EAAD,CAAV,GAAiB4I,CAAC,GAAGsB,OAArB;AACAT,UAAAA,UAAU,CAACzJ,EAAE,GAAG,CAAN,CAAV,GAAqB6I,CAAC,GAAGqB,OAAzB;AACAT,UAAAA,UAAU,CAACzJ,EAAE,GAAG,CAAN,CAAV,GAAqBlN,CAAC,GAAGoX,OAAzB;AACAT,UAAAA,UAAU,CAACzJ,EAAE,GAAG,CAAN,CAAV,GAAqBnN,CAAC,GAAGsX,YAAzB;AAEA7S,UAAAA,MAAM,IAAIiP,iBAAiB,CAACvG,EAAD,EAAKyJ,UAAL,EAAiBnS,MAAjB,CAA3B;AACH;AACJ;;AAED,aAAO;AACH8N,QAAAA,IAAI,EAAEqE,UADH;AAEHpX,QAAAA,KAAK,EAAEiX,WAFJ;AAGHhX,QAAAA,MAAM,EAAEiX;AAHL,OAAP;AAKH;AACJ,GA7RD;AA8RA;;;AAEA,MAAIqB,kBAAkB,GAAG,SAASA,kBAAT,CAA4BC,IAA5B,EAAkCC,MAAlC,EAA0C;AAC/D;AACA,QAAID,IAAI,CAACE,SAAL,CAAeD,MAAM,GAAG,CAAxB,EAA2B,KAA3B,MAAsC,UAA1C,EAAsD,OAFS,CAI/D;;AACAA,IAAAA,MAAM,IAAI,CAAV,CAL+D,CAO/D;AACA;;AACA,QAAIE,gBAAgB,GAAGH,IAAI,CAACI,SAAL,CAAgBH,MAAM,IAAI,CAA1B,EAA8B,KAA9B,MAAyC,MAAhE;AACAA,IAAAA,MAAM,IAAID,IAAI,CAACE,SAAL,CAAeD,MAAM,GAAG,CAAxB,EAA2BE,gBAA3B,CAAV;AAEA,QAAIE,IAAI,GAAGL,IAAI,CAACI,SAAL,CAAeH,MAAf,EAAuBE,gBAAvB,CAAX;AACAF,IAAAA,MAAM,IAAI,CAAV,CAb+D,CAe/D;;AACA,SAAK,IAAI3Q,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+Q,IAApB,EAA0B/Q,CAAC,EAA3B,EAA+B;AAC3B,UAAI0Q,IAAI,CAACI,SAAL,CAAeH,MAAM,GAAG3Q,CAAC,GAAG,EAA5B,EAAgC6Q,gBAAhC,MAAsD,MAA1D,EAAkE;AAC9DH,QAAAA,IAAI,CAACM,SAAL,CAAeL,MAAM,GAAG3Q,CAAC,GAAG,EAAb,GAAkB,CAAjC,EAAoC,CAApC,EAAuC6Q,gBAAvC;AACA,eAAO,IAAP;AACH;AACJ;;AACD,WAAO,KAAP;AACH,GAvBD;;AAyBA,MAAII,QAAQ,GAAG,SAASA,QAAT,CAAkBhG,IAAlB,EAAwB;AACnC,QAAIyF,IAAI,GAAG,IAAIQ,QAAJ,CAAajG,IAAb,CAAX,CADmC,CAGnC;AACA;;AACA,QAAIyF,IAAI,CAACI,SAAL,CAAe,CAAf,MAAsB,MAA1B,EAAkC,OAAO,IAAP;AAElC,QAAIH,MAAM,GAAG,CAAb,CAPmC,CAOnB;;AAChB,QAAIQ,MAAJ;AACA,QAAIC,YAAJ;AACA,QAAIC,oBAAoB,GAAG,KAA3B;;AAEA,WAAOV,MAAM,GAAGD,IAAI,CAACY,UAArB,EAAiC;AAC7BH,MAAAA,MAAM,GAAGT,IAAI,CAACI,SAAL,CAAeH,MAAf,EAAuB,KAAvB,CAAT;AACAS,MAAAA,YAAY,GAAGV,IAAI,CAACI,SAAL,CAAeH,MAAM,GAAG,CAAxB,EAA2B,KAA3B,IAAoC,CAAnD,CAF6B,CAI7B;;AACA,UAAIY,MAAM,GAAIJ,MAAM,IAAI,MAAV,IAAoBA,MAAM,IAAI,MAA/B,IAA0CA,MAAM,KAAK,MAAlE;;AACA,UAAI,CAACI,MAAL,EAAa;AACT;AACH;;AAED,UAAI,CAACF,oBAAL,EAA2B;AACvBA,QAAAA,oBAAoB,GAAGZ,kBAAkB,CAACC,IAAD,EAAOC,MAAP,EAAeS,YAAf,CAAzC;AACH;;AAED,UAAIT,MAAM,GAAGS,YAAT,GAAwBV,IAAI,CAACY,UAAjC,EAA6C;AACzC;AACH;;AAEDX,MAAAA,MAAM,IAAIS,YAAV;AACH;;AACD,WAAOnG,IAAI,CAACuG,KAAL,CAAW,CAAX,EAAcb,MAAd,CAAP;AACH,GAjCD;;AAmCA,MAAIc,YAAY,GAAG,SAASA,YAAT,CAAsB1a,IAAtB,EAA4B;AAC3C,WAAO,IAAIsJ,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjC,UAAIoR,MAAM,GAAG,IAAIxJ,UAAJ,EAAb;;AACAwJ,MAAAA,MAAM,CAACxK,MAAP,GAAgB,YAAW;AACvB,eAAO5G,OAAO,CAAC2Q,QAAQ,CAACS,MAAM,CAACtJ,MAAR,CAAR,IAA2B,IAA5B,CAAd;AACH,OAFD;;AAGAsJ,MAAAA,MAAM,CAACC,iBAAP,CAAyB5a,IAAI,CAACya,KAAL,CAAW,CAAX,EAAc,MAAM,IAApB,CAAzB;AACH,KANM,CAAP;AAOH,GARD;;AAUA,MAAII,cAAc,GAAG,SAASA,cAAT,GAA0B;AAC3C,WAAQ7S,MAAM,CAAC8S,WAAP,GACJ9S,MAAM,CAAC8S,WAAP,IACA9S,MAAM,CAAC+S,iBADP,IAEA/S,MAAM,CAACgT,cAFP,IAGAhT,MAAM,CAACiT,aAJX;AAKH,GAND;;AAQA,MAAIC,UAAU,GAAG,SAASA,UAAT,CAAoBC,WAApB,EAAiCxa,QAAjC,EAA2C;AACxD,QAAIya,EAAE,GAAGP,cAAc,EAAvB;;AAEA,QAAIO,EAAJ,EAAQ;AACJ,UAAIhG,EAAE,GAAG,IAAIgG,EAAJ,EAAT;AACAhG,MAAAA,EAAE,CAACiG,MAAH,CAAUF,WAAV;AACA,aAAO/F,EAAE,CAACkG,OAAH,CAAW3a,QAAX,CAAP;AACH;;AAED,WAAO,IAAIwI,IAAJ,CAAS,CAACgS,WAAD,CAAT,EAAwB;AAC3Bjb,MAAAA,IAAI,EAAES;AADqB,KAAxB,CAAP;AAGH,GAZD;;AAcA,MAAI4a,WAAW,GAAG,SAASA,WAAT,GAAuB;AACrC,WAAOvZ,IAAI,CAACwZ,MAAL,GACFC,QADE,CACO,EADP,EAEFpb,MAFE,CAEK,CAFL,EAEQ,CAFR,CAAP;AAGH,GAJD;;AAMA,MAAIqb,YAAY,GAAG,SAASA,YAAT,CAAsBC,EAAtB,EAA0B;AACzC,QAAIC,UAAU,GAAG,IAAIzS,IAAJ,CAAS,CAAC,GAAD,EAAMwS,EAAE,CAACF,QAAH,EAAN,EAAqB,KAArB,CAAT,EAAsC;AAAEvb,MAAAA,IAAI,EAAE;AAAR,KAAtC,CAAjB;AACA,QAAI2b,SAAS,GAAGC,GAAG,CAACC,eAAJ,CAAoBH,UAApB,CAAhB;AACA,QAAII,MAAM,GAAG,IAAIC,MAAJ,CAAWJ,SAAX,CAAb;AAEA,QAAIK,KAAK,GAAG,EAAZ;AAEA,WAAO;AACHC,MAAAA,QAAQ,EAAE,SAASA,QAAT,GAAoB,CAAE,CAD7B;AAC+B;AAClCC,MAAAA,IAAI,EAAE,SAASA,IAAT,CAActH,OAAd,EAAuBJ,EAAvB,EAA2B2H,YAA3B,EAAyC;AAC3C,YAAIrM,EAAE,GAAGuL,WAAW,EAApB;AACAW,QAAAA,KAAK,CAAClM,EAAD,CAAL,GAAY0E,EAAZ;;AAEAsH,QAAAA,MAAM,CAACnH,SAAP,GAAmB,UAASb,CAAT,EAAY;AAC3B,cAAIU,EAAE,GAAGwH,KAAK,CAAClI,CAAC,CAACE,IAAF,CAAOlE,EAAR,CAAd;AACA,cAAI,CAAC0E,EAAL,EAAS;AACTA,UAAAA,EAAE,CAACV,CAAC,CAACE,IAAF,CAAOY,OAAR,CAAF;AACA,iBAAOoH,KAAK,CAAClI,CAAC,CAACE,IAAF,CAAOlE,EAAR,CAAZ;AACH,SALD;;AAOAgM,QAAAA,MAAM,CAAChH,WAAP,CACI;AACIhF,UAAAA,EAAE,EAAEA,EADR;AAEI8E,UAAAA,OAAO,EAAEA;AAFb,SADJ,EAMIuH,YANJ;AAQH,OArBE;AAsBHC,MAAAA,SAAS,EAAE,SAASA,SAAT,GAAqB;AAC5BN,QAAAA,MAAM,CAACM,SAAP;AACAR,QAAAA,GAAG,CAACS,eAAJ,CAAoBV,SAApB;AACH;AAzBE,KAAP;AA2BH,GAlCD;;AAoCA,MAAIW,SAAS,GAAG,SAASA,SAAT,CAAmBC,GAAnB,EAAwB;AACpC,WAAO,IAAInT,OAAJ,CAAY,UAASC,OAAT,EAAkBmT,MAAlB,EAA0B;AACzC,UAAIC,GAAG,GAAG,IAAIC,KAAJ,EAAV;;AACAD,MAAAA,GAAG,CAACxM,MAAJ,GAAa,YAAW;AACpB5G,QAAAA,OAAO,CAACoT,GAAD,CAAP;AACH,OAFD;;AAGAA,MAAAA,GAAG,CAACE,OAAJ,GAAc,UAAS7I,CAAT,EAAY;AACtB0I,QAAAA,MAAM,CAAC1I,CAAD,CAAN;AACH,OAFD;;AAGA2I,MAAAA,GAAG,CAACtM,GAAJ,GAAUoM,GAAV;AACH,KATM,CAAP;AAUH,GAXD;;AAaA,MAAIK,KAAK,GAAG,SAASA,KAAT,CAAeC,KAAf,EAAsB;AAC9B,WAAOA,KAAK,CAAClK,MAAN,CAAa,UAASmK,OAAT,EAAkBC,IAAlB,EAAwB;AACxC,aAAOD,OAAO,CAACvT,IAAR,CAAa,UAAS4H,MAAT,EAAiB;AACjC,eAAO4L,IAAI,GAAGxT,IAAP,CAAYyT,KAAK,CAAChV,SAAN,CAAgBpH,MAAhB,CAAuBqc,IAAvB,CAA4B9L,MAA5B,CAAZ,CAAP;AACH,OAFM,CAAP;AAGH,KAJM,EAIJ/H,OAAO,CAACC,OAAR,CAAgB,EAAhB,CAJI,CAAP;AAKH,GAND;;AAQA,MAAI6T,iBAAiB,GAAG,SAASA,iBAAT,CAA2BhY,MAA3B,EAAmCuF,MAAnC,EAA2C;AAC/D,WAAO,IAAIrB,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjC,UAAIe,IAAI,GAAG;AACPnJ,QAAAA,KAAK,EAAEiE,MAAM,CAACjE,KADP;AAEPC,QAAAA,MAAM,EAAEgE,MAAM,CAAChE;AAFR,OAAX;AAKA,UAAIiE,GAAG,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAV;AAEA,UAAI+X,OAAO,GAAG1S,MAAM,CAACiI,IAAP,CAAY9B,kBAAZ,EAAgCpF,GAAhC,CAAoC,UAAS4R,IAAT,EAAe;AAC7D,eAAO,YAAW;AACd,iBAAO,IAAIhU,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjC,gBAAI8H,MAAM,GAAGkM,gBAAgB,CAACD,IAAI,CAAC,CAAD,CAAL,CAAhB,CAA0BjY,GAA1B,EAA+BiF,IAA/B,EAAqCgT,IAAI,CAAC,CAAD,CAAzC,EAA8C/T,OAA9C,CAAb;AACA,gBAAI8H,MAAJ,EAAY9H,OAAO;AACtB,WAHM,CAAP;AAIH,SALD;AAMH,OAPa,CAAd;AASAuT,MAAAA,KAAK,CAACO,OAAD,CAAL,CAAe5T,IAAf,CAAoB,YAAW;AAC3B,eAAOF,OAAO,CAACnE,MAAD,CAAd;AACH,OAFD;AAGH,KApBM,CAAP;AAqBH,GAtBD;;AAwBA,MAAIoY,iBAAiB,GAAG,SAASA,iBAAT,CAA2BnY,GAA3B,EAAgC+H,MAAhC,EAAwC;AAC5D/H,IAAAA,GAAG,CAACoY,SAAJ;AACApY,IAAAA,GAAG,CAACkG,OAAJ,GAAc6B,MAAM,CAAC,gBAAD,CAApB;AACA/H,IAAAA,GAAG,CAACmG,QAAJ,GAAe4B,MAAM,CAAC,iBAAD,CAArB;AACA/H,IAAAA,GAAG,CAACiG,SAAJ,GAAgB8B,MAAM,CAAC,cAAD,CAAtB;;AACA,QAAIA,MAAM,CAAC,kBAAD,CAAN,CAA2BjL,MAA/B,EAAuC;AACnCkD,MAAAA,GAAG,CAACqY,WAAJ,CAAgBtQ,MAAM,CAAC,kBAAD,CAAN,CAA2BxM,KAA3B,CAAiC,GAAjC,CAAhB;AACH;;AACDyE,IAAAA,GAAG,CAACoC,SAAJ,GAAgB2F,MAAM,CAAC,MAAD,CAAtB;AACA/H,IAAAA,GAAG,CAACsY,WAAJ,GAAkBvQ,MAAM,CAAC,QAAD,CAAxB;AACA/H,IAAAA,GAAG,CAACuY,WAAJ,GAAkBxQ,MAAM,CAACxB,OAAP,IAAkB,CAApC;AACH,GAXD;;AAaA,MAAIiS,gBAAgB,GAAG,SAASA,gBAAT,CAA0BxY,GAA1B,EAA+B;AAClDA,IAAAA,GAAG,CAACyF,IAAJ;AACAzF,IAAAA,GAAG,CAAC4F,MAAJ;AACA5F,IAAAA,GAAG,CAACuY,WAAJ,GAAkB,CAAlB;AACH,GAJD;;AAMA,MAAIE,QAAQ,GAAG,SAASA,QAAT,CAAkBzY,GAAlB,EAAuBiF,IAAvB,EAA6BK,MAA7B,EAAqC;AAChD,QAAI1H,IAAI,GAAG6I,aAAa,CAACnB,MAAD,EAASL,IAAT,CAAxB;AACA,QAAI8C,MAAM,GAAG1C,eAAe,CAACC,MAAD,EAASL,IAAT,CAA5B;AACAkT,IAAAA,iBAAiB,CAACnY,GAAD,EAAM+H,MAAN,CAAjB;AACA/H,IAAAA,GAAG,CAACpC,IAAJ,CAASA,IAAI,CAACzB,CAAd,EAAiByB,IAAI,CAACxB,CAAtB,EAAyBwB,IAAI,CAAC9B,KAA9B,EAAqC8B,IAAI,CAAC7B,MAA1C;AACAyc,IAAAA,gBAAgB,CAACxY,GAAD,EAAM+H,MAAN,CAAhB;AACA,WAAO,IAAP;AACH,GAPD;;AASA,MAAI2Q,WAAW,GAAG,SAASA,WAAT,CAAqB1Y,GAArB,EAA0BiF,IAA1B,EAAgCK,MAAhC,EAAwC;AACtD,QAAI1H,IAAI,GAAG6I,aAAa,CAACnB,MAAD,EAASL,IAAT,CAAxB;AACA,QAAI8C,MAAM,GAAG1C,eAAe,CAACC,MAAD,EAASL,IAAT,CAA5B;AACAkT,IAAAA,iBAAiB,CAACnY,GAAD,EAAM+H,MAAN,CAAjB;AAEA,QAAI5L,CAAC,GAAGyB,IAAI,CAACzB,CAAb;AAAA,QACIC,CAAC,GAAGwB,IAAI,CAACxB,CADb;AAAA,QAEIyB,CAAC,GAAGD,IAAI,CAAC9B,KAFb;AAAA,QAGIgC,CAAC,GAAGF,IAAI,CAAC7B,MAHb;AAAA,QAII4c,KAAK,GAAG,SAJZ;AAAA,QAKIC,EAAE,GAAI/a,CAAC,GAAG,CAAL,GAAU8a,KALnB;AAAA,QAMIE,EAAE,GAAI/a,CAAC,GAAG,CAAL,GAAU6a,KANnB;AAAA,QAOIG,EAAE,GAAG3c,CAAC,GAAG0B,CAPb;AAAA,QAQIkb,EAAE,GAAG3c,CAAC,GAAG0B,CARb;AAAA,QASIkb,EAAE,GAAG7c,CAAC,GAAG0B,CAAC,GAAG,CATjB;AAAA,QAUIob,EAAE,GAAG7c,CAAC,GAAG0B,CAAC,GAAG,CAVjB;AAYAkC,IAAAA,GAAG,CAACkZ,MAAJ,CAAW/c,CAAX,EAAc8c,EAAd;AACAjZ,IAAAA,GAAG,CAACmZ,aAAJ,CAAkBhd,CAAlB,EAAqB8c,EAAE,GAAGJ,EAA1B,EAA8BG,EAAE,GAAGJ,EAAnC,EAAuCxc,CAAvC,EAA0C4c,EAA1C,EAA8C5c,CAA9C;AACA4D,IAAAA,GAAG,CAACmZ,aAAJ,CAAkBH,EAAE,GAAGJ,EAAvB,EAA2Bxc,CAA3B,EAA8B0c,EAA9B,EAAkCG,EAAE,GAAGJ,EAAvC,EAA2CC,EAA3C,EAA+CG,EAA/C;AACAjZ,IAAAA,GAAG,CAACmZ,aAAJ,CAAkBL,EAAlB,EAAsBG,EAAE,GAAGJ,EAA3B,EAA+BG,EAAE,GAAGJ,EAApC,EAAwCG,EAAxC,EAA4CC,EAA5C,EAAgDD,EAAhD;AACA/Y,IAAAA,GAAG,CAACmZ,aAAJ,CAAkBH,EAAE,GAAGJ,EAAvB,EAA2BG,EAA3B,EAA+B5c,CAA/B,EAAkC8c,EAAE,GAAGJ,EAAvC,EAA2C1c,CAA3C,EAA8C8c,EAA9C;AAEAT,IAAAA,gBAAgB,CAACxY,GAAD,EAAM+H,MAAN,CAAhB;AACA,WAAO,IAAP;AACH,GAzBD;;AA2BA,MAAI/G,SAAS,GAAG,SAASA,SAAT,CAAmBhB,GAAnB,EAAwBiF,IAAxB,EAA8BK,MAA9B,EAAsC8T,IAAtC,EAA4C;AACxD,QAAIxb,IAAI,GAAG6I,aAAa,CAACnB,MAAD,EAASL,IAAT,CAAxB;AACA,QAAI8C,MAAM,GAAG1C,eAAe,CAACC,MAAD,EAASL,IAAT,CAA5B;AACAkT,IAAAA,iBAAiB,CAACnY,GAAD,EAAM+H,MAAN,CAAjB;AAEA,QAAI1I,KAAK,GAAG,IAAIkY,KAAJ,EAAZ,CALwD,CAOxD;;AACA,QAAI8B,kBAAkB,GAClB,IAAI5C,GAAJ,CAAQnR,MAAM,CAAC0F,GAAf,EAAoBrI,MAAM,CAAC2W,QAAP,CAAgBC,IAApC,EAA0CzU,MAA1C,KAAqDnC,MAAM,CAAC2W,QAAP,CAAgBxU,MADzE;AAEA,QAAIuU,kBAAJ,EAAwBha,KAAK,CAACma,WAAN,GAAoB,EAApB;;AAExBna,IAAAA,KAAK,CAACyL,MAAN,GAAe,YAAW;AACtB,UAAIxF,MAAM,CAACkD,GAAP,KAAe,OAAnB,EAA4B;AACxB,YAAIiR,EAAE,GAAG7b,IAAI,CAAC9B,KAAL,GAAa8B,IAAI,CAAC7B,MAA3B;AACA,YAAID,KAAK,GAAG2d,EAAE,GAAG,CAAL,GAASpa,KAAK,CAACvD,KAAf,GAAuBuD,KAAK,CAACtD,MAAN,GAAe0d,EAAlD;AACA,YAAI1d,MAAM,GAAG0d,EAAE,GAAG,CAAL,GAASpa,KAAK,CAACvD,KAAN,GAAc2d,EAAvB,GAA4Bpa,KAAK,CAACtD,MAA/C;AACA,YAAII,CAAC,GAAGkD,KAAK,CAACvD,KAAN,GAAc,GAAd,GAAoBA,KAAK,GAAG,GAApC;AACA,YAAIM,CAAC,GAAGiD,KAAK,CAACtD,MAAN,GAAe,GAAf,GAAqBA,MAAM,GAAG,GAAtC;AACAiE,QAAAA,GAAG,CAACgB,SAAJ,CAAc3B,KAAd,EAAqBlD,CAArB,EAAwBC,CAAxB,EAA2BN,KAA3B,EAAkCC,MAAlC,EAA0C6B,IAAI,CAACzB,CAA/C,EAAkDyB,IAAI,CAACxB,CAAvD,EAA0DwB,IAAI,CAAC9B,KAA/D,EAAsE8B,IAAI,CAAC7B,MAA3E;AACH,OAPD,MAOO,IAAIuJ,MAAM,CAACkD,GAAP,KAAe,SAAnB,EAA8B;AACjC,YAAI3I,MAAM,GAAGlD,IAAI,CAACyI,GAAL,CAASxH,IAAI,CAAC9B,KAAL,GAAauD,KAAK,CAACvD,KAA5B,EAAmC8B,IAAI,CAAC7B,MAAL,GAAcsD,KAAK,CAACtD,MAAvD,CAAb;;AACA,YAAI2d,MAAM,GAAG7Z,MAAM,GAAGR,KAAK,CAACvD,KAA5B;;AACA,YAAI6d,OAAO,GAAG9Z,MAAM,GAAGR,KAAK,CAACtD,MAA7B;;AACA,YAAI6d,EAAE,GAAGhc,IAAI,CAACzB,CAAL,GAASyB,IAAI,CAAC9B,KAAL,GAAa,GAAtB,GAA4B4d,MAAM,GAAG,GAA9C;;AACA,YAAIG,EAAE,GAAGjc,IAAI,CAACxB,CAAL,GAASwB,IAAI,CAAC7B,MAAL,GAAc,GAAvB,GAA6B4d,OAAO,GAAG,GAAhD;;AACA3Z,QAAAA,GAAG,CAACgB,SAAJ,CAAc3B,KAAd,EAAqB,CAArB,EAAwB,CAAxB,EAA2BA,KAAK,CAACvD,KAAjC,EAAwCuD,KAAK,CAACtD,MAA9C,EAAsD6d,EAAtD,EAA0DC,EAA1D,EAA8DH,MAA9D,EAAsEC,OAAtE;AACH,OAPM,MAOA;AACH3Z,QAAAA,GAAG,CAACgB,SAAJ,CACI3B,KADJ,EAEI,CAFJ,EAGI,CAHJ,EAIIA,KAAK,CAACvD,KAJV,EAKIuD,KAAK,CAACtD,MALV,EAMI6B,IAAI,CAACzB,CANT,EAOIyB,IAAI,CAACxB,CAPT,EAQIwB,IAAI,CAAC9B,KART,EASI8B,IAAI,CAAC7B,MATT;AAWH;;AAEDyc,MAAAA,gBAAgB,CAACxY,GAAD,EAAM+H,MAAN,CAAhB;AACAqR,MAAAA,IAAI;AACP,KA/BD;;AAgCA/Z,IAAAA,KAAK,CAAC2L,GAAN,GAAY1F,MAAM,CAAC0F,GAAnB;AACH,GA7CD;;AA+CA,MAAI8O,QAAQ,GAAG,SAASA,QAAT,CAAkB9Z,GAAlB,EAAuBiF,IAAvB,EAA6BK,MAA7B,EAAqC;AAChD,QAAI1H,IAAI,GAAG6I,aAAa,CAACnB,MAAD,EAASL,IAAT,CAAxB;AACA,QAAI8C,MAAM,GAAG1C,eAAe,CAACC,MAAD,EAASL,IAAT,CAA5B;AACAkT,IAAAA,iBAAiB,CAACnY,GAAD,EAAM+H,MAAN,CAAjB;AAEA,QAAIY,QAAQ,GAAG3D,cAAc,CAACM,MAAM,CAACqD,QAAR,EAAkB1D,IAAlB,CAA7B;AACA,QAAI2D,UAAU,GAAGtD,MAAM,CAACsD,UAAP,IAAqB,YAAtC;AACA,QAAIC,UAAU,GAAGvD,MAAM,CAACuD,UAAP,IAAqB,QAAtC;AACA,QAAIC,SAAS,GAAGxD,MAAM,CAACwD,SAAP,IAAoB,MAApC;AAEA9I,IAAAA,GAAG,CAAC+Z,IAAJ,GAAW,GACNte,MADM,CACCoN,UADD,EACa,GADb,EAENpN,MAFM,CAECkN,QAFD,EAEW,KAFX,EAGNlN,MAHM,CAGCmN,UAHD,CAAX;AAIA5I,IAAAA,GAAG,CAAC8I,SAAJ,GAAgBA,SAAhB;AACA9I,IAAAA,GAAG,CAACga,QAAJ,CAAa1U,MAAM,CAACyD,IAApB,EAA0BnL,IAAI,CAACzB,CAA/B,EAAkCyB,IAAI,CAACxB,CAAvC;AAEAoc,IAAAA,gBAAgB,CAACxY,GAAD,EAAM+H,MAAN,CAAhB;AACA,WAAO,IAAP;AACH,GAnBD;;AAqBA,MAAIkS,QAAQ,GAAG,SAASA,QAAT,CAAkBja,GAAlB,EAAuBiF,IAAvB,EAA6BK,MAA7B,EAAqC;AAChD,QAAIyC,MAAM,GAAG1C,eAAe,CAACC,MAAD,EAASL,IAAT,CAA5B;AACAkT,IAAAA,iBAAiB,CAACnY,GAAD,EAAM+H,MAAN,CAAjB;AACA/H,IAAAA,GAAG,CAACoY,SAAJ;AAEA,QAAIrR,MAAM,GAAGzB,MAAM,CAACyB,MAAP,CAAcV,GAAd,CAAkB,UAASW,KAAT,EAAgB;AAC3C,aAAO;AACH7K,QAAAA,CAAC,EAAE6I,cAAc,CAACgC,KAAK,CAAC7K,CAAP,EAAU8I,IAAV,EAAgB,CAAhB,EAAmB,OAAnB,CADd;AAEH7I,QAAAA,CAAC,EAAE4I,cAAc,CAACgC,KAAK,CAAC5K,CAAP,EAAU6I,IAAV,EAAgB,CAAhB,EAAmB,QAAnB;AAFd,OAAP;AAIH,KALY,CAAb;AAOAjF,IAAAA,GAAG,CAACkZ,MAAJ,CAAWnS,MAAM,CAAC,CAAD,CAAN,CAAU5K,CAArB,EAAwB4K,MAAM,CAAC,CAAD,CAAN,CAAU3K,CAAlC;AACA,QAAIuI,CAAC,GAAGoC,MAAM,CAACjK,MAAf;;AACA,SAAK,IAAI8G,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGe,CAApB,EAAuBf,CAAC,EAAxB,EAA4B;AACxB5D,MAAAA,GAAG,CAACka,MAAJ,CAAWnT,MAAM,CAACnD,CAAD,CAAN,CAAUzH,CAArB,EAAwB4K,MAAM,CAACnD,CAAD,CAAN,CAAUxH,CAAlC;AACH;;AAEDoc,IAAAA,gBAAgB,CAACxY,GAAD,EAAM+H,MAAN,CAAhB;AACA,WAAO,IAAP;AACH,GApBD;;AAsBA,MAAIoS,QAAQ,GAAG,SAASA,QAAT,CAAkBna,GAAlB,EAAuBiF,IAAvB,EAA6BK,MAA7B,EAAqC;AAChD,QAAI1H,IAAI,GAAG6I,aAAa,CAACnB,MAAD,EAASL,IAAT,CAAxB;AACA,QAAI8C,MAAM,GAAG1C,eAAe,CAACC,MAAD,EAASL,IAAT,CAA5B;AACAkT,IAAAA,iBAAiB,CAACnY,GAAD,EAAM+H,MAAN,CAAjB;AAEA/H,IAAAA,GAAG,CAACoY,SAAJ;AAEA,QAAItT,MAAM,GAAG;AACT3I,MAAAA,CAAC,EAAEyB,IAAI,CAACzB,CADC;AAETC,MAAAA,CAAC,EAAEwB,IAAI,CAACxB;AAFC,KAAb;AAKA,QAAIkN,MAAM,GAAG;AACTnN,MAAAA,CAAC,EAAEyB,IAAI,CAACzB,CAAL,GAASyB,IAAI,CAAC9B,KADR;AAETM,MAAAA,CAAC,EAAEwB,IAAI,CAACxB,CAAL,GAASwB,IAAI,CAAC7B;AAFR,KAAb;AAKAiE,IAAAA,GAAG,CAACkZ,MAAJ,CAAWpU,MAAM,CAAC3I,CAAlB,EAAqB2I,MAAM,CAAC1I,CAA5B;AACA4D,IAAAA,GAAG,CAACka,MAAJ,CAAW5Q,MAAM,CAACnN,CAAlB,EAAqBmN,MAAM,CAAClN,CAA5B;AAEA,QAAIkI,CAAC,GAAGI,eAAe,CAAC;AACpBvI,MAAAA,CAAC,EAAEmN,MAAM,CAACnN,CAAP,GAAW2I,MAAM,CAAC3I,CADD;AAEpBC,MAAAA,CAAC,EAAEkN,MAAM,CAAClN,CAAP,GAAW0I,MAAM,CAAC1I;AAFD,KAAD,CAAvB;AAKA,QAAIuI,CAAC,GAAG,OAAOhI,IAAI,CAACyI,GAAL,CAASH,IAAI,CAACnJ,KAAd,EAAqBmJ,IAAI,CAAClJ,MAA1B,CAAf;;AAEA,QAAIuJ,MAAM,CAACqE,cAAP,CAAsBG,OAAtB,CAA8B,aAA9B,MAAiD,CAAC,CAAtD,EAAyD;AACrD,UAAIC,uBAAuB,GAAG1F,cAAc,CAACC,CAAD,EAAIK,CAAJ,CAA5C;AACA,UAAIqF,gBAAgB,GAAGvF,SAAS,CAACK,MAAD,EAASiF,uBAAT,CAAhC;AACA,UAAIE,WAAW,GAAGrF,YAAY,CAACE,MAAD,EAAS,CAAT,EAAYkF,gBAAZ,CAA9B;AACA,UAAIE,WAAW,GAAGtF,YAAY,CAACE,MAAD,EAAS,CAAC,CAAV,EAAakF,gBAAb,CAA9B;AAEAhK,MAAAA,GAAG,CAACkZ,MAAJ,CAAWjP,WAAW,CAAC9N,CAAvB,EAA0B8N,WAAW,CAAC7N,CAAtC;AACA4D,MAAAA,GAAG,CAACka,MAAJ,CAAWpV,MAAM,CAAC3I,CAAlB,EAAqB2I,MAAM,CAAC1I,CAA5B;AACA4D,MAAAA,GAAG,CAACka,MAAJ,CAAWhQ,WAAW,CAAC/N,CAAvB,EAA0B+N,WAAW,CAAC9N,CAAtC;AACH;;AACD,QAAIkJ,MAAM,CAACqE,cAAP,CAAsBG,OAAtB,CAA8B,WAA9B,MAA+C,CAAC,CAApD,EAAuD;AACnD,UAAIM,qBAAqB,GAAG/F,cAAc,CAACC,CAAD,EAAI,CAACK,CAAL,CAA1C;AACA,UAAI0F,cAAc,GAAG5F,SAAS,CAAC6E,MAAD,EAASc,qBAAT,CAA9B;AACA,UAAIE,SAAS,GAAG1F,YAAY,CAAC0E,MAAD,EAAS,CAAT,EAAYe,cAAZ,CAA5B;AACA,UAAIE,SAAS,GAAG3F,YAAY,CAAC0E,MAAD,EAAS,CAAC,CAAV,EAAae,cAAb,CAA5B;AAEArK,MAAAA,GAAG,CAACkZ,MAAJ,CAAW5O,SAAS,CAACnO,CAArB,EAAwBmO,SAAS,CAAClO,CAAlC;AACA4D,MAAAA,GAAG,CAACka,MAAJ,CAAW5Q,MAAM,CAACnN,CAAlB,EAAqBmN,MAAM,CAAClN,CAA5B;AACA4D,MAAAA,GAAG,CAACka,MAAJ,CAAW3P,SAAS,CAACpO,CAArB,EAAwBoO,SAAS,CAACnO,CAAlC;AACH;;AAEDoc,IAAAA,gBAAgB,CAACxY,GAAD,EAAM+H,MAAN,CAAhB;AACA,WAAO,IAAP;AACH,GAlDD;;AAoDA,MAAImQ,gBAAgB,GAAG;AACnBta,IAAAA,IAAI,EAAE6a,QADa;AAEnBrN,IAAAA,OAAO,EAAEsN,WAFU;AAGnBrZ,IAAAA,KAAK,EAAE2B,SAHY;AAInB+H,IAAAA,IAAI,EAAE+Q,QAJa;AAKnB5Q,IAAAA,IAAI,EAAEiR,QALa;AAMnB9O,IAAAA,IAAI,EAAE4O;AANa,GAAvB;;AASA,MAAIG,iBAAiB,GAAG,SAASA,iBAAT,CAA2B5X,SAA3B,EAAsC;AAC1D,QAAInD,KAAK,GAAGqB,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAZ;AACAtB,IAAAA,KAAK,CAACvD,KAAN,GAAc0G,SAAS,CAAC1G,KAAxB;AACAuD,IAAAA,KAAK,CAACtD,MAAN,GAAeyG,SAAS,CAACzG,MAAzB;AACA,QAAIiE,GAAG,GAAGX,KAAK,CAACY,UAAN,CAAiB,IAAjB,CAAV;AACAD,IAAAA,GAAG,CAACqa,YAAJ,CAAiB7X,SAAjB,EAA4B,CAA5B,EAA+B,CAA/B;AACA,WAAOnD,KAAP;AACH,GAPD;;AASA,MAAIib,cAAc,GAAG,SAASA,cAAT,CAAwB3f,IAAxB,EAA8B4f,YAA9B,EAA4C;AAC7D,QAAInZ,OAAO,GAAG5C,SAAS,CAAC1B,MAAV,GAAmB,CAAnB,IAAwB0B,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAlF;AACA,WAAO,IAAIyF,OAAJ,CAAY,UAASC,OAAT,EAAkBmT,MAAlB,EAA0B;AACzC;AACA,UAAI,CAAC1c,IAAD,IAAS,CAACgB,SAAS,CAAChB,IAAD,CAAvB,EACI,OAAO0c,MAAM,CAAC;AAAEmD,QAAAA,MAAM,EAAE,mBAAV;AAA+B7f,QAAAA,IAAI,EAAEA;AAArC,OAAD,CAAb,CAHqC,CAKzC;;AACA,UAAI8f,cAAc,GAAGrZ,OAAO,CAACqZ,cAA7B;AAAA,UACIzW,gBAAgB,GAAG5C,OAAO,CAAC4C,gBAD/B;AAAA,UAEI0W,eAAe,GAAGtZ,OAAO,CAACsZ,eAF9B;AAAA,UAGIrZ,iBAAiB,GAAGD,OAAO,CAACC,iBAHhC,CANyC,CAWzC;;AACA,UAAIF,IAAI,GAAGoZ,YAAY,CAACpZ,IAAxB;AAAA,UACI8D,IAAI,GAAGsV,YAAY,CAACtV,IADxB;AAAA,UAEIiK,MAAM,GAAGqL,YAAY,CAACrL,MAF1B;AAAA,UAGI5J,MAAM,GAAGiV,YAAY,CAACjV,MAH1B;AAAA,UAIIqV,MAAM,GAAGJ,YAAY,CAACI,MAJ1B,CAZyC,CAkBzC;;AACA,UAAI1e,WAAW,GACXse,YAAY,CAAClb,KAAb,IAAsBkb,YAAY,CAAClb,KAAb,CAAmBpD,WAAzC,GACMU,IAAI,CAACqC,GAAL,CAAS,CAAT,EAAYrC,IAAI,CAACyI,GAAL,CAAS,CAAT,EAAYmV,YAAY,CAAClb,KAAb,CAAmBpD,WAA/B,CAAZ,CADN,GAEM,IAHV,CAnByC,CAwBzC;;AACA,UAAI2e,mBAAmB,GAAGD,MAAM,IAAIA,MAAM,CAACxX,OAA3C;AACA,UAAIA,OAAO,GAAGyX,mBAAmB,KAAK,IAAxB,GAA+B,IAA/B,GAAsCA,mBAAmB,GAAG,GAA1E,CA1ByC,CA4BzC;;AACA,UAAI/f,IAAI,GAAI8f,MAAM,IAAIA,MAAM,CAAC9f,IAAlB,IAA2B,IAAtC,CA7ByC,CA+BzC;;AACA,UAAI0G,UAAU,GAAIoZ,MAAM,IAAIA,MAAM,CAACpZ,UAAlB,IAAiC,IAAlD,CAhCyC,CAkCzC;;AACA,UAAI6N,UAAU,GAAG,EAAjB,CAnCyC,CAqCzC;;AACA,UAAInK,IAAI,KAAK,OAAOA,IAAI,CAACnJ,KAAZ,KAAsB,QAAtB,IAAkC,OAAOmJ,IAAI,CAAClJ,MAAZ,KAAuB,QAA9D,CAAR,EAAiF;AAC7EqT,QAAAA,UAAU,CAACyL,IAAX,CAAgB;AAAEhgB,UAAAA,IAAI,EAAE,QAAR;AAAkBgU,UAAAA,IAAI,EAAE5J;AAAxB,SAAhB;AACH,OAxCwC,CA0CzC;;;AACA,UAAIiK,MAAM,IAAIA,MAAM,CAACpS,MAAP,KAAkB,EAAhC,EAAoC;AAChCsS,QAAAA,UAAU,CAACyL,IAAX,CAAgB;AAAEhgB,UAAAA,IAAI,EAAE,QAAR;AAAkBgU,UAAAA,IAAI,EAAEK;AAAxB,SAAhB;AACH,OA7CwC,CA+CzC;;;AACA,UAAI4L,eAAe,GAAG,SAASA,eAAT,CAAyBlP,IAAzB,EAA+B;AACjD,YAAImP,YAAY,GAAGL,eAAe,GAAGA,eAAe,CAAC9O,IAAD,CAAlB,GAA2BA,IAA7D;AACA3H,QAAAA,OAAO,CAACC,OAAR,CAAgB6W,YAAhB,EAA8B3W,IAA9B,CAAmCF,OAAnC;AACH,OAHD,CAhDyC,CAqDzC;;;AACA,UAAIpB,MAAM,GAAG,SAASA,MAAT,CAAgBN,SAAhB,EAA2BpB,OAA3B,EAAoC;AAC7C,YAAIrB,MAAM,GAAGqa,iBAAiB,CAAC5X,SAAD,CAA9B;AACA,YAAIwY,cAAc,GAAG1V,MAAM,CAACxI,MAAP,GAAgBib,iBAAiB,CAAChY,MAAD,EAASuF,MAAT,CAAjC,GAAoDvF,MAAzE;AACAkE,QAAAA,OAAO,CAACC,OAAR,CAAgB8W,cAAhB,EAAgC5W,IAAhC,CAAqC,UAASrE,MAAT,EAAiB;AAClDgE,UAAAA,YAAY,CAAChE,MAAD,EAASqB,OAAT,EAAkB4C,gBAAlB,CAAZ,CACKI,IADL,CACU,UAASwH,IAAT,EAAe;AACjB;AACA9L,YAAAA,aAAa,CAACC,MAAD,CAAb,CAFiB,CAIjB;;AACA,gBAAI0a,cAAJ,EAAoB,OAAOK,eAAe,CAAClP,IAAD,CAAtB,CALH,CAOjB;;AACAyJ,YAAAA,YAAY,CAAC1a,IAAD,CAAZ,CAAmByJ,IAAnB,CAAwB,UAAS6W,SAAT,EAAoB;AACxC;AACA,kBAAIA,SAAS,KAAK,IAAlB,EAAwB;AACpBrP,gBAAAA,IAAI,GAAG,IAAI9H,IAAJ,CAAS,CAACmX,SAAD,EAAYrP,IAAI,CAACwJ,KAAL,CAAW,EAAX,CAAZ,CAAT,EAAsC;AACzCva,kBAAAA,IAAI,EAAE+Q,IAAI,CAAC/Q;AAD8B,iBAAtC,CAAP;AAGH,eANuC,CAQxC;;;AACAigB,cAAAA,eAAe,CAAClP,IAAD,CAAf;AACH,aAVD;AAWH,WApBL,EAqBKsP,KArBL,CAqBW7D,MArBX;AAsBH,SAvBD;AAwBH,OA3BD,CAtDyC,CAmFzC;;;AACA,UAAI,MAAMzc,IAAN,CAAWD,IAAI,CAACE,IAAhB,KAAyBA,IAAI,KAAK,IAAtC,EAA4C;AACxC,eAAO8Q,OAAO,CAAChR,IAAD,EAAOwG,IAAP,EAAamE,MAAb,EAAqB;AAAE/D,UAAAA,UAAU,EAAEA;AAAd,SAArB,CAAP,CAAwD6C,IAAxD,CAA6D,UAAS2E,IAAT,EAAe;AAC/E7E,UAAAA,OAAO,CAAC2R,UAAU,CAAC9M,IAAD,EAAO,eAAP,CAAX,CAAP;AACH,SAFM,CAAP;AAGH,OAxFwC,CA0FzC;;;AACA,UAAIqO,GAAG,GAAGX,GAAG,CAACC,eAAJ,CAAoB/b,IAApB,CAAV,CA3FyC,CA6FzC;;AACAwc,MAAAA,SAAS,CAACC,GAAD,CAAT,CACKhT,IADL,CACU,UAAS/E,KAAT,EAAgB;AAClB;AACAoX,QAAAA,GAAG,CAACS,eAAJ,CAAoBE,GAApB,EAFkB,CAIlB;;AACA,YAAI5U,SAAS,GAAGvB,gBAAgB,CAAC5B,KAAD,EAAQpD,WAAR,EAAqBkF,IAArB,EAA2B;AACvDE,UAAAA,iBAAiB,EAAEA,iBADoC;AAEvDE,UAAAA,UAAU,EAAEA;AAF2C,SAA3B,CAAhC,CALkB,CAUlB;;AACA,YAAI4Z,YAAY,GAAG;AACfhY,UAAAA,OAAO,EAAEA,OADM;AAEftI,UAAAA,IAAI,EAAEA,IAAI,IAAIF,IAAI,CAACE;AAFJ,SAAnB,CAXkB,CAgBlB;;AACA,YAAI,CAACuU,UAAU,CAACtS,MAAhB,EAAwB;AACpB,iBAAOgG,MAAM,CAACN,SAAD,EAAY2Y,YAAZ,CAAb;AACH,SAnBiB,CAqBlB;;;AACA,YAAIxE,MAAM,GAAGN,YAAY,CAACtH,eAAD,CAAzB;AACA4H,QAAAA,MAAM,CAACI,IAAP,CACI;AACI3H,UAAAA,UAAU,EAAEA,UADhB;AAEI5M,UAAAA,SAAS,EAAEA;AAFf,SADJ,EAMI,UAASkN,QAAT,EAAmB;AACf;AACA5M,UAAAA,MAAM,CAAC0L,iBAAiB,CAACkB,QAAD,CAAlB,EAA8ByL,YAA9B,CAAN,CAFe,CAIf;;AACAxE,UAAAA,MAAM,CAACM,SAAP;AACH,SAZL,EAaI,CAACzU,SAAS,CAACqM,IAAV,CAAee,MAAhB,CAbJ;AAeH,OAvCL,EAwCKsL,KAxCL,CAwCW7D,MAxCX;AAyCH,KAvIM,CAAP;AAwIH,GA1ID;;AA4IA,WAAS+D,OAAT,CAAiB3M,GAAjB,EAAsB;AAClB,QAAI,OAAO4M,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA/D,EAAyE;AACrEF,MAAAA,OAAO,GAAG,UAAS3M,GAAT,EAAc;AACpB,eAAO,OAAOA,GAAd;AACH,OAFD;AAGH,KAJD,MAIO;AACH2M,MAAAA,OAAO,GAAG,UAAS3M,GAAT,EAAc;AACpB,eAAOA,GAAG,IACN,OAAO4M,MAAP,KAAkB,UADf,IAEH5M,GAAG,CAAC8M,WAAJ,KAAoBF,MAFjB,IAGH5M,GAAG,KAAK4M,MAAM,CAACxY,SAHZ,GAID,QAJC,GAKD,OAAO4L,GALb;AAMH,OAPD;AAQH;;AAED,WAAO2M,OAAO,CAAC3M,GAAD,CAAd;AACH;;AAED,MAAI+M,kBAAJ;;AAEA,WAASC,IAAT,CAAc5gB,IAAd,EAAoB6gB,KAApB,EAA2BnU,GAA3B,EAAgCoU,QAAhC,EAA0C;AACtC,QAAI,CAACH,kBAAL,EAAyB;AACrBA,MAAAA,kBAAkB,GACb,OAAOH,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACO,GAAvC,IAA8CP,MAAM,CAACO,GAAP,CAAW,eAAX,CAA/C,IACA,MAFJ;AAGH;;AAED,QAAIC,YAAY,GAAGhhB,IAAI,IAAIA,IAAI,CAACghB,YAAhC;AACA,QAAIC,cAAc,GAAGtd,SAAS,CAAC1B,MAAV,GAAmB,CAAxC;;AAEA,QAAI,CAAC4e,KAAD,IAAUI,cAAc,KAAK,CAAjC,EAAoC;AAChCJ,MAAAA,KAAK,GAAG;AACJC,QAAAA,QAAQ,EAAE,KAAK;AADX,OAAR;AAGH;;AAED,QAAID,KAAK,IAAIG,YAAb,EAA2B;AACvB,WAAK,IAAIE,QAAT,IAAqBF,YAArB,EAAmC;AAC/B,YAAIH,KAAK,CAACK,QAAD,CAAL,KAAoB,KAAK,CAA7B,EAAgC;AAC5BL,UAAAA,KAAK,CAACK,QAAD,CAAL,GAAkBF,YAAY,CAACE,QAAD,CAA9B;AACH;AACJ;AACJ,KAND,MAMO,IAAI,CAACL,KAAL,EAAY;AACfA,MAAAA,KAAK,GAAGG,YAAY,IAAI,EAAxB;AACH;;AAED,QAAIC,cAAc,KAAK,CAAvB,EAA0B;AACtBJ,MAAAA,KAAK,CAACC,QAAN,GAAiBA,QAAjB;AACH,KAFD,MAEO,IAAIG,cAAc,GAAG,CAArB,EAAwB;AAC3B,UAAIE,UAAU,GAAG,IAAInE,KAAJ,CAAUiE,cAAV,CAAjB;;AAEA,WAAK,IAAIlY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkY,cAApB,EAAoClY,CAAC,EAArC,EAAyC;AACrCoY,QAAAA,UAAU,CAACpY,CAAD,CAAV,GAAgBpF,SAAS,CAACoF,CAAC,GAAG,CAAL,CAAzB;AACH;;AAED8X,MAAAA,KAAK,CAACC,QAAN,GAAiBK,UAAjB;AACH;;AAED,WAAO;AACHC,MAAAA,QAAQ,EAAET,kBADP;AAEH3gB,MAAAA,IAAI,EAAEA,IAFH;AAGH0M,MAAAA,GAAG,EAAEA,GAAG,KAAK9I,SAAR,GAAoB,IAApB,GAA2B,KAAK8I,GAHlC;AAIH6M,MAAAA,GAAG,EAAE,IAJF;AAKHsH,MAAAA,KAAK,EAAEA,KALJ;AAMHQ,MAAAA,MAAM,EAAE;AANL,KAAP;AAQH;;AAED,WAASC,cAAT,CAAwBC,QAAxB,EAAkC;AAC9B,QAAIC,MAAJ;;AAEA,QAAI,OAAOhB,MAAP,KAAkB,UAAtB,EAAkC;AAC9B,UAAIA,MAAM,CAACiB,aAAX,EAA0B;AACtBD,QAAAA,MAAM,GAAGD,QAAQ,CAACf,MAAM,CAACiB,aAAR,CAAjB;AACA,YAAID,MAAM,IAAI,IAAd,EAAoB,OAAOA,MAAM,CAACE,IAAP,CAAYH,QAAZ,CAAP;AACvB;;AAED,UAAIf,MAAM,CAACC,QAAX,EAAqB;AACjBe,QAAAA,MAAM,GAAGD,QAAQ,CAACf,MAAM,CAACC,QAAR,CAAjB;AACA,YAAIe,MAAM,IAAI,IAAd,EAAoB,OAAOA,MAAM,CAACE,IAAP,CAAYH,QAAZ,CAAP;AACvB;AACJ;;AAED,UAAM,IAAII,SAAJ,CAAc,8BAAd,CAAN;AACH;;AAED,WAASC,WAAT,CAAqBxZ,KAArB,EAA4B;AACxB,SAAKyZ,OAAL,GAAezZ,KAAf;AACH;;AAED,WAAS0Z,eAAT,CAAyBC,GAAzB,EAA8B;AAC1B,QAAIC,KAAJ,EAAWC,IAAX;;AAEA,aAASC,IAAT,CAAcxV,GAAd,EAAmByV,GAAnB,EAAwB;AACpB,aAAO,IAAI/Y,OAAJ,CAAY,UAASC,OAAT,EAAkBmT,MAAlB,EAA0B;AACzC,YAAI4F,OAAO,GAAG;AACV1V,UAAAA,GAAG,EAAEA,GADK;AAEVyV,UAAAA,GAAG,EAAEA,GAFK;AAGV9Y,UAAAA,OAAO,EAAEA,OAHC;AAIVmT,UAAAA,MAAM,EAAEA,MAJE;AAKV6F,UAAAA,IAAI,EAAE;AALI,SAAd;;AAQA,YAAIJ,IAAJ,EAAU;AACNA,UAAAA,IAAI,GAAGA,IAAI,CAACI,IAAL,GAAYD,OAAnB;AACH,SAFD,MAEO;AACHJ,UAAAA,KAAK,GAAGC,IAAI,GAAGG,OAAf;AACAE,UAAAA,MAAM,CAAC5V,GAAD,EAAMyV,GAAN,CAAN;AACH;AACJ,OAfM,CAAP;AAgBH;;AAED,aAASG,MAAT,CAAgB5V,GAAhB,EAAqByV,GAArB,EAA0B;AACtB,UAAI;AACA,YAAIhR,MAAM,GAAG4Q,GAAG,CAACrV,GAAD,CAAH,CAASyV,GAAT,CAAb;AACA,YAAI/Z,KAAK,GAAG+I,MAAM,CAAC/I,KAAnB;AACA,YAAIma,YAAY,GAAGna,KAAK,YAAYwZ,WAApC;AACAxY,QAAAA,OAAO,CAACC,OAAR,CAAgBkZ,YAAY,GAAGna,KAAK,CAACyZ,OAAT,GAAmBzZ,KAA/C,EAAsDmB,IAAtD,CACI,UAAS4Y,GAAT,EAAc;AACV,cAAII,YAAJ,EAAkB;AACdD,YAAAA,MAAM,CAAC,MAAD,EAASH,GAAT,CAAN;AACA;AACH;;AAEDK,UAAAA,MAAM,CAACrR,MAAM,CAACoN,IAAP,GAAc,QAAd,GAAyB,QAA1B,EAAoC4D,GAApC,CAAN;AACH,SARL,EASI,UAASM,GAAT,EAAc;AACVH,UAAAA,MAAM,CAAC,OAAD,EAAUG,GAAV,CAAN;AACH,SAXL;AAaH,OAjBD,CAiBE,OAAOA,GAAP,EAAY;AACVD,QAAAA,MAAM,CAAC,OAAD,EAAUC,GAAV,CAAN;AACH;AACJ;;AAED,aAASD,MAAT,CAAgBxiB,IAAhB,EAAsBoI,KAAtB,EAA6B;AACzB,cAAQpI,IAAR;AACI,aAAK,QAAL;AACIgiB,UAAAA,KAAK,CAAC3Y,OAAN,CAAc;AACVjB,YAAAA,KAAK,EAAEA,KADG;AAEVmW,YAAAA,IAAI,EAAE;AAFI,WAAd;AAIA;;AAEJ,aAAK,OAAL;AACIyD,UAAAA,KAAK,CAACxF,MAAN,CAAapU,KAAb;AACA;;AAEJ;AACI4Z,UAAAA,KAAK,CAAC3Y,OAAN,CAAc;AACVjB,YAAAA,KAAK,EAAEA,KADG;AAEVmW,YAAAA,IAAI,EAAE;AAFI,WAAd;AAIA;AAjBR;;AAoBAyD,MAAAA,KAAK,GAAGA,KAAK,CAACK,IAAd;;AAEA,UAAIL,KAAJ,EAAW;AACPM,QAAAA,MAAM,CAACN,KAAK,CAACtV,GAAP,EAAYsV,KAAK,CAACG,GAAlB,CAAN;AACH,OAFD,MAEO;AACHF,QAAAA,IAAI,GAAG,IAAP;AACH;AACJ;;AAED,SAAKS,OAAL,GAAeR,IAAf;;AAEA,QAAI,OAAOH,GAAG,CAACY,MAAX,KAAsB,UAA1B,EAAsC;AAClC,WAAKA,MAAL,GAAc/e,SAAd;AACH;AACJ;;AAED,MAAI,OAAO4c,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACiB,aAA3C,EAA0D;AACtDK,IAAAA,eAAe,CAAC9Z,SAAhB,CAA0BwY,MAAM,CAACiB,aAAjC,IAAkD,YAAW;AACzD,aAAO,IAAP;AACH,KAFD;AAGH;;AAEDK,EAAAA,eAAe,CAAC9Z,SAAhB,CAA0Bqa,IAA1B,GAAiC,UAASF,GAAT,EAAc;AAC3C,WAAO,KAAKO,OAAL,CAAa,MAAb,EAAqBP,GAArB,CAAP;AACH,GAFD;;AAIAL,EAAAA,eAAe,CAAC9Z,SAAhB,CAA0B4a,KAA1B,GAAkC,UAAST,GAAT,EAAc;AAC5C,WAAO,KAAKO,OAAL,CAAa,OAAb,EAAsBP,GAAtB,CAAP;AACH,GAFD;;AAIAL,EAAAA,eAAe,CAAC9Z,SAAhB,CAA0B2a,MAA1B,GAAmC,UAASR,GAAT,EAAc;AAC7C,WAAO,KAAKO,OAAL,CAAa,QAAb,EAAuBP,GAAvB,CAAP;AACH,GAFD;;AAIA,WAASU,mBAAT,CAA6BpH,EAA7B,EAAiC;AAC7B,WAAO,YAAW;AACd,aAAO,IAAIqG,eAAJ,CAAoBrG,EAAE,CAACxV,KAAH,CAAS,IAAT,EAAetC,SAAf,CAApB,CAAP;AACH,KAFD;AAGH;;AAED,WAASmf,oBAAT,CAA8B1a,KAA9B,EAAqC;AACjC,WAAO,IAAIwZ,WAAJ,CAAgBxZ,KAAhB,CAAP;AACH;;AAED,WAAS2a,uBAAT,CAAiCC,KAAjC,EAAwCC,SAAxC,EAAmD;AAC/C,QAAIC,IAAI,GAAG,EAAX;AAAA,QACIC,OAAO,GAAG,KADd;;AAGA,aAASC,IAAT,CAAc1W,GAAd,EAAmBtE,KAAnB,EAA0B;AACtB+a,MAAAA,OAAO,GAAG,IAAV;AACA/a,MAAAA,KAAK,GAAG,IAAIgB,OAAJ,CAAY,UAASC,OAAT,EAAkB;AAClCA,QAAAA,OAAO,CAAC2Z,KAAK,CAACtW,GAAD,CAAL,CAAWtE,KAAX,CAAD,CAAP;AACH,OAFO,CAAR;AAGA,aAAO;AACHmW,QAAAA,IAAI,EAAE,KADH;AAEHnW,QAAAA,KAAK,EAAE6a,SAAS,CAAC7a,KAAD;AAFb,OAAP;AAIH;;AAED,QAAI,OAAOoY,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACC,QAA3C,EAAqD;AACjDyC,MAAAA,IAAI,CAAC1C,MAAM,CAACC,QAAR,CAAJ,GAAwB,YAAW;AAC/B,eAAO,IAAP;AACH,OAFD;AAGH;;AAEDyC,IAAAA,IAAI,CAACb,IAAL,GAAY,UAASja,KAAT,EAAgB;AACxB,UAAI+a,OAAJ,EAAa;AACTA,QAAAA,OAAO,GAAG,KAAV;AACA,eAAO/a,KAAP;AACH;;AAED,aAAOgb,IAAI,CAAC,MAAD,EAAShb,KAAT,CAAX;AACH,KAPD;;AASA,QAAI,OAAO4a,KAAK,CAACJ,KAAb,KAAuB,UAA3B,EAAuC;AACnCM,MAAAA,IAAI,CAACN,KAAL,GAAa,UAASxa,KAAT,EAAgB;AACzB,YAAI+a,OAAJ,EAAa;AACTA,UAAAA,OAAO,GAAG,KAAV;AACA,gBAAM/a,KAAN;AACH;;AAED,eAAOgb,IAAI,CAAC,OAAD,EAAUhb,KAAV,CAAX;AACH,OAPD;AAQH;;AAED,QAAI,OAAO4a,KAAK,CAACL,MAAb,KAAwB,UAA5B,EAAwC;AACpCO,MAAAA,IAAI,CAACP,MAAL,GAAc,UAASva,KAAT,EAAgB;AAC1B,eAAOgb,IAAI,CAAC,QAAD,EAAWhb,KAAX,CAAX;AACH,OAFD;AAGH;;AAED,WAAO8a,IAAP;AACH;;AAED,WAASG,kBAAT,CAA4BtB,GAA5B,EAAiC1Y,OAAjC,EAA0CmT,MAA1C,EAAkD8G,KAAlD,EAAyDC,MAAzD,EAAiE7W,GAAjE,EAAsEyV,GAAtE,EAA2E;AACvE,QAAI;AACA,UAAIqB,IAAI,GAAGzB,GAAG,CAACrV,GAAD,CAAH,CAASyV,GAAT,CAAX;AACA,UAAI/Z,KAAK,GAAGob,IAAI,CAACpb,KAAjB;AACH,KAHD,CAGE,OAAOqb,KAAP,EAAc;AACZjH,MAAAA,MAAM,CAACiH,KAAD,CAAN;AACA;AACH;;AAED,QAAID,IAAI,CAACjF,IAAT,EAAe;AACXlV,MAAAA,OAAO,CAACjB,KAAD,CAAP;AACH,KAFD,MAEO;AACHgB,MAAAA,OAAO,CAACC,OAAR,CAAgBjB,KAAhB,EAAuBmB,IAAvB,CAA4B+Z,KAA5B,EAAmCC,MAAnC;AACH;AACJ;;AAED,WAASG,iBAAT,CAA2BjI,EAA3B,EAA+B;AAC3B,WAAO,YAAW;AACd,UAAI9b,IAAI,GAAG,IAAX;AAAA,UACIgkB,IAAI,GAAGhgB,SADX;AAEA,aAAO,IAAIyF,OAAJ,CAAY,UAASC,OAAT,EAAkBmT,MAAlB,EAA0B;AACzC,YAAIuF,GAAG,GAAGtG,EAAE,CAACxV,KAAH,CAAStG,IAAT,EAAegkB,IAAf,CAAV;;AAEA,iBAASL,KAAT,CAAelb,KAAf,EAAsB;AAClBib,UAAAA,kBAAkB,CAACtB,GAAD,EAAM1Y,OAAN,EAAemT,MAAf,EAAuB8G,KAAvB,EAA8BC,MAA9B,EAAsC,MAAtC,EAA8Cnb,KAA9C,CAAlB;AACH;;AAED,iBAASmb,MAAT,CAAgBd,GAAhB,EAAqB;AACjBY,UAAAA,kBAAkB,CAACtB,GAAD,EAAM1Y,OAAN,EAAemT,MAAf,EAAuB8G,KAAvB,EAA8BC,MAA9B,EAAsC,OAAtC,EAA+Cd,GAA/C,CAAlB;AACH;;AAEDa,QAAAA,KAAK,CAAC1f,SAAD,CAAL;AACH,OAZM,CAAP;AAaH,KAhBD;AAiBH;;AAED,WAASggB,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAC5C,QAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AACpC,YAAM,IAAInC,SAAJ,CAAc,mCAAd,CAAN;AACH;AACJ;;AAED,WAASoC,iBAAT,CAA2BtV,MAA3B,EAAmCoS,KAAnC,EAA0C;AACtC,SAAK,IAAI9X,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8X,KAAK,CAAC5e,MAA1B,EAAkC8G,CAAC,EAAnC,EAAuC;AACnC,UAAIib,UAAU,GAAGnD,KAAK,CAAC9X,CAAD,CAAtB;AACAib,MAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AACAD,MAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;AACA,UAAI,WAAWF,UAAf,EAA2BA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AAC3Bjc,MAAAA,MAAM,CAACC,cAAP,CAAsBsG,MAAtB,EAA8BuV,UAAU,CAACtX,GAAzC,EAA8CsX,UAA9C;AACH;AACJ;;AAED,WAASI,YAAT,CAAsBN,WAAtB,EAAmCO,UAAnC,EAA+CC,WAA/C,EAA4D;AACxD,QAAID,UAAJ,EAAgBN,iBAAiB,CAACD,WAAW,CAAC9b,SAAb,EAAwBqc,UAAxB,CAAjB;AAChB,QAAIC,WAAJ,EAAiBP,iBAAiB,CAACD,WAAD,EAAcQ,WAAd,CAAjB;AACjB,WAAOR,WAAP;AACH;;AAED,WAASS,2BAAT,CAAqC3Q,GAArC,EAA0C4Q,KAA1C,EAAiD;AAC7C,SAAK,IAAI9X,GAAT,IAAgB8X,KAAhB,EAAuB;AACnB,UAAIC,IAAI,GAAGD,KAAK,CAAC9X,GAAD,CAAhB;AACA+X,MAAAA,IAAI,CAACP,YAAL,GAAoBO,IAAI,CAACR,UAAL,GAAkB,IAAtC;AACA,UAAI,WAAWQ,IAAf,EAAqBA,IAAI,CAACN,QAAL,GAAgB,IAAhB;AACrBjc,MAAAA,MAAM,CAACC,cAAP,CAAsByL,GAAtB,EAA2BlH,GAA3B,EAAgC+X,IAAhC;AACH;;AAED,QAAIvc,MAAM,CAACwc,qBAAX,EAAkC;AAC9B,UAAIC,aAAa,GAAGzc,MAAM,CAACwc,qBAAP,CAA6BF,KAA7B,CAApB;;AAEA,WAAK,IAAIzb,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4b,aAAa,CAAC1iB,MAAlC,EAA0C8G,CAAC,EAA3C,EAA+C;AAC3C,YAAI6b,GAAG,GAAGD,aAAa,CAAC5b,CAAD,CAAvB;AACA,YAAI0b,IAAI,GAAGD,KAAK,CAACI,GAAD,CAAhB;AACAH,QAAAA,IAAI,CAACP,YAAL,GAAoBO,IAAI,CAACR,UAAL,GAAkB,IAAtC;AACA,YAAI,WAAWQ,IAAf,EAAqBA,IAAI,CAACN,QAAL,GAAgB,IAAhB;AACrBjc,QAAAA,MAAM,CAACC,cAAP,CAAsByL,GAAtB,EAA2BgR,GAA3B,EAAgCH,IAAhC;AACH;AACJ;;AAED,WAAO7Q,GAAP;AACH;;AAED,WAASiR,SAAT,CAAmBjR,GAAnB,EAAwBkR,QAAxB,EAAkC;AAC9B,QAAItY,IAAI,GAAGtE,MAAM,CAAC6c,mBAAP,CAA2BD,QAA3B,CAAX;;AAEA,SAAK,IAAI/b,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyD,IAAI,CAACvK,MAAzB,EAAiC8G,CAAC,EAAlC,EAAsC;AAClC,UAAI2D,GAAG,GAAGF,IAAI,CAACzD,CAAD,CAAd;AACA,UAAIX,KAAK,GAAGF,MAAM,CAAC8c,wBAAP,CAAgCF,QAAhC,EAA0CpY,GAA1C,CAAZ;;AAEA,UAAItE,KAAK,IAAIA,KAAK,CAAC8b,YAAf,IAA+BtQ,GAAG,CAAClH,GAAD,CAAH,KAAa9I,SAAhD,EAA2D;AACvDsE,QAAAA,MAAM,CAACC,cAAP,CAAsByL,GAAtB,EAA2BlH,GAA3B,EAAgCtE,KAAhC;AACH;AACJ;;AAED,WAAOwL,GAAP;AACH;;AAED,WAASqR,eAAT,CAAyBrR,GAAzB,EAA8BlH,GAA9B,EAAmCtE,KAAnC,EAA0C;AACtC,QAAIsE,GAAG,IAAIkH,GAAX,EAAgB;AACZ1L,MAAAA,MAAM,CAACC,cAAP,CAAsByL,GAAtB,EAA2BlH,GAA3B,EAAgC;AAC5BtE,QAAAA,KAAK,EAAEA,KADqB;AAE5B6b,QAAAA,UAAU,EAAE,IAFgB;AAG5BC,QAAAA,YAAY,EAAE,IAHc;AAI5BC,QAAAA,QAAQ,EAAE;AAJkB,OAAhC;AAMH,KAPD,MAOO;AACHvQ,MAAAA,GAAG,CAAClH,GAAD,CAAH,GAAWtE,KAAX;AACH;;AAED,WAAOwL,GAAP;AACH;;AAED,WAASsR,QAAT,GAAoB;AAChBA,IAAAA,QAAQ,GACJhd,MAAM,CAAC+E,MAAP,IACA,UAASwB,MAAT,EAAiB;AACb,WAAK,IAAI1F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpF,SAAS,CAAC1B,MAA9B,EAAsC8G,CAAC,EAAvC,EAA2C;AACvC,YAAIoc,MAAM,GAAGxhB,SAAS,CAACoF,CAAD,CAAtB;;AAEA,aAAK,IAAI2D,GAAT,IAAgByY,MAAhB,EAAwB;AACpB,cAAIjd,MAAM,CAACF,SAAP,CAAiBod,cAAjB,CAAgC1D,IAAhC,CAAqCyD,MAArC,EAA6CzY,GAA7C,CAAJ,EAAuD;AACnD+B,YAAAA,MAAM,CAAC/B,GAAD,CAAN,GAAcyY,MAAM,CAACzY,GAAD,CAApB;AACH;AACJ;AACJ;;AAED,aAAO+B,MAAP;AACH,KAdL;;AAgBA,WAAOyW,QAAQ,CAACjf,KAAT,CAAe,IAAf,EAAqBtC,SAArB,CAAP;AACH;;AAED,WAAS0hB,aAAT,CAAuB5W,MAAvB,EAA+B;AAC3B,SAAK,IAAI1F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpF,SAAS,CAAC1B,MAA9B,EAAsC8G,CAAC,EAAvC,EAA2C;AACvC,UAAIoc,MAAM,GAAGxhB,SAAS,CAACoF,CAAD,CAAT,IAAgB,IAAhB,GAAuBpF,SAAS,CAACoF,CAAD,CAAhC,GAAsC,EAAnD;AACA,UAAIuc,OAAO,GAAGpd,MAAM,CAACsE,IAAP,CAAY2Y,MAAZ,CAAd;;AAEA,UAAI,OAAOjd,MAAM,CAACwc,qBAAd,KAAwC,UAA5C,EAAwD;AACpDY,QAAAA,OAAO,GAAGA,OAAO,CAAC1kB,MAAR,CACNsH,MAAM,CAACwc,qBAAP,CAA6BS,MAA7B,EAAqC9Q,MAArC,CAA4C,UAASuQ,GAAT,EAAc;AACtD,iBAAO1c,MAAM,CAAC8c,wBAAP,CAAgCG,MAAhC,EAAwCP,GAAxC,EAA6CX,UAApD;AACH,SAFD,CADM,CAAV;AAKH;;AAEDqB,MAAAA,OAAO,CAAC7Y,OAAR,CAAgB,UAASC,GAAT,EAAc;AAC1BuY,QAAAA,eAAe,CAACxW,MAAD,EAAS/B,GAAT,EAAcyY,MAAM,CAACzY,GAAD,CAApB,CAAf;AACH,OAFD;AAGH;;AAED,WAAO+B,MAAP;AACH;;AAED,WAAS8W,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AACrC,QAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;AACzD,YAAM,IAAI9D,SAAJ,CAAc,oDAAd,CAAN;AACH;;AAED6D,IAAAA,QAAQ,CAACxd,SAAT,GAAqBE,MAAM,CAACwd,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAACzd,SAAvC,EAAkD;AACnE0Y,MAAAA,WAAW,EAAE;AACTtY,QAAAA,KAAK,EAAEod,QADE;AAETrB,QAAAA,QAAQ,EAAE,IAFD;AAGTD,QAAAA,YAAY,EAAE;AAHL;AADsD,KAAlD,CAArB;AAOA,QAAIuB,UAAJ,EAAgBE,eAAe,CAACH,QAAD,EAAWC,UAAX,CAAf;AACnB;;AAED,WAASG,cAAT,CAAwBJ,QAAxB,EAAkCC,UAAlC,EAA8C;AAC1CD,IAAAA,QAAQ,CAACxd,SAAT,GAAqBE,MAAM,CAACwd,MAAP,CAAcD,UAAU,CAACzd,SAAzB,CAArB;AACAwd,IAAAA,QAAQ,CAACxd,SAAT,CAAmB0Y,WAAnB,GAAiC8E,QAAjC;AACAA,IAAAA,QAAQ,CAACK,SAAT,GAAqBJ,UAArB;AACH;;AAED,WAASK,eAAT,CAAyBC,CAAzB,EAA4B;AACxBD,IAAAA,eAAe,GAAG5d,MAAM,CAAC8d,cAAP,GACZ9d,MAAM,CAAC+d,cADK,GAEZ,SAASH,eAAT,CAAyBC,CAAzB,EAA4B;AACxB,aAAOA,CAAC,CAACF,SAAF,IAAe3d,MAAM,CAAC+d,cAAP,CAAsBF,CAAtB,CAAtB;AACH,KAJP;AAKA,WAAOD,eAAe,CAACC,CAAD,CAAtB;AACH;;AAED,WAASJ,eAAT,CAAyBI,CAAzB,EAA4BG,CAA5B,EAA+B;AAC3BP,IAAAA,eAAe,GACXzd,MAAM,CAAC8d,cAAP,IACA,SAASL,eAAT,CAAyBI,CAAzB,EAA4BG,CAA5B,EAA+B;AAC3BH,MAAAA,CAAC,CAACF,SAAF,GAAcK,CAAd;AACA,aAAOH,CAAP;AACH,KALL;;AAOA,WAAOJ,eAAe,CAACI,CAAD,EAAIG,CAAJ,CAAtB;AACH;;AAED,WAASC,wBAAT,GAAoC;AAChC,QAAI,OAAOC,OAAP,KAAmB,WAAnB,IAAkC,CAACA,OAAO,CAACC,SAA/C,EAA0D,OAAO,KAAP;AAC1D,QAAID,OAAO,CAACC,SAAR,CAAkBC,IAAtB,EAA4B,OAAO,KAAP;AAC5B,QAAI,OAAOC,KAAP,KAAiB,UAArB,EAAiC,OAAO,IAAP;;AAEjC,QAAI;AACAC,MAAAA,IAAI,CAACxe,SAAL,CAAeuT,QAAf,CAAwBmG,IAAxB,CAA6B0E,OAAO,CAACC,SAAR,CAAkBG,IAAlB,EAAwB,EAAxB,EAA4B,YAAW,CAAE,CAAzC,CAA7B;AACA,aAAO,IAAP;AACH,KAHD,CAGE,OAAO1S,CAAP,EAAU;AACR,aAAO,KAAP;AACH;AACJ;;AAED,WAAS2S,UAAT,CAAoBC,MAApB,EAA4B/C,IAA5B,EAAkCgD,KAAlC,EAAyC;AACrC,QAAIR,wBAAwB,EAA5B,EAAgC;AAC5BM,MAAAA,UAAU,GAAGL,OAAO,CAACC,SAArB;AACH,KAFD,MAEO;AACHI,MAAAA,UAAU,GAAG,SAASA,UAAT,CAAoBC,MAApB,EAA4B/C,IAA5B,EAAkCgD,KAAlC,EAAyC;AAClD,YAAIllB,CAAC,GAAG,CAAC,IAAD,CAAR;AACAA,QAAAA,CAAC,CAACue,IAAF,CAAO/Z,KAAP,CAAaxE,CAAb,EAAgBkiB,IAAhB;AACA,YAAIG,WAAW,GAAG8C,QAAQ,CAAC3J,IAAT,CAAchX,KAAd,CAAoBygB,MAApB,EAA4BjlB,CAA5B,CAAlB;AACA,YAAIoiB,QAAQ,GAAG,IAAIC,WAAJ,EAAf;AACA,YAAI6C,KAAJ,EAAWhB,eAAe,CAAC9B,QAAD,EAAW8C,KAAK,CAAC3e,SAAjB,CAAf;AACX,eAAO6b,QAAP;AACH,OAPD;AAQH;;AAED,WAAO4C,UAAU,CAACxgB,KAAX,CAAiB,IAAjB,EAAuBtC,SAAvB,CAAP;AACH;;AAED,WAASkjB,iBAAT,CAA2BpL,EAA3B,EAA+B;AAC3B,WAAOmL,QAAQ,CAACrL,QAAT,CAAkBmG,IAAlB,CAAuBjG,EAAvB,EAA2BxM,OAA3B,CAAmC,eAAnC,MAAwD,CAAC,CAAhE;AACH;;AAED,WAAS6X,gBAAT,CAA0BH,KAA1B,EAAiC;AAC7B,QAAII,MAAM,GAAG,OAAOC,GAAP,KAAe,UAAf,GAA4B,IAAIA,GAAJ,EAA5B,GAAwCpjB,SAArD;;AAEAkjB,IAAAA,gBAAgB,GAAG,SAASA,gBAAT,CAA0BH,KAA1B,EAAiC;AAChD,UAAIA,KAAK,KAAK,IAAV,IAAkB,CAACE,iBAAiB,CAACF,KAAD,CAAxC,EAAiD,OAAOA,KAAP;;AAEjD,UAAI,OAAOA,KAAP,KAAiB,UAArB,EAAiC;AAC7B,cAAM,IAAIhF,SAAJ,CAAc,oDAAd,CAAN;AACH;;AAED,UAAI,OAAOoF,MAAP,KAAkB,WAAtB,EAAmC;AAC/B,YAAIA,MAAM,CAACE,GAAP,CAAWN,KAAX,CAAJ,EAAuB,OAAOI,MAAM,CAACG,GAAP,CAAWP,KAAX,CAAP;;AAEvBI,QAAAA,MAAM,CAAC9S,GAAP,CAAW0S,KAAX,EAAkBQ,OAAlB;AACH;;AAED,eAASA,OAAT,GAAmB;AACf,eAAOV,UAAU,CAACE,KAAD,EAAQhjB,SAAR,EAAmBmiB,eAAe,CAAC,IAAD,CAAf,CAAsBpF,WAAzC,CAAjB;AACH;;AAEDyG,MAAAA,OAAO,CAACnf,SAAR,GAAoBE,MAAM,CAACwd,MAAP,CAAciB,KAAK,CAAC3e,SAApB,EAA+B;AAC/C0Y,QAAAA,WAAW,EAAE;AACTtY,UAAAA,KAAK,EAAE+e,OADE;AAETlD,UAAAA,UAAU,EAAE,KAFH;AAGTE,UAAAA,QAAQ,EAAE,IAHD;AAITD,UAAAA,YAAY,EAAE;AAJL;AADkC,OAA/B,CAApB;AAQA,aAAOyB,eAAe,CAACwB,OAAD,EAAUR,KAAV,CAAtB;AACH,KA1BD;;AA4BA,WAAOG,gBAAgB,CAACH,KAAD,CAAvB;AACH;;AAED,WAASS,WAAT,CAAqBvb,IAArB,EAA2BE,KAA3B,EAAkC;AAC9B,QAAIA,KAAK,IAAI,IAAT,IAAiB,OAAOyU,MAAP,KAAkB,WAAnC,IAAkDzU,KAAK,CAACyU,MAAM,CAAC6G,WAAR,CAA3D,EAAiF;AAC7E,aAAOtb,KAAK,CAACyU,MAAM,CAAC6G,WAAR,CAAL,CAA0Bxb,IAA1B,CAAP;AACH,KAFD,MAEO;AACH,aAAOA,IAAI,YAAYE,KAAvB;AACH;AACJ;;AAED,WAASub,sBAAT,CAAgC1T,GAAhC,EAAqC;AACjC,WAAOA,GAAG,IAAIA,GAAG,CAAC2T,UAAX,GACD3T,GADC,GAED;AACI4T,MAAAA,OAAO,EAAE5T;AADb,KAFN;AAKH;;AAED,WAAS6T,uBAAT,CAAiC7T,GAAjC,EAAsC;AAClC,QAAIA,GAAG,IAAIA,GAAG,CAAC2T,UAAf,EAA2B;AACvB,aAAO3T,GAAP;AACH,KAFD,MAEO;AACH,UAAI8T,MAAM,GAAG,EAAb;;AAEA,UAAI9T,GAAG,IAAI,IAAX,EAAiB;AACb,aAAK,IAAIlH,GAAT,IAAgBkH,GAAhB,EAAqB;AACjB,cAAI1L,MAAM,CAACF,SAAP,CAAiBod,cAAjB,CAAgC1D,IAAhC,CAAqC9N,GAArC,EAA0ClH,GAA1C,CAAJ,EAAoD;AAChD,gBAAI+X,IAAI,GACJvc,MAAM,CAACC,cAAP,IAAyBD,MAAM,CAAC8c,wBAAhC,GACM9c,MAAM,CAAC8c,wBAAP,CAAgCpR,GAAhC,EAAqClH,GAArC,CADN,GAEM,EAHV;;AAKA,gBAAI+X,IAAI,CAACyC,GAAL,IAAYzC,IAAI,CAACxQ,GAArB,EAA0B;AACtB/L,cAAAA,MAAM,CAACC,cAAP,CAAsBuf,MAAtB,EAA8Bhb,GAA9B,EAAmC+X,IAAnC;AACH,aAFD,MAEO;AACHiD,cAAAA,MAAM,CAAChb,GAAD,CAAN,GAAckH,GAAG,CAAClH,GAAD,CAAjB;AACH;AACJ;AACJ;AACJ;;AAEDgb,MAAAA,MAAM,CAACF,OAAP,GAAiB5T,GAAjB;AACA,aAAO8T,MAAP;AACH;AACJ;;AAED,WAASC,cAAT,CAAwBC,SAAxB,EAAmCC,SAAnC,EAA8C;AAC1C,QAAID,SAAS,KAAKC,SAAlB,EAA6B;AACzB,YAAM,IAAIlG,SAAJ,CAAc,sCAAd,CAAN;AACH;AACJ;;AAED,WAASmG,yBAAT,CAAmClU,GAAnC,EAAwC;AACpC,QAAIA,GAAG,IAAI,IAAX,EAAiB,MAAM,IAAI+N,SAAJ,CAAc,8BAAd,CAAN;AACpB;;AAED,WAASoG,6BAAT,CAAuC5C,MAAvC,EAA+C6C,QAA/C,EAAyD;AACrD,QAAI7C,MAAM,IAAI,IAAd,EAAoB,OAAO,EAAP;AACpB,QAAI1W,MAAM,GAAG,EAAb;AACA,QAAIwZ,UAAU,GAAG/f,MAAM,CAACsE,IAAP,CAAY2Y,MAAZ,CAAjB;AACA,QAAIzY,GAAJ,EAAS3D,CAAT;;AAEA,SAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGkf,UAAU,CAAChmB,MAA3B,EAAmC8G,CAAC,EAApC,EAAwC;AACpC2D,MAAAA,GAAG,GAAGub,UAAU,CAAClf,CAAD,CAAhB;AACA,UAAIif,QAAQ,CAAC/Y,OAAT,CAAiBvC,GAAjB,KAAyB,CAA7B,EAAgC;AAChC+B,MAAAA,MAAM,CAAC/B,GAAD,CAAN,GAAcyY,MAAM,CAACzY,GAAD,CAApB;AACH;;AAED,WAAO+B,MAAP;AACH;;AAED,WAASyZ,wBAAT,CAAkC/C,MAAlC,EAA0C6C,QAA1C,EAAoD;AAChD,QAAI7C,MAAM,IAAI,IAAd,EAAoB,OAAO,EAAP;;AAEpB,QAAI1W,MAAM,GAAGsZ,6BAA6B,CAAC5C,MAAD,EAAS6C,QAAT,CAA1C;;AAEA,QAAItb,GAAJ,EAAS3D,CAAT;;AAEA,QAAIb,MAAM,CAACwc,qBAAX,EAAkC;AAC9B,UAAIyD,gBAAgB,GAAGjgB,MAAM,CAACwc,qBAAP,CAA6BS,MAA7B,CAAvB;;AAEA,WAAKpc,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGof,gBAAgB,CAAClmB,MAAjC,EAAyC8G,CAAC,EAA1C,EAA8C;AAC1C2D,QAAAA,GAAG,GAAGyb,gBAAgB,CAACpf,CAAD,CAAtB;AACA,YAAIif,QAAQ,CAAC/Y,OAAT,CAAiBvC,GAAjB,KAAyB,CAA7B,EAAgC;AAChC,YAAI,CAACxE,MAAM,CAACF,SAAP,CAAiBogB,oBAAjB,CAAsC1G,IAAtC,CAA2CyD,MAA3C,EAAmDzY,GAAnD,CAAL,EAA8D;AAC9D+B,QAAAA,MAAM,CAAC/B,GAAD,CAAN,GAAcyY,MAAM,CAACzY,GAAD,CAApB;AACH;AACJ;;AAED,WAAO+B,MAAP;AACH;;AAED,WAAS4Z,sBAAT,CAAgC1oB,IAAhC,EAAsC;AAClC,QAAIA,IAAI,KAAK,KAAK,CAAlB,EAAqB;AACjB,YAAM,IAAI2oB,cAAJ,CAAmB,2DAAnB,CAAN;AACH;;AAED,WAAO3oB,IAAP;AACH;;AAED,WAAS4oB,0BAAT,CAAoC5oB,IAApC,EAA0C+hB,IAA1C,EAAgD;AAC5C,QAAIA,IAAI,KAAK,OAAOA,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,IAAP,KAAgB,UAAjD,CAAR,EAAsE;AAClE,aAAOA,IAAP;AACH;;AAED,WAAO2G,sBAAsB,CAAC1oB,IAAD,CAA7B;AACH;;AAED,WAAS6oB,cAAT,CAAwBC,MAAxB,EAAgCC,QAAhC,EAA0C;AACtC,WAAO,CAACxgB,MAAM,CAACF,SAAP,CAAiBod,cAAjB,CAAgC1D,IAAhC,CAAqC+G,MAArC,EAA6CC,QAA7C,CAAR,EAAgE;AAC5DD,MAAAA,MAAM,GAAG3C,eAAe,CAAC2C,MAAD,CAAxB;AACA,UAAIA,MAAM,KAAK,IAAf,EAAqB;AACxB;;AAED,WAAOA,MAAP;AACH;;AAED,WAASE,IAAT,CAAcla,MAAd,EAAsBia,QAAtB,EAAgCE,QAAhC,EAA0C;AACtC,QAAI,OAAOxC,OAAP,KAAmB,WAAnB,IAAkCA,OAAO,CAACc,GAA9C,EAAmD;AAC/CyB,MAAAA,IAAI,GAAGvC,OAAO,CAACc,GAAf;AACH,KAFD,MAEO;AACHyB,MAAAA,IAAI,GAAG,SAASA,IAAT,CAAcla,MAAd,EAAsBia,QAAtB,EAAgCE,QAAhC,EAA0C;AAC7C,YAAIC,IAAI,GAAGL,cAAc,CAAC/Z,MAAD,EAASia,QAAT,CAAzB;;AAEA,YAAI,CAACG,IAAL,EAAW;AACX,YAAIpE,IAAI,GAAGvc,MAAM,CAAC8c,wBAAP,CAAgC6D,IAAhC,EAAsCH,QAAtC,CAAX;;AAEA,YAAIjE,IAAI,CAACyC,GAAT,EAAc;AACV,iBAAOzC,IAAI,CAACyC,GAAL,CAASxF,IAAT,CAAckH,QAAd,CAAP;AACH;;AAED,eAAOnE,IAAI,CAACrc,KAAZ;AACH,OAXD;AAYH;;AAED,WAAOugB,IAAI,CAACla,MAAD,EAASia,QAAT,EAAmBE,QAAQ,IAAIna,MAA/B,CAAX;AACH;;AAED,WAASwF,GAAT,CAAaxF,MAAb,EAAqBia,QAArB,EAA+BtgB,KAA/B,EAAsCwgB,QAAtC,EAAgD;AAC5C,QAAI,OAAOxC,OAAP,KAAmB,WAAnB,IAAkCA,OAAO,CAACnS,GAA9C,EAAmD;AAC/CA,MAAAA,GAAG,GAAGmS,OAAO,CAACnS,GAAd;AACH,KAFD,MAEO;AACHA,MAAAA,GAAG,GAAG,SAASA,GAAT,CAAaxF,MAAb,EAAqBia,QAArB,EAA+BtgB,KAA/B,EAAsCwgB,QAAtC,EAAgD;AAClD,YAAIC,IAAI,GAAGL,cAAc,CAAC/Z,MAAD,EAASia,QAAT,CAAzB;;AAEA,YAAIjE,IAAJ;;AAEA,YAAIoE,IAAJ,EAAU;AACNpE,UAAAA,IAAI,GAAGvc,MAAM,CAAC8c,wBAAP,CAAgC6D,IAAhC,EAAsCH,QAAtC,CAAP;;AAEA,cAAIjE,IAAI,CAACxQ,GAAT,EAAc;AACVwQ,YAAAA,IAAI,CAACxQ,GAAL,CAASyN,IAAT,CAAckH,QAAd,EAAwBxgB,KAAxB;AACA,mBAAO,IAAP;AACH,WAHD,MAGO,IAAI,CAACqc,IAAI,CAACN,QAAV,EAAoB;AACvB,mBAAO,KAAP;AACH;AACJ;;AAEDM,QAAAA,IAAI,GAAGvc,MAAM,CAAC8c,wBAAP,CAAgC4D,QAAhC,EAA0CF,QAA1C,CAAP;;AAEA,YAAIjE,IAAJ,EAAU;AACN,cAAI,CAACA,IAAI,CAACN,QAAV,EAAoB;AAChB,mBAAO,KAAP;AACH;;AAEDM,UAAAA,IAAI,CAACrc,KAAL,GAAaA,KAAb;AACAF,UAAAA,MAAM,CAACC,cAAP,CAAsBygB,QAAtB,EAAgCF,QAAhC,EAA0CjE,IAA1C;AACH,SAPD,MAOO;AACHQ,UAAAA,eAAe,CAAC2D,QAAD,EAAWF,QAAX,EAAqBtgB,KAArB,CAAf;AACH;;AAED,eAAO,IAAP;AACH,OA9BD;AA+BH;;AAED,WAAO6L,GAAG,CAACxF,MAAD,EAASia,QAAT,EAAmBtgB,KAAnB,EAA0BwgB,QAA1B,CAAV;AACH;;AAED,WAASE,IAAT,CAAcra,MAAd,EAAsBia,QAAtB,EAAgCtgB,KAAhC,EAAuCwgB,QAAvC,EAAiDG,QAAjD,EAA2D;AACvD,QAAIC,CAAC,GAAG/U,GAAG,CAACxF,MAAD,EAASia,QAAT,EAAmBtgB,KAAnB,EAA0BwgB,QAAQ,IAAIna,MAAtC,CAAX;;AAEA,QAAI,CAACua,CAAD,IAAMD,QAAV,EAAoB;AAChB,YAAM,IAAIE,KAAJ,CAAU,wBAAV,CAAN;AACH;;AAED,WAAO7gB,KAAP;AACH;;AAED,WAAS8gB,sBAAT,CAAgCC,OAAhC,EAAyCC,GAAzC,EAA8C;AAC1C,QAAI,CAACA,GAAL,EAAU;AACNA,MAAAA,GAAG,GAAGD,OAAO,CAAC5O,KAAR,CAAc,CAAd,CAAN;AACH;;AAED,WAAOrS,MAAM,CAACmhB,MAAP,CACHnhB,MAAM,CAACohB,gBAAP,CAAwBH,OAAxB,EAAiC;AAC7BC,MAAAA,GAAG,EAAE;AACDhhB,QAAAA,KAAK,EAAEF,MAAM,CAACmhB,MAAP,CAAcD,GAAd;AADN;AADwB,KAAjC,CADG,CAAP;AAOH;;AAED,WAASG,2BAAT,CAAqCJ,OAArC,EAA8CC,GAA9C,EAAmD;AAC/C,QAAI,CAACA,GAAL,EAAU;AACNA,MAAAA,GAAG,GAAGD,OAAO,CAAC5O,KAAR,CAAc,CAAd,CAAN;AACH;;AAED4O,IAAAA,OAAO,CAACC,GAAR,GAAcA,GAAd;AACA,WAAOD,OAAP;AACH;;AAED,WAASK,YAAT,CAAsBC,GAAtB,EAA2BvpB,IAA3B,EAAiC;AAC7B,QAAIupB,GAAG,KAAKC,kBAAZ,EAAgC;AAC5B,YAAM,IAAIpB,cAAJ,CAAmBpoB,IAAI,GAAG,sCAA1B,CAAN;AACH,KAFD,MAEO;AACH,aAAOupB,GAAP;AACH;AACJ;;AAED,WAASE,cAAT,CAAwBzpB,IAAxB,EAA8B;AAC1B,UAAM,IAAI+oB,KAAJ,CAAU,MAAM/oB,IAAN,GAAa,gBAAvB,CAAN;AACH;;AAED,WAAS0pB,kBAAT,CAA4B1pB,IAA5B,EAAkC;AAC9B,UAAM,IAAI+oB,KAAJ,CAAU,YAAY/oB,IAAZ,GAAmB,mDAA7B,CAAN;AACH;;AAED,MAAIwpB,kBAAkB,GAAG,EAAzB;;AAEA,WAASG,cAAT,CAAwBhhB,GAAxB,EAA6BE,CAA7B,EAAgC;AAC5B,WAAO+gB,eAAe,CAACjhB,GAAD,CAAf,IAAwBkhB,qBAAqB,CAAClhB,GAAD,EAAME,CAAN,CAA7C,IAAyDihB,gBAAgB,EAAhF;AACH;;AAED,WAASC,mBAAT,CAA6BphB,GAA7B,EAAkCE,CAAlC,EAAqC;AACjC,WAAO+gB,eAAe,CAACjhB,GAAD,CAAf,IAAwBqhB,0BAA0B,CAACrhB,GAAD,EAAME,CAAN,CAAlD,IAA8DihB,gBAAgB,EAArF;AACH;;AAED,WAASG,QAAT,CAAkBthB,GAAlB,EAAuB;AACnB,WAAOihB,eAAe,CAACjhB,GAAD,CAAf,IAAwBuhB,gBAAgB,CAACvhB,GAAD,CAAxC,IAAiDmhB,gBAAgB,EAAxE;AACH;;AAED,WAASK,kBAAT,CAA4BxhB,GAA5B,EAAiC;AAC7B,WAAOyhB,kBAAkB,CAACzhB,GAAD,CAAlB,IAA2BuhB,gBAAgB,CAACvhB,GAAD,CAA3C,IAAoD0hB,kBAAkB,EAA7E;AACH;;AAED,WAASD,kBAAT,CAA4BzhB,GAA5B,EAAiC;AAC7B,QAAImU,KAAK,CAACwN,OAAN,CAAc3hB,GAAd,CAAJ,EAAwB;AACpB,WAAK,IAAIE,CAAC,GAAG,CAAR,EAAW0hB,IAAI,GAAG,IAAIzN,KAAJ,CAAUnU,GAAG,CAAC5G,MAAd,CAAvB,EAA8C8G,CAAC,GAAGF,GAAG,CAAC5G,MAAtD,EAA8D8G,CAAC,EAA/D,EAAmE0hB,IAAI,CAAC1hB,CAAD,CAAJ,GAAUF,GAAG,CAACE,CAAD,CAAb;;AAEnE,aAAO0hB,IAAP;AACH;AACJ;;AAED,WAASX,eAAT,CAAyBjhB,GAAzB,EAA8B;AAC1B,QAAImU,KAAK,CAACwN,OAAN,CAAc3hB,GAAd,CAAJ,EAAwB,OAAOA,GAAP;AAC3B;;AAED,WAASuhB,gBAAT,CAA0BlH,IAA1B,EAAgC;AAC5B,QACI1C,MAAM,CAACC,QAAP,IAAmBvY,MAAM,CAACgb,IAAD,CAAzB,IACAhb,MAAM,CAACF,SAAP,CAAiBuT,QAAjB,CAA0BmG,IAA1B,CAA+BwB,IAA/B,MAAyC,oBAF7C,EAII,OAAOlG,KAAK,CAAC0N,IAAN,CAAWxH,IAAX,CAAP;AACP;;AAED,WAAS6G,qBAAT,CAA+BlhB,GAA/B,EAAoCE,CAApC,EAAuC;AACnC,QAAI4hB,IAAI,GAAG,EAAX;AACA,QAAIC,EAAE,GAAG,IAAT;AACA,QAAIC,EAAE,GAAG,KAAT;AACA,QAAIC,EAAE,GAAGlnB,SAAT;;AAEA,QAAI;AACA,WAAK,IAAImnB,EAAE,GAAGliB,GAAG,CAAC2X,MAAM,CAACC,QAAR,CAAH,EAAT,EAAiCuK,EAAtC,EAA0C,EAAEJ,EAAE,GAAG,CAACI,EAAE,GAAGD,EAAE,CAAC1I,IAAH,EAAN,EAAiB9D,IAAxB,CAA1C,EAAyEqM,EAAE,GAAG,IAA9E,EAAoF;AAChFD,QAAAA,IAAI,CAAC3K,IAAL,CAAUgL,EAAE,CAAC5iB,KAAb;;AAEA,YAAIW,CAAC,IAAI4hB,IAAI,CAAC1oB,MAAL,KAAgB8G,CAAzB,EAA4B;AAC/B;AACJ,KAND,CAME,OAAO0Z,GAAP,EAAY;AACVoI,MAAAA,EAAE,GAAG,IAAL;AACAC,MAAAA,EAAE,GAAGrI,GAAL;AACH,KATD,SASU;AACN,UAAI;AACA,YAAI,CAACmI,EAAD,IAAOG,EAAE,CAAC,QAAD,CAAF,IAAgB,IAA3B,EAAiCA,EAAE,CAAC,QAAD,CAAF;AACpC,OAFD,SAEU;AACN,YAAIF,EAAJ,EAAQ,MAAMC,EAAN;AACX;AACJ;;AAED,WAAOH,IAAP;AACH;;AAED,WAAST,0BAAT,CAAoCrhB,GAApC,EAAyCE,CAAzC,EAA4C;AACxC,QAAI4hB,IAAI,GAAG,EAAX;;AAEA,SAAK,IAAIM,SAAS,GAAGpiB,GAAG,CAAC2X,MAAM,CAACC,QAAR,CAAH,EAAhB,EAAwCyK,KAA7C,EAAoD,CAAC,CAACA,KAAK,GAAGD,SAAS,CAAC5I,IAAV,EAAT,EAA2B9D,IAAhF,GAAwF;AACpFoM,MAAAA,IAAI,CAAC3K,IAAL,CAAUkL,KAAK,CAAC9iB,KAAhB;;AAEA,UAAIW,CAAC,IAAI4hB,IAAI,CAAC1oB,MAAL,KAAgB8G,CAAzB,EAA4B;AAC/B;;AAED,WAAO4hB,IAAP;AACH;;AAED,WAASJ,kBAAT,GAA8B;AAC1B,UAAM,IAAI5I,SAAJ,CAAc,iDAAd,CAAN;AACH;;AAED,WAASqI,gBAAT,GAA4B;AACxB,UAAM,IAAIrI,SAAJ,CAAc,sDAAd,CAAN;AACH;;AAED,WAASwJ,uBAAT,CAAiC1P,EAAjC,EAAqC;AACjC,WAAO,YAAW;AACd,UAAI2P,EAAE,GAAG3P,EAAE,CAACxV,KAAH,CAAS,IAAT,EAAetC,SAAf,CAAT;AACAynB,MAAAA,EAAE,CAAC/I,IAAH;AACA,aAAO+I,EAAP;AACH,KAJD;AAKH;;AAED,WAASC,YAAT,CAAsBC,KAAtB,EAA6BC,IAA7B,EAAmC;AAC/B,QAAI,OAAOD,KAAP,KAAiB,QAAjB,IAA6BA,KAAK,KAAK,IAA3C,EAAiD,OAAOA,KAAP;AACjD,QAAIE,IAAI,GAAGF,KAAK,CAAC9K,MAAM,CAACiL,WAAR,CAAhB;;AAEA,QAAID,IAAI,KAAK5nB,SAAb,EAAwB;AACpB,UAAI8nB,GAAG,GAAGF,IAAI,CAAC9J,IAAL,CAAU4J,KAAV,EAAiBC,IAAI,IAAI,SAAzB,CAAV;AACA,UAAI,OAAOG,GAAP,KAAe,QAAnB,EAA6B,OAAOA,GAAP;AAC7B,YAAM,IAAI/J,SAAJ,CAAc,8CAAd,CAAN;AACH;;AAED,WAAO,CAAC4J,IAAI,KAAK,QAAT,GAAoBI,MAApB,GAA6BC,MAA9B,EAAsCN,KAAtC,CAAP;AACH;;AAED,WAASO,cAAT,CAAwB1J,GAAxB,EAA6B;AACzB,QAAIzV,GAAG,GAAG2e,YAAY,CAAClJ,GAAD,EAAM,QAAN,CAAtB;;AAEA,WAAO,OAAOzV,GAAP,KAAe,QAAf,GAA0BA,GAA1B,GAAgCif,MAAM,CAACjf,GAAD,CAA7C;AACH;;AAED,WAASof,yBAAT,CAAmC9H,UAAnC,EAA+C+H,OAA/C,EAAwD;AACpD,UAAM,IAAI9C,KAAJ,CACF,0DACI,kEADJ,GAEI,0EAFJ,GAGI,kDAJF,CAAN;AAMH;;AAED,WAAS+C,0BAAT,CAAoCvd,MAApC,EAA4Cia,QAA5C,EAAsD1E,UAAtD,EAAkE+H,OAAlE,EAA2E;AACvE,QAAI,CAAC/H,UAAL,EAAiB;AACjB9b,IAAAA,MAAM,CAACC,cAAP,CAAsBsG,MAAtB,EAA8Bia,QAA9B,EAAwC;AACpCzE,MAAAA,UAAU,EAAED,UAAU,CAACC,UADa;AAEpCC,MAAAA,YAAY,EAAEF,UAAU,CAACE,YAFW;AAGpCC,MAAAA,QAAQ,EAAEH,UAAU,CAACG,QAHe;AAIpC/b,MAAAA,KAAK,EAAE4b,UAAU,CAACiI,WAAX,GAAyBjI,UAAU,CAACiI,WAAX,CAAuBvK,IAAvB,CAA4BqK,OAA5B,CAAzB,GAAgE,KAAK;AAJxC,KAAxC;AAMH;;AAED,WAASG,yBAAT,CAAmCzd,MAAnC,EAA2Cia,QAA3C,EAAqDyD,UAArD,EAAiEnI,UAAjE,EAA6E+H,OAA7E,EAAsF;AAClF,QAAItH,IAAI,GAAG,EAAX;AACAvc,IAAAA,MAAM,CAACsE,IAAP,CAAYwX,UAAZ,EAAwBvX,OAAxB,CAAgC,UAASC,GAAT,EAAc;AAC1C+X,MAAAA,IAAI,CAAC/X,GAAD,CAAJ,GAAYsX,UAAU,CAACtX,GAAD,CAAtB;AACH,KAFD;AAGA+X,IAAAA,IAAI,CAACR,UAAL,GAAkB,CAAC,CAACQ,IAAI,CAACR,UAAzB;AACAQ,IAAAA,IAAI,CAACP,YAAL,GAAoB,CAAC,CAACO,IAAI,CAACP,YAA3B;;AAEA,QAAI,WAAWO,IAAX,IAAmBA,IAAI,CAACwH,WAA5B,EAAyC;AACrCxH,MAAAA,IAAI,CAACN,QAAL,GAAgB,IAAhB;AACH;;AAEDM,IAAAA,IAAI,GAAG0H,UAAU,CACZ5R,KADE,GAEF6R,OAFE,GAGFzZ,MAHE,CAGK,UAAS8R,IAAT,EAAe4H,SAAf,EAA0B;AAC9B,aAAOA,SAAS,CAAC5d,MAAD,EAASia,QAAT,EAAmBjE,IAAnB,CAAT,IAAqCA,IAA5C;AACH,KALE,EAKAA,IALA,CAAP;;AAOA,QAAIsH,OAAO,IAAItH,IAAI,CAACwH,WAAL,KAAqB,KAAK,CAAzC,EAA4C;AACxCxH,MAAAA,IAAI,CAACrc,KAAL,GAAaqc,IAAI,CAACwH,WAAL,GAAmBxH,IAAI,CAACwH,WAAL,CAAiBvK,IAAjB,CAAsBqK,OAAtB,CAAnB,GAAoD,KAAK,CAAtE;AACAtH,MAAAA,IAAI,CAACwH,WAAL,GAAmBroB,SAAnB;AACH;;AAED,QAAI6gB,IAAI,CAACwH,WAAL,KAAqB,KAAK,CAA9B,EAAiC;AAC7B/jB,MAAAA,MAAM,CAACC,cAAP,CAAsBsG,MAAtB,EAA8Bia,QAA9B,EAAwCjE,IAAxC;AACAA,MAAAA,IAAI,GAAG,IAAP;AACH;;AAED,WAAOA,IAAP;AACH;;AAED,MAAI3U,EAAE,GAAG,CAAT;;AAEA,WAASwc,0BAAT,CAAoCpsB,IAApC,EAA0C;AACtC,WAAO,eAAe4P,EAAE,EAAjB,GAAsB,GAAtB,GAA4B5P,IAAnC;AACH;;AAED,WAASqsB,2BAAT,CAAqC3D,QAArC,EAA+C4D,UAA/C,EAA2D;AACvD,QAAI,CAACtkB,MAAM,CAACF,SAAP,CAAiBod,cAAjB,CAAgC1D,IAAhC,CAAqCkH,QAArC,EAA+C4D,UAA/C,CAAL,EAAiE;AAC7D,YAAM,IAAI7K,SAAJ,CAAc,gDAAd,CAAN;AACH;;AAED,WAAOiH,QAAP;AACH;;AAED,WAAS6D,qBAAT,CAA+B7D,QAA/B,EAAyC8D,UAAzC,EAAqD;AACjD,QAAI,CAACA,UAAU,CAACzF,GAAX,CAAe2B,QAAf,CAAL,EAA+B;AAC3B,YAAM,IAAIjH,SAAJ,CAAc,gDAAd,CAAN;AACH;;AAED,QAAIqC,UAAU,GAAG0I,UAAU,CAACxF,GAAX,CAAe0B,QAAf,CAAjB;;AAEA,QAAI5E,UAAU,CAACkD,GAAf,EAAoB;AAChB,aAAOlD,UAAU,CAACkD,GAAX,CAAexF,IAAf,CAAoBkH,QAApB,CAAP;AACH;;AAED,WAAO5E,UAAU,CAAC5b,KAAlB;AACH;;AAED,WAASukB,qBAAT,CAA+B/D,QAA/B,EAAyC8D,UAAzC,EAAqDtkB,KAArD,EAA4D;AACxD,QAAI,CAACskB,UAAU,CAACzF,GAAX,CAAe2B,QAAf,CAAL,EAA+B;AAC3B,YAAM,IAAIjH,SAAJ,CAAc,gDAAd,CAAN;AACH;;AAED,QAAIqC,UAAU,GAAG0I,UAAU,CAACxF,GAAX,CAAe0B,QAAf,CAAjB;;AAEA,QAAI5E,UAAU,CAAC/P,GAAf,EAAoB;AAChB+P,MAAAA,UAAU,CAAC/P,GAAX,CAAeyN,IAAf,CAAoBkH,QAApB,EAA8BxgB,KAA9B;AACH,KAFD,MAEO;AACH,UAAI,CAAC4b,UAAU,CAACG,QAAhB,EAA0B;AACtB,cAAM,IAAIxC,SAAJ,CAAc,0CAAd,CAAN;AACH;;AAEDqC,MAAAA,UAAU,CAAC5b,KAAX,GAAmBA,KAAnB;AACH;;AAED,WAAOA,KAAP;AACH;;AAED,WAASwkB,+BAAT,CAAyChE,QAAzC,EAAmDiE,gBAAnD,EAAqE7I,UAArE,EAAiF;AAC7E,QAAI4E,QAAQ,KAAKiE,gBAAjB,EAAmC;AAC/B,YAAM,IAAIlL,SAAJ,CAAc,2CAAd,CAAN;AACH;;AAED,WAAOqC,UAAU,CAAC5b,KAAlB;AACH;;AAED,WAAS0kB,+BAAT,CAAyClE,QAAzC,EAAmDiE,gBAAnD,EAAqE7I,UAArE,EAAiF5b,KAAjF,EAAwF;AACpF,QAAIwgB,QAAQ,KAAKiE,gBAAjB,EAAmC;AAC/B,YAAM,IAAIlL,SAAJ,CAAc,2CAAd,CAAN;AACH;;AAED,QAAI,CAACqC,UAAU,CAACG,QAAhB,EAA0B;AACtB,YAAM,IAAIxC,SAAJ,CAAc,0CAAd,CAAN;AACH;;AAEDqC,IAAAA,UAAU,CAAC5b,KAAX,GAAmBA,KAAnB;AACA,WAAOA,KAAP;AACH;;AAED,WAAS2kB,4BAAT,CAAsCnE,QAAtC,EAAgDiE,gBAAhD,EAAkErL,MAAlE,EAA0E;AACtE,QAAIoH,QAAQ,KAAKiE,gBAAjB,EAAmC;AAC/B,YAAM,IAAIlL,SAAJ,CAAc,2CAAd,CAAN;AACH;;AAED,WAAOH,MAAP;AACH;;AAED,WAASwL,4BAAT,GAAwC;AACpC,UAAM,IAAIrL,SAAJ,CAAc,iDAAd,CAAN;AACH;;AAED,WAASsL,SAAT,CAAmBd,UAAnB,EAA+B7sB,OAA/B,EAAwCmmB,UAAxC,EAAoDyH,MAApD,EAA4D;AACxD,QAAIC,GAAG,GAAGC,iBAAiB,EAA3B;;AAEA,QAAIF,MAAJ,EAAY;AACR,WAAK,IAAInkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmkB,MAAM,CAACjrB,MAA3B,EAAmC8G,CAAC,EAApC,EAAwC;AACpCokB,QAAAA,GAAG,GAAGD,MAAM,CAACnkB,CAAD,CAAN,CAAUokB,GAAV,CAAN;AACH;AACJ;;AAED,QAAI3V,CAAC,GAAGlY,OAAO,CAAC,SAAS+tB,UAAT,CAAoBC,CAApB,EAAuB;AACnCH,MAAAA,GAAG,CAACI,0BAAJ,CAA+BD,CAA/B,EAAkCE,SAAS,CAACC,QAA5C;AACH,KAFc,EAEZhI,UAFY,CAAf;AAGA,QAAI+H,SAAS,GAAGL,GAAG,CAACO,aAAJ,CACZC,sBAAsB,CAACnW,CAAC,CAAClI,CAAF,CAAI9D,GAAJ,CAAQoiB,wBAAR,CAAD,CADV,EAEZzB,UAFY,CAAhB;AAIAgB,IAAAA,GAAG,CAACU,uBAAJ,CAA4BrW,CAAC,CAACsW,CAA9B,EAAiCN,SAAS,CAACC,QAA3C;AACA,WAAON,GAAG,CAACY,iBAAJ,CAAsBvW,CAAC,CAACsW,CAAxB,EAA2BN,SAAS,CAACQ,SAArC,CAAP;AACH;;AAED,WAASZ,iBAAT,GAA6B;AACzBA,IAAAA,iBAAiB,GAAG,YAAW;AAC3B,aAAOD,GAAP;AACH,KAFD;;AAIA,QAAIA,GAAG,GAAG;AACNc,MAAAA,uBAAuB,EAAE,CAAC,CAAC,QAAD,CAAD,EAAa,CAAC,OAAD,CAAb,CADnB;AAENV,MAAAA,0BAA0B,EAAE,UAASD,CAAT,EAAYG,QAAZ,EAAsB;AAC9C,SAAC,QAAD,EAAW,OAAX,EAAoBhhB,OAApB,CAA4B,UAASyhB,IAAT,EAAe;AACvCT,UAAAA,QAAQ,CAAChhB,OAAT,CAAiB,UAASH,OAAT,EAAkB;AAC/B,gBAAIA,OAAO,CAAC4hB,IAAR,KAAiBA,IAAjB,IAAyB5hB,OAAO,CAAC6hB,SAAR,KAAsB,KAAnD,EAA0D;AACtD,mBAAKC,kBAAL,CAAwBd,CAAxB,EAA2BhhB,OAA3B;AACH;AACJ,WAJD,EAIG,IAJH;AAKH,SAND,EAMG,IANH;AAOH,OAVK;AAWNuhB,MAAAA,uBAAuB,EAAE,UAASC,CAAT,EAAYL,QAAZ,EAAsB;AAC3C,YAAIY,KAAK,GAAGP,CAAC,CAAC9lB,SAAd;AACA,SAAC,QAAD,EAAW,OAAX,EAAoByE,OAApB,CAA4B,UAASyhB,IAAT,EAAe;AACvCT,UAAAA,QAAQ,CAAChhB,OAAT,CAAiB,UAASH,OAAT,EAAkB;AAC/B,gBAAI6hB,SAAS,GAAG7hB,OAAO,CAAC6hB,SAAxB;;AAEA,gBACI7hB,OAAO,CAAC4hB,IAAR,KAAiBA,IAAjB,KACCC,SAAS,KAAK,QAAd,IAA0BA,SAAS,KAAK,WADzC,CADJ,EAGE;AACE,kBAAIvF,QAAQ,GAAGuF,SAAS,KAAK,QAAd,GAAyBL,CAAzB,GAA6BO,KAA5C;AACA,mBAAKD,kBAAL,CAAwBxF,QAAxB,EAAkCtc,OAAlC;AACH;AACJ,WAVD,EAUG,IAVH;AAWH,SAZD,EAYG,IAZH;AAaH,OA1BK;AA2BN8hB,MAAAA,kBAAkB,EAAE,UAASxF,QAAT,EAAmBtc,OAAnB,EAA4B;AAC5C,YAAI0X,UAAU,GAAG1X,OAAO,CAAC0X,UAAzB;;AAEA,YAAI1X,OAAO,CAAC4hB,IAAR,KAAiB,OAArB,EAA8B;AAC1B,cAAIjC,WAAW,GAAG3f,OAAO,CAAC2f,WAA1B;AACAjI,UAAAA,UAAU,GAAG;AACTC,YAAAA,UAAU,EAAED,UAAU,CAACC,UADd;AAETE,YAAAA,QAAQ,EAAEH,UAAU,CAACG,QAFZ;AAGTD,YAAAA,YAAY,EAAEF,UAAU,CAACE,YAHhB;AAIT9b,YAAAA,KAAK,EAAE6jB,WAAW,KAAK,KAAK,CAArB,GAAyB,KAAK,CAA9B,GAAkCA,WAAW,CAACvK,IAAZ,CAAiBkH,QAAjB;AAJhC,WAAb;AAMH;;AAED1gB,QAAAA,MAAM,CAACC,cAAP,CAAsBygB,QAAtB,EAAgCtc,OAAO,CAACI,GAAxC,EAA6CsX,UAA7C;AACH,OAzCK;AA0CN0J,MAAAA,aAAa,EAAE,UAASD,QAAT,EAAmBtB,UAAnB,EAA+B;AAC1C,YAAImC,WAAW,GAAG,EAAlB;AACA,YAAIN,SAAS,GAAG,EAAhB;AACA,YAAIO,UAAU,GAAG;AACbC,UAAAA,MAAM,EAAE,EADK;AAEbxmB,UAAAA,SAAS,EAAE,EAFE;AAGbymB,UAAAA,GAAG,EAAE;AAHQ,SAAjB;AAKAhB,QAAAA,QAAQ,CAAChhB,OAAT,CAAiB,UAASH,OAAT,EAAkB;AAC/B,eAAKoiB,mBAAL,CAAyBpiB,OAAzB,EAAkCiiB,UAAlC;AACH,SAFD,EAEG,IAFH;AAGAd,QAAAA,QAAQ,CAAChhB,OAAT,CAAiB,UAASH,OAAT,EAAkB;AAC/B,cAAI,CAACqiB,cAAc,CAACriB,OAAD,CAAnB,EAA8B,OAAOgiB,WAAW,CAACtO,IAAZ,CAAiB1T,OAAjB,CAAP;AAC9B,cAAIsiB,sBAAsB,GAAG,KAAKC,eAAL,CAAqBviB,OAArB,EAA8BiiB,UAA9B,CAA7B;AACAD,UAAAA,WAAW,CAACtO,IAAZ,CAAiB4O,sBAAsB,CAACtiB,OAAxC;AACAgiB,UAAAA,WAAW,CAACtO,IAAZ,CAAiB/Z,KAAjB,CAAuBqoB,WAAvB,EAAoCM,sBAAsB,CAACE,MAA3D;AACAd,UAAAA,SAAS,CAAChO,IAAV,CAAe/Z,KAAf,CAAqB+nB,SAArB,EAAgCY,sBAAsB,CAACZ,SAAvD;AACH,SAND,EAMG,IANH;;AAQA,YAAI,CAAC7B,UAAL,EAAiB;AACb,iBAAO;AACHsB,YAAAA,QAAQ,EAAEa,WADP;AAEHN,YAAAA,SAAS,EAAEA;AAFR,WAAP;AAIH;;AAED,YAAI7c,MAAM,GAAG,KAAK4d,mBAAL,CAAyBT,WAAzB,EAAsCnC,UAAtC,CAAb;AACA6B,QAAAA,SAAS,CAAChO,IAAV,CAAe/Z,KAAf,CAAqB+nB,SAArB,EAAgC7c,MAAM,CAAC6c,SAAvC;AACA7c,QAAAA,MAAM,CAAC6c,SAAP,GAAmBA,SAAnB;AACA,eAAO7c,MAAP;AACH,OAxEK;AAyENud,MAAAA,mBAAmB,EAAE,UAASpiB,OAAT,EAAkBiiB,UAAlB,EAA8BS,MAA9B,EAAsC;AACvD,YAAIxiB,IAAI,GAAG+hB,UAAU,CAACjiB,OAAO,CAAC6hB,SAAT,CAArB;;AAEA,YAAI,CAACa,MAAD,IAAWxiB,IAAI,CAACyC,OAAL,CAAa3C,OAAO,CAACI,GAArB,MAA8B,CAAC,CAA9C,EAAiD;AAC7C,gBAAM,IAAIiV,SAAJ,CAAc,yBAAyBrV,OAAO,CAACI,GAAjC,GAAuC,GAArD,CAAN;AACH;;AAEDF,QAAAA,IAAI,CAACwT,IAAL,CAAU1T,OAAO,CAACI,GAAlB;AACH,OAjFK;AAkFNmiB,MAAAA,eAAe,EAAE,UAASviB,OAAT,EAAkBiiB,UAAlB,EAA8B;AAC3C,YAAIO,MAAM,GAAG,EAAb;AACA,YAAId,SAAS,GAAG,EAAhB;;AAEA,aAAK,IAAI7B,UAAU,GAAG7f,OAAO,CAAC6f,UAAzB,EAAqCpjB,CAAC,GAAGojB,UAAU,CAAClqB,MAAX,GAAoB,CAAlE,EAAqE8G,CAAC,IAAI,CAA1E,EAA6EA,CAAC,EAA9E,EAAkF;AAC9E,cAAIyD,IAAI,GAAG+hB,UAAU,CAACjiB,OAAO,CAAC6hB,SAAT,CAArB;AACA3hB,UAAAA,IAAI,CAACyiB,MAAL,CAAYziB,IAAI,CAACyC,OAAL,CAAa3C,OAAO,CAACI,GAArB,CAAZ,EAAuC,CAAvC;AACA,cAAIwiB,aAAa,GAAG,KAAKC,qBAAL,CAA2B7iB,OAA3B,CAApB;AACA,cAAI8iB,qBAAqB,GAAG,KAAKC,uBAAL,CACxB,CAAC,GAAGlD,UAAU,CAACpjB,CAAD,CAAd,EAAmBmmB,aAAnB,KAAqCA,aADb,CAA5B;AAGA5iB,UAAAA,OAAO,GAAG8iB,qBAAqB,CAAC9iB,OAAhC;AACA,eAAKoiB,mBAAL,CAAyBpiB,OAAzB,EAAkCiiB,UAAlC;;AAEA,cAAIa,qBAAqB,CAACE,QAA1B,EAAoC;AAChCtB,YAAAA,SAAS,CAAChO,IAAV,CAAeoP,qBAAqB,CAACE,QAArC;AACH;;AAED,cAAIC,SAAS,GAAGH,qBAAqB,CAACN,MAAtC;;AAEA,cAAIS,SAAJ,EAAe;AACX,iBAAK,IAAI3W,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2W,SAAS,CAACttB,MAA9B,EAAsC2W,CAAC,EAAvC,EAA2C;AACvC,mBAAK8V,mBAAL,CAAyBa,SAAS,CAAC3W,CAAD,CAAlC,EAAuC2V,UAAvC;AACH;;AAEDO,YAAAA,MAAM,CAAC9O,IAAP,CAAY/Z,KAAZ,CAAkB6oB,MAAlB,EAA0BS,SAA1B;AACH;AACJ;;AAED,eAAO;AACHjjB,UAAAA,OAAO,EAAEA,OADN;AAEH0hB,UAAAA,SAAS,EAAEA,SAFR;AAGHc,UAAAA,MAAM,EAAEA;AAHL,SAAP;AAKH,OApHK;AAqHNC,MAAAA,mBAAmB,EAAE,UAAStB,QAAT,EAAmBtB,UAAnB,EAA+B;AAChD,YAAI6B,SAAS,GAAG,EAAhB;;AAEA,aAAK,IAAIjlB,CAAC,GAAGojB,UAAU,CAAClqB,MAAX,GAAoB,CAAjC,EAAoC8G,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD;AAC7C,cAAI6K,GAAG,GAAG,KAAK4b,mBAAL,CAAyB/B,QAAzB,CAAV;AACA,cAAIgC,mBAAmB,GAAG,KAAKC,iBAAL,CACtB,CAAC,GAAGvD,UAAU,CAACpjB,CAAD,CAAd,EAAmB6K,GAAnB,KAA2BA,GADL,CAA1B;;AAIA,cAAI6b,mBAAmB,CAACH,QAApB,KAAiC1rB,SAArC,EAAgD;AAC5CoqB,YAAAA,SAAS,CAAChO,IAAV,CAAeyP,mBAAmB,CAACH,QAAnC;AACH;;AAED,cAAIG,mBAAmB,CAAChC,QAApB,KAAiC7pB,SAArC,EAAgD;AAC5C6pB,YAAAA,QAAQ,GAAGgC,mBAAmB,CAAChC,QAA/B;;AAEA,iBAAK,IAAI7U,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6U,QAAQ,CAACxrB,MAAT,GAAkB,CAAtC,EAAyC2W,CAAC,EAA1C,EAA8C;AAC1C,mBAAK,IAAI+W,CAAC,GAAG/W,CAAC,GAAG,CAAjB,EAAoB+W,CAAC,GAAGlC,QAAQ,CAACxrB,MAAjC,EAAyC0tB,CAAC,EAA1C,EAA8C;AAC1C,oBACIlC,QAAQ,CAAC7U,CAAD,CAAR,CAAYlM,GAAZ,KAAoB+gB,QAAQ,CAACkC,CAAD,CAAR,CAAYjjB,GAAhC,IACA+gB,QAAQ,CAAC7U,CAAD,CAAR,CAAYuV,SAAZ,KAA0BV,QAAQ,CAACkC,CAAD,CAAR,CAAYxB,SAF1C,EAGE;AACE,wBAAM,IAAIxM,SAAJ,CACF,yBAAyB8L,QAAQ,CAAC7U,CAAD,CAAR,CAAYlM,GAArC,GAA2C,GADzC,CAAN;AAGH;AACJ;AACJ;AACJ;AACJ;;AAED,eAAO;AACH+gB,UAAAA,QAAQ,EAAEA,QADP;AAEHO,UAAAA,SAAS,EAAEA;AAFR,SAAP;AAIH,OAxJK;AAyJNmB,MAAAA,qBAAqB,EAAE,UAAS7iB,OAAT,EAAkB;AACrC,YAAIsH,GAAG,GAAG;AACNsa,UAAAA,IAAI,EAAE5hB,OAAO,CAAC4hB,IADR;AAENxhB,UAAAA,GAAG,EAAEJ,OAAO,CAACI,GAFP;AAGNyhB,UAAAA,SAAS,EAAE7hB,OAAO,CAAC6hB,SAHb;AAINnK,UAAAA,UAAU,EAAE1X,OAAO,CAAC0X;AAJd,SAAV;AAMA,YAAIS,IAAI,GAAG;AACPrc,UAAAA,KAAK,EAAE,YADA;AAEP8b,UAAAA,YAAY,EAAE;AAFP,SAAX;AAIAhc,QAAAA,MAAM,CAACC,cAAP,CAAsByL,GAAtB,EAA2B4M,MAAM,CAACoP,WAAlC,EAA+CnL,IAA/C;AACA,YAAInY,OAAO,CAAC4hB,IAAR,KAAiB,OAArB,EAA8Bta,GAAG,CAACqY,WAAJ,GAAkB3f,OAAO,CAAC2f,WAA1B;AAC9B,eAAOrY,GAAP;AACH,OAvKK;AAwKNic,MAAAA,oBAAoB,EAAE,UAASC,cAAT,EAAyB;AAC3C,YAAIA,cAAc,KAAKlsB,SAAvB,EAAkC;AAClC,eAAOumB,QAAQ,CAAC2F,cAAD,CAAR,CAAyBtkB,GAAzB,CAA6B,UAAS0jB,aAAT,EAAwB;AACxD,cAAI5iB,OAAO,GAAG,KAAKyjB,mBAAL,CAAyBb,aAAzB,CAAd;AACA,eAAKc,gBAAL,CAAsBd,aAAtB,EAAqC,UAArC,EAAiD,uBAAjD;AACA,eAAKc,gBAAL,CAAsBd,aAAtB,EAAqC,QAArC,EAA+C,uBAA/C;AACA,iBAAO5iB,OAAP;AACH,SALM,EAKJ,IALI,CAAP;AAMH,OAhLK;AAiLNyjB,MAAAA,mBAAmB,EAAE,UAASb,aAAT,EAAwB;AACzC,YAAIhB,IAAI,GAAGvC,MAAM,CAACuD,aAAa,CAAChB,IAAf,CAAjB;;AAEA,YAAIA,IAAI,KAAK,QAAT,IAAqBA,IAAI,KAAK,OAAlC,EAA2C;AACvC,gBAAM,IAAIvM,SAAJ,CACF,uEACI,8DADJ,GAEI,UAFJ,GAGIuM,IAHJ,GAII,GALF,CAAN;AAOH;;AAED,YAAIxhB,GAAG,GAAGmf,cAAc,CAACqD,aAAa,CAACxiB,GAAf,CAAxB;;AAEA,YAAIyhB,SAAS,GAAGxC,MAAM,CAACuD,aAAa,CAACf,SAAf,CAAtB;;AAEA,YAAIA,SAAS,KAAK,QAAd,IAA0BA,SAAS,KAAK,WAAxC,IAAuDA,SAAS,KAAK,KAAzE,EAAgF;AAC5E,gBAAM,IAAIxM,SAAJ,CACF,0EACI,sEADJ,GAEI,oBAFJ,GAGIwM,SAHJ,GAII,GALF,CAAN;AAOH;;AAED,YAAInK,UAAU,GAAGkL,aAAa,CAAClL,UAA/B;AACA,aAAKgM,gBAAL,CAAsBd,aAAtB,EAAqC,UAArC,EAAiD,uBAAjD;AACA,YAAI5iB,OAAO,GAAG;AACV4hB,UAAAA,IAAI,EAAEA,IADI;AAEVxhB,UAAAA,GAAG,EAAEA,GAFK;AAGVyhB,UAAAA,SAAS,EAAEA,SAHD;AAIVnK,UAAAA,UAAU,EAAE9b,MAAM,CAAC+E,MAAP,CAAc,EAAd,EAAkB+W,UAAlB;AAJF,SAAd;;AAOA,YAAIkK,IAAI,KAAK,OAAb,EAAsB;AAClB,eAAK8B,gBAAL,CAAsBd,aAAtB,EAAqC,aAArC,EAAoD,qBAApD;AACH,SAFD,MAEO;AACH,eAAKc,gBAAL,CACIhM,UADJ,EAEI,KAFJ,EAGI,+CAHJ;AAKA,eAAKgM,gBAAL,CACIhM,UADJ,EAEI,KAFJ,EAGI,+CAHJ;AAKA,eAAKgM,gBAAL,CACIhM,UADJ,EAEI,OAFJ,EAGI,+CAHJ;AAKA1X,UAAAA,OAAO,CAAC2f,WAAR,GAAsBiD,aAAa,CAACjD,WAApC;AACH;;AAED,eAAO3f,OAAP;AACH,OA3OK;AA4ON+iB,MAAAA,uBAAuB,EAAE,UAASH,aAAT,EAAwB;AAC7C,YAAI5iB,OAAO,GAAG,KAAKyjB,mBAAL,CAAyBb,aAAzB,CAAd;;AAEA,YAAII,QAAQ,GAAGW,yBAAyB,CAACf,aAAD,EAAgB,UAAhB,CAAxC;;AAEA,YAAIJ,MAAM,GAAG,KAAKe,oBAAL,CAA0BX,aAAa,CAACJ,MAAxC,CAAb;AACA,eAAO;AACHxiB,UAAAA,OAAO,EAAEA,OADN;AAEHgjB,UAAAA,QAAQ,EAAEA,QAFP;AAGHR,UAAAA,MAAM,EAAEA;AAHL,SAAP;AAKH,OAvPK;AAwPNU,MAAAA,mBAAmB,EAAE,UAAS/B,QAAT,EAAmB;AACpC,YAAI7Z,GAAG,GAAG;AACNsa,UAAAA,IAAI,EAAE,OADA;AAENT,UAAAA,QAAQ,EAAEA,QAAQ,CAACjiB,GAAT,CAAa,KAAK2jB,qBAAlB,EAAyC,IAAzC;AAFJ,SAAV;AAIA,YAAI1K,IAAI,GAAG;AACPrc,UAAAA,KAAK,EAAE,YADA;AAEP8b,UAAAA,YAAY,EAAE;AAFP,SAAX;AAIAhc,QAAAA,MAAM,CAACC,cAAP,CAAsByL,GAAtB,EAA2B4M,MAAM,CAACoP,WAAlC,EAA+CnL,IAA/C;AACA,eAAO7Q,GAAP;AACH,OAnQK;AAoQN8b,MAAAA,iBAAiB,EAAE,UAAS9b,GAAT,EAAc;AAC7B,YAAIsa,IAAI,GAAGvC,MAAM,CAAC/X,GAAG,CAACsa,IAAL,CAAjB;;AAEA,YAAIA,IAAI,KAAK,OAAb,EAAsB;AAClB,gBAAM,IAAIvM,SAAJ,CACF,0EACI,0CADJ,GAEIuM,IAFJ,GAGI,GAJF,CAAN;AAMH;;AAED,aAAK8B,gBAAL,CAAsBpc,GAAtB,EAA2B,KAA3B,EAAkC,oBAAlC;AACA,aAAKoc,gBAAL,CAAsBpc,GAAtB,EAA2B,WAA3B,EAAwC,oBAAxC;AACA,aAAKoc,gBAAL,CAAsBpc,GAAtB,EAA2B,YAA3B,EAAyC,oBAAzC;AACA,aAAKoc,gBAAL,CAAsBpc,GAAtB,EAA2B,aAA3B,EAA0C,oBAA1C;AACA,aAAKoc,gBAAL,CAAsBpc,GAAtB,EAA2B,QAA3B,EAAqC,oBAArC;;AAEA,YAAI0b,QAAQ,GAAGW,yBAAyB,CAACrc,GAAD,EAAM,UAAN,CAAxC;;AAEA,YAAI6Z,QAAQ,GAAG,KAAKoC,oBAAL,CAA0Bjc,GAAG,CAAC6Z,QAA9B,CAAf;AACA,eAAO;AACHA,UAAAA,QAAQ,EAAEA,QADP;AAEH6B,UAAAA,QAAQ,EAAEA;AAFP,SAAP;AAIH,OA7RK;AA8RNvB,MAAAA,iBAAiB,EAAE,UAASrN,WAAT,EAAsBsN,SAAtB,EAAiC;AAChD,aAAK,IAAIjlB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGilB,SAAS,CAAC/rB,MAA9B,EAAsC8G,CAAC,EAAvC,EAA2C;AACvC,cAAImnB,cAAc,GAAG,CAAC,GAAGlC,SAAS,CAACjlB,CAAD,CAAb,EAAkB2X,WAAlB,CAArB;;AAEA,cAAIwP,cAAc,KAAKtsB,SAAvB,EAAkC;AAC9B,gBAAI,OAAOssB,cAAP,KAA0B,UAA9B,EAA0C;AACtC,oBAAM,IAAIvO,SAAJ,CAAc,sCAAd,CAAN;AACH;;AAEDjB,YAAAA,WAAW,GAAGwP,cAAd;AACH;AACJ;;AAED,eAAOxP,WAAP;AACH,OA5SK;AA6SNsP,MAAAA,gBAAgB,EAAE,UAASpc,GAAT,EAAc1T,IAAd,EAAoBiwB,UAApB,EAAgC;AAC9C,YAAIvc,GAAG,CAAC1T,IAAD,CAAH,KAAc0D,SAAlB,EAA6B;AACzB,gBAAM,IAAI+d,SAAJ,CAAcwO,UAAU,GAAG,iBAAb,GAAiCjwB,IAAjC,GAAwC,YAAtD,CAAN;AACH;AACJ;AAjTK,KAAV;AAmTA,WAAOitB,GAAP;AACH;;AAED,WAASS,wBAAT,CAAkCwC,GAAlC,EAAuC;AACnC,QAAI1jB,GAAG,GAAGmf,cAAc,CAACuE,GAAG,CAAC1jB,GAAL,CAAxB;;AAEA,QAAIsX,UAAJ;;AAEA,QAAIoM,GAAG,CAAClC,IAAJ,KAAa,QAAjB,EAA2B;AACvBlK,MAAAA,UAAU,GAAG;AACT5b,QAAAA,KAAK,EAAEgoB,GAAG,CAAChoB,KADF;AAET+b,QAAAA,QAAQ,EAAE,IAFD;AAGTD,QAAAA,YAAY,EAAE,IAHL;AAITD,QAAAA,UAAU,EAAE;AAJH,OAAb;AAMH,KAPD,MAOO,IAAImM,GAAG,CAAClC,IAAJ,KAAa,KAAjB,EAAwB;AAC3BlK,MAAAA,UAAU,GAAG;AACTkD,QAAAA,GAAG,EAAEkJ,GAAG,CAAChoB,KADA;AAET8b,QAAAA,YAAY,EAAE,IAFL;AAGTD,QAAAA,UAAU,EAAE;AAHH,OAAb;AAKH,KANM,MAMA,IAAImM,GAAG,CAAClC,IAAJ,KAAa,KAAjB,EAAwB;AAC3BlK,MAAAA,UAAU,GAAG;AACT/P,QAAAA,GAAG,EAAEmc,GAAG,CAAChoB,KADA;AAET8b,QAAAA,YAAY,EAAE,IAFL;AAGTD,QAAAA,UAAU,EAAE;AAHH,OAAb;AAKH,KANM,MAMA,IAAImM,GAAG,CAAClC,IAAJ,KAAa,OAAjB,EAA0B;AAC7BlK,MAAAA,UAAU,GAAG;AACTE,QAAAA,YAAY,EAAE,IADL;AAETC,QAAAA,QAAQ,EAAE,IAFD;AAGTF,QAAAA,UAAU,EAAE;AAHH,OAAb;AAKH;;AAED,QAAI3X,OAAO,GAAG;AACV4hB,MAAAA,IAAI,EAAEkC,GAAG,CAAClC,IAAJ,KAAa,OAAb,GAAuB,OAAvB,GAAiC,QAD7B;AAEVxhB,MAAAA,GAAG,EAAEA,GAFK;AAGVyhB,MAAAA,SAAS,EAAEiC,GAAG,CAAC5B,MAAJ,GAAa,QAAb,GAAwB4B,GAAG,CAAClC,IAAJ,KAAa,OAAb,GAAuB,KAAvB,GAA+B,WAHxD;AAIVlK,MAAAA,UAAU,EAAEA;AAJF,KAAd;AAMA,QAAIoM,GAAG,CAACjE,UAAR,EAAoB7f,OAAO,CAAC6f,UAAR,GAAqBiE,GAAG,CAACjE,UAAzB;AACpB,QAAIiE,GAAG,CAAClC,IAAJ,KAAa,OAAjB,EAA0B5hB,OAAO,CAAC2f,WAAR,GAAsBmE,GAAG,CAAChoB,KAA1B;AAC1B,WAAOkE,OAAP;AACH;;AAED,WAAS+jB,qBAAT,CAA+B/jB,OAA/B,EAAwCgkB,KAAxC,EAA+C;AAC3C,QAAIhkB,OAAO,CAAC0X,UAAR,CAAmBkD,GAAnB,KAA2BtjB,SAA/B,EAA0C;AACtC0sB,MAAAA,KAAK,CAACtM,UAAN,CAAiBkD,GAAjB,GAAuB5a,OAAO,CAAC0X,UAAR,CAAmBkD,GAA1C;AACH,KAFD,MAEO;AACHoJ,MAAAA,KAAK,CAACtM,UAAN,CAAiB/P,GAAjB,GAAuB3H,OAAO,CAAC0X,UAAR,CAAmB/P,GAA1C;AACH;AACJ;;AAED,WAAS0Z,sBAAT,CAAgCF,QAAhC,EAA0C;AACtC,QAAIa,WAAW,GAAG,EAAlB;;AAEA,QAAIiC,aAAa,GAAG,UAASD,KAAT,EAAgB;AAChC,aACIA,KAAK,CAACpC,IAAN,KAAe,QAAf,IACAoC,KAAK,CAAC5jB,GAAN,KAAcJ,OAAO,CAACI,GADtB,IAEA4jB,KAAK,CAACnC,SAAN,KAAoB7hB,OAAO,CAAC6hB,SAHhC;AAKH,KAND;;AAQA,SAAK,IAAIplB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG0kB,QAAQ,CAACxrB,MAA7B,EAAqC8G,CAAC,EAAtC,EAA0C;AACtC,UAAIuD,OAAO,GAAGmhB,QAAQ,CAAC1kB,CAAD,CAAtB;AACA,UAAIunB,KAAJ;;AAEA,UAAIhkB,OAAO,CAAC4hB,IAAR,KAAiB,QAAjB,KAA8BoC,KAAK,GAAGhC,WAAW,CAACkC,IAAZ,CAAiBD,aAAjB,CAAtC,CAAJ,EAA4E;AACxE,YAAIE,iBAAiB,CAACnkB,OAAO,CAAC0X,UAAT,CAAjB,IAAyCyM,iBAAiB,CAACH,KAAK,CAACtM,UAAP,CAA9D,EAAkF;AAC9E,cAAI2K,cAAc,CAACriB,OAAD,CAAd,IAA2BqiB,cAAc,CAAC2B,KAAD,CAA7C,EAAsD;AAClD,kBAAM,IAAIhI,cAAJ,CACF,yBAAyBhc,OAAO,CAACI,GAAjC,GAAuC,uBADrC,CAAN;AAGH;;AAED4jB,UAAAA,KAAK,CAACtM,UAAN,GAAmB1X,OAAO,CAAC0X,UAA3B;AACH,SARD,MAQO;AACH,cAAI2K,cAAc,CAACriB,OAAD,CAAlB,EAA6B;AACzB,gBAAIqiB,cAAc,CAAC2B,KAAD,CAAlB,EAA2B;AACvB,oBAAM,IAAIhI,cAAJ,CACF,gEACI,qBADJ,GAEIhc,OAAO,CAACI,GAFZ,GAGI,IAJF,CAAN;AAMH;;AAED4jB,YAAAA,KAAK,CAACnE,UAAN,GAAmB7f,OAAO,CAAC6f,UAA3B;AACH;;AAEDkE,UAAAA,qBAAqB,CAAC/jB,OAAD,EAAUgkB,KAAV,CAArB;AACH;AACJ,OAzBD,MAyBO;AACHhC,QAAAA,WAAW,CAACtO,IAAZ,CAAiB1T,OAAjB;AACH;AACJ;;AAED,WAAOgiB,WAAP;AACH;;AAED,WAASK,cAAT,CAAwBriB,OAAxB,EAAiC;AAC7B,WAAOA,OAAO,CAAC6f,UAAR,IAAsB7f,OAAO,CAAC6f,UAAR,CAAmBlqB,MAAhD;AACH;;AAED,WAASwuB,iBAAT,CAA2BhM,IAA3B,EAAiC;AAC7B,WAAOA,IAAI,KAAK7gB,SAAT,IAAsB,EAAE6gB,IAAI,CAACrc,KAAL,KAAexE,SAAf,IAA4B6gB,IAAI,CAACN,QAAL,KAAkBvgB,SAAhD,CAA7B;AACH;;AAED,WAASqsB,yBAAT,CAAmCrc,GAAnC,EAAwC1T,IAAxC,EAA8C;AAC1C,QAAIkI,KAAK,GAAGwL,GAAG,CAAC1T,IAAD,CAAf;;AAEA,QAAIkI,KAAK,KAAKxE,SAAV,IAAuB,OAAOwE,KAAP,KAAiB,UAA5C,EAAwD;AACpD,YAAM,IAAIuZ,SAAJ,CAAc,eAAezhB,IAAf,GAAsB,oBAApC,CAAN;AACH;;AAED,WAAOkI,KAAP;AACH;;AAED,WAASsoB,sBAAT,CAAgC9H,QAAhC,EAA0C+H,UAA1C,EAAsDlV,EAAtD,EAA0D;AACtD,QAAI,CAACkV,UAAU,CAAC1J,GAAX,CAAe2B,QAAf,CAAL,EAA+B;AAC3B,YAAM,IAAIjH,SAAJ,CAAc,gDAAd,CAAN;AACH;;AAED,WAAOlG,EAAP;AACH;;AAED,WAASmV,sBAAT,GAAkC;AAC9B,UAAM,IAAIjP,SAAJ,CAAc,sCAAd,CAAN;AACH;;AAED,WAASkP,WAAT,CAAqBC,EAArB,EAAyBC,MAAzB,EAAiC;AAC7BF,IAAAA,WAAW,GAAG,UAASC,EAAT,EAAaC,MAAb,EAAqB;AAC/B,aAAO,IAAIC,WAAJ,CAAgBF,EAAhB,EAAoBC,MAApB,CAAP;AACH,KAFD;;AAIA,QAAIE,OAAO,GAAGnK,gBAAgB,CAACoK,MAAD,CAA9B;;AAEA,QAAIC,MAAM,GAAGD,MAAM,CAAClpB,SAApB;;AAEA,QAAIopB,OAAO,GAAG,IAAIC,OAAJ,EAAd;;AAEA,aAASL,WAAT,CAAqBF,EAArB,EAAyBC,MAAzB,EAAiC;AAC7B,UAAIO,KAAK,GAAGL,OAAO,CAACvP,IAAR,CAAa,IAAb,EAAmBoP,EAAnB,CAAZ;;AAEAM,MAAAA,OAAO,CAACnd,GAAR,CAAYqd,KAAZ,EAAmBP,MAAnB;;AAEA,aAAOO,KAAP;AACH;;AAED/L,IAAAA,SAAS,CAACyL,WAAD,EAAcC,OAAd,CAAT;;AAEAD,IAAAA,WAAW,CAAChpB,SAAZ,CAAsBupB,IAAtB,GAA6B,UAASC,GAAT,EAAc;AACvC,UAAIrgB,MAAM,GAAGggB,MAAM,CAACI,IAAP,CAAY7P,IAAZ,CAAiB,IAAjB,EAAuB8P,GAAvB,CAAb;;AAEA,UAAIrgB,MAAJ,EAAYA,MAAM,CAAC4f,MAAP,GAAgBU,WAAW,CAACtgB,MAAD,EAAS,IAAT,CAA3B;AACZ,aAAOA,MAAP;AACH,KALD;;AAOA6f,IAAAA,WAAW,CAAChpB,SAAZ,CAAsBwY,MAAM,CAACxN,OAA7B,IAAwC,UAASwe,GAAT,EAAcE,YAAd,EAA4B;AAChE,UAAI,OAAOA,YAAP,KAAwB,QAA5B,EAAsC;AAClC,YAAIX,MAAM,GAAGK,OAAO,CAAClK,GAAR,CAAY,IAAZ,CAAb;;AAEA,eAAOiK,MAAM,CAAC3Q,MAAM,CAACxN,OAAR,CAAN,CAAuB0O,IAAvB,CACH,IADG,EAEH8P,GAFG,EAGHE,YAAY,CAAC1e,OAAb,CAAqB,cAArB,EAAqC,UAAShS,CAAT,EAAYd,IAAZ,EAAkB;AACnD,iBAAO,MAAM6wB,MAAM,CAAC7wB,IAAD,CAAnB;AACH,SAFD,CAHG,CAAP;AAOH,OAVD,MAUO,IAAI,OAAOwxB,YAAP,KAAwB,UAA5B,EAAwC;AAC3C,YAAIJ,KAAK,GAAG,IAAZ;;AAEA,eAAOH,MAAM,CAAC3Q,MAAM,CAACxN,OAAR,CAAN,CAAuB0O,IAAvB,CAA4B,IAA5B,EAAkC8P,GAAlC,EAAuC,YAAW;AACrD,cAAI7N,IAAI,GAAG,EAAX;AACAA,UAAAA,IAAI,CAAC3D,IAAL,CAAU/Z,KAAV,CAAgB0d,IAAhB,EAAsBhgB,SAAtB;;AAEA,cAAI,OAAOggB,IAAI,CAACA,IAAI,CAAC1hB,MAAL,GAAc,CAAf,CAAX,KAAiC,QAArC,EAA+C;AAC3C0hB,YAAAA,IAAI,CAAC3D,IAAL,CAAUyR,WAAW,CAAC9N,IAAD,EAAO2N,KAAP,CAArB;AACH;;AAED,iBAAOI,YAAY,CAACzrB,KAAb,CAAmB,IAAnB,EAAyB0d,IAAzB,CAAP;AACH,SATM,CAAP;AAUH,OAbM,MAaA;AACH,eAAOwN,MAAM,CAAC3Q,MAAM,CAACxN,OAAR,CAAN,CAAuB0O,IAAvB,CAA4B,IAA5B,EAAkC8P,GAAlC,EAAuCE,YAAvC,CAAP;AACH;AACJ,KA3BD;;AA6BA,aAASD,WAAT,CAAqBtgB,MAArB,EAA6B2f,EAA7B,EAAiC;AAC7B,UAAIrZ,CAAC,GAAG2Z,OAAO,CAAClK,GAAR,CAAY4J,EAAZ,CAAR;;AAEA,aAAO5oB,MAAM,CAACsE,IAAP,CAAYiL,CAAZ,EAAe9E,MAAf,CAAsB,UAASoe,MAAT,EAAiB7wB,IAAjB,EAAuB;AAChD6wB,QAAAA,MAAM,CAAC7wB,IAAD,CAAN,GAAeiR,MAAM,CAACsG,CAAC,CAACvX,IAAD,CAAF,CAArB;AACA,eAAO6wB,MAAP;AACH,OAHM,EAGJ7oB,MAAM,CAACwd,MAAP,CAAc,IAAd,CAHI,CAAP;AAIH;;AAED,WAAOmL,WAAW,CAAC5qB,KAAZ,CAAkB,IAAlB,EAAwBtC,SAAxB,CAAP;AACH;;AAED,MAAIguB,WAAW,GAAG,CAAC,GAAD,EAAM,GAAN,EAAW,MAAX,EAAmB,KAAnB,EAA0B,OAA1B,EAAmC,QAAnC,EAA6C,OAA7C,EAAsD,QAAtD,CAAlB;;AAEA,MAAIC,kBAAkB,GAAG,SAASA,kBAAT,CAA4BxpB,KAA5B,EAAmC;AACxD,WAAO,OAAOA,KAAP,KAAiB,QAAjB,IAA6B,IAAIrI,IAAJ,CAASqI,KAAT,CAA7B,GAA+CkC,UAAU,CAAClC,KAAD,CAAV,GAAoB,GAAnE,GAAyEA,KAAhF;AACH,GAFD,CA1uGgB,CA8uGhB;;;AACA,MAAIypB,aAAa,GAAG,SAASA,aAAT,CAAuBpnB,MAAvB,EAA+B;AAC/C,QAAIqnB,OAAO,GAAGjI,cAAc,CAACpf,MAAD,EAAS,CAAT,CAA5B;AAAA,QACIzK,IAAI,GAAG8xB,OAAO,CAAC,CAAD,CADlB;AAAA,QAEIjR,KAAK,GAAGiR,OAAO,CAAC,CAAD,CAFnB;;AAIA,QAAI/uB,IAAI,GAAG8d,KAAK,CAAC3U,MAAN,GACL,EADK,GAELylB,WAAW,CAAChf,MAAZ,CAAmB,UAASC,IAAT,EAAemf,IAAf,EAAqB;AACpCnf,MAAAA,IAAI,CAACmf,IAAD,CAAJ,GAAaH,kBAAkB,CAAC/Q,KAAK,CAACkR,IAAD,CAAN,CAA/B;AACA,aAAOnf,IAAP;AACH,KAHD,EAGG,EAHH,CAFN;AAOA,WAAO,CACH5S,IADG,EAEHkI,MAAM,CAAC+E,MAAP,CACI;AACI4D,MAAAA,MAAM,EAAE;AADZ,KADJ,EAIIgQ,KAJJ,EAKI9d,IALJ,CAFG,CAAP;AAUH,GAtBD;;AAwBA,MAAIivB,YAAY,GAAG,SAASA,YAAT,CAAsBlyB,IAAtB,EAA4B;AAC3C,WAAO,IAAIsJ,OAAJ,CAAY,UAASC,OAAT,EAAkBmT,MAAlB,EAA0B;AACzC,UAAInW,YAAY,GAAG,IAAIqW,KAAJ,EAAnB;AACArW,MAAAA,YAAY,CAAC8J,GAAb,GAAmByL,GAAG,CAACC,eAAJ,CAAoB/b,IAApB,CAAnB,CAFyC,CAIzC;;AACA,UAAImyB,OAAO,GAAG,SAASA,OAAT,GAAmB;AAC7B,YAAIhxB,KAAK,GAAGoF,YAAY,CAACV,YAAzB;AACA,YAAIzE,MAAM,GAAGmF,YAAY,CAACT,aAA1B;AACA,YAAIssB,OAAO,GAAGjxB,KAAK,IAAIC,MAAvB;AACA,YAAI,CAACgxB,OAAL,EAAc;AAEdtW,QAAAA,GAAG,CAACS,eAAJ,CAAoBhW,YAAY,CAAC8J,GAAjC;AACAgiB,QAAAA,aAAa,CAACC,UAAD,CAAb;AACA/oB,QAAAA,OAAO,CAAC;AAAEpI,UAAAA,KAAK,EAAEA,KAAT;AAAgBC,UAAAA,MAAM,EAAEA;AAAxB,SAAD,CAAP;AACH,OATD;;AAWAmF,MAAAA,YAAY,CAACsW,OAAb,GAAuB,UAAS8F,GAAT,EAAc;AACjC7G,QAAAA,GAAG,CAACS,eAAJ,CAAoBhW,YAAY,CAAC8J,GAAjC;AACAgiB,QAAAA,aAAa,CAACC,UAAD,CAAb;AACA5V,QAAAA,MAAM,CAACiG,GAAD,CAAN;AACH,OAJD;;AAMA,UAAI2P,UAAU,GAAGC,WAAW,CAACJ,OAAD,EAAU,CAAV,CAA5B;AAEAA,MAAAA,OAAO;AACV,KAzBM,CAAP;AA0BH,GA3BD;AA6BA;AACJ;AACA;;;AACI,MAAI,OAAOnqB,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACjC,QAAd,KAA2B,WAAhE,EAA6E;AACzE,QAAI,CAACkC,iBAAiB,CAACC,SAAlB,CAA4BC,MAAjC,EAAyC;AACrCC,MAAAA,MAAM,CAACC,cAAP,CAAsBJ,iBAAiB,CAACC,SAAxC,EAAmD,QAAnD,EAA6D;AACzDI,QAAAA,KAAK,EAAE,SAASA,KAAT,CAAeoM,EAAf,EAAmBxU,IAAnB,EAAyBsI,OAAzB,EAAkC;AACrC,cAAIpD,MAAM,GAAG,IAAb;AACAuD,UAAAA,UAAU,CAAC,YAAW;AAClB,gBAAIF,OAAO,GAAGrD,MAAM,CAACsD,SAAP,CAAiBxI,IAAjB,EAAuBsI,OAAvB,EAAgC5H,KAAhC,CAAsC,GAAtC,EAA2C,CAA3C,CAAd;AACA,gBAAIgI,MAAM,GAAGC,IAAI,CAACJ,OAAD,CAAjB;AACA,gBAAI6D,KAAK,GAAG1D,MAAM,CAACzG,MAAnB;AACA,gBAAI+R,IAAI,GAAG,IAAIlL,UAAJ,CAAesD,KAAf,CAAX;;AACA,mBAAOA,KAAK,EAAZ,EAAgB;AACZ4H,cAAAA,IAAI,CAAC5H,KAAD,CAAJ,GAAc1D,MAAM,CAACM,UAAP,CAAkBoD,KAAlB,CAAd;AACH;;AACDoI,YAAAA,EAAE,CAAC,IAAIvL,IAAJ,CAAS,CAAC+K,IAAD,CAAT,EAAiB;AAAEhU,cAAAA,IAAI,EAAEA,IAAI,IAAI;AAAhB,aAAjB,CAAD,CAAF;AACH,WATS,CAAV;AAUH;AAbwD,OAA7D;AAeH;AACJ;;AAED,MAAIsyB,SAAS,GAAG,OAAOxqB,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACjC,QAAd,KAA2B,WAA5E;AACA,MAAI0sB,KAAK,GAAGD,SAAS,IAAI,mBAAmBvyB,IAAnB,CAAwByyB,SAAS,CAACC,SAAlC,CAAb,IAA6D,CAAC3qB,MAAM,CAAC4qB,QAAjF;AAEA;AACJ;AACA;;AACI,MAAIC,MAAM,GAAG,SAASA,MAAT,CAAgBC,IAAhB,EAAsB;AAC/B,QAAIC,SAAS,GAAGD,IAAI,CAACC,SAArB;AAAA,QACIC,KAAK,GAAGF,IAAI,CAACE,KADjB;AAEA,QAAIC,IAAI,GAAGD,KAAK,CAACC,IAAjB;AAAA,QACIC,KAAK,GAAGF,KAAK,CAACE,KADlB;AAAA,QAEIC,eAAe,GAAGH,KAAK,CAACG,eAF5B;AAAA,QAGIC,MAAM,GAAGJ,KAAK,CAACI,MAHnB;AAKA;AACR;AACA;AAEQ;;AACA,QAAIC,cAAc,GAAG,CAAC,MAAD,EAAS,QAAT,EAAmB,QAAnB,EAA6B,QAA7B,EAAuC,QAAvC,CAArB;;AAEA,QAAIC,oBAAoB,GAAG,SAASA,oBAAT,CAA8BC,cAA9B,EAA8C;AACrE,aAAO,UAASrtB,SAAT,EAAoBlG,IAApB,EAA0BwzB,QAA1B,EAAoC;AACvC,eAAOttB,SAAS,CAAClG,IAAD,EAAOuzB,cAAc,GAAGA,cAAc,CAACC,QAAD,CAAjB,GAA8BA,QAAnD,CAAhB;AACH,OAFD;AAGH,KAJD;;AAMA,QAAIC,aAAa,GAAG,SAASA,aAAT,CAAuBjtB,IAAvB,EAA6B;AAC7C,aACIA,IAAI,CAAChC,WAAL,KAAqB,IAArB,IACAgC,IAAI,CAACpE,QAAL,KAAkB,CADlB,IAEAoE,IAAI,CAAC5B,IAAL,KAAc,CAFd,IAGA4B,IAAI,CAACzC,MAHL,IAIAyC,IAAI,CAACzC,MAAL,CAAYvC,CAAZ,KAAkB,GAJlB,IAKAgF,IAAI,CAACzC,MAAL,CAAYtC,CAAZ,KAAkB,GALlB,IAMA+E,IAAI,CAACf,IANL,IAOAe,IAAI,CAACf,IAAL,CAAUC,UAAV,KAAyB,KAPzB,IAQAc,IAAI,CAACf,IAAL,CAAUE,QAAV,KAAuB,KAT3B;AAWH,KAZD;AAcA;AACR;AACA;;;AACQotB,IAAAA,SAAS,CAAC,uBAAD,EAA0B,UAASW,mBAAT,EAA8BC,KAA9B,EAAqC;AACpE,UAAIC,KAAK,GAAGD,KAAK,CAACC,KAAlB;AACA,aAAO,IAAItqB,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjC;AACAA,QAAAA,OAAO,CAAC,CAACqqB,KAAK,CAAC,UAAD,CAAP,CAAP;AACH,OAHM,CAAP;AAIH,KANQ,CAAT;;AAQA,QAAIC,mBAAmB,GAAG,SAASA,mBAAT,CAA6BD,KAA7B,EAAoC5zB,IAApC,EAA0Csd,IAA1C,EAAgD;AACtE,aAAO,IAAIhU,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjC,YACI,CAACqqB,KAAK,CAAC,2BAAD,CAAN,IACAtW,IAAI,CAACwW,QADL,IAEA,CAACV,MAAM,CAACpzB,IAAD,CAFP,IAGA,CAACD,OAAO,CAACC,IAAD,CAJZ,EAKE;AACE,iBAAOuJ,OAAO,CAAC,KAAD,CAAd;AACH,SARgC,CAUjC;;;AACA2oB,QAAAA,YAAY,CAAClyB,IAAD,CAAZ,CACKyJ,IADL,CACU,YAAW;AACb,cAAIkS,EAAE,GAAGiY,KAAK,CAAC,kCAAD,CAAd;;AACA,cAAIjY,EAAJ,EAAQ;AACJ,gBAAIoY,YAAY,GAAGpY,EAAE,CAAC3b,IAAD,CAArB;;AACA,gBAAI+zB,YAAY,IAAI,IAApB,EAA0B;AACtB;AACA,qBAAOC,YAAY,CAAC,IAAD,CAAnB;AACH;;AACD,gBAAI,OAAOD,YAAP,KAAwB,SAA5B,EAAuC;AACnC,qBAAOxqB,OAAO,CAACwqB,YAAD,CAAd;AACH;;AACD,gBAAI,OAAOA,YAAY,CAACtqB,IAApB,KAA6B,UAAjC,EAA6C;AACzC,qBAAOsqB,YAAY,CAACtqB,IAAb,CAAkBF,OAAlB,CAAP;AACH;AACJ;;AAEDA,UAAAA,OAAO,CAAC,IAAD,CAAP;AACH,SAlBL,EAmBKgX,KAnBL,CAmBW,UAASoC,GAAT,EAAc;AACjBpZ,UAAAA,OAAO,CAAC,KAAD,CAAP;AACH,SArBL;AAsBH,OAjCM,CAAP;AAkCH,KAnCD;;AAqCAwpB,IAAAA,SAAS,CAAC,iBAAD,EAAoB,UAASzV,IAAT,EAAe2W,KAAf,EAAsB;AAC/C,UAAIL,KAAK,GAAGK,KAAK,CAACL,KAAlB;AAAA,UACIM,QAAQ,GAAGD,KAAK,CAACC,QADrB;AAEA,UAAI,CAACN,KAAK,CAAC,2BAAD,CAAV,EAAyC;AAEzCtW,MAAAA,IAAI,CAAC6W,MAAL,CAAY,gBAAZ,EAA8B,YAAW;AACrC,eAAO,IAAI7qB,OAAJ,CAAY,UAASC,OAAT,EAAkBmT,MAAlB,EAA0B;AACzCwX,UAAAA,QAAQ,CACJ,wBADI,EAEJ;AACIN,YAAAA,KAAK,EAAEtW,IAAI,CAACtN,EADhB;AAEIsN,YAAAA,IAAI,EAAEA,IAFV;AAGI8W,YAAAA,OAAO,EAAE7qB,OAHb;AAII8qB,YAAAA,OAAO,EAAE3X;AAJb,WAFI,EASJ,IATI,CAAR;AAWH,SAZM,CAAP;AAaH,OAdD;AAeH,KApBQ,CAAT,CAnF+B,CAyG/B;;AACAqW,IAAAA,SAAS,CAAC,gBAAD,EAAmB,UAAS/yB,IAAT,EAAes0B,KAAf,EAAsB;AAC9C,UAAIV,KAAK,GAAGU,KAAK,CAACV,KAAlB;AAAA,UACItW,IAAI,GAAGgX,KAAK,CAAChX,IADjB;AAEA,aAAO,IAAIhU,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjCsqB,QAAAA,mBAAmB,CAACD,KAAD,EAAQ5zB,IAAR,EAAcsd,IAAd,CAAnB,CAAuC7T,IAAvC,CAA4C,UAAS8qB,eAAT,EAA0B;AAClE;AACA,cAAI,CAACA,eAAL,EAAsB,OAAOhrB,OAAO,CAACvJ,IAAD,CAAd,CAF4C,CAIlE;;AACA,cAAIw0B,QAAQ,GAAG,EAAf,CALkE,CAOlE;;AACA,cAAIZ,KAAK,CAAC,+CAAD,CAAT,EAA4D;AACxDY,YAAAA,QAAQ,CAACtU,IAAT,CAAc,YAAW;AACrB,qBAAO,IAAI5W,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjCA,gBAAAA,OAAO,CAAC;AACJnJ,kBAAAA,IAAI,EAAEwzB,KAAK,CAAC,4CAAD,CADP;AAEJ5zB,kBAAAA,IAAI,EAAEA;AAFF,iBAAD,CAAP;AAIH,eALM,CAAP;AAMH,aAPD;AAQH,WAjBiE,CAmBlE;;;AACA,cAAI4zB,KAAK,CAAC,8CAAD,CAAT,EAA2D;AACvDY,YAAAA,QAAQ,CAACtU,IAAT,CAAc,UAASha,SAAT,EAAoBlG,IAApB,EAA0BwzB,QAA1B,EAAoC;AAC9C,qBAAO,IAAIlqB,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjCrD,gBAAAA,SAAS,CAAClG,IAAD,EAAOwzB,QAAP,CAAT,CAA0B/pB,IAA1B,CAA+B,UAASzJ,IAAT,EAAe;AAC1C,yBAAOuJ,OAAO,CAAC;AACXnJ,oBAAAA,IAAI,EAAEwzB,KAAK,CAAC,2CAAD,CADA;AAGX5zB,oBAAAA,IAAI,EAAEA;AAHK,mBAAD,CAAd;AAKH,iBAND;AAOH,eARM,CAAP;AASH,aAVD;AAWH,WAhCiE,CAkClE;;;AACA,cAAIy0B,kBAAkB,GAAGb,KAAK,CAAC,8BAAD,CAAL,IAAyC,EAAlE;AACAV,UAAAA,KAAK,CAACuB,kBAAD,EAAqB,UAAS7nB,GAAT,EAAc+O,EAAd,EAAkB;AACxC,gBAAI+Y,aAAa,GAAGpB,oBAAoB,CAAC3X,EAAD,CAAxC;AACA6Y,YAAAA,QAAQ,CAACtU,IAAT,CAAc,UAASha,SAAT,EAAoBlG,IAApB,EAA0BwzB,QAA1B,EAAoC;AAC9C,qBAAO,IAAIlqB,OAAJ,CAAY,UAASC,OAAT,EAAkB;AACjCmrB,gBAAAA,aAAa,CAACxuB,SAAD,EAAYlG,IAAZ,EAAkBwzB,QAAlB,CAAb,CAAyC/pB,IAAzC,CAA8C,UAASzJ,IAAT,EAAe;AACzD,yBAAOuJ,OAAO,CAAC;AAAEnJ,oBAAAA,IAAI,EAAEwM,GAAR;AAAa5M,oBAAAA,IAAI,EAAEA;AAAnB,mBAAD,CAAd;AACH,iBAFD;AAGH,eAJM,CAAP;AAKH,aAND;AAOH,WATI,CAAL,CApCkE,CA+ClE;;AACA,cAAIigB,mBAAmB,GAAG2T,KAAK,CAAC,oCAAD,CAA/B;AACA,cAAIe,WAAW,GAAGf,KAAK,CAAC,yCAAD,CAAvB;AACA,cAAIprB,OAAO,GAAGyX,mBAAmB,KAAK,IAAxB,GAA+B,IAA/B,GAAsCA,mBAAmB,GAAG,GAA1E;AACA,cAAI/f,IAAI,GAAG0zB,KAAK,CAAC,sCAAD,CAAhB;AACA,cAAIgB,gBAAgB,GAChBhB,KAAK,CAAC,uCAAD,CAAL,IAAkDP,cADtD,CApDkE,CAuDlE;;AACA/V,UAAAA,IAAI,CAACuX,WAAL,CACI,QADJ,EAEI;AACI30B,YAAAA,IAAI,EAAEA,IADV;AAEIsI,YAAAA,OAAO,EAAEA,OAFb;AAGIssB,YAAAA,MAAM,EAAEF;AAHZ,WAFJ,EAQI,IARJ,EAxDkE,CAmElE;;AACA,cAAI1uB,SAAS,GAAG,SAASA,SAAT,CAAmBlG,IAAnB,EAAyBwzB,QAAzB,EAAmC;AAC/C,mBAAO,IAAIlqB,OAAJ,CAAY,UAASC,OAAT,EAAkBmT,MAAlB,EAA0B;AACzC,kBAAIqY,gBAAgB,GAAG3sB,MAAM,CAAC+E,MAAP,CAAc,EAAd,EAAkBqmB,QAAlB,CAAvB;AAEAprB,cAAAA,MAAM,CAACsE,IAAP,CAAYqoB,gBAAZ,EACKxgB,MADL,CACY,UAASygB,WAAT,EAAsB;AAC1B,uBAAOA,WAAW,KAAK,MAAvB;AACH,eAHL,EAIKroB,OAJL,CAIa,UAASqoB,WAAT,EAAsB;AAC3B;AACA,oBAAIJ,gBAAgB,CAACzlB,OAAjB,CAAyB6lB,WAAzB,MAA0C,CAAC,CAA/C,EAAkD;AAC9C,yBAAOD,gBAAgB,CAACC,WAAD,CAAvB;AACH;AACJ,eATL;AAUA,kBAAI1gB,MAAM,GAAGygB,gBAAgB,CAACzgB,MAA9B;AAAA,kBACI2gB,IAAI,GAAGF,gBAAgB,CAACE,IAD5B;AAAA,kBAEIjV,MAAM,GAAG+U,gBAAgB,CAAC/U,MAF9B;AAAA,kBAGIxZ,IAAI,GAAGuuB,gBAAgB,CAACvuB,IAH5B;AAAA,kBAII+N,MAAM,GAAGwgB,gBAAgB,CAACxgB,MAJ9B;AAAA,kBAKI5J,MAAM,GAAGoqB,gBAAgB,CAACpqB,MAL9B;AAOA,kBAAIiV,YAAY,GAAG;AACflb,gBAAAA,KAAK,EAAE;AACHpD,kBAAAA,WAAW,EAAE2zB,IAAI,GAAGA,IAAI,CAAC3zB,WAAR,GAAsB;AADpC,iBADQ;AAKf0e,gBAAAA,MAAM,EACFA,MAAM,KACLA,MAAM,CAAC9f,IAAP,IACG,OAAO8f,MAAM,CAACxX,OAAd,KAA0B,QAD7B,IAEGwX,MAAM,CAACpZ,UAHL,CAAN,GAIM;AACI1G,kBAAAA,IAAI,EAAE8f,MAAM,CAAC9f,IADjB;AAEIsI,kBAAAA,OAAO,EACH,OAAOwX,MAAM,CAACxX,OAAd,KAA0B,QAA1B,GACMwX,MAAM,CAACxX,OAAP,GAAiB,GADvB,GAEM,IALd;AAMI5B,kBAAAA,UAAU,EACNoZ,MAAM,CAACpZ,UAAP,IACAgtB,KAAK,CACD,6CADC,CADL,IAIA;AAXR,iBAJN,GAiBM9vB,SAvBK;AAwBfwG,gBAAAA,IAAI,EACAgK,MAAM,KAAKA,MAAM,CAAChK,IAAP,CAAYnJ,KAAZ,IAAqBmT,MAAM,CAAChK,IAAP,CAAYlJ,MAAtC,CAAN,GACMgH,MAAM,CAAC+E,MAAP,CACI;AACI0K,kBAAAA,IAAI,EAAEvD,MAAM,CAACuD,IADjB;AAEIE,kBAAAA,OAAO,EAAEzD,MAAM,CAACyD;AAFpB,iBADJ,EAKIzD,MAAM,CAAChK,IALX,CADN,GAQMxG,SAjCK;AAkCf0C,gBAAAA,IAAI,EACAA,IAAI,IAAI,CAACitB,aAAa,CAACjtB,IAAD,CAAtB,GACM4B,MAAM,CAAC+E,MAAP,CACI,EADJ,EAGI3G,IAHJ,CADN,GAMM1C,SAzCK;AA0Cf6G,gBAAAA,MAAM,EAAEA,MAAM,IAAIA,MAAM,CAACxI,MAAjB,GAA0BwI,MAAM,CAACe,GAAP,CAAWqmB,aAAX,CAA1B,GAAsD,EA1C/C;AA2Cfxd,gBAAAA,MAAM,EAAEA;AA3CO,eAAnB;;AA8CA,kBAAIqL,YAAY,CAACI,MAAjB,EAAyB;AACrB;AACA,oBAAIkV,cAAc,GAAGlV,MAAM,CAAC9f,IAAP,GACf;AACA8f,gBAAAA,MAAM,CAAC9f,IAAP,KAAgBF,IAAI,CAACE,IAFN,GAGf;AACA,qBAJN;AAMA,oBAAIi1B,gBAAgB,GAAG,WAAWl1B,IAAX,CAAgBD,IAAI,CAACE,IAArB,CAAvB;AACA,oBAAIk1B,iBAAiB,GACjBpV,MAAM,CAACxX,OAAP,KAAmB,IAAnB,GACM;AACA2sB,gBAAAA,gBAAgB,IAAIR,WAAW,KAAK,QAF1C,GAGM;AACA,qBALV,CATqB,CAgBrB;;AACA,oBAAIU,mBAAmB,GAAG,CAAC,EACvBzV,YAAY,CAACtV,IAAb,IACAsV,YAAY,CAACpZ,IADb,IAEAoZ,YAAY,CAACrL,MAFb,IAGA2gB,cAHA,IAIAE,iBALuB,CAA3B,CAjBqB,CAyBrB;;AACA,oBAAI,CAACC,mBAAL,EAA0B,OAAO9rB,OAAO,CAACvJ,IAAD,CAAd;AAC7B;;AAED,kBAAIyG,OAAO,GAAG;AACV4C,gBAAAA,gBAAgB,EAAEuqB,KAAK,CAAC,wCAAD,CADb;AAEV7T,gBAAAA,eAAe,EAAE6T,KAAK,CAAC,uCAAD,CAFZ;AAGVltB,gBAAAA,iBAAiB,EAAEktB,KAAK,CAAC,yCAAD,CAHd;AAIV9T,gBAAAA,cAAc,EAAE8T,KAAK,CACjB,6CADiB;AAJX,eAAd;AASAjU,cAAAA,cAAc,CAAC3f,IAAD,EAAO4f,YAAP,EAAqBnZ,OAArB,CAAd,CACKgD,IADL,CACU,UAASwH,IAAT,EAAe;AACjB;AACA,oBAAIqkB,GAAG,GAAGnC,eAAe,CACrBliB,IADqB,EAErB;AACAxQ,gBAAAA,yBAAyB,CACrBT,IAAI,CAACI,IADgB,EAErBW,sBAAsB,CAACkQ,IAAI,CAAC/Q,IAAN,CAFD,CAHJ,CAAzB;AASAqJ,gBAAAA,OAAO,CAAC+rB,GAAD,CAAP;AACH,eAbL,EAcK/U,KAdL,CAcW7D,MAdX;AAeH,aAvHM,CAAP;AAwHH,WAzHD,CApEkE,CA+LlE;;;AACA,cAAI6Y,eAAe,GAAGf,QAAQ,CAAC9oB,GAAT,CAAa,UAASka,MAAT,EAAiB;AAChD,mBAAOA,MAAM,CAAC1f,SAAD,EAAYlG,IAAZ,EAAkBsd,IAAI,CAACkY,WAAL,EAAlB,CAAb;AACH,WAFqB,CAAtB,CAhMkE,CAoMlE;;AACAlsB,UAAAA,OAAO,CAACmsB,GAAR,CAAYF,eAAZ,EAA6B9rB,IAA7B,CAAkC,UAASisB,KAAT,EAAgB;AAC9C;AACAnsB,YAAAA,OAAO,CACHmsB,KAAK,CAACvzB,MAAN,KAAiB,CAAjB,IAAsBuzB,KAAK,CAAC,CAAD,CAAL,CAASt1B,IAAT,KAAkB,IAAxC,GACM;AACAs1B,YAAAA,KAAK,CAAC,CAAD,CAAL,CAAS11B,IAFf,GAGM;AACA01B,YAAAA,KALH,CAAP;AAOH,WATD;AAUH,SA/MD;AAgNH,OAjNM,CAAP;AAkNH,KArNQ,CAAT,CA1G+B,CAiU/B;;AACA,WAAO;AACHjvB,MAAAA,OAAO,EAAE;AACLkvB,QAAAA,mBAAmB,EAAE,CAAC,IAAD,EAAO1C,IAAI,CAAC2C,OAAZ,CADhB;AAGL;AACAC,QAAAA,yBAAyB,EAAE,CAAC,IAAD,EAAO5C,IAAI,CAAC6C,QAAZ,CAJtB;AAML;AACAC,QAAAA,4BAA4B,EAAE,CAAC,IAAD,EAAO9C,IAAI,CAAC+C,MAAZ,CAPzB;AASL;AACAC,QAAAA,2BAA2B,EAAE,CAAC,IAAD,EAAOhD,IAAI,CAACiD,GAAZ,CAVxB;AAYL;AACAC,QAAAA,kCAAkC,EAAE,CAAC,IAAD,EAAOlD,IAAI,CAAC2C,OAAZ,CAb/B;AAeL;AACAQ,QAAAA,8BAA8B,EAAE,CAAC,IAAD,EAAOnD,IAAI,CAACoD,KAAZ,CAhB3B;AAkBL;AACAC,QAAAA,+BAA+B,EAAE,CAAC,QAAD,EAAWrD,IAAI,CAAC+C,MAAhB,CAnB5B;AAoBL;AACA;AACA;AAEA;AACAO,QAAAA,sBAAsB,EAAE,CAAC,IAAD,EAAOtD,IAAI,CAACuD,MAAZ,CAzBnB;AA2BL;AACAC,QAAAA,oCAAoC,EAAE,CAAC,IAAD,EAAOxD,IAAI,CAAC2C,OAAZ,CA5BjC;AA8BL;AACAc,QAAAA,iCAAiC,EAAE,CAAC,IAAD,EAAOzD,IAAI,CAAC+C,MAAZ,CA/B9B;AAiCL;AACAW,QAAAA,qCAAqC,EAAE,CAAC,KAAD,EAAQ1D,IAAI,CAAC2C,OAAb,CAlClC;AAoCL;AACAgB,QAAAA,kCAAkC,EAAE,CAAC,WAAD,EAAc3D,IAAI,CAAC+C,MAAnB,CArC/B;AAuCL;AACAa,QAAAA,8BAA8B,EAAE,CAAC,IAAD,EAAO5D,IAAI,CAAC6C,QAAZ,CAxC3B;AA0CL;AACAgB,QAAAA,6BAA6B,EAAE,CAAC,IAAD,EAAO7D,IAAI,CAAC6C,QAAZ,CA3C1B;AA6CL;AACAiB,QAAAA,+BAA+B,EAAE,CAC7BvE,SAAS,IAAIC,KAAb,GAAqB,OAAO,IAA5B,GAAmC,IADN,EAE7BQ,IAAI,CAACiD,GAFwB,CA9C5B;AAmDL;AACAc,QAAAA,mCAAmC,EAAE,CAAC,IAAD,EAAO/D,IAAI,CAAC+C,MAAZ;AApDhC;AADN,KAAP;AAwDH,GA1XD,CAj0GgB,CA6rHhB;;;AACA,MAAIxD,SAAJ,EAAe;AACXzsB,IAAAA,QAAQ,CAACkxB,aAAT,CAAuB,IAAIC,WAAJ,CAAgB,uBAAhB,EAAyC;AAAEC,MAAAA,MAAM,EAAEtE;AAAV,KAAzC,CAAvB;AACH;;AAED,SAAOA,MAAP;AACH,CAzsHD","sourcesContent":["/*!\n * FilePondPluginImageTransform 3.8.7\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n\n(function(global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined'\n        ? (module.exports = factory())\n        : typeof define === 'function' && define.amd\n        ? define(factory)\n        : ((global = global || self), (global.FilePondPluginImageTransform = factory()));\n})(this, function() {\n    'use strict';\n\n    // test if file is of type image\n    var isImage = function isImage(file) {\n        return /^image/.test(file.type);\n    };\n\n    var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n        return name.substr(0, name.lastIndexOf('.')) || name;\n    };\n\n    // only handles image/jpg, image/jpeg, image/png, and image/svg+xml for now\n    var ExtensionMap = {\n        jpeg: 'jpg',\n        'svg+xml': 'svg',\n    };\n\n    var renameFileToMatchMimeType = function renameFileToMatchMimeType(filename, mimeType) {\n        var name = getFilenameWithoutExtension(filename);\n        var type = mimeType.split('/')[1];\n        var extension = ExtensionMap[type] || type;\n        return ''.concat(name, '.').concat(extension);\n    };\n\n    // returns all the valid output formats we can encode towards\n    var getValidOutputMimeType = function getValidOutputMimeType(type) {\n        return /jpeg|png|svg\\+xml/.test(type) ? type : 'image/jpeg';\n    };\n\n    // test if file is of type image\n    var isImage$1 = function isImage(file) {\n        return /^image/.test(file.type);\n    };\n\n    var MATRICES = {\n        1: function _() {\n            return [1, 0, 0, 1, 0, 0];\n        },\n        2: function _(width) {\n            return [-1, 0, 0, 1, width, 0];\n        },\n        3: function _(width, height) {\n            return [-1, 0, 0, -1, width, height];\n        },\n        4: function _(width, height) {\n            return [1, 0, 0, -1, 0, height];\n        },\n        5: function _() {\n            return [0, 1, 1, 0, 0, 0];\n        },\n        6: function _(width, height) {\n            return [0, 1, -1, 0, height, 0];\n        },\n        7: function _(width, height) {\n            return [0, -1, -1, 0, height, width];\n        },\n        8: function _(width) {\n            return [0, -1, 1, 0, 0, width];\n        },\n    };\n\n    var getImageOrientationMatrix = function getImageOrientationMatrix(width, height, orientation) {\n        if (orientation === -1) {\n            orientation = 1;\n        }\n        return MATRICES[orientation](width, height);\n    };\n\n    var createVector = function createVector(x, y) {\n        return { x: x, y: y };\n    };\n\n    var vectorDot = function vectorDot(a, b) {\n        return a.x * b.x + a.y * b.y;\n    };\n\n    var vectorSubtract = function vectorSubtract(a, b) {\n        return createVector(a.x - b.x, a.y - b.y);\n    };\n\n    var vectorDistanceSquared = function vectorDistanceSquared(a, b) {\n        return vectorDot(vectorSubtract(a, b), vectorSubtract(a, b));\n    };\n\n    var vectorDistance = function vectorDistance(a, b) {\n        return Math.sqrt(vectorDistanceSquared(a, b));\n    };\n\n    var getOffsetPointOnEdge = function getOffsetPointOnEdge(length, rotation) {\n        var a = length;\n\n        var A = 1.5707963267948966;\n        var B = rotation;\n        var C = 1.5707963267948966 - rotation;\n\n        var sinA = Math.sin(A);\n        var sinB = Math.sin(B);\n        var sinC = Math.sin(C);\n        var cosC = Math.cos(C);\n        var ratio = a / sinA;\n        var b = ratio * sinB;\n        var c = ratio * sinC;\n\n        return createVector(cosC * b, cosC * c);\n    };\n\n    var getRotatedRectSize = function getRotatedRectSize(rect, rotation) {\n        var w = rect.width;\n        var h = rect.height;\n\n        var hor = getOffsetPointOnEdge(w, rotation);\n        var ver = getOffsetPointOnEdge(h, rotation);\n\n        var tl = createVector(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));\n\n        var tr = createVector(rect.x + rect.width + Math.abs(ver.y), rect.y + Math.abs(ver.x));\n\n        var bl = createVector(rect.x - Math.abs(ver.y), rect.y + rect.height - Math.abs(ver.x));\n\n        return {\n            width: vectorDistance(tl, tr),\n            height: vectorDistance(tl, bl),\n        };\n    };\n\n    var getImageRectZoomFactor = function getImageRectZoomFactor(imageRect, cropRect) {\n        var rotation = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n        var center =\n            arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : { x: 0.5, y: 0.5 };\n\n        // calculate available space round image center position\n        var cx = center.x > 0.5 ? 1 - center.x : center.x;\n        var cy = center.y > 0.5 ? 1 - center.y : center.y;\n        var imageWidth = cx * 2 * imageRect.width;\n        var imageHeight = cy * 2 * imageRect.height;\n\n        // calculate rotated crop rectangle size\n        var rotatedCropSize = getRotatedRectSize(cropRect, rotation);\n\n        return Math.max(rotatedCropSize.width / imageWidth, rotatedCropSize.height / imageHeight);\n    };\n\n    var getCenteredCropRect = function getCenteredCropRect(container, aspectRatio) {\n        var width = container.width;\n        var height = width * aspectRatio;\n        if (height > container.height) {\n            height = container.height;\n            width = height / aspectRatio;\n        }\n        var x = (container.width - width) * 0.5;\n        var y = (container.height - height) * 0.5;\n\n        return {\n            x: x,\n            y: y,\n            width: width,\n            height: height,\n        };\n    };\n\n    var calculateCanvasSize = function calculateCanvasSize(image, canvasAspectRatio) {\n        var zoom = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n        var imageAspectRatio = image.height / image.width;\n\n        // determine actual pixels on x and y axis\n        var canvasWidth = 1;\n        var canvasHeight = canvasAspectRatio;\n        var imgWidth = 1;\n        var imgHeight = imageAspectRatio;\n        if (imgHeight > canvasHeight) {\n            imgHeight = canvasHeight;\n            imgWidth = imgHeight / imageAspectRatio;\n        }\n\n        var scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);\n        var width = image.width / (zoom * scalar * imgWidth);\n        var height = width * canvasAspectRatio;\n\n        return {\n            width: width,\n            height: height,\n        };\n    };\n\n    var canvasRelease = function canvasRelease(canvas) {\n        canvas.width = 1;\n        canvas.height = 1;\n        var ctx = canvas.getContext('2d');\n        ctx.clearRect(0, 0, 1, 1);\n    };\n\n    var isFlipped = function isFlipped(flip) {\n        return flip && (flip.horizontal || flip.vertical);\n    };\n\n    var getBitmap = function getBitmap(image, orientation, flip) {\n        if (orientation <= 1 && !isFlipped(flip)) {\n            image.width = image.naturalWidth;\n            image.height = image.naturalHeight;\n            return image;\n        }\n\n        var canvas = document.createElement('canvas');\n        var width = image.naturalWidth;\n        var height = image.naturalHeight;\n\n        // if is rotated incorrectly swap width and height\n        var swapped = orientation >= 5 && orientation <= 8;\n        if (swapped) {\n            canvas.width = height;\n            canvas.height = width;\n        } else {\n            canvas.width = width;\n            canvas.height = height;\n        }\n\n        // draw the image but first fix orientation and set correct flip\n        var ctx = canvas.getContext('2d');\n\n        // get base transformation matrix\n        if (orientation) {\n            ctx.transform.apply(ctx, getImageOrientationMatrix(width, height, orientation));\n        }\n\n        if (isFlipped(flip)) {\n            // flip horizontal\n            // [-1, 0, 0, 1, width, 0]\n            var matrix = [1, 0, 0, 1, 0, 0];\n            if ((!swapped && flip.horizontal) || swapped & flip.vertical) {\n                matrix[0] = -1;\n                matrix[4] = width;\n            }\n\n            // flip vertical\n            // [1, 0, 0, -1, 0, height]\n            if ((!swapped && flip.vertical) || (swapped && flip.horizontal)) {\n                matrix[3] = -1;\n                matrix[5] = height;\n            }\n\n            ctx.transform.apply(ctx, matrix);\n        }\n\n        ctx.drawImage(image, 0, 0, width, height);\n\n        return canvas;\n    };\n\n    var imageToImageData = function imageToImageData(imageElement, orientation) {\n        var crop = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n        var canvasMemoryLimit = options.canvasMemoryLimit,\n            _options$background = options.background,\n            background = _options$background === void 0 ? null : _options$background;\n\n        var zoom = crop.zoom || 1;\n\n        // fixes possible image orientation problems by drawing the image on the correct canvas\n        var bitmap = getBitmap(imageElement, orientation, crop.flip);\n        var imageSize = {\n            width: bitmap.width,\n            height: bitmap.height,\n        };\n\n        var aspectRatio = crop.aspectRatio || imageSize.height / imageSize.width;\n\n        var canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n\n        if (canvasMemoryLimit) {\n            var requiredMemory = canvasSize.width * canvasSize.height;\n            if (requiredMemory > canvasMemoryLimit) {\n                var scalar = Math.sqrt(canvasMemoryLimit) / Math.sqrt(requiredMemory);\n                imageSize.width = Math.floor(imageSize.width * scalar);\n                imageSize.height = Math.floor(imageSize.height * scalar);\n                canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n            }\n        }\n\n        var canvas = document.createElement('canvas');\n\n        var canvasCenter = {\n            x: canvasSize.width * 0.5,\n            y: canvasSize.height * 0.5,\n        };\n\n        var stage = {\n            x: 0,\n            y: 0,\n            width: canvasSize.width,\n            height: canvasSize.height,\n            center: canvasCenter,\n        };\n\n        var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n\n        var scale =\n            zoom *\n            getImageRectZoomFactor(\n                imageSize,\n                getCenteredCropRect(stage, aspectRatio),\n                crop.rotation,\n                shouldLimit ? crop.center : { x: 0.5, y: 0.5 }\n            );\n\n        // start drawing\n        canvas.width = Math.round(canvasSize.width / scale);\n        canvas.height = Math.round(canvasSize.height / scale);\n\n        canvasCenter.x /= scale;\n        canvasCenter.y /= scale;\n\n        var imageOffset = {\n            x: canvasCenter.x - imageSize.width * (crop.center ? crop.center.x : 0.5),\n            y: canvasCenter.y - imageSize.height * (crop.center ? crop.center.y : 0.5),\n        };\n\n        var ctx = canvas.getContext('2d');\n        if (background) {\n            ctx.fillStyle = background;\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n        }\n\n        // move to draw offset\n        ctx.translate(canvasCenter.x, canvasCenter.y);\n        ctx.rotate(crop.rotation || 0);\n\n        // draw the image\n        ctx.drawImage(\n            bitmap,\n            imageOffset.x - canvasCenter.x,\n            imageOffset.y - canvasCenter.y,\n            imageSize.width,\n            imageSize.height\n        );\n\n        // get data from canvas\n        var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n        // release canvas\n        canvasRelease(canvas);\n\n        // return data\n        return imageData;\n    };\n\n    /**\n     * Polyfill toBlob for Edge\n     */\n    var IS_BROWSER = (function() {\n        return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n    })();\n    if (IS_BROWSER) {\n        if (!HTMLCanvasElement.prototype.toBlob) {\n            Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n                value: function value(callback, type, quality) {\n                    var dataURL = this.toDataURL(type, quality).split(',')[1];\n                    setTimeout(function() {\n                        var binStr = atob(dataURL);\n                        var len = binStr.length;\n                        var arr = new Uint8Array(len);\n                        for (var i = 0; i < len; i++) {\n                            arr[i] = binStr.charCodeAt(i);\n                        }\n                        callback(new Blob([arr], { type: type || 'image/png' }));\n                    });\n                },\n            });\n        }\n    }\n\n    var canvasToBlob = function canvasToBlob(canvas, options) {\n        var beforeCreateBlob =\n            arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n        return new Promise(function(resolve) {\n            var promisedImage = beforeCreateBlob ? beforeCreateBlob(canvas) : canvas;\n            Promise.resolve(promisedImage).then(function(canvas) {\n                canvas.toBlob(resolve, options.type, options.quality);\n            });\n        });\n    };\n\n    var vectorMultiply = function vectorMultiply(v, amount) {\n        return createVector$1(v.x * amount, v.y * amount);\n    };\n\n    var vectorAdd = function vectorAdd(a, b) {\n        return createVector$1(a.x + b.x, a.y + b.y);\n    };\n\n    var vectorNormalize = function vectorNormalize(v) {\n        var l = Math.sqrt(v.x * v.x + v.y * v.y);\n        if (l === 0) {\n            return {\n                x: 0,\n                y: 0,\n            };\n        }\n        return createVector$1(v.x / l, v.y / l);\n    };\n\n    var vectorRotate = function vectorRotate(v, radians, origin) {\n        var cos = Math.cos(radians);\n        var sin = Math.sin(radians);\n        var t = createVector$1(v.x - origin.x, v.y - origin.y);\n        return createVector$1(origin.x + cos * t.x - sin * t.y, origin.y + sin * t.x + cos * t.y);\n    };\n\n    var createVector$1 = function createVector() {\n        var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n        var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n        return { x: x, y: y };\n    };\n\n    var getMarkupValue = function getMarkupValue(value, size) {\n        var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n        var axis = arguments.length > 3 ? arguments[3] : undefined;\n        if (typeof value === 'string') {\n            return parseFloat(value) * scalar;\n        }\n        if (typeof value === 'number') {\n            return value * (axis ? size[axis] : Math.min(size.width, size.height));\n        }\n        return;\n    };\n\n    var getMarkupStyles = function getMarkupStyles(markup, size, scale) {\n        var lineStyle = markup.borderStyle || markup.lineStyle || 'solid';\n        var fill = markup.backgroundColor || markup.fontColor || 'transparent';\n        var stroke = markup.borderColor || markup.lineColor || 'transparent';\n        var strokeWidth = getMarkupValue(markup.borderWidth || markup.lineWidth, size, scale);\n        var lineCap = markup.lineCap || 'round';\n        var lineJoin = markup.lineJoin || 'round';\n        var dashes =\n            typeof lineStyle === 'string'\n                ? ''\n                : lineStyle\n                      .map(function(v) {\n                          return getMarkupValue(v, size, scale);\n                      })\n                      .join(',');\n        var opacity = markup.opacity || 1;\n        return {\n            'stroke-linecap': lineCap,\n            'stroke-linejoin': lineJoin,\n            'stroke-width': strokeWidth || 0,\n            'stroke-dasharray': dashes,\n            stroke: stroke,\n            fill: fill,\n            opacity: opacity,\n        };\n    };\n\n    var isDefined = function isDefined(value) {\n        return value != null;\n    };\n\n    var getMarkupRect = function getMarkupRect(rect, size) {\n        var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n        var left =\n            getMarkupValue(rect.x, size, scalar, 'width') ||\n            getMarkupValue(rect.left, size, scalar, 'width');\n        var top =\n            getMarkupValue(rect.y, size, scalar, 'height') ||\n            getMarkupValue(rect.top, size, scalar, 'height');\n        var width = getMarkupValue(rect.width, size, scalar, 'width');\n        var height = getMarkupValue(rect.height, size, scalar, 'height');\n        var right = getMarkupValue(rect.right, size, scalar, 'width');\n        var bottom = getMarkupValue(rect.bottom, size, scalar, 'height');\n\n        if (!isDefined(top)) {\n            if (isDefined(height) && isDefined(bottom)) {\n                top = size.height - height - bottom;\n            } else {\n                top = bottom;\n            }\n        }\n\n        if (!isDefined(left)) {\n            if (isDefined(width) && isDefined(right)) {\n                left = size.width - width - right;\n            } else {\n                left = right;\n            }\n        }\n\n        if (!isDefined(width)) {\n            if (isDefined(left) && isDefined(right)) {\n                width = size.width - left - right;\n            } else {\n                width = 0;\n            }\n        }\n\n        if (!isDefined(height)) {\n            if (isDefined(top) && isDefined(bottom)) {\n                height = size.height - top - bottom;\n            } else {\n                height = 0;\n            }\n        }\n\n        return {\n            x: left || 0,\n            y: top || 0,\n            width: width || 0,\n            height: height || 0,\n        };\n    };\n\n    var pointsToPathShape = function pointsToPathShape(points) {\n        return points\n            .map(function(point, index) {\n                return ''\n                    .concat(index === 0 ? 'M' : 'L', ' ')\n                    .concat(point.x, ' ')\n                    .concat(point.y);\n            })\n            .join(' ');\n    };\n\n    var setAttributes = function setAttributes(element, attr) {\n        return Object.keys(attr).forEach(function(key) {\n            return element.setAttribute(key, attr[key]);\n        });\n    };\n\n    var ns = 'http://www.w3.org/2000/svg';\n    var svg = function svg(tag, attr) {\n        var element = document.createElementNS(ns, tag);\n        if (attr) {\n            setAttributes(element, attr);\n        }\n        return element;\n    };\n\n    var updateRect = function updateRect(element) {\n        return setAttributes(element, Object.assign({}, element.rect, element.styles));\n    };\n\n    var updateEllipse = function updateEllipse(element) {\n        var cx = element.rect.x + element.rect.width * 0.5;\n        var cy = element.rect.y + element.rect.height * 0.5;\n        var rx = element.rect.width * 0.5;\n        var ry = element.rect.height * 0.5;\n        return setAttributes(\n            element,\n            Object.assign(\n                {\n                    cx: cx,\n                    cy: cy,\n                    rx: rx,\n                    ry: ry,\n                },\n                element.styles\n            )\n        );\n    };\n\n    var IMAGE_FIT_STYLE = {\n        contain: 'xMidYMid meet',\n        cover: 'xMidYMid slice',\n    };\n\n    var updateImage = function updateImage(element, markup) {\n        setAttributes(\n            element,\n            Object.assign({}, element.rect, element.styles, {\n                preserveAspectRatio: IMAGE_FIT_STYLE[markup.fit] || 'none',\n            })\n        );\n    };\n\n    var TEXT_ANCHOR = {\n        left: 'start',\n        center: 'middle',\n        right: 'end',\n    };\n\n    var updateText = function updateText(element, markup, size, scale) {\n        var fontSize = getMarkupValue(markup.fontSize, size, scale);\n        var fontFamily = markup.fontFamily || 'sans-serif';\n        var fontWeight = markup.fontWeight || 'normal';\n        var textAlign = TEXT_ANCHOR[markup.textAlign] || 'start';\n\n        setAttributes(\n            element,\n            Object.assign({}, element.rect, element.styles, {\n                'stroke-width': 0,\n                'font-weight': fontWeight,\n                'font-size': fontSize,\n                'font-family': fontFamily,\n                'text-anchor': textAlign,\n            })\n        );\n\n        // update text\n        if (element.text !== markup.text) {\n            element.text = markup.text;\n            element.textContent = markup.text.length ? markup.text : ' ';\n        }\n    };\n\n    var updateLine = function updateLine(element, markup, size, scale) {\n        setAttributes(\n            element,\n            Object.assign({}, element.rect, element.styles, {\n                fill: 'none',\n            })\n        );\n\n        var line = element.childNodes[0];\n        var begin = element.childNodes[1];\n        var end = element.childNodes[2];\n\n        var origin = element.rect;\n\n        var target = {\n            x: element.rect.x + element.rect.width,\n            y: element.rect.y + element.rect.height,\n        };\n\n        setAttributes(line, {\n            x1: origin.x,\n            y1: origin.y,\n            x2: target.x,\n            y2: target.y,\n        });\n\n        if (!markup.lineDecoration) return;\n\n        begin.style.display = 'none';\n        end.style.display = 'none';\n\n        var v = vectorNormalize({\n            x: target.x - origin.x,\n            y: target.y - origin.y,\n        });\n\n        var l = getMarkupValue(0.05, size, scale);\n\n        if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n            var arrowBeginRotationPoint = vectorMultiply(v, l);\n            var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n            var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n            var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n\n            setAttributes(begin, {\n                style: 'display:block;',\n                d: 'M'\n                    .concat(arrowBeginA.x, ',')\n                    .concat(arrowBeginA.y, ' L')\n                    .concat(origin.x, ',')\n                    .concat(origin.y, ' L')\n                    .concat(arrowBeginB.x, ',')\n                    .concat(arrowBeginB.y),\n            });\n        }\n\n        if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n            var arrowEndRotationPoint = vectorMultiply(v, -l);\n            var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n            var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n            var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n\n            setAttributes(end, {\n                style: 'display:block;',\n                d: 'M'\n                    .concat(arrowEndA.x, ',')\n                    .concat(arrowEndA.y, ' L')\n                    .concat(target.x, ',')\n                    .concat(target.y, ' L')\n                    .concat(arrowEndB.x, ',')\n                    .concat(arrowEndB.y),\n            });\n        }\n    };\n\n    var updatePath = function updatePath(element, markup, size, scale) {\n        setAttributes(\n            element,\n            Object.assign({}, element.styles, {\n                fill: 'none',\n                d: pointsToPathShape(\n                    markup.points.map(function(point) {\n                        return {\n                            x: getMarkupValue(point.x, size, scale, 'width'),\n                            y: getMarkupValue(point.y, size, scale, 'height'),\n                        };\n                    })\n                ),\n            })\n        );\n    };\n\n    var createShape = function createShape(node) {\n        return function(markup) {\n            return svg(node, { id: markup.id });\n        };\n    };\n\n    var createImage = function createImage(markup) {\n        var shape = svg('image', {\n            id: markup.id,\n            'stroke-linecap': 'round',\n            'stroke-linejoin': 'round',\n            opacity: '0',\n        });\n\n        shape.onload = function() {\n            shape.setAttribute('opacity', markup.opacity || 1);\n        };\n        shape.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', markup.src);\n        return shape;\n    };\n\n    var createLine = function createLine(markup) {\n        var shape = svg('g', {\n            id: markup.id,\n            'stroke-linecap': 'round',\n            'stroke-linejoin': 'round',\n        });\n\n        var line = svg('line');\n        shape.appendChild(line);\n\n        var begin = svg('path');\n        shape.appendChild(begin);\n\n        var end = svg('path');\n        shape.appendChild(end);\n\n        return shape;\n    };\n\n    var CREATE_TYPE_ROUTES = {\n        image: createImage,\n        rect: createShape('rect'),\n        ellipse: createShape('ellipse'),\n        text: createShape('text'),\n        path: createShape('path'),\n        line: createLine,\n    };\n\n    var UPDATE_TYPE_ROUTES = {\n        rect: updateRect,\n        ellipse: updateEllipse,\n        image: updateImage,\n        text: updateText,\n        path: updatePath,\n        line: updateLine,\n    };\n\n    var createMarkupByType = function createMarkupByType(type, markup) {\n        return CREATE_TYPE_ROUTES[type](markup);\n    };\n\n    var updateMarkupByType = function updateMarkupByType(element, type, markup, size, scale) {\n        if (type !== 'path') {\n            element.rect = getMarkupRect(markup, size, scale);\n        }\n        element.styles = getMarkupStyles(markup, size, scale);\n        UPDATE_TYPE_ROUTES[type](element, markup, size, scale);\n    };\n\n    var sortMarkupByZIndex = function sortMarkupByZIndex(a, b) {\n        if (a[1].zIndex > b[1].zIndex) {\n            return 1;\n        }\n        if (a[1].zIndex < b[1].zIndex) {\n            return -1;\n        }\n        return 0;\n    };\n\n    var cropSVG = function cropSVG(blob) {\n        var crop = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        var markup = arguments.length > 2 ? arguments[2] : undefined;\n        var options = arguments.length > 3 ? arguments[3] : undefined;\n        return new Promise(function(resolve) {\n            var _options$background = options.background,\n                background = _options$background === void 0 ? null : _options$background;\n\n            // load blob contents and wrap in crop svg\n            var fr = new FileReader();\n            fr.onloadend = function() {\n                // get svg text\n                var text = fr.result;\n\n                // create element with svg and get size\n                var original = document.createElement('div');\n                original.style.cssText =\n                    'position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;';\n                original.innerHTML = text;\n                var originalNode = original.querySelector('svg');\n                document.body.appendChild(original);\n\n                // request bounding box dimensions\n                var bBox = originalNode.getBBox();\n                original.parentNode.removeChild(original);\n\n                // get title\n                var titleNode = original.querySelector('title');\n\n                // calculate new heights and widths\n                var viewBoxAttribute = originalNode.getAttribute('viewBox') || '';\n                var widthAttribute = originalNode.getAttribute('width') || '';\n                var heightAttribute = originalNode.getAttribute('height') || '';\n                var width = parseFloat(widthAttribute) || null;\n                var height = parseFloat(heightAttribute) || null;\n                var widthUnits = (widthAttribute.match(/[a-z]+/) || [])[0] || '';\n                var heightUnits = (heightAttribute.match(/[a-z]+/) || [])[0] || '';\n\n                // create new size\n                var viewBoxList = viewBoxAttribute.split(' ').map(parseFloat);\n                var viewBox = viewBoxList.length\n                    ? {\n                          x: viewBoxList[0],\n                          y: viewBoxList[1],\n                          width: viewBoxList[2],\n                          height: viewBoxList[3],\n                      }\n                    : bBox;\n\n                var imageWidth = width != null ? width : viewBox.width;\n                var imageHeight = height != null ? height : viewBox.height;\n\n                originalNode.style.overflow = 'visible';\n                originalNode.setAttribute('width', imageWidth);\n                originalNode.setAttribute('height', imageHeight);\n\n                // markup\n                var markupSVG = '';\n                if (markup && markup.length) {\n                    var size = {\n                        width: imageWidth,\n                        height: imageHeight,\n                    };\n\n                    markupSVG = markup.sort(sortMarkupByZIndex).reduce(function(prev, shape) {\n                        var el = createMarkupByType(shape[0], shape[1]);\n                        updateMarkupByType(el, shape[0], shape[1], size);\n                        el.removeAttribute('id');\n                        if (el.getAttribute('opacity') === 1) {\n                            el.removeAttribute('opacity');\n                        }\n                        return prev + '\\n' + el.outerHTML + '\\n';\n                    }, '');\n                    markupSVG = '\\n\\n<g>'.concat(markupSVG.replace(/&nbsp;/g, ' '), '</g>\\n\\n');\n                }\n\n                var aspectRatio = crop.aspectRatio || imageHeight / imageWidth;\n\n                var canvasWidth = imageWidth;\n                var canvasHeight = canvasWidth * aspectRatio;\n\n                var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n\n                var cropCenterX = crop.center ? crop.center.x : 0.5;\n                var cropCenterY = crop.center ? crop.center.y : 0.5;\n\n                var canvasZoomFactor = getImageRectZoomFactor(\n                    {\n                        width: imageWidth,\n                        height: imageHeight,\n                    },\n\n                    getCenteredCropRect(\n                        {\n                            width: canvasWidth,\n                            height: canvasHeight,\n                        },\n\n                        aspectRatio\n                    ),\n\n                    crop.rotation,\n                    shouldLimit\n                        ? { x: cropCenterX, y: cropCenterY }\n                        : {\n                              x: 0.5,\n                              y: 0.5,\n                          }\n                );\n\n                var scale = crop.zoom * canvasZoomFactor;\n\n                var rotation = crop.rotation * (180 / Math.PI);\n\n                var canvasCenter = {\n                    x: canvasWidth * 0.5,\n                    y: canvasHeight * 0.5,\n                };\n\n                var imageOffset = {\n                    x: canvasCenter.x - imageWidth * cropCenterX,\n                    y: canvasCenter.y - imageHeight * cropCenterY,\n                };\n\n                var cropTransforms = [\n                    // rotate\n                    'rotate('\n                        .concat(rotation, ' ')\n                        .concat(canvasCenter.x, ' ')\n                        .concat(canvasCenter.y, ')'),\n\n                    // scale\n                    'translate('.concat(canvasCenter.x, ' ').concat(canvasCenter.y, ')'),\n                    'scale('.concat(scale, ')'),\n                    'translate('.concat(-canvasCenter.x, ' ').concat(-canvasCenter.y, ')'),\n\n                    // offset\n                    'translate('.concat(imageOffset.x, ' ').concat(imageOffset.y, ')'),\n                ];\n\n                var cropFlipHorizontal = crop.flip && crop.flip.horizontal;\n                var cropFlipVertical = crop.flip && crop.flip.vertical;\n\n                var flipTransforms = [\n                    'scale('\n                        .concat(cropFlipHorizontal ? -1 : 1, ' ')\n                        .concat(cropFlipVertical ? -1 : 1, ')'),\n                    'translate('\n                        .concat(cropFlipHorizontal ? -imageWidth : 0, ' ')\n                        .concat(cropFlipVertical ? -imageHeight : 0, ')'),\n                ];\n\n                // crop\n                var transformed = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<svg width=\"'\n                    .concat(canvasWidth)\n                    .concat(widthUnits, '\" height=\"')\n                    .concat(canvasHeight)\n                    .concat(heightUnits, '\" \\nviewBox=\"0 0 ')\n                    .concat(canvasWidth, ' ')\n                    .concat(canvasHeight, '\" ')\n                    .concat(\n                        background ? 'style=\"background:' + background + '\" ' : '',\n                        '\\npreserveAspectRatio=\"xMinYMin\"\\nxmlns:xlink=\"http://www.w3.org/1999/xlink\"\\nxmlns=\"http://www.w3.org/2000/svg\">\\n<!-- Generated by PQINA - https://pqina.nl/ -->\\n<title>'\n                    )\n                    .concat(titleNode ? titleNode.textContent : '', '</title>\\n<g transform=\"')\n                    .concat(cropTransforms.join(' '), '\">\\n<g transform=\"')\n                    .concat(flipTransforms.join(' '), '\">\\n')\n                    .concat(originalNode.outerHTML)\n                    .concat(markupSVG, '\\n</g>\\n</g>\\n</svg>');\n\n                // create new svg file\n                resolve(transformed);\n            };\n\n            fr.readAsText(blob);\n        });\n    };\n\n    var objectToImageData = function objectToImageData(obj) {\n        var imageData;\n        try {\n            imageData = new ImageData(obj.width, obj.height);\n        } catch (e) {\n            // IE + Old EDGE (tested on 12)\n            var canvas = document.createElement('canvas');\n            imageData = canvas.getContext('2d').createImageData(obj.width, obj.height);\n        }\n        imageData.data.set(obj.data);\n        return imageData;\n    };\n\n    /* javascript-obfuscator:disable */\n    var TransformWorker = function TransformWorker() {\n        // maps transform types to transform functions\n        var TRANSFORMS = { resize: resize, filter: filter };\n\n        // applies all image transforms to the image data array\n        var applyTransforms = function applyTransforms(transforms, imageData) {\n            transforms.forEach(function(transform) {\n                imageData = TRANSFORMS[transform.type](imageData, transform.data);\n            });\n            return imageData;\n        };\n\n        // transform image hub\n        var transform = function transform(data, cb) {\n            var transforms = data.transforms;\n\n            // if has filter and has resize, move filter to resize operation\n            var filterTransform = null;\n            transforms.forEach(function(transform) {\n                if (transform.type === 'filter') {\n                    filterTransform = transform;\n                }\n            });\n            if (filterTransform) {\n                // find resize\n                var resizeTransform = null;\n                transforms.forEach(function(transform) {\n                    if (transform.type === 'resize') {\n                        resizeTransform = transform;\n                    }\n                });\n\n                if (resizeTransform) {\n                    // update resize operation\n                    resizeTransform.data.matrix = filterTransform.data;\n\n                    // remove filter\n                    transforms = transforms.filter(function(transform) {\n                        return transform.type !== 'filter';\n                    });\n                }\n            }\n\n            cb(applyTransforms(transforms, data.imageData));\n        };\n\n        // eslint-disable-next-line no-restricted-globals\n        self.onmessage = function(e) {\n            transform(e.data.message, function(response) {\n                // eslint-disable-next-line no-restricted-globals\n                self.postMessage({ id: e.data.id, message: response }, [response.data.buffer]);\n            });\n        };\n\n        var br = 1.0;\n        var bg = 1.0;\n        var bb = 1.0;\n        function applyFilterMatrix(index, data, m) {\n            var ir = data[index] / 255;\n            var ig = data[index + 1] / 255;\n            var ib = data[index + 2] / 255;\n            var ia = data[index + 3] / 255;\n\n            var mr = ir * m[0] + ig * m[1] + ib * m[2] + ia * m[3] + m[4];\n            var mg = ir * m[5] + ig * m[6] + ib * m[7] + ia * m[8] + m[9];\n            var mb = ir * m[10] + ig * m[11] + ib * m[12] + ia * m[13] + m[14];\n            var ma = ir * m[15] + ig * m[16] + ib * m[17] + ia * m[18] + m[19];\n\n            var or = Math.max(0, mr * ma) + br * (1.0 - ma);\n            var og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n            var ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n\n            data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n            data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n            data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255;\n        }\n\n        var identityMatrix = self.JSON.stringify([\n            1,\n            0,\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n            0,\n            0,\n            0,\n            0,\n            1,\n            0,\n        ]);\n        function isIdentityMatrix(filter) {\n            return self.JSON.stringify(filter || []) === identityMatrix;\n        }\n\n        function filter(imageData, matrix) {\n            if (!matrix || isIdentityMatrix(matrix)) return imageData;\n\n            var data = imageData.data;\n            var l = data.length;\n\n            var m11 = matrix[0];\n            var m12 = matrix[1];\n            var m13 = matrix[2];\n            var m14 = matrix[3];\n            var m15 = matrix[4];\n\n            var m21 = matrix[5];\n            var m22 = matrix[6];\n            var m23 = matrix[7];\n            var m24 = matrix[8];\n            var m25 = matrix[9];\n\n            var m31 = matrix[10];\n            var m32 = matrix[11];\n            var m33 = matrix[12];\n            var m34 = matrix[13];\n            var m35 = matrix[14];\n\n            var m41 = matrix[15];\n            var m42 = matrix[16];\n            var m43 = matrix[17];\n            var m44 = matrix[18];\n            var m45 = matrix[19];\n\n            var index = 0,\n                r = 0.0,\n                g = 0.0,\n                b = 0.0,\n                a = 0.0,\n                mr = 0.0,\n                mg = 0.0,\n                mb = 0.0,\n                ma = 0.0,\n                or = 0.0,\n                og = 0.0,\n                ob = 0.0;\n\n            for (; index < l; index += 4) {\n                r = data[index] / 255;\n                g = data[index + 1] / 255;\n                b = data[index + 2] / 255;\n                a = data[index + 3] / 255;\n\n                mr = r * m11 + g * m12 + b * m13 + a * m14 + m15;\n                mg = r * m21 + g * m22 + b * m23 + a * m24 + m25;\n                mb = r * m31 + g * m32 + b * m33 + a * m34 + m35;\n                ma = r * m41 + g * m42 + b * m43 + a * m44 + m45;\n\n                or = Math.max(0, mr * ma) + br * (1.0 - ma);\n                og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n                ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n\n                data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n                data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n                data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255;\n                // don't update alpha value\n            }\n\n            return imageData;\n        }\n\n        function resize(imageData, data) {\n            var _data$mode = data.mode,\n                mode = _data$mode === void 0 ? 'contain' : _data$mode,\n                _data$upscale = data.upscale,\n                upscale = _data$upscale === void 0 ? false : _data$upscale,\n                width = data.width,\n                height = data.height,\n                matrix = data.matrix;\n\n            // test if is identity matrix\n            matrix = !matrix || isIdentityMatrix(matrix) ? null : matrix;\n\n            // need at least a width or a height\n            // also 0 is not a valid width or height\n            if (!width && !height) {\n                return filter(imageData, matrix);\n            }\n\n            // make sure all bounds are set\n            if (width === null) {\n                width = height;\n            } else if (height === null) {\n                height = width;\n            }\n\n            if (mode !== 'force') {\n                var scalarWidth = width / imageData.width;\n                var scalarHeight = height / imageData.height;\n                var scalar = 1;\n\n                if (mode === 'cover') {\n                    scalar = Math.max(scalarWidth, scalarHeight);\n                } else if (mode === 'contain') {\n                    scalar = Math.min(scalarWidth, scalarHeight);\n                }\n\n                // if image is too small, exit here with original image\n                if (scalar > 1 && upscale === false) {\n                    return filter(imageData, matrix);\n                }\n\n                width = imageData.width * scalar;\n                height = imageData.height * scalar;\n            }\n\n            var originWidth = imageData.width;\n            var originHeight = imageData.height;\n            var targetWidth = Math.round(width);\n            var targetHeight = Math.round(height);\n            var inputData = imageData.data;\n            var outputData = new Uint8ClampedArray(targetWidth * targetHeight * 4);\n            var ratioWidth = originWidth / targetWidth;\n            var ratioHeight = originHeight / targetHeight;\n            var ratioWidthHalf = Math.ceil(ratioWidth * 0.5);\n            var ratioHeightHalf = Math.ceil(ratioHeight * 0.5);\n\n            for (var j = 0; j < targetHeight; j++) {\n                for (var i = 0; i < targetWidth; i++) {\n                    var x2 = (i + j * targetWidth) * 4;\n                    var weight = 0;\n                    var weights = 0;\n                    var weightsAlpha = 0;\n                    var r = 0;\n                    var g = 0;\n                    var b = 0;\n                    var a = 0;\n                    var centerY = (j + 0.5) * ratioHeight;\n\n                    for (var yy = Math.floor(j * ratioHeight); yy < (j + 1) * ratioHeight; yy++) {\n                        var dy = Math.abs(centerY - (yy + 0.5)) / ratioHeightHalf;\n                        var centerX = (i + 0.5) * ratioWidth;\n                        var w0 = dy * dy;\n\n                        for (var xx = Math.floor(i * ratioWidth); xx < (i + 1) * ratioWidth; xx++) {\n                            var dx = Math.abs(centerX - (xx + 0.5)) / ratioWidthHalf;\n                            var w = Math.sqrt(w0 + dx * dx);\n\n                            if (w >= -1 && w <= 1) {\n                                weight = 2 * w * w * w - 3 * w * w + 1;\n\n                                if (weight > 0) {\n                                    dx = 4 * (xx + yy * originWidth);\n\n                                    var ref = inputData[dx + 3];\n                                    a += weight * ref;\n                                    weightsAlpha += weight;\n\n                                    if (ref < 255) {\n                                        weight = (weight * ref) / 250;\n                                    }\n\n                                    r += weight * inputData[dx];\n                                    g += weight * inputData[dx + 1];\n                                    b += weight * inputData[dx + 2];\n                                    weights += weight;\n                                }\n                            }\n                        }\n                    }\n\n                    outputData[x2] = r / weights;\n                    outputData[x2 + 1] = g / weights;\n                    outputData[x2 + 2] = b / weights;\n                    outputData[x2 + 3] = a / weightsAlpha;\n\n                    matrix && applyFilterMatrix(x2, outputData, matrix);\n                }\n            }\n\n            return {\n                data: outputData,\n                width: targetWidth,\n                height: targetHeight,\n            };\n        }\n    };\n    /* javascript-obfuscator:enable */\n\n    var correctOrientation = function correctOrientation(view, offset) {\n        // Missing 0x45786966 Marker? No Exif Header, stop here\n        if (view.getUint32(offset + 4, false) !== 0x45786966) return;\n\n        // next byte!\n        offset += 4;\n\n        // First 2bytes defines byte align of TIFF data.\n        // If it is 0x4949=\"I I\", it means \"Intel\" type byte align\n        var intelByteAligned = view.getUint16((offset += 6), false) === 0x4949;\n        offset += view.getUint32(offset + 4, intelByteAligned);\n\n        var tags = view.getUint16(offset, intelByteAligned);\n        offset += 2;\n\n        // find Orientation tag\n        for (var i = 0; i < tags; i++) {\n            if (view.getUint16(offset + i * 12, intelByteAligned) === 0x0112) {\n                view.setUint16(offset + i * 12 + 8, 1, intelByteAligned);\n                return true;\n            }\n        }\n        return false;\n    };\n\n    var readData = function readData(data) {\n        var view = new DataView(data);\n\n        // Every JPEG file starts from binary value '0xFFD8'\n        // If it's not present, exit here\n        if (view.getUint16(0) !== 0xffd8) return null;\n\n        var offset = 2; // Start at 2 as we skipped two bytes (FFD8)\n        var marker;\n        var markerLength;\n        var orientationCorrected = false;\n\n        while (offset < view.byteLength) {\n            marker = view.getUint16(offset, false);\n            markerLength = view.getUint16(offset + 2, false) + 2;\n\n            // Test if is APP and COM markers\n            var isData = (marker >= 0xffe0 && marker <= 0xffef) || marker === 0xfffe;\n            if (!isData) {\n                break;\n            }\n\n            if (!orientationCorrected) {\n                orientationCorrected = correctOrientation(view, offset, markerLength);\n            }\n\n            if (offset + markerLength > view.byteLength) {\n                break;\n            }\n\n            offset += markerLength;\n        }\n        return data.slice(0, offset);\n    };\n\n    var getImageHead = function getImageHead(file) {\n        return new Promise(function(resolve) {\n            var reader = new FileReader();\n            reader.onload = function() {\n                return resolve(readData(reader.result) || null);\n            };\n            reader.readAsArrayBuffer(file.slice(0, 256 * 1024));\n        });\n    };\n\n    var getBlobBuilder = function getBlobBuilder() {\n        return (window.BlobBuilder =\n            window.BlobBuilder ||\n            window.WebKitBlobBuilder ||\n            window.MozBlobBuilder ||\n            window.MSBlobBuilder);\n    };\n\n    var createBlob = function createBlob(arrayBuffer, mimeType) {\n        var BB = getBlobBuilder();\n\n        if (BB) {\n            var bb = new BB();\n            bb.append(arrayBuffer);\n            return bb.getBlob(mimeType);\n        }\n\n        return new Blob([arrayBuffer], {\n            type: mimeType,\n        });\n    };\n\n    var getUniqueId = function getUniqueId() {\n        return Math.random()\n            .toString(36)\n            .substr(2, 9);\n    };\n\n    var createWorker = function createWorker(fn) {\n        var workerBlob = new Blob(['(', fn.toString(), ')()'], { type: 'application/javascript' });\n        var workerURL = URL.createObjectURL(workerBlob);\n        var worker = new Worker(workerURL);\n\n        var trips = [];\n\n        return {\n            transfer: function transfer() {}, // (message, cb) => {}\n            post: function post(message, cb, transferList) {\n                var id = getUniqueId();\n                trips[id] = cb;\n\n                worker.onmessage = function(e) {\n                    var cb = trips[e.data.id];\n                    if (!cb) return;\n                    cb(e.data.message);\n                    delete trips[e.data.id];\n                };\n\n                worker.postMessage(\n                    {\n                        id: id,\n                        message: message,\n                    },\n\n                    transferList\n                );\n            },\n            terminate: function terminate() {\n                worker.terminate();\n                URL.revokeObjectURL(workerURL);\n            },\n        };\n    };\n\n    var loadImage = function loadImage(url) {\n        return new Promise(function(resolve, reject) {\n            var img = new Image();\n            img.onload = function() {\n                resolve(img);\n            };\n            img.onerror = function(e) {\n                reject(e);\n            };\n            img.src = url;\n        });\n    };\n\n    var chain = function chain(funcs) {\n        return funcs.reduce(function(promise, func) {\n            return promise.then(function(result) {\n                return func().then(Array.prototype.concat.bind(result));\n            });\n        }, Promise.resolve([]));\n    };\n\n    var canvasApplyMarkup = function canvasApplyMarkup(canvas, markup) {\n        return new Promise(function(resolve) {\n            var size = {\n                width: canvas.width,\n                height: canvas.height,\n            };\n\n            var ctx = canvas.getContext('2d');\n\n            var drawers = markup.sort(sortMarkupByZIndex).map(function(item) {\n                return function() {\n                    return new Promise(function(resolve) {\n                        var result = TYPE_DRAW_ROUTES[item[0]](ctx, size, item[1], resolve);\n                        if (result) resolve();\n                    });\n                };\n            });\n\n            chain(drawers).then(function() {\n                return resolve(canvas);\n            });\n        });\n    };\n\n    var applyMarkupStyles = function applyMarkupStyles(ctx, styles) {\n        ctx.beginPath();\n        ctx.lineCap = styles['stroke-linecap'];\n        ctx.lineJoin = styles['stroke-linejoin'];\n        ctx.lineWidth = styles['stroke-width'];\n        if (styles['stroke-dasharray'].length) {\n            ctx.setLineDash(styles['stroke-dasharray'].split(','));\n        }\n        ctx.fillStyle = styles['fill'];\n        ctx.strokeStyle = styles['stroke'];\n        ctx.globalAlpha = styles.opacity || 1;\n    };\n\n    var drawMarkupStyles = function drawMarkupStyles(ctx) {\n        ctx.fill();\n        ctx.stroke();\n        ctx.globalAlpha = 1;\n    };\n\n    var drawRect = function drawRect(ctx, size, markup) {\n        var rect = getMarkupRect(markup, size);\n        var styles = getMarkupStyles(markup, size);\n        applyMarkupStyles(ctx, styles);\n        ctx.rect(rect.x, rect.y, rect.width, rect.height);\n        drawMarkupStyles(ctx, styles);\n        return true;\n    };\n\n    var drawEllipse = function drawEllipse(ctx, size, markup) {\n        var rect = getMarkupRect(markup, size);\n        var styles = getMarkupStyles(markup, size);\n        applyMarkupStyles(ctx, styles);\n\n        var x = rect.x,\n            y = rect.y,\n            w = rect.width,\n            h = rect.height,\n            kappa = 0.5522848,\n            ox = (w / 2) * kappa,\n            oy = (h / 2) * kappa,\n            xe = x + w,\n            ye = y + h,\n            xm = x + w / 2,\n            ym = y + h / 2;\n\n        ctx.moveTo(x, ym);\n        ctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\n        ctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\n        ctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n        ctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\n\n        drawMarkupStyles(ctx, styles);\n        return true;\n    };\n\n    var drawImage = function drawImage(ctx, size, markup, done) {\n        var rect = getMarkupRect(markup, size);\n        var styles = getMarkupStyles(markup, size);\n        applyMarkupStyles(ctx, styles);\n\n        var image = new Image();\n\n        // if is cross origin image add cross origin attribute\n        var isCrossOriginImage =\n            new URL(markup.src, window.location.href).origin !== window.location.origin;\n        if (isCrossOriginImage) image.crossOrigin = '';\n\n        image.onload = function() {\n            if (markup.fit === 'cover') {\n                var ar = rect.width / rect.height;\n                var width = ar > 1 ? image.width : image.height * ar;\n                var height = ar > 1 ? image.width / ar : image.height;\n                var x = image.width * 0.5 - width * 0.5;\n                var y = image.height * 0.5 - height * 0.5;\n                ctx.drawImage(image, x, y, width, height, rect.x, rect.y, rect.width, rect.height);\n            } else if (markup.fit === 'contain') {\n                var scalar = Math.min(rect.width / image.width, rect.height / image.height);\n                var _width = scalar * image.width;\n                var _height = scalar * image.height;\n                var _x = rect.x + rect.width * 0.5 - _width * 0.5;\n                var _y = rect.y + rect.height * 0.5 - _height * 0.5;\n                ctx.drawImage(image, 0, 0, image.width, image.height, _x, _y, _width, _height);\n            } else {\n                ctx.drawImage(\n                    image,\n                    0,\n                    0,\n                    image.width,\n                    image.height,\n                    rect.x,\n                    rect.y,\n                    rect.width,\n                    rect.height\n                );\n            }\n\n            drawMarkupStyles(ctx, styles);\n            done();\n        };\n        image.src = markup.src;\n    };\n\n    var drawText = function drawText(ctx, size, markup) {\n        var rect = getMarkupRect(markup, size);\n        var styles = getMarkupStyles(markup, size);\n        applyMarkupStyles(ctx, styles);\n\n        var fontSize = getMarkupValue(markup.fontSize, size);\n        var fontFamily = markup.fontFamily || 'sans-serif';\n        var fontWeight = markup.fontWeight || 'normal';\n        var textAlign = markup.textAlign || 'left';\n\n        ctx.font = ''\n            .concat(fontWeight, ' ')\n            .concat(fontSize, 'px ')\n            .concat(fontFamily);\n        ctx.textAlign = textAlign;\n        ctx.fillText(markup.text, rect.x, rect.y);\n\n        drawMarkupStyles(ctx, styles);\n        return true;\n    };\n\n    var drawPath = function drawPath(ctx, size, markup) {\n        var styles = getMarkupStyles(markup, size);\n        applyMarkupStyles(ctx, styles);\n        ctx.beginPath();\n\n        var points = markup.points.map(function(point) {\n            return {\n                x: getMarkupValue(point.x, size, 1, 'width'),\n                y: getMarkupValue(point.y, size, 1, 'height'),\n            };\n        });\n\n        ctx.moveTo(points[0].x, points[0].y);\n        var l = points.length;\n        for (var i = 1; i < l; i++) {\n            ctx.lineTo(points[i].x, points[i].y);\n        }\n\n        drawMarkupStyles(ctx, styles);\n        return true;\n    };\n\n    var drawLine = function drawLine(ctx, size, markup) {\n        var rect = getMarkupRect(markup, size);\n        var styles = getMarkupStyles(markup, size);\n        applyMarkupStyles(ctx, styles);\n\n        ctx.beginPath();\n\n        var origin = {\n            x: rect.x,\n            y: rect.y,\n        };\n\n        var target = {\n            x: rect.x + rect.width,\n            y: rect.y + rect.height,\n        };\n\n        ctx.moveTo(origin.x, origin.y);\n        ctx.lineTo(target.x, target.y);\n\n        var v = vectorNormalize({\n            x: target.x - origin.x,\n            y: target.y - origin.y,\n        });\n\n        var l = 0.04 * Math.min(size.width, size.height);\n\n        if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n            var arrowBeginRotationPoint = vectorMultiply(v, l);\n            var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n            var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n            var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n\n            ctx.moveTo(arrowBeginA.x, arrowBeginA.y);\n            ctx.lineTo(origin.x, origin.y);\n            ctx.lineTo(arrowBeginB.x, arrowBeginB.y);\n        }\n        if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n            var arrowEndRotationPoint = vectorMultiply(v, -l);\n            var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n            var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n            var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n\n            ctx.moveTo(arrowEndA.x, arrowEndA.y);\n            ctx.lineTo(target.x, target.y);\n            ctx.lineTo(arrowEndB.x, arrowEndB.y);\n        }\n\n        drawMarkupStyles(ctx, styles);\n        return true;\n    };\n\n    var TYPE_DRAW_ROUTES = {\n        rect: drawRect,\n        ellipse: drawEllipse,\n        image: drawImage,\n        text: drawText,\n        line: drawLine,\n        path: drawPath,\n    };\n\n    var imageDataToCanvas = function imageDataToCanvas(imageData) {\n        var image = document.createElement('canvas');\n        image.width = imageData.width;\n        image.height = imageData.height;\n        var ctx = image.getContext('2d');\n        ctx.putImageData(imageData, 0, 0);\n        return image;\n    };\n\n    var transformImage = function transformImage(file, instructions) {\n        var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        return new Promise(function(resolve, reject) {\n            // if the file is not an image we do not have any business transforming it\n            if (!file || !isImage$1(file))\n                return reject({ status: 'not an image file', file: file });\n\n            // get separate options for easier use\n            var stripImageHead = options.stripImageHead,\n                beforeCreateBlob = options.beforeCreateBlob,\n                afterCreateBlob = options.afterCreateBlob,\n                canvasMemoryLimit = options.canvasMemoryLimit;\n\n            // get crop\n            var crop = instructions.crop,\n                size = instructions.size,\n                filter = instructions.filter,\n                markup = instructions.markup,\n                output = instructions.output;\n\n            // get exif orientation\n            var orientation =\n                instructions.image && instructions.image.orientation\n                    ? Math.max(1, Math.min(8, instructions.image.orientation))\n                    : null;\n\n            // compression quality 0 => 100\n            var qualityAsPercentage = output && output.quality;\n            var quality = qualityAsPercentage === null ? null : qualityAsPercentage / 100;\n\n            // output format\n            var type = (output && output.type) || null;\n\n            // background color\n            var background = (output && output.background) || null;\n\n            // get transforms\n            var transforms = [];\n\n            // add resize transforms if set\n            if (size && (typeof size.width === 'number' || typeof size.height === 'number')) {\n                transforms.push({ type: 'resize', data: size });\n            }\n\n            // add filters\n            if (filter && filter.length === 20) {\n                transforms.push({ type: 'filter', data: filter });\n            }\n\n            // resolves with supplied blob\n            var resolveWithBlob = function resolveWithBlob(blob) {\n                var promisedBlob = afterCreateBlob ? afterCreateBlob(blob) : blob;\n                Promise.resolve(promisedBlob).then(resolve);\n            };\n\n            // done\n            var toBlob = function toBlob(imageData, options) {\n                var canvas = imageDataToCanvas(imageData);\n                var promisedCanvas = markup.length ? canvasApplyMarkup(canvas, markup) : canvas;\n                Promise.resolve(promisedCanvas).then(function(canvas) {\n                    canvasToBlob(canvas, options, beforeCreateBlob)\n                        .then(function(blob) {\n                            // force release of canvas memory\n                            canvasRelease(canvas);\n\n                            // remove image head (default)\n                            if (stripImageHead) return resolveWithBlob(blob);\n\n                            // try to copy image head from original file to generated blob\n                            getImageHead(file).then(function(imageHead) {\n                                // re-inject image head in case of JPEG, as the image head is removed by canvas export\n                                if (imageHead !== null) {\n                                    blob = new Blob([imageHead, blob.slice(20)], {\n                                        type: blob.type,\n                                    });\n                                }\n\n                                // done!\n                                resolveWithBlob(blob);\n                            });\n                        })\n                        .catch(reject);\n                });\n            };\n\n            // if this is an svg and we want it to stay an svg\n            if (/svg/.test(file.type) && type === null) {\n                return cropSVG(file, crop, markup, { background: background }).then(function(text) {\n                    resolve(createBlob(text, 'image/svg+xml'));\n                });\n            }\n\n            // get file url\n            var url = URL.createObjectURL(file);\n\n            // turn the file into an image\n            loadImage(url)\n                .then(function(image) {\n                    // url is no longer needed\n                    URL.revokeObjectURL(url);\n\n                    // draw to canvas and start transform chain\n                    var imageData = imageToImageData(image, orientation, crop, {\n                        canvasMemoryLimit: canvasMemoryLimit,\n                        background: background,\n                    });\n\n                    // determine the format of the blob that we will output\n                    var outputFormat = {\n                        quality: quality,\n                        type: type || file.type,\n                    };\n\n                    // no transforms necessary, we done!\n                    if (!transforms.length) {\n                        return toBlob(imageData, outputFormat);\n                    }\n\n                    // send to the transform worker to transform the blob on a separate thread\n                    var worker = createWorker(TransformWorker);\n                    worker.post(\n                        {\n                            transforms: transforms,\n                            imageData: imageData,\n                        },\n\n                        function(response) {\n                            // finish up\n                            toBlob(objectToImageData(response), outputFormat);\n\n                            // stop worker\n                            worker.terminate();\n                        },\n                        [imageData.data.buffer]\n                    );\n                })\n                .catch(reject);\n        });\n    };\n\n    function _typeof(obj) {\n        if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n            _typeof = function(obj) {\n                return typeof obj;\n            };\n        } else {\n            _typeof = function(obj) {\n                return obj &&\n                    typeof Symbol === 'function' &&\n                    obj.constructor === Symbol &&\n                    obj !== Symbol.prototype\n                    ? 'symbol'\n                    : typeof obj;\n            };\n        }\n\n        return _typeof(obj);\n    }\n\n    var REACT_ELEMENT_TYPE;\n\n    function _jsx(type, props, key, children) {\n        if (!REACT_ELEMENT_TYPE) {\n            REACT_ELEMENT_TYPE =\n                (typeof Symbol === 'function' && Symbol.for && Symbol.for('react.element')) ||\n                0xeac7;\n        }\n\n        var defaultProps = type && type.defaultProps;\n        var childrenLength = arguments.length - 3;\n\n        if (!props && childrenLength !== 0) {\n            props = {\n                children: void 0,\n            };\n        }\n\n        if (props && defaultProps) {\n            for (var propName in defaultProps) {\n                if (props[propName] === void 0) {\n                    props[propName] = defaultProps[propName];\n                }\n            }\n        } else if (!props) {\n            props = defaultProps || {};\n        }\n\n        if (childrenLength === 1) {\n            props.children = children;\n        } else if (childrenLength > 1) {\n            var childArray = new Array(childrenLength);\n\n            for (var i = 0; i < childrenLength; i++) {\n                childArray[i] = arguments[i + 3];\n            }\n\n            props.children = childArray;\n        }\n\n        return {\n            $$typeof: REACT_ELEMENT_TYPE,\n            type: type,\n            key: key === undefined ? null : '' + key,\n            ref: null,\n            props: props,\n            _owner: null,\n        };\n    }\n\n    function _asyncIterator(iterable) {\n        var method;\n\n        if (typeof Symbol === 'function') {\n            if (Symbol.asyncIterator) {\n                method = iterable[Symbol.asyncIterator];\n                if (method != null) return method.call(iterable);\n            }\n\n            if (Symbol.iterator) {\n                method = iterable[Symbol.iterator];\n                if (method != null) return method.call(iterable);\n            }\n        }\n\n        throw new TypeError('Object is not async iterable');\n    }\n\n    function _AwaitValue(value) {\n        this.wrapped = value;\n    }\n\n    function _AsyncGenerator(gen) {\n        var front, back;\n\n        function send(key, arg) {\n            return new Promise(function(resolve, reject) {\n                var request = {\n                    key: key,\n                    arg: arg,\n                    resolve: resolve,\n                    reject: reject,\n                    next: null,\n                };\n\n                if (back) {\n                    back = back.next = request;\n                } else {\n                    front = back = request;\n                    resume(key, arg);\n                }\n            });\n        }\n\n        function resume(key, arg) {\n            try {\n                var result = gen[key](arg);\n                var value = result.value;\n                var wrappedAwait = value instanceof _AwaitValue;\n                Promise.resolve(wrappedAwait ? value.wrapped : value).then(\n                    function(arg) {\n                        if (wrappedAwait) {\n                            resume('next', arg);\n                            return;\n                        }\n\n                        settle(result.done ? 'return' : 'normal', arg);\n                    },\n                    function(err) {\n                        resume('throw', err);\n                    }\n                );\n            } catch (err) {\n                settle('throw', err);\n            }\n        }\n\n        function settle(type, value) {\n            switch (type) {\n                case 'return':\n                    front.resolve({\n                        value: value,\n                        done: true,\n                    });\n                    break;\n\n                case 'throw':\n                    front.reject(value);\n                    break;\n\n                default:\n                    front.resolve({\n                        value: value,\n                        done: false,\n                    });\n                    break;\n            }\n\n            front = front.next;\n\n            if (front) {\n                resume(front.key, front.arg);\n            } else {\n                back = null;\n            }\n        }\n\n        this._invoke = send;\n\n        if (typeof gen.return !== 'function') {\n            this.return = undefined;\n        }\n    }\n\n    if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n        _AsyncGenerator.prototype[Symbol.asyncIterator] = function() {\n            return this;\n        };\n    }\n\n    _AsyncGenerator.prototype.next = function(arg) {\n        return this._invoke('next', arg);\n    };\n\n    _AsyncGenerator.prototype.throw = function(arg) {\n        return this._invoke('throw', arg);\n    };\n\n    _AsyncGenerator.prototype.return = function(arg) {\n        return this._invoke('return', arg);\n    };\n\n    function _wrapAsyncGenerator(fn) {\n        return function() {\n            return new _AsyncGenerator(fn.apply(this, arguments));\n        };\n    }\n\n    function _awaitAsyncGenerator(value) {\n        return new _AwaitValue(value);\n    }\n\n    function _asyncGeneratorDelegate(inner, awaitWrap) {\n        var iter = {},\n            waiting = false;\n\n        function pump(key, value) {\n            waiting = true;\n            value = new Promise(function(resolve) {\n                resolve(inner[key](value));\n            });\n            return {\n                done: false,\n                value: awaitWrap(value),\n            };\n        }\n\n        if (typeof Symbol === 'function' && Symbol.iterator) {\n            iter[Symbol.iterator] = function() {\n                return this;\n            };\n        }\n\n        iter.next = function(value) {\n            if (waiting) {\n                waiting = false;\n                return value;\n            }\n\n            return pump('next', value);\n        };\n\n        if (typeof inner.throw === 'function') {\n            iter.throw = function(value) {\n                if (waiting) {\n                    waiting = false;\n                    throw value;\n                }\n\n                return pump('throw', value);\n            };\n        }\n\n        if (typeof inner.return === 'function') {\n            iter.return = function(value) {\n                return pump('return', value);\n            };\n        }\n\n        return iter;\n    }\n\n    function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n        try {\n            var info = gen[key](arg);\n            var value = info.value;\n        } catch (error) {\n            reject(error);\n            return;\n        }\n\n        if (info.done) {\n            resolve(value);\n        } else {\n            Promise.resolve(value).then(_next, _throw);\n        }\n    }\n\n    function _asyncToGenerator(fn) {\n        return function() {\n            var self = this,\n                args = arguments;\n            return new Promise(function(resolve, reject) {\n                var gen = fn.apply(self, args);\n\n                function _next(value) {\n                    asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);\n                }\n\n                function _throw(err) {\n                    asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n                }\n\n                _next(undefined);\n            });\n        };\n    }\n\n    function _classCallCheck(instance, Constructor) {\n        if (!(instance instanceof Constructor)) {\n            throw new TypeError('Cannot call a class as a function');\n        }\n    }\n\n    function _defineProperties(target, props) {\n        for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if ('value' in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n        }\n    }\n\n    function _createClass(Constructor, protoProps, staticProps) {\n        if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n        if (staticProps) _defineProperties(Constructor, staticProps);\n        return Constructor;\n    }\n\n    function _defineEnumerableProperties(obj, descs) {\n        for (var key in descs) {\n            var desc = descs[key];\n            desc.configurable = desc.enumerable = true;\n            if ('value' in desc) desc.writable = true;\n            Object.defineProperty(obj, key, desc);\n        }\n\n        if (Object.getOwnPropertySymbols) {\n            var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n            for (var i = 0; i < objectSymbols.length; i++) {\n                var sym = objectSymbols[i];\n                var desc = descs[sym];\n                desc.configurable = desc.enumerable = true;\n                if ('value' in desc) desc.writable = true;\n                Object.defineProperty(obj, sym, desc);\n            }\n        }\n\n        return obj;\n    }\n\n    function _defaults(obj, defaults) {\n        var keys = Object.getOwnPropertyNames(defaults);\n\n        for (var i = 0; i < keys.length; i++) {\n            var key = keys[i];\n            var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n            if (value && value.configurable && obj[key] === undefined) {\n                Object.defineProperty(obj, key, value);\n            }\n        }\n\n        return obj;\n    }\n\n    function _defineProperty(obj, key, value) {\n        if (key in obj) {\n            Object.defineProperty(obj, key, {\n                value: value,\n                enumerable: true,\n                configurable: true,\n                writable: true,\n            });\n        } else {\n            obj[key] = value;\n        }\n\n        return obj;\n    }\n\n    function _extends() {\n        _extends =\n            Object.assign ||\n            function(target) {\n                for (var i = 1; i < arguments.length; i++) {\n                    var source = arguments[i];\n\n                    for (var key in source) {\n                        if (Object.prototype.hasOwnProperty.call(source, key)) {\n                            target[key] = source[key];\n                        }\n                    }\n                }\n\n                return target;\n            };\n\n        return _extends.apply(this, arguments);\n    }\n\n    function _objectSpread(target) {\n        for (var i = 1; i < arguments.length; i++) {\n            var source = arguments[i] != null ? arguments[i] : {};\n            var ownKeys = Object.keys(source);\n\n            if (typeof Object.getOwnPropertySymbols === 'function') {\n                ownKeys = ownKeys.concat(\n                    Object.getOwnPropertySymbols(source).filter(function(sym) {\n                        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n                    })\n                );\n            }\n\n            ownKeys.forEach(function(key) {\n                _defineProperty(target, key, source[key]);\n            });\n        }\n\n        return target;\n    }\n\n    function _inherits(subClass, superClass) {\n        if (typeof superClass !== 'function' && superClass !== null) {\n            throw new TypeError('Super expression must either be null or a function');\n        }\n\n        subClass.prototype = Object.create(superClass && superClass.prototype, {\n            constructor: {\n                value: subClass,\n                writable: true,\n                configurable: true,\n            },\n        });\n        if (superClass) _setPrototypeOf(subClass, superClass);\n    }\n\n    function _inheritsLoose(subClass, superClass) {\n        subClass.prototype = Object.create(superClass.prototype);\n        subClass.prototype.constructor = subClass;\n        subClass.__proto__ = superClass;\n    }\n\n    function _getPrototypeOf(o) {\n        _getPrototypeOf = Object.setPrototypeOf\n            ? Object.getPrototypeOf\n            : function _getPrototypeOf(o) {\n                  return o.__proto__ || Object.getPrototypeOf(o);\n              };\n        return _getPrototypeOf(o);\n    }\n\n    function _setPrototypeOf(o, p) {\n        _setPrototypeOf =\n            Object.setPrototypeOf ||\n            function _setPrototypeOf(o, p) {\n                o.__proto__ = p;\n                return o;\n            };\n\n        return _setPrototypeOf(o, p);\n    }\n\n    function isNativeReflectConstruct() {\n        if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n        if (Reflect.construct.sham) return false;\n        if (typeof Proxy === 'function') return true;\n\n        try {\n            Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    function _construct(Parent, args, Class) {\n        if (isNativeReflectConstruct()) {\n            _construct = Reflect.construct;\n        } else {\n            _construct = function _construct(Parent, args, Class) {\n                var a = [null];\n                a.push.apply(a, args);\n                var Constructor = Function.bind.apply(Parent, a);\n                var instance = new Constructor();\n                if (Class) _setPrototypeOf(instance, Class.prototype);\n                return instance;\n            };\n        }\n\n        return _construct.apply(null, arguments);\n    }\n\n    function _isNativeFunction(fn) {\n        return Function.toString.call(fn).indexOf('[native code]') !== -1;\n    }\n\n    function _wrapNativeSuper(Class) {\n        var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n        _wrapNativeSuper = function _wrapNativeSuper(Class) {\n            if (Class === null || !_isNativeFunction(Class)) return Class;\n\n            if (typeof Class !== 'function') {\n                throw new TypeError('Super expression must either be null or a function');\n            }\n\n            if (typeof _cache !== 'undefined') {\n                if (_cache.has(Class)) return _cache.get(Class);\n\n                _cache.set(Class, Wrapper);\n            }\n\n            function Wrapper() {\n                return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n            }\n\n            Wrapper.prototype = Object.create(Class.prototype, {\n                constructor: {\n                    value: Wrapper,\n                    enumerable: false,\n                    writable: true,\n                    configurable: true,\n                },\n            });\n            return _setPrototypeOf(Wrapper, Class);\n        };\n\n        return _wrapNativeSuper(Class);\n    }\n\n    function _instanceof(left, right) {\n        if (right != null && typeof Symbol !== 'undefined' && right[Symbol.hasInstance]) {\n            return right[Symbol.hasInstance](left);\n        } else {\n            return left instanceof right;\n        }\n    }\n\n    function _interopRequireDefault(obj) {\n        return obj && obj.__esModule\n            ? obj\n            : {\n                  default: obj,\n              };\n    }\n\n    function _interopRequireWildcard(obj) {\n        if (obj && obj.__esModule) {\n            return obj;\n        } else {\n            var newObj = {};\n\n            if (obj != null) {\n                for (var key in obj) {\n                    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n                        var desc =\n                            Object.defineProperty && Object.getOwnPropertyDescriptor\n                                ? Object.getOwnPropertyDescriptor(obj, key)\n                                : {};\n\n                        if (desc.get || desc.set) {\n                            Object.defineProperty(newObj, key, desc);\n                        } else {\n                            newObj[key] = obj[key];\n                        }\n                    }\n                }\n            }\n\n            newObj.default = obj;\n            return newObj;\n        }\n    }\n\n    function _newArrowCheck(innerThis, boundThis) {\n        if (innerThis !== boundThis) {\n            throw new TypeError('Cannot instantiate an arrow function');\n        }\n    }\n\n    function _objectDestructuringEmpty(obj) {\n        if (obj == null) throw new TypeError('Cannot destructure undefined');\n    }\n\n    function _objectWithoutPropertiesLoose(source, excluded) {\n        if (source == null) return {};\n        var target = {};\n        var sourceKeys = Object.keys(source);\n        var key, i;\n\n        for (i = 0; i < sourceKeys.length; i++) {\n            key = sourceKeys[i];\n            if (excluded.indexOf(key) >= 0) continue;\n            target[key] = source[key];\n        }\n\n        return target;\n    }\n\n    function _objectWithoutProperties(source, excluded) {\n        if (source == null) return {};\n\n        var target = _objectWithoutPropertiesLoose(source, excluded);\n\n        var key, i;\n\n        if (Object.getOwnPropertySymbols) {\n            var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n            for (i = 0; i < sourceSymbolKeys.length; i++) {\n                key = sourceSymbolKeys[i];\n                if (excluded.indexOf(key) >= 0) continue;\n                if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n                target[key] = source[key];\n            }\n        }\n\n        return target;\n    }\n\n    function _assertThisInitialized(self) {\n        if (self === void 0) {\n            throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n        }\n\n        return self;\n    }\n\n    function _possibleConstructorReturn(self, call) {\n        if (call && (typeof call === 'object' || typeof call === 'function')) {\n            return call;\n        }\n\n        return _assertThisInitialized(self);\n    }\n\n    function _superPropBase(object, property) {\n        while (!Object.prototype.hasOwnProperty.call(object, property)) {\n            object = _getPrototypeOf(object);\n            if (object === null) break;\n        }\n\n        return object;\n    }\n\n    function _get(target, property, receiver) {\n        if (typeof Reflect !== 'undefined' && Reflect.get) {\n            _get = Reflect.get;\n        } else {\n            _get = function _get(target, property, receiver) {\n                var base = _superPropBase(target, property);\n\n                if (!base) return;\n                var desc = Object.getOwnPropertyDescriptor(base, property);\n\n                if (desc.get) {\n                    return desc.get.call(receiver);\n                }\n\n                return desc.value;\n            };\n        }\n\n        return _get(target, property, receiver || target);\n    }\n\n    function set(target, property, value, receiver) {\n        if (typeof Reflect !== 'undefined' && Reflect.set) {\n            set = Reflect.set;\n        } else {\n            set = function set(target, property, value, receiver) {\n                var base = _superPropBase(target, property);\n\n                var desc;\n\n                if (base) {\n                    desc = Object.getOwnPropertyDescriptor(base, property);\n\n                    if (desc.set) {\n                        desc.set.call(receiver, value);\n                        return true;\n                    } else if (!desc.writable) {\n                        return false;\n                    }\n                }\n\n                desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n                if (desc) {\n                    if (!desc.writable) {\n                        return false;\n                    }\n\n                    desc.value = value;\n                    Object.defineProperty(receiver, property, desc);\n                } else {\n                    _defineProperty(receiver, property, value);\n                }\n\n                return true;\n            };\n        }\n\n        return set(target, property, value, receiver);\n    }\n\n    function _set(target, property, value, receiver, isStrict) {\n        var s = set(target, property, value, receiver || target);\n\n        if (!s && isStrict) {\n            throw new Error('failed to set property');\n        }\n\n        return value;\n    }\n\n    function _taggedTemplateLiteral(strings, raw) {\n        if (!raw) {\n            raw = strings.slice(0);\n        }\n\n        return Object.freeze(\n            Object.defineProperties(strings, {\n                raw: {\n                    value: Object.freeze(raw),\n                },\n            })\n        );\n    }\n\n    function _taggedTemplateLiteralLoose(strings, raw) {\n        if (!raw) {\n            raw = strings.slice(0);\n        }\n\n        strings.raw = raw;\n        return strings;\n    }\n\n    function _temporalRef(val, name) {\n        if (val === _temporalUndefined) {\n            throw new ReferenceError(name + ' is not defined - temporal dead zone');\n        } else {\n            return val;\n        }\n    }\n\n    function _readOnlyError(name) {\n        throw new Error('\"' + name + '\" is read-only');\n    }\n\n    function _classNameTDZError(name) {\n        throw new Error('Class \"' + name + '\" cannot be referenced in computed property keys.');\n    }\n\n    var _temporalUndefined = {};\n\n    function _slicedToArray(arr, i) {\n        return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n    }\n\n    function _slicedToArrayLoose(arr, i) {\n        return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _nonIterableRest();\n    }\n\n    function _toArray(arr) {\n        return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n    }\n\n    function _toConsumableArray(arr) {\n        return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n    }\n\n    function _arrayWithoutHoles(arr) {\n        if (Array.isArray(arr)) {\n            for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n            return arr2;\n        }\n    }\n\n    function _arrayWithHoles(arr) {\n        if (Array.isArray(arr)) return arr;\n    }\n\n    function _iterableToArray(iter) {\n        if (\n            Symbol.iterator in Object(iter) ||\n            Object.prototype.toString.call(iter) === '[object Arguments]'\n        )\n            return Array.from(iter);\n    }\n\n    function _iterableToArrayLimit(arr, i) {\n        var _arr = [];\n        var _n = true;\n        var _d = false;\n        var _e = undefined;\n\n        try {\n            for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n                _arr.push(_s.value);\n\n                if (i && _arr.length === i) break;\n            }\n        } catch (err) {\n            _d = true;\n            _e = err;\n        } finally {\n            try {\n                if (!_n && _i['return'] != null) _i['return']();\n            } finally {\n                if (_d) throw _e;\n            }\n        }\n\n        return _arr;\n    }\n\n    function _iterableToArrayLimitLoose(arr, i) {\n        var _arr = [];\n\n        for (var _iterator = arr[Symbol.iterator](), _step; !(_step = _iterator.next()).done; ) {\n            _arr.push(_step.value);\n\n            if (i && _arr.length === i) break;\n        }\n\n        return _arr;\n    }\n\n    function _nonIterableSpread() {\n        throw new TypeError('Invalid attempt to spread non-iterable instance');\n    }\n\n    function _nonIterableRest() {\n        throw new TypeError('Invalid attempt to destructure non-iterable instance');\n    }\n\n    function _skipFirstGeneratorNext(fn) {\n        return function() {\n            var it = fn.apply(this, arguments);\n            it.next();\n            return it;\n        };\n    }\n\n    function _toPrimitive(input, hint) {\n        if (typeof input !== 'object' || input === null) return input;\n        var prim = input[Symbol.toPrimitive];\n\n        if (prim !== undefined) {\n            var res = prim.call(input, hint || 'default');\n            if (typeof res !== 'object') return res;\n            throw new TypeError('@@toPrimitive must return a primitive value.');\n        }\n\n        return (hint === 'string' ? String : Number)(input);\n    }\n\n    function _toPropertyKey(arg) {\n        var key = _toPrimitive(arg, 'string');\n\n        return typeof key === 'symbol' ? key : String(key);\n    }\n\n    function _initializerWarningHelper(descriptor, context) {\n        throw new Error(\n            'Decorating class property failed. Please ensure that ' +\n                'proposal-class-properties is enabled and set to use loose mode. ' +\n                'To use proposal-class-properties in spec mode with decorators, wait for ' +\n                'the next major version of decorators in stage 2.'\n        );\n    }\n\n    function _initializerDefineProperty(target, property, descriptor, context) {\n        if (!descriptor) return;\n        Object.defineProperty(target, property, {\n            enumerable: descriptor.enumerable,\n            configurable: descriptor.configurable,\n            writable: descriptor.writable,\n            value: descriptor.initializer ? descriptor.initializer.call(context) : void 0,\n        });\n    }\n\n    function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n        var desc = {};\n        Object.keys(descriptor).forEach(function(key) {\n            desc[key] = descriptor[key];\n        });\n        desc.enumerable = !!desc.enumerable;\n        desc.configurable = !!desc.configurable;\n\n        if ('value' in desc || desc.initializer) {\n            desc.writable = true;\n        }\n\n        desc = decorators\n            .slice()\n            .reverse()\n            .reduce(function(desc, decorator) {\n                return decorator(target, property, desc) || desc;\n            }, desc);\n\n        if (context && desc.initializer !== void 0) {\n            desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n            desc.initializer = undefined;\n        }\n\n        if (desc.initializer === void 0) {\n            Object.defineProperty(target, property, desc);\n            desc = null;\n        }\n\n        return desc;\n    }\n\n    var id = 0;\n\n    function _classPrivateFieldLooseKey(name) {\n        return '__private_' + id++ + '_' + name;\n    }\n\n    function _classPrivateFieldLooseBase(receiver, privateKey) {\n        if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n            throw new TypeError('attempted to use private field on non-instance');\n        }\n\n        return receiver;\n    }\n\n    function _classPrivateFieldGet(receiver, privateMap) {\n        if (!privateMap.has(receiver)) {\n            throw new TypeError('attempted to get private field on non-instance');\n        }\n\n        var descriptor = privateMap.get(receiver);\n\n        if (descriptor.get) {\n            return descriptor.get.call(receiver);\n        }\n\n        return descriptor.value;\n    }\n\n    function _classPrivateFieldSet(receiver, privateMap, value) {\n        if (!privateMap.has(receiver)) {\n            throw new TypeError('attempted to set private field on non-instance');\n        }\n\n        var descriptor = privateMap.get(receiver);\n\n        if (descriptor.set) {\n            descriptor.set.call(receiver, value);\n        } else {\n            if (!descriptor.writable) {\n                throw new TypeError('attempted to set read only private field');\n            }\n\n            descriptor.value = value;\n        }\n\n        return value;\n    }\n\n    function _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n        if (receiver !== classConstructor) {\n            throw new TypeError('Private static access of wrong provenance');\n        }\n\n        return descriptor.value;\n    }\n\n    function _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n        if (receiver !== classConstructor) {\n            throw new TypeError('Private static access of wrong provenance');\n        }\n\n        if (!descriptor.writable) {\n            throw new TypeError('attempted to set read only private field');\n        }\n\n        descriptor.value = value;\n        return value;\n    }\n\n    function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n        if (receiver !== classConstructor) {\n            throw new TypeError('Private static access of wrong provenance');\n        }\n\n        return method;\n    }\n\n    function _classStaticPrivateMethodSet() {\n        throw new TypeError('attempted to set read only static private field');\n    }\n\n    function _decorate(decorators, factory, superClass, mixins) {\n        var api = _getDecoratorsApi();\n\n        if (mixins) {\n            for (var i = 0; i < mixins.length; i++) {\n                api = mixins[i](api);\n            }\n        }\n\n        var r = factory(function initialize(O) {\n            api.initializeInstanceElements(O, decorated.elements);\n        }, superClass);\n        var decorated = api.decorateClass(\n            _coalesceClassElements(r.d.map(_createElementDescriptor)),\n            decorators\n        );\n        api.initializeClassElements(r.F, decorated.elements);\n        return api.runClassFinishers(r.F, decorated.finishers);\n    }\n\n    function _getDecoratorsApi() {\n        _getDecoratorsApi = function() {\n            return api;\n        };\n\n        var api = {\n            elementsDefinitionOrder: [['method'], ['field']],\n            initializeInstanceElements: function(O, elements) {\n                ['method', 'field'].forEach(function(kind) {\n                    elements.forEach(function(element) {\n                        if (element.kind === kind && element.placement === 'own') {\n                            this.defineClassElement(O, element);\n                        }\n                    }, this);\n                }, this);\n            },\n            initializeClassElements: function(F, elements) {\n                var proto = F.prototype;\n                ['method', 'field'].forEach(function(kind) {\n                    elements.forEach(function(element) {\n                        var placement = element.placement;\n\n                        if (\n                            element.kind === kind &&\n                            (placement === 'static' || placement === 'prototype')\n                        ) {\n                            var receiver = placement === 'static' ? F : proto;\n                            this.defineClassElement(receiver, element);\n                        }\n                    }, this);\n                }, this);\n            },\n            defineClassElement: function(receiver, element) {\n                var descriptor = element.descriptor;\n\n                if (element.kind === 'field') {\n                    var initializer = element.initializer;\n                    descriptor = {\n                        enumerable: descriptor.enumerable,\n                        writable: descriptor.writable,\n                        configurable: descriptor.configurable,\n                        value: initializer === void 0 ? void 0 : initializer.call(receiver),\n                    };\n                }\n\n                Object.defineProperty(receiver, element.key, descriptor);\n            },\n            decorateClass: function(elements, decorators) {\n                var newElements = [];\n                var finishers = [];\n                var placements = {\n                    static: [],\n                    prototype: [],\n                    own: [],\n                };\n                elements.forEach(function(element) {\n                    this.addElementPlacement(element, placements);\n                }, this);\n                elements.forEach(function(element) {\n                    if (!_hasDecorators(element)) return newElements.push(element);\n                    var elementFinishersExtras = this.decorateElement(element, placements);\n                    newElements.push(elementFinishersExtras.element);\n                    newElements.push.apply(newElements, elementFinishersExtras.extras);\n                    finishers.push.apply(finishers, elementFinishersExtras.finishers);\n                }, this);\n\n                if (!decorators) {\n                    return {\n                        elements: newElements,\n                        finishers: finishers,\n                    };\n                }\n\n                var result = this.decorateConstructor(newElements, decorators);\n                finishers.push.apply(finishers, result.finishers);\n                result.finishers = finishers;\n                return result;\n            },\n            addElementPlacement: function(element, placements, silent) {\n                var keys = placements[element.placement];\n\n                if (!silent && keys.indexOf(element.key) !== -1) {\n                    throw new TypeError('Duplicated element (' + element.key + ')');\n                }\n\n                keys.push(element.key);\n            },\n            decorateElement: function(element, placements) {\n                var extras = [];\n                var finishers = [];\n\n                for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n                    var keys = placements[element.placement];\n                    keys.splice(keys.indexOf(element.key), 1);\n                    var elementObject = this.fromElementDescriptor(element);\n                    var elementFinisherExtras = this.toElementFinisherExtras(\n                        (0, decorators[i])(elementObject) || elementObject\n                    );\n                    element = elementFinisherExtras.element;\n                    this.addElementPlacement(element, placements);\n\n                    if (elementFinisherExtras.finisher) {\n                        finishers.push(elementFinisherExtras.finisher);\n                    }\n\n                    var newExtras = elementFinisherExtras.extras;\n\n                    if (newExtras) {\n                        for (var j = 0; j < newExtras.length; j++) {\n                            this.addElementPlacement(newExtras[j], placements);\n                        }\n\n                        extras.push.apply(extras, newExtras);\n                    }\n                }\n\n                return {\n                    element: element,\n                    finishers: finishers,\n                    extras: extras,\n                };\n            },\n            decorateConstructor: function(elements, decorators) {\n                var finishers = [];\n\n                for (var i = decorators.length - 1; i >= 0; i--) {\n                    var obj = this.fromClassDescriptor(elements);\n                    var elementsAndFinisher = this.toClassDescriptor(\n                        (0, decorators[i])(obj) || obj\n                    );\n\n                    if (elementsAndFinisher.finisher !== undefined) {\n                        finishers.push(elementsAndFinisher.finisher);\n                    }\n\n                    if (elementsAndFinisher.elements !== undefined) {\n                        elements = elementsAndFinisher.elements;\n\n                        for (var j = 0; j < elements.length - 1; j++) {\n                            for (var k = j + 1; k < elements.length; k++) {\n                                if (\n                                    elements[j].key === elements[k].key &&\n                                    elements[j].placement === elements[k].placement\n                                ) {\n                                    throw new TypeError(\n                                        'Duplicated element (' + elements[j].key + ')'\n                                    );\n                                }\n                            }\n                        }\n                    }\n                }\n\n                return {\n                    elements: elements,\n                    finishers: finishers,\n                };\n            },\n            fromElementDescriptor: function(element) {\n                var obj = {\n                    kind: element.kind,\n                    key: element.key,\n                    placement: element.placement,\n                    descriptor: element.descriptor,\n                };\n                var desc = {\n                    value: 'Descriptor',\n                    configurable: true,\n                };\n                Object.defineProperty(obj, Symbol.toStringTag, desc);\n                if (element.kind === 'field') obj.initializer = element.initializer;\n                return obj;\n            },\n            toElementDescriptors: function(elementObjects) {\n                if (elementObjects === undefined) return;\n                return _toArray(elementObjects).map(function(elementObject) {\n                    var element = this.toElementDescriptor(elementObject);\n                    this.disallowProperty(elementObject, 'finisher', 'An element descriptor');\n                    this.disallowProperty(elementObject, 'extras', 'An element descriptor');\n                    return element;\n                }, this);\n            },\n            toElementDescriptor: function(elementObject) {\n                var kind = String(elementObject.kind);\n\n                if (kind !== 'method' && kind !== 'field') {\n                    throw new TypeError(\n                        'An element descriptor\\'s .kind property must be either \"method\" or' +\n                            ' \"field\", but a decorator created an element descriptor with' +\n                            ' .kind \"' +\n                            kind +\n                            '\"'\n                    );\n                }\n\n                var key = _toPropertyKey(elementObject.key);\n\n                var placement = String(elementObject.placement);\n\n                if (placement !== 'static' && placement !== 'prototype' && placement !== 'own') {\n                    throw new TypeError(\n                        'An element descriptor\\'s .placement property must be one of \"static\",' +\n                            ' \"prototype\" or \"own\", but a decorator created an element descriptor' +\n                            ' with .placement \"' +\n                            placement +\n                            '\"'\n                    );\n                }\n\n                var descriptor = elementObject.descriptor;\n                this.disallowProperty(elementObject, 'elements', 'An element descriptor');\n                var element = {\n                    kind: kind,\n                    key: key,\n                    placement: placement,\n                    descriptor: Object.assign({}, descriptor),\n                };\n\n                if (kind !== 'field') {\n                    this.disallowProperty(elementObject, 'initializer', 'A method descriptor');\n                } else {\n                    this.disallowProperty(\n                        descriptor,\n                        'get',\n                        'The property descriptor of a field descriptor'\n                    );\n                    this.disallowProperty(\n                        descriptor,\n                        'set',\n                        'The property descriptor of a field descriptor'\n                    );\n                    this.disallowProperty(\n                        descriptor,\n                        'value',\n                        'The property descriptor of a field descriptor'\n                    );\n                    element.initializer = elementObject.initializer;\n                }\n\n                return element;\n            },\n            toElementFinisherExtras: function(elementObject) {\n                var element = this.toElementDescriptor(elementObject);\n\n                var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n                var extras = this.toElementDescriptors(elementObject.extras);\n                return {\n                    element: element,\n                    finisher: finisher,\n                    extras: extras,\n                };\n            },\n            fromClassDescriptor: function(elements) {\n                var obj = {\n                    kind: 'class',\n                    elements: elements.map(this.fromElementDescriptor, this),\n                };\n                var desc = {\n                    value: 'Descriptor',\n                    configurable: true,\n                };\n                Object.defineProperty(obj, Symbol.toStringTag, desc);\n                return obj;\n            },\n            toClassDescriptor: function(obj) {\n                var kind = String(obj.kind);\n\n                if (kind !== 'class') {\n                    throw new TypeError(\n                        'A class descriptor\\'s .kind property must be \"class\", but a decorator' +\n                            ' created a class descriptor with .kind \"' +\n                            kind +\n                            '\"'\n                    );\n                }\n\n                this.disallowProperty(obj, 'key', 'A class descriptor');\n                this.disallowProperty(obj, 'placement', 'A class descriptor');\n                this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n                this.disallowProperty(obj, 'initializer', 'A class descriptor');\n                this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n                var finisher = _optionalCallableProperty(obj, 'finisher');\n\n                var elements = this.toElementDescriptors(obj.elements);\n                return {\n                    elements: elements,\n                    finisher: finisher,\n                };\n            },\n            runClassFinishers: function(constructor, finishers) {\n                for (var i = 0; i < finishers.length; i++) {\n                    var newConstructor = (0, finishers[i])(constructor);\n\n                    if (newConstructor !== undefined) {\n                        if (typeof newConstructor !== 'function') {\n                            throw new TypeError('Finishers must return a constructor.');\n                        }\n\n                        constructor = newConstructor;\n                    }\n                }\n\n                return constructor;\n            },\n            disallowProperty: function(obj, name, objectType) {\n                if (obj[name] !== undefined) {\n                    throw new TypeError(objectType + \" can't have a .\" + name + ' property.');\n                }\n            },\n        };\n        return api;\n    }\n\n    function _createElementDescriptor(def) {\n        var key = _toPropertyKey(def.key);\n\n        var descriptor;\n\n        if (def.kind === 'method') {\n            descriptor = {\n                value: def.value,\n                writable: true,\n                configurable: true,\n                enumerable: false,\n            };\n        } else if (def.kind === 'get') {\n            descriptor = {\n                get: def.value,\n                configurable: true,\n                enumerable: false,\n            };\n        } else if (def.kind === 'set') {\n            descriptor = {\n                set: def.value,\n                configurable: true,\n                enumerable: false,\n            };\n        } else if (def.kind === 'field') {\n            descriptor = {\n                configurable: true,\n                writable: true,\n                enumerable: true,\n            };\n        }\n\n        var element = {\n            kind: def.kind === 'field' ? 'field' : 'method',\n            key: key,\n            placement: def.static ? 'static' : def.kind === 'field' ? 'own' : 'prototype',\n            descriptor: descriptor,\n        };\n        if (def.decorators) element.decorators = def.decorators;\n        if (def.kind === 'field') element.initializer = def.value;\n        return element;\n    }\n\n    function _coalesceGetterSetter(element, other) {\n        if (element.descriptor.get !== undefined) {\n            other.descriptor.get = element.descriptor.get;\n        } else {\n            other.descriptor.set = element.descriptor.set;\n        }\n    }\n\n    function _coalesceClassElements(elements) {\n        var newElements = [];\n\n        var isSameElement = function(other) {\n            return (\n                other.kind === 'method' &&\n                other.key === element.key &&\n                other.placement === element.placement\n            );\n        };\n\n        for (var i = 0; i < elements.length; i++) {\n            var element = elements[i];\n            var other;\n\n            if (element.kind === 'method' && (other = newElements.find(isSameElement))) {\n                if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n                    if (_hasDecorators(element) || _hasDecorators(other)) {\n                        throw new ReferenceError(\n                            'Duplicated methods (' + element.key + \") can't be decorated.\"\n                        );\n                    }\n\n                    other.descriptor = element.descriptor;\n                } else {\n                    if (_hasDecorators(element)) {\n                        if (_hasDecorators(other)) {\n                            throw new ReferenceError(\n                                \"Decorators can't be placed on different accessors with for \" +\n                                    'the same property (' +\n                                    element.key +\n                                    ').'\n                            );\n                        }\n\n                        other.decorators = element.decorators;\n                    }\n\n                    _coalesceGetterSetter(element, other);\n                }\n            } else {\n                newElements.push(element);\n            }\n        }\n\n        return newElements;\n    }\n\n    function _hasDecorators(element) {\n        return element.decorators && element.decorators.length;\n    }\n\n    function _isDataDescriptor(desc) {\n        return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n    }\n\n    function _optionalCallableProperty(obj, name) {\n        var value = obj[name];\n\n        if (value !== undefined && typeof value !== 'function') {\n            throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n        }\n\n        return value;\n    }\n\n    function _classPrivateMethodGet(receiver, privateSet, fn) {\n        if (!privateSet.has(receiver)) {\n            throw new TypeError('attempted to get private field on non-instance');\n        }\n\n        return fn;\n    }\n\n    function _classPrivateMethodSet() {\n        throw new TypeError('attempted to reassign private method');\n    }\n\n    function _wrapRegExp(re, groups) {\n        _wrapRegExp = function(re, groups) {\n            return new BabelRegExp(re, groups);\n        };\n\n        var _RegExp = _wrapNativeSuper(RegExp);\n\n        var _super = RegExp.prototype;\n\n        var _groups = new WeakMap();\n\n        function BabelRegExp(re, groups) {\n            var _this = _RegExp.call(this, re);\n\n            _groups.set(_this, groups);\n\n            return _this;\n        }\n\n        _inherits(BabelRegExp, _RegExp);\n\n        BabelRegExp.prototype.exec = function(str) {\n            var result = _super.exec.call(this, str);\n\n            if (result) result.groups = buildGroups(result, this);\n            return result;\n        };\n\n        BabelRegExp.prototype[Symbol.replace] = function(str, substitution) {\n            if (typeof substitution === 'string') {\n                var groups = _groups.get(this);\n\n                return _super[Symbol.replace].call(\n                    this,\n                    str,\n                    substitution.replace(/\\$<([^>]+)>/g, function(_, name) {\n                        return '$' + groups[name];\n                    })\n                );\n            } else if (typeof substitution === 'function') {\n                var _this = this;\n\n                return _super[Symbol.replace].call(this, str, function() {\n                    var args = [];\n                    args.push.apply(args, arguments);\n\n                    if (typeof args[args.length - 1] !== 'object') {\n                        args.push(buildGroups(args, _this));\n                    }\n\n                    return substitution.apply(this, args);\n                });\n            } else {\n                return _super[Symbol.replace].call(this, str, substitution);\n            }\n        };\n\n        function buildGroups(result, re) {\n            var g = _groups.get(re);\n\n            return Object.keys(g).reduce(function(groups, name) {\n                groups[name] = result[g[name]];\n                return groups;\n            }, Object.create(null));\n        }\n\n        return _wrapRegExp.apply(this, arguments);\n    }\n\n    var MARKUP_RECT = ['x', 'y', 'left', 'top', 'right', 'bottom', 'width', 'height'];\n\n    var toOptionalFraction = function toOptionalFraction(value) {\n        return typeof value === 'string' && /%/.test(value) ? parseFloat(value) / 100 : value;\n    };\n\n    // adds default markup properties, clones markup\n    var prepareMarkup = function prepareMarkup(markup) {\n        var _markup = _slicedToArray(markup, 2),\n            type = _markup[0],\n            props = _markup[1];\n\n        var rect = props.points\n            ? {}\n            : MARKUP_RECT.reduce(function(prev, curr) {\n                  prev[curr] = toOptionalFraction(props[curr]);\n                  return prev;\n              }, {});\n\n        return [\n            type,\n            Object.assign(\n                {\n                    zIndex: 0,\n                },\n                props,\n                rect\n            ),\n        ];\n    };\n\n    var getImageSize = function getImageSize(file) {\n        return new Promise(function(resolve, reject) {\n            var imageElement = new Image();\n            imageElement.src = URL.createObjectURL(file);\n\n            // start testing size\n            var measure = function measure() {\n                var width = imageElement.naturalWidth;\n                var height = imageElement.naturalHeight;\n                var hasSize = width && height;\n                if (!hasSize) return;\n\n                URL.revokeObjectURL(imageElement.src);\n                clearInterval(intervalId);\n                resolve({ width: width, height: height });\n            };\n\n            imageElement.onerror = function(err) {\n                URL.revokeObjectURL(imageElement.src);\n                clearInterval(intervalId);\n                reject(err);\n            };\n\n            var intervalId = setInterval(measure, 1);\n\n            measure();\n        });\n    };\n\n    /**\n     * Polyfill Edge and IE when in Browser\n     */\n    if (typeof window !== 'undefined' && typeof window.document !== 'undefined') {\n        if (!HTMLCanvasElement.prototype.toBlob) {\n            Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n                value: function value(cb, type, quality) {\n                    var canvas = this;\n                    setTimeout(function() {\n                        var dataURL = canvas.toDataURL(type, quality).split(',')[1];\n                        var binStr = atob(dataURL);\n                        var index = binStr.length;\n                        var data = new Uint8Array(index);\n                        while (index--) {\n                            data[index] = binStr.charCodeAt(index);\n                        }\n                        cb(new Blob([data], { type: type || 'image/png' }));\n                    });\n                },\n            });\n        }\n    }\n\n    var isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n    var isIOS = isBrowser && /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n\n    /**\n     * Image Transform Plugin\n     */\n    var plugin = function plugin(_ref) {\n        var addFilter = _ref.addFilter,\n            utils = _ref.utils;\n        var Type = utils.Type,\n            forin = utils.forin,\n            getFileFromBlob = utils.getFileFromBlob,\n            isFile = utils.isFile;\n\n        /**\n         * Helper functions\n         */\n\n        // valid transforms (in correct order)\n        var TRANSFORM_LIST = ['crop', 'resize', 'filter', 'markup', 'output'];\n\n        var createVariantCreator = function createVariantCreator(updateMetadata) {\n            return function(transform, file, metadata) {\n                return transform(file, updateMetadata ? updateMetadata(metadata) : metadata);\n            };\n        };\n\n        var isDefaultCrop = function isDefaultCrop(crop) {\n            return (\n                crop.aspectRatio === null &&\n                crop.rotation === 0 &&\n                crop.zoom === 1 &&\n                crop.center &&\n                crop.center.x === 0.5 &&\n                crop.center.y === 0.5 &&\n                crop.flip &&\n                crop.flip.horizontal === false &&\n                crop.flip.vertical === false\n            );\n        };\n\n        /**\n         * Filters\n         */\n        addFilter('SHOULD_PREPARE_OUTPUT', function(shouldPrepareOutput, _ref2) {\n            var query = _ref2.query;\n            return new Promise(function(resolve) {\n                // If is not async should prepare now\n                resolve(!query('IS_ASYNC'));\n            });\n        });\n\n        var shouldTransformFile = function shouldTransformFile(query, file, item) {\n            return new Promise(function(resolve) {\n                if (\n                    !query('GET_ALLOW_IMAGE_TRANSFORM') ||\n                    item.archived ||\n                    !isFile(file) ||\n                    !isImage(file)\n                ) {\n                    return resolve(false);\n                }\n\n                // if size can't be read this browser doesn't support image\n                getImageSize(file)\n                    .then(function() {\n                        var fn = query('GET_IMAGE_TRANSFORM_IMAGE_FILTER');\n                        if (fn) {\n                            var filterResult = fn(file);\n                            if (filterResult == null) {\n                                // undefined or null\n                                return handleRevert(true);\n                            }\n                            if (typeof filterResult === 'boolean') {\n                                return resolve(filterResult);\n                            }\n                            if (typeof filterResult.then === 'function') {\n                                return filterResult.then(resolve);\n                            }\n                        }\n\n                        resolve(true);\n                    })\n                    .catch(function(err) {\n                        resolve(false);\n                    });\n            });\n        };\n\n        addFilter('DID_CREATE_ITEM', function(item, _ref3) {\n            var query = _ref3.query,\n                dispatch = _ref3.dispatch;\n            if (!query('GET_ALLOW_IMAGE_TRANSFORM')) return;\n\n            item.extend('requestPrepare', function() {\n                return new Promise(function(resolve, reject) {\n                    dispatch(\n                        'REQUEST_PREPARE_OUTPUT',\n                        {\n                            query: item.id,\n                            item: item,\n                            success: resolve,\n                            failure: reject,\n                        },\n\n                        true\n                    );\n                });\n            });\n        });\n\n        // subscribe to file transformations\n        addFilter('PREPARE_OUTPUT', function(file, _ref4) {\n            var query = _ref4.query,\n                item = _ref4.item;\n            return new Promise(function(resolve) {\n                shouldTransformFile(query, file, item).then(function(shouldTransform) {\n                    // no need to transform, exit\n                    if (!shouldTransform) return resolve(file);\n\n                    // get variants\n                    var variants = [];\n\n                    // add original file\n                    if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL')) {\n                        variants.push(function() {\n                            return new Promise(function(resolve) {\n                                resolve({\n                                    name: query('GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME'),\n                                    file: file,\n                                });\n                            });\n                        });\n                    }\n\n                    // add default output version if output default set to true or if no variants defined\n                    if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT')) {\n                        variants.push(function(transform, file, metadata) {\n                            return new Promise(function(resolve) {\n                                transform(file, metadata).then(function(file) {\n                                    return resolve({\n                                        name: query('GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME'),\n\n                                        file: file,\n                                    });\n                                });\n                            });\n                        });\n                    }\n\n                    // get other variants\n                    var variantsDefinition = query('GET_IMAGE_TRANSFORM_VARIANTS') || {};\n                    forin(variantsDefinition, function(key, fn) {\n                        var createVariant = createVariantCreator(fn);\n                        variants.push(function(transform, file, metadata) {\n                            return new Promise(function(resolve) {\n                                createVariant(transform, file, metadata).then(function(file) {\n                                    return resolve({ name: key, file: file });\n                                });\n                            });\n                        });\n                    });\n\n                    // output format (quality 0 => 100)\n                    var qualityAsPercentage = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY');\n                    var qualityMode = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE');\n                    var quality = qualityAsPercentage === null ? null : qualityAsPercentage / 100;\n                    var type = query('GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE');\n                    var clientTransforms =\n                        query('GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS') || TRANSFORM_LIST;\n\n                    // update transform metadata object\n                    item.setMetadata(\n                        'output',\n                        {\n                            type: type,\n                            quality: quality,\n                            client: clientTransforms,\n                        },\n\n                        true\n                    );\n\n                    // the function that is used to apply the file transformations\n                    var transform = function transform(file, metadata) {\n                        return new Promise(function(resolve, reject) {\n                            var filteredMetadata = Object.assign({}, metadata);\n\n                            Object.keys(filteredMetadata)\n                                .filter(function(instruction) {\n                                    return instruction !== 'exif';\n                                })\n                                .forEach(function(instruction) {\n                                    // if not in list, remove from object, the instruction will be handled by the server\n                                    if (clientTransforms.indexOf(instruction) === -1) {\n                                        delete filteredMetadata[instruction];\n                                    }\n                                });\n                            var resize = filteredMetadata.resize,\n                                exif = filteredMetadata.exif,\n                                output = filteredMetadata.output,\n                                crop = filteredMetadata.crop,\n                                filter = filteredMetadata.filter,\n                                markup = filteredMetadata.markup;\n\n                            var instructions = {\n                                image: {\n                                    orientation: exif ? exif.orientation : null,\n                                },\n\n                                output:\n                                    output &&\n                                    (output.type ||\n                                        typeof output.quality === 'number' ||\n                                        output.background)\n                                        ? {\n                                              type: output.type,\n                                              quality:\n                                                  typeof output.quality === 'number'\n                                                      ? output.quality * 100\n                                                      : null,\n                                              background:\n                                                  output.background ||\n                                                  query(\n                                                      'GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR'\n                                                  ) ||\n                                                  null,\n                                          }\n                                        : undefined,\n                                size:\n                                    resize && (resize.size.width || resize.size.height)\n                                        ? Object.assign(\n                                              {\n                                                  mode: resize.mode,\n                                                  upscale: resize.upscale,\n                                              },\n                                              resize.size\n                                          )\n                                        : undefined,\n                                crop:\n                                    crop && !isDefaultCrop(crop)\n                                        ? Object.assign(\n                                              {},\n\n                                              crop\n                                          )\n                                        : undefined,\n                                markup: markup && markup.length ? markup.map(prepareMarkup) : [],\n                                filter: filter,\n                            };\n\n                            if (instructions.output) {\n                                // determine if file type will change\n                                var willChangeType = output.type\n                                    ? // type set\n                                      output.type !== file.type\n                                    : // type not set\n                                      false;\n\n                                var canChangeQuality = /\\/jpe?g$/.test(file.type);\n                                var willChangeQuality =\n                                    output.quality !== null\n                                        ? // quality set\n                                          canChangeQuality && qualityMode === 'always'\n                                        : // quality not set\n                                          false;\n\n                                // determine if file data will be modified\n                                var willModifyImageData = !!(\n                                    instructions.size ||\n                                    instructions.crop ||\n                                    instructions.filter ||\n                                    willChangeType ||\n                                    willChangeQuality\n                                );\n\n                                // if we're not modifying the image data then we don't have to modify the output\n                                if (!willModifyImageData) return resolve(file);\n                            }\n\n                            var options = {\n                                beforeCreateBlob: query('GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB'),\n                                afterCreateBlob: query('GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB'),\n                                canvasMemoryLimit: query('GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT'),\n                                stripImageHead: query(\n                                    'GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD'\n                                ),\n                            };\n\n                            transformImage(file, instructions, options)\n                                .then(function(blob) {\n                                    // set file object\n                                    var out = getFileFromBlob(\n                                        blob,\n                                        // rename the original filename to match the mime type of the output image\n                                        renameFileToMatchMimeType(\n                                            file.name,\n                                            getValidOutputMimeType(blob.type)\n                                        )\n                                    );\n\n                                    resolve(out);\n                                })\n                                .catch(reject);\n                        });\n                    };\n\n                    // start creating variants\n                    var variantPromises = variants.map(function(create) {\n                        return create(transform, file, item.getMetadata());\n                    });\n\n                    // wait for results\n                    Promise.all(variantPromises).then(function(files) {\n                        // if single file object in array, return the single file object else, return array of\n                        resolve(\n                            files.length === 1 && files[0].name === null\n                                ? // return the File object\n                                  files[0].file\n                                : // return an array of files { name:'name', file:File }\n                                  files\n                        );\n                    });\n                });\n            });\n        });\n\n        // Expose plugin options\n        return {\n            options: {\n                allowImageTransform: [true, Type.BOOLEAN],\n\n                // filter images to transform\n                imageTransformImageFilter: [null, Type.FUNCTION],\n\n                // null, 'image/jpeg', 'image/png'\n                imageTransformOutputMimeType: [null, Type.STRING],\n\n                // null, 0 - 100\n                imageTransformOutputQuality: [null, Type.INT],\n\n                // set to false to copy image exif data to output\n                imageTransformOutputStripImageHead: [true, Type.BOOLEAN],\n\n                // only apply transforms in this list\n                imageTransformClientTransforms: [null, Type.ARRAY],\n\n                // only apply output quality when a transform is required\n                imageTransformOutputQualityMode: ['always', Type.STRING],\n                // 'always'\n                // 'optional'\n                // 'mismatch' (future feature, only applied if quality differs from input)\n\n                // get image transform variants\n                imageTransformVariants: [null, Type.OBJECT],\n\n                // should we post the default transformed file\n                imageTransformVariantsIncludeDefault: [true, Type.BOOLEAN],\n\n                // which name to prefix the default transformed file with\n                imageTransformVariantsDefaultName: [null, Type.STRING],\n\n                // should we post the original file\n                imageTransformVariantsIncludeOriginal: [false, Type.BOOLEAN],\n\n                // which name to prefix the original file with\n                imageTransformVariantsOriginalName: ['original_', Type.STRING],\n\n                // called before creating the blob, receives canvas, expects promise resolve with canvas\n                imageTransformBeforeCreateBlob: [null, Type.FUNCTION],\n\n                // expects promise resolved with blob\n                imageTransformAfterCreateBlob: [null, Type.FUNCTION],\n\n                // canvas memory limit\n                imageTransformCanvasMemoryLimit: [\n                    isBrowser && isIOS ? 4096 * 4096 : null,\n                    Type.INT,\n                ],\n\n                // background image of the output canvas\n                imageTransformCanvasBackgroundColor: [null, Type.STRING],\n            },\n        };\n    };\n\n    // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\n    if (isBrowser) {\n        document.dispatchEvent(new CustomEvent('FilePond:pluginloaded', { detail: plugin }));\n    }\n\n    return plugin;\n});\n"]},"metadata":{},"sourceType":"script"}